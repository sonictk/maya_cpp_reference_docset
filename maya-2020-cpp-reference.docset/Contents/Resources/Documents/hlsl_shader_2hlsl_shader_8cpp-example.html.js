var topic = "<!-- saved from url=(0024)http://docs.autodesk.com -->\n\
<html>\n\
   <head><script src=\"../scripts/yepnope.1.5.4-min.js\" type=\"text/javascript\"></script><script src=\"../scripts/lib/jquery-1.11.1.min.js\" type=\"text/javascript\"></script>\n\
      <title>C++ API Reference: hlslShader/hlslShader.cpp</title>\n\
      \n\
	  \n\
      \n\
      \n\
      \n\
      \n\
      \n\
      \n\
      \n\
    \n\
\n\
</head>\n\
   <body height=\"100%\"><div class=\"body_content\" id=\"body-content\"><link rel=\"stylesheet\" type=\"text/css\" href=\"cpp_ref/navtree.css\"><link rel=\"stylesheet\" type=\"text/css\" href=\"cpp_ref/doxygen.css\"><link rel=\"stylesheet\" type=\"text/css\" href=\"cpp_ref/tabs.css\"><link rel=\"stylesheet\" type=\"text/css\" href=\"style/adsk.cpm.css\"><script type=\"text/javascript\">\n\
var tocSystemNeedsToBeLoaded = typeof(cpp_ref_adsk_ref_toc) == \'undefined\';\n\
var weAreIn21 = $(\'div#main.view-active\').length;\n\
var tocPrefix = \'\';\n\
if (weAreIn21)\n\
{ tocPrefix = \'cpp_ref/\'; }\n\
function cpp_ref_initializeToc(forceTrigger) {\n\
    cpp_ref_adsk_ref_toc.initResizable();\n\
    cpp_ref_adsk_ref_toc.initNavTree(\'hlsl_shader_2hlsl_shader_8cpp-example.html\', tocPrefix);\n\
    dQuery(document).trigger(\'toc_initialized\');\n\
}\n\
if (tocSystemNeedsToBeLoaded)\n\
{\n\
	yepnope([{\n\
	load:[tocPrefix + \'json3.min.js\', tocPrefix + \'jquery.js\', tocPrefix + \'ref-toc-controller.js\', tocPrefix + \'dynsections.js\'],\n\
	complete: function() {\n\
	  if (typeof(dQuery) == \'undefined\')\n\
	  {\n\
	    dQuery = jQuery.noConflict(true);\n\
	  }\n\
	  else { jQuery.noConflict(true); }\n\
	  $(document).ready(cpp_ref_initializeToc);\n\
	}\n\
 	}])\n\
}\n\
if (!weAreIn21) { // if in AKN...\n\
$(window).load( function() {\n\
    setTimeout( function() {\n\
        var content = $(\'body > div\').not(\'#body-content\');     // take any divs under body that are not id=body-content\n\
        content.each( function() { \n\
            $(this).css( { \'padding-left\': $(this).css(\'margin-left\') } );       // and if they have any padding-left already, move it to margin-left.\n\
        } );\n\
        var width = cpp_ref_adsk_ref_toc.readFromStorage(\'width\');\n\
        content.css({marginLeft:parseInt(width)+6+\"px\"});\n\
    }, 100);\n\
} ); \n\
}\n\
</script><script>\n\
 if (!tocSystemNeedsToBeLoaded) { cpp_ref_initializeToc(); }\n\
 </script>\n\
      <div>\n\
         <div class=\"head\">\n\
            <h1>C++ API Reference: hlslShader/hlslShader.cpp</h1>\n\
         </div>\n\
\n\
<div id=\"top\"><!-- do not remove this div, it is closed by doxygen! -->\n\
\n\
<!-- end header part -->\n\
<!-- Generated by Doxygen 1.8.10 -->\n\
\n\
  <div id=\"navrow1\" class=\"tabs\">\n\
    <ul class=\"tablist\">\n\
      <li><a href=\"#!/url=./cpp_ref/index.html\"><span>Main&#160;Page</span></a></li>\n\
      <li><a href=\"#!/url=./cpp_ref/pages.html\"><span>Related&#160;Pages</span></a></li>\n\
      <li><a href=\"#!/url=./cpp_ref/modules.html\"><span>Modules</span></a></li>\n\
      <li><a href=\"#!/url=./cpp_ref/namespaces.html\"><span>Namespaces</span></a></li>\n\
      <li><a href=\"#!/url=./cpp_ref/annotated.html\"><span>Classes</span></a></li>\n\
      <li><a href=\"#!/url=./cpp_ref/examples.html\"><span>Examples</span></a></li>\n\
      <li>\n\
        <div id=\"MSearchBox\" class=\"MSearchBoxInactive\">\n\
        <span class=\"left\">\n\
          <img id=\"MSearchSelect\" src=\"cpp_ref/search/mag_sel.png\" onmouseover=\"return searchBox.OnSearchSelectShow()\" onmouseout=\"return searchBox.OnSearchSelectHide()\" alt=\"\">\n\
          <input type=\"text\" id=\"MSearchField\" value=\"Search\" accesskey=\"S\" onfocus=\"searchBox.OnSearchFieldFocus(true)\" onblur=\"searchBox.OnSearchFieldFocus(false)\" onkeyup=\"searchBox.OnSearchFieldChange(event)\">\n\
          </span><span class=\"right\">\n\
            <a id=\"MSearchClose\" href=\"javascript:searchBox.CloseResultsWindow()\"><img id=\"MSearchCloseImg\" border=\"0\" src=\"cpp_ref/search/close.png\" alt=\"\"></a>\n\
          </span>\n\
        </div>\n\
      </li>\n\
    </ul>\n\
  </div>\n\
</div><!-- top -->\n\
<div id=\"side-nav\" class=\"ui-resizable side-nav-resizable\">\n\
  <div id=\"nav-tree\">\n\
    <div id=\"nav-tree-contents\">\n\
      <div id=\"nav-sync\" class=\"sync\"></div>\n\
    </div>\n\
  </div>\n\
  <div id=\"splitbar\" style=\"-moz-user-select:none;\" class=\"ui-resizable-handle\">\n\
  </div>\n\
</div>\n\
\n\
<div id=\"doc-content\">\n\
<!-- window showing the filter options -->\n\
\n\
\n\
<!-- iframe showing the search results (closed by default) -->\n\
\n\
\n\
<div class=\"header\">\n\
  <div class=\"headertitle\">\n\
<div class=\"title\">hlslShader/hlslShader.cpp</div>  </div>\n\
</div><!--header-->\n\
<div class=\"contents\">\n\
<div class=\"fragment\"><div class=\"line\"><span class=\"comment\">//-</span></div>\n\
<div class=\"line\"><span class=\"comment\">// ==========================================================================</span></div>\n\
<div class=\"line\"><span class=\"comment\">// Copyright 1995,2006,2008 Autodesk, Inc. All rights reserved.</span></div>\n\
<div class=\"line\"><span class=\"comment\">//</span></div>\n\
<div class=\"line\"><span class=\"comment\">// Use of this software is subject to the terms of the Autodesk</span></div>\n\
<div class=\"line\"><span class=\"comment\">// license agreement provided at the time of installation or download,</span></div>\n\
<div class=\"line\"><span class=\"comment\">// or which otherwise accompanies this software in either electronic</span></div>\n\
<div class=\"line\"><span class=\"comment\">// or hard copy form.</span></div>\n\
<div class=\"line\"><span class=\"comment\">// ==========================================================================</span></div>\n\
<div class=\"line\"><span class=\"comment\">//+</span></div>\n\
<div class=\"line\"><span class=\"preprocessor\">#ifndef HLSL_VERSION  </span></div>\n\
<div class=\"line\"><span class=\"preprocessor\">#define HLSL_VERSION  &quot;1.0&quot;</span></div>\n\
<div class=\"line\"><span class=\"preprocessor\">#endif</span></div>\n\
<div class=\"line\"><span class=\"preprocessor\">#define ERROR_LIMIT 20</span></div>\n\
<div class=\"line\"><span class=\"comment\">//#define VALIDATE_TECHNIQUE_LIST</span></div>\n\
<div class=\"line\"><span class=\"comment\">//#define VALIDATE_TECHNIQUES</span></div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"><span class=\"comment\">// Now, because we&#39;re rendering from system memory, DirectX can start to get</span></div>\n\
<div class=\"line\"><span class=\"comment\">// suspicious that the graphics driver has hung if we try and render too much</span></div>\n\
<div class=\"line\"><span class=\"comment\">// stuff in a single call. So, we&#39;ll take stability over performance and</span></div>\n\
<div class=\"line\"><span class=\"comment\">// split up the draw. Given we only do this for large amounts of geometry, the</span></div>\n\
<div class=\"line\"><span class=\"comment\">// hit shouldn&#39;t be too bad. Commenting this #define out will cause the plugin</span></div>\n\
<div class=\"line\"><span class=\"comment\">// to try and render everything in a single render call, no matter how large </span></div>\n\
<div class=\"line\"><span class=\"comment\">// it is (which seems to work on some graphics cards, but not others)</span></div>\n\
<div class=\"line\"><span class=\"preprocessor\">#define MAX_SEGMENTED_BATCH_SIZE 40000</span></div>\n\
<div class=\"line\"> </div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"><span class=\"preprocessor\">#include &quot;hlslShader.h&quot;</span></div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"><span class=\"preprocessor\">#include &lt;maya/MGlobal.h&gt;</span></div>\n\
<div class=\"line\"><span class=\"preprocessor\">#include &lt;maya/MGeometry.h&gt;</span></div>\n\
<div class=\"line\"><span class=\"preprocessor\">#include &lt;maya/MGeometryData.h&gt;</span></div>\n\
<div class=\"line\"><span class=\"preprocessor\">#include &lt;maya/MGeometryPrimitive.h&gt;</span></div>\n\
<div class=\"line\"><span class=\"preprocessor\">#include &lt;maya/MGeometryList.h&gt;</span></div>\n\
<div class=\"line\"><span class=\"preprocessor\">#include &lt;maya/MGeometryManager.h&gt;</span></div>\n\
<div class=\"line\"><span class=\"preprocessor\">#include &lt;maya/MVaryingParameterList.h&gt;</span></div>\n\
<div class=\"line\"><span class=\"preprocessor\">#include &lt;maya/MUniformParameter.h&gt;</span></div>\n\
<div class=\"line\"><span class=\"preprocessor\">#include &lt;maya/MGlobal.h&gt;</span></div>\n\
<div class=\"line\"><span class=\"preprocessor\">#include &lt;maya/MFnDependencyNode.h&gt;</span></div>\n\
<div class=\"line\"><span class=\"preprocessor\">#include &lt;maya/MFnTypedAttribute.h&gt;</span></div>\n\
<div class=\"line\"><span class=\"preprocessor\">#include &lt;maya/MFnStringData.h&gt;</span></div>\n\
<div class=\"line\"><span class=\"preprocessor\">#include &lt;maya/MFnStringArrayData.h&gt;</span></div>\n\
<div class=\"line\"><span class=\"preprocessor\">#include &lt;maya/MSceneMessage.h&gt;</span></div>\n\
<div class=\"line\"><span class=\"preprocessor\">#include &lt;maya/MFileIO.h&gt;</span></div>\n\
<div class=\"line\"><span class=\"preprocessor\">#include &lt;maya/MMatrix.h&gt;</span></div>\n\
<div class=\"line\"><span class=\"preprocessor\">#include &lt;maya/MFileObject.h&gt;</span></div>\n\
<div class=\"line\"><span class=\"preprocessor\">#include &lt;maya/MArgParser.h&gt;</span></div>\n\
<div class=\"line\"><span class=\"preprocessor\">#include &lt;maya/MSyntax.h&gt;</span></div>\n\
<div class=\"line\"><span class=\"preprocessor\">#include &lt;maya/MPointArray.h&gt;</span></div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"><span class=\"preprocessor\">#include &lt;maya/MD3D9Renderer.h&gt;</span></div>\n\
<div class=\"line\"><span class=\"preprocessor\">#include &lt;maya/MHwrCallback.h&gt;</span></div>\n\
<div class=\"line\"><span class=\"preprocessor\">#include &lt;stdio.h&gt;</span></div>\n\
<div class=\"line\"><span class=\"preprocessor\">#include &lt;new.h&gt;</span> <span class=\"comment\">// for fancy pants re-initialisation of existing memory version</span></div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"><span class=\"comment\">// For swatch rendering</span></div>\n\
<div class=\"line\"><span class=\"preprocessor\">#include &lt;maya/MHardwareRenderer.h&gt;</span></div>\n\
<div class=\"line\"><span class=\"preprocessor\">#include &lt;maya/MHWShaderSwatchGenerator.h&gt;</span></div>\n\
<div class=\"line\"><span class=\"preprocessor\">#include &lt;maya/MGeometryRequirements.h&gt;</span></div>\n\
<div class=\"line\"><span class=\"preprocessor\">#include &lt;maya/MHwTextureManager.h&gt;</span></div>\n\
<div class=\"line\"><span class=\"preprocessor\">#include &lt;maya/MImageFileInfo.h&gt;</span></div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"><span class=\"comment\">// For vp2.0</span></div>\n\
<div class=\"line\"><span class=\"preprocessor\">#include &lt;maya/MViewport2Renderer.h&gt;</span></div>\n\
<div class=\"line\"><span class=\"preprocessor\">#include &lt;maya/MDrawContext.h&gt;</span></div>\n\
<div class=\"line\"><span class=\"preprocessor\">#include &lt;maya/MRenderUtilities.h&gt;</span></div>\n\
<div class=\"line\"><span class=\"preprocessor\">#include &lt;maya/MTextureManager.h&gt;</span></div>\n\
<div class=\"line\"><span class=\"preprocessor\">#include &lt;maya/MUIDrawManager.h&gt;</span></div>\n\
<div class=\"line\"><span class=\"preprocessor\">#include &lt;maya/MGL.h&gt;</span></div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"><span class=\"preprocessor\">#include &lt;sys/stat.h&gt;</span></div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"><span class=\"comment\">// Debugging</span></div>\n\
<div class=\"line\"><span class=\"preprocessor\">#define DEBUG_TEXTURE_CACHE(X) </span></div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">class</span> T&gt; <span class=\"keyword\">class </span>ObjArray</div>\n\
<div class=\"line\">{</div>\n\
<div class=\"line\"><span class=\"keyword\">public</span>:</div>\n\
<div class=\"line\">    <span class=\"keyword\">inline</span>      ObjArray() : fLength( 0), fCapacity( 0), fData( NULL) {}</div>\n\
<div class=\"line\">    <span class=\"keyword\">inline</span>      ~ObjArray() { <span class=\"keywordflow\">if</span>( fData) { destroy( 0, fLength); <span class=\"keyword\">delete</span>[] ((<span class=\"keywordtype\">char</span>*)fData); } } <span class=\"comment\">// Don&#39;t call the destructors here, destroy did it!</span></div>\n\
<div class=\"line\">    <span class=\"keyword\">inline</span> <span class=\"keywordtype\">int</span>  length()<span class=\"keyword\"> const </span>{ <span class=\"keywordflow\">return</span> fLength; }</div>\n\
<div class=\"line\">    <span class=\"keyword\">inline</span> <span class=\"keywordtype\">void</span> length( <span class=\"keywordtype\">int</span> l) { <span class=\"keywordflow\">if</span>( l &gt; fLength) { <span class=\"keywordflow\">if</span>( l &gt; fCapacity) resize( l); create( fLength, l); } <span class=\"keywordflow\">else</span> <span class=\"keywordflow\">if</span>( l &lt; fLength) destroy( l, fLength); fLength = l; }</div>\n\
<div class=\"line\">    <span class=\"keyword\">inline</span> <span class=\"keyword\">const</span> T&amp; operator[]( <span class=\"keywordtype\">int</span> i)<span class=\"keyword\"> const </span>{ <span class=\"keywordflow\">return</span> fData[ i]; }</div>\n\
<div class=\"line\">    <span class=\"keyword\">inline</span> T&amp;   operator[]( <span class=\"keywordtype\">int</span> i) { <span class=\"keywordflow\">return</span> fData[ i]; }</div>\n\
<div class=\"line\"><span class=\"keyword\">private</span>:</div>\n\
<div class=\"line\">    <span class=\"keyword\">inline</span> <span class=\"keywordtype\">void</span> create( <span class=\"keywordtype\">int</span> s, <span class=\"keywordtype\">int</span> e) { <span class=\"keywordflow\">for</span>( ; s &lt; e; s++) <span class=\"keyword\">new</span> ((<span class=\"keywordtype\">void</span>*)(fData + s)) T; }</div>\n\
<div class=\"line\">    <span class=\"keyword\">inline</span> <span class=\"keywordtype\">void</span> destroy( <span class=\"keywordtype\">int</span> s, <span class=\"keywordtype\">int</span> e) { <span class=\"keywordflow\">for</span>( ; s &lt; e; s++) (fData + s)-&gt;T::~T(); }</div>\n\
<div class=\"line\">    <span class=\"keyword\">enum</span></div>\n\
<div class=\"line\">    {</div>\n\
<div class=\"line\">        MIN_ARRAY_SIZE = 4</div>\n\
<div class=\"line\">    };</div>\n\
<div class=\"line\">    <span class=\"keyword\">inline</span> <span class=\"keywordtype\">void</span> resize( <span class=\"keywordtype\">int</span> l) </div>\n\
<div class=\"line\">    { </div>\n\
<div class=\"line\">        <span class=\"keywordflow\">if</span>( l &lt; MIN_ARRAY_SIZE) l = MIN_ARRAY_SIZE; </div>\n\
<div class=\"line\">        <span class=\"keywordflow\">else</span> <span class=\"keywordflow\">if</span>( l &lt; fCapacity * 2) l = fCapacity * 2; </div>\n\
<div class=\"line\">        T* newData = (T*)<span class=\"keyword\">new</span> <span class=\"keywordtype\">char</span>[ l * <span class=\"keyword\">sizeof</span>( T)]; </div>\n\
<div class=\"line\">        <span class=\"keywordflow\">if</span>( fData) </div>\n\
<div class=\"line\">        { </div>\n\
<div class=\"line\">            memcpy( newData, fData, fCapacity * <span class=\"keyword\">sizeof</span>( T)); </div>\n\
<div class=\"line\">            <span class=\"keyword\">delete</span>[] ((<span class=\"keywordtype\">char</span>*)fData); </div>\n\
<div class=\"line\">        } </div>\n\
<div class=\"line\">        fData = newData; </div>\n\
<div class=\"line\">        fCapacity = l; </div>\n\
<div class=\"line\">    }</div>\n\
<div class=\"line\">    <span class=\"keywordtype\">int</span>         fLength;</div>\n\
<div class=\"line\">    <span class=\"keywordtype\">int</span>         fCapacity;</div>\n\
<div class=\"line\">    T*          fData;</div>\n\
<div class=\"line\">};</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"><span class=\"comment\">// setup device callbacks as needed</span></div>\n\
<div class=\"line\"><span class=\"comment\">// currently this class defined in hlslShader.h</span></div>\n\
<div class=\"line\"><span class=\"comment\">//</span></div>\n\
<div class=\"line\"><span class=\"keywordtype\">void</span> hlslDeviceManager::deviceNew()</div>\n\
<div class=\"line\">{</div>\n\
<div class=\"line\">    fState = kValid;</div>\n\
<div class=\"line\">    <span class=\"comment\">//printf(&quot;calling setShader with name: %s\\n&quot;, fShader.fShader.asChar() );   </span></div>\n\
<div class=\"line\">    fShader.setShader( fShader.fShader);</div>\n\
<div class=\"line\">}</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"><span class=\"keywordtype\">void</span> hlslDeviceManager::deviceLost()</div>\n\
<div class=\"line\">{</div>\n\
<div class=\"line\">    fState = kInvalid;</div>\n\
<div class=\"line\">    <span class=\"comment\">//printf(&quot;devLost: releasing %s handles\\n&quot;, fShader.fShader.asChar() );</span></div>\n\
<div class=\"line\">    fShader.release();</div>\n\
<div class=\"line\">}</div>\n\
<div class=\"line\"><span class=\"keywordtype\">void</span> hlslDeviceManager::deviceDeleted()</div>\n\
<div class=\"line\">{</div>\n\
<div class=\"line\">    fState = kInvalid;</div>\n\
<div class=\"line\">    <span class=\"comment\">//printf(&quot;devDeleted: releasing %s handles\\n&quot;, fShader.fShader.asChar() );</span></div>\n\
<div class=\"line\">    fShader.release();</div>\n\
<div class=\"line\">}</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"><span class=\"keywordtype\">void</span> hlslDeviceManager::deviceReset()</div>\n\
<div class=\"line\">{</div>\n\
<div class=\"line\">    fState = kReset;</div>\n\
<div class=\"line\">    <span class=\"comment\">//printf(&quot;devRest: releasing %s handles\\n&quot;, fShader.fShader.asChar() );</span></div>\n\
<div class=\"line\">}</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"><span class=\"keywordtype\">void</span> hlslDeviceManager::resetShader()</div>\n\
<div class=\"line\">{</div>\n\
<div class=\"line\">    fState = kValid;</div>\n\
<div class=\"line\">    fShader.setShader( fShader.fShader);</div>\n\
<div class=\"line\">    <span class=\"comment\">//printf(&quot;resetShader: releasing %s handles\\n&quot;, fShader.fShader.asChar() );</span></div>\n\
<div class=\"line\">}</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"><span class=\"comment\">//</span></div>\n\
<div class=\"line\"><span class=\"comment\">// Lookup tables for the (default) names and internal semantics</span></div>\n\
<div class=\"line\"><span class=\"comment\">// that map to D3D&#39;s usage types</span></div>\n\
<div class=\"line\"><span class=\"comment\">//</span></div>\n\
<div class=\"line\"><span class=\"keyword\">struct </span>SemanticInfo</div>\n\
<div class=\"line\">{</div>\n\
<div class=\"line\">    <span class=\"keyword\">const</span> <span class=\"keywordtype\">char</span>* Name;</div>\n\
<div class=\"line\">    MVaryingParameter::MVaryingParameterSemantic Type;</div>\n\
<div class=\"line\">    <span class=\"keywordtype\">int</span>         MinElements;</div>\n\
<div class=\"line\">    <span class=\"keywordtype\">int</span>         MaxElements;</div>\n\
<div class=\"line\">    BYTE        D3DType;</div>\n\
<div class=\"line\">};</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">SemanticInfo gSemanticInfo[] = </div>\n\
<div class=\"line\">{ </div>\n\
<div class=\"line\">    <span class=\"stringliteral\">&quot;Position&quot;</span>,             MVaryingParameter::kPosition,       2, 4,       D3DDECLTYPE_FLOAT3,     </div>\n\
<div class=\"line\">    <span class=\"stringliteral\">&quot;BlendWeight&quot;</span>,          MVaryingParameter::kNoSemantic,     1, 4,       D3DDECLTYPE_FLOAT4,</div>\n\
<div class=\"line\">    <span class=\"stringliteral\">&quot;BlendIndices&quot;</span>,         MVaryingParameter::kNoSemantic,     1, 4,       D3DDECLTYPE_FLOAT4, </div>\n\
<div class=\"line\">    <span class=\"stringliteral\">&quot;Normal&quot;</span>,               MVaryingParameter::kNormal,         3, 4,       D3DDECLTYPE_FLOAT3, </div>\n\
<div class=\"line\">    <span class=\"stringliteral\">&quot;PointSize&quot;</span>,            MVaryingParameter::kNoSemantic,     1, 4,       D3DDECLTYPE_FLOAT3, </div>\n\
<div class=\"line\">    <span class=\"stringliteral\">&quot;UV&quot;</span>,                   MVaryingParameter::kTexCoord,       2, 4,       D3DDECLTYPE_FLOAT2,</div>\n\
<div class=\"line\">    <span class=\"stringliteral\">&quot;Tangent&quot;</span>,              MVaryingParameter::kTangent,        3, 4,       D3DDECLTYPE_FLOAT3, </div>\n\
<div class=\"line\">    <span class=\"stringliteral\">&quot;BiNormal&quot;</span>,             MVaryingParameter::kBinormal,       3, 4,       D3DDECLTYPE_FLOAT3, </div>\n\
<div class=\"line\">    <span class=\"stringliteral\">&quot;TesselateFactor&quot;</span>,      MVaryingParameter::kNoSemantic,     1, 4,       D3DDECLTYPE_FLOAT4, </div>\n\
<div class=\"line\">    <span class=\"stringliteral\">&quot;PositionTransformed&quot;</span>,  MVaryingParameter::kNoSemantic,     1, 4,       D3DDECLTYPE_FLOAT4, </div>\n\
<div class=\"line\">    <span class=\"stringliteral\">&quot;Color&quot;</span>,                MVaryingParameter::kColor,          3, 4,       D3DDECLTYPE_FLOAT4, </div>\n\
<div class=\"line\">    <span class=\"stringliteral\">&quot;Fog&quot;</span>,                  MVaryingParameter::kNoSemantic,     1, 4,       D3DDECLTYPE_FLOAT4, </div>\n\
<div class=\"line\">    <span class=\"stringliteral\">&quot;Depth&quot;</span>,                MVaryingParameter::kNoSemantic,     1, 4,       D3DDECLTYPE_FLOAT4, </div>\n\
<div class=\"line\">    <span class=\"stringliteral\">&quot;Sample&quot;</span>,               MVaryingParameter::kNoSemantic,     1, 4,       D3DDECLTYPE_FLOAT4,</div>\n\
<div class=\"line\">};</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"><span class=\"comment\">//</span></div>\n\
<div class=\"line\"><span class=\"comment\">// A wee state manager used to flip from DX to GL culling handed-ness</span></div>\n\
<div class=\"line\"><span class=\"comment\">//</span></div>\n\
<div class=\"line\"><span class=\"keyword\">class </span>HLSLStateManager : <span class=\"keyword\">public</span> ID3DXEffectStateManager</div>\n\
<div class=\"line\">{</div>\n\
<div class=\"line\"><span class=\"keyword\">public</span>:</div>\n\
<div class=\"line\">    <span class=\"keyword\">static</span> HLSLStateManager sInstance;</div>\n\
<div class=\"line\">    <span class=\"keyword\">inline</span> HLSLStateManager() : fShapeCullMode( <a name=\"_a0\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_list.html\">MGeometryList</a>::kCullCW), fShaderCullMode( D3DCULL_CCW) {}</div>\n\
<div class=\"line\">    </div>\n\
<div class=\"line\">    <span class=\"comment\">// Set the cull mode Maya needs</span></div>\n\
<div class=\"line\">    <span class=\"keyword\">inline</span> <span class=\"keywordtype\">void</span> shapeCullMode( <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_list.html#ae8a071ea1afbb0c50330deec77c8c2c4\">MGeometryList::MCullMode</a> cullMode, <span class=\"keywordtype\">bool</span> ignoreShaderCullMode = <span class=\"keyword\">false</span>) </div>\n\
<div class=\"line\">    { </div>\n\
<div class=\"line\">        fShapeCullMode = cullMode; </div>\n\
<div class=\"line\">        <span class=\"keywordflow\">if</span>( ignoreShaderCullMode) fShaderSetCullMode = <span class=\"keyword\">false</span>;</div>\n\
<div class=\"line\">        setupCulling(); </div>\n\
<div class=\"line\">    }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <span class=\"comment\">// Reverse the cull direction if we need &quot;normal&quot; OpenGL culling as DirectX</span></div>\n\
<div class=\"line\">    <span class=\"comment\">// has the opposite &quot;handedness&quot; to GL</span></div>\n\
<div class=\"line\">    STDMETHOD(SetRenderState)(THIS_ D3DRENDERSTATETYPE d3dRenderState, DWORD dwValue ) </div>\n\
<div class=\"line\">    { </div>\n\
<div class=\"line\">        <span class=\"keywordflow\">if</span>( d3dRenderState == D3DRS_CULLMODE)</div>\n\
<div class=\"line\">        {</div>\n\
<div class=\"line\">            fShaderCullMode = dwValue;</div>\n\
<div class=\"line\">            fShaderSetCullMode = <span class=\"keyword\">true</span>;</div>\n\
<div class=\"line\">            <span class=\"keywordflow\">return</span> D3D_OK;</div>\n\
<div class=\"line\">        }</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">return</span> fD3DDevice-&gt;SetRenderState( d3dRenderState, dwValue ); </div>\n\
<div class=\"line\">    }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <span class=\"comment\">// Helper to setup a pass tracking whether cull direction was explicitly set, and reversing it if it was</span></div>\n\
<div class=\"line\">    <span class=\"keyword\">inline</span> <span class=\"keywordtype\">void</span> BeginPass( LPD3DXEFFECT effect, <span class=\"keywordtype\">int</span> pass) </div>\n\
<div class=\"line\">    { </div>\n\
<div class=\"line\">        fShaderSetCullMode = <span class=\"keyword\">false</span>;</div>\n\
<div class=\"line\">        effect-&gt;BeginPass( pass); </div>\n\
<div class=\"line\">        setupCulling();</div>\n\
<div class=\"line\">    }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <span class=\"comment\">// Default implementations</span></div>\n\
<div class=\"line\">    STDMETHOD(SetSamplerState)(THIS_ DWORD dwStage, D3DSAMPLERSTATETYPE d3dSamplerState, DWORD dwValue ) { <span class=\"keywordflow\">return</span> fD3DDevice-&gt;SetSamplerState( dwStage, d3dSamplerState, dwValue ); }</div>\n\
<div class=\"line\">    STDMETHOD(SetTextureStageState)(THIS_ DWORD dwStage, D3DTEXTURESTAGESTATETYPE d3dTextureStageState, DWORD dwValue ) { <span class=\"keywordflow\">return</span> fD3DDevice-&gt;SetTextureStageState( dwStage, d3dTextureStageState, dwValue ); }</div>\n\
<div class=\"line\">    STDMETHOD(SetTexture)(THIS_ DWORD dwStage, LPDIRECT3DBASETEXTURE9 pTexture ) { <span class=\"keywordflow\">return</span> fD3DDevice-&gt;SetTexture( dwStage, pTexture ); }</div>\n\
<div class=\"line\">    STDMETHOD(SetVertexShader)(THIS_ LPDIRECT3DVERTEXSHADER9 pShader ) { <span class=\"keywordflow\">return</span> fD3DDevice-&gt;SetVertexShader( pShader ); }</div>\n\
<div class=\"line\">    STDMETHOD(SetPixelShader)(THIS_ LPDIRECT3DPIXELSHADER9 pShader ) { <span class=\"keywordflow\">return</span> fD3DDevice-&gt;SetPixelShader( pShader ); }</div>\n\
<div class=\"line\">    STDMETHOD(SetFVF)(THIS_ DWORD dwFVF ) { <span class=\"keywordflow\">return</span> fD3DDevice-&gt;SetFVF( dwFVF ); }</div>\n\
<div class=\"line\">    STDMETHOD(SetTransform)(THIS_ D3DTRANSFORMSTATETYPE State, CONST D3DMATRIX *pMatrix ) { <span class=\"keywordflow\">return</span> fD3DDevice-&gt;SetTransform( State, pMatrix ); }</div>\n\
<div class=\"line\">    STDMETHOD(SetMaterial)(THIS_ CONST D3DMATERIAL9 *pMaterial ) { <span class=\"keywordflow\">return</span> fD3DDevice-&gt;SetMaterial( pMaterial ); }</div>\n\
<div class=\"line\">    STDMETHOD(SetLight)(THIS_ DWORD Index, CONST D3DLIGHT9 *pLight ) { <span class=\"keywordflow\">return</span> fD3DDevice-&gt;SetLight( Index, pLight ); }</div>\n\
<div class=\"line\">    STDMETHOD(LightEnable)(THIS_ DWORD Index, BOOL Enable ) { <span class=\"keywordflow\">return</span> fD3DDevice-&gt;LightEnable( Index, Enable ); }</div>\n\
<div class=\"line\">    STDMETHOD(SetNPatchMode)(THIS_ FLOAT NumSegments ) { <span class=\"keywordflow\">return</span> fD3DDevice-&gt;SetNPatchMode( NumSegments ); }</div>\n\
<div class=\"line\">    STDMETHOD(SetVertexShaderConstantF)(THIS_ UINT RegisterIndex, CONST FLOAT *pConstantData, UINT RegisterCount ) { <span class=\"keywordflow\">return</span> fD3DDevice-&gt;SetVertexShaderConstantF( RegisterIndex, pConstantData, RegisterCount ); }</div>\n\
<div class=\"line\">    STDMETHOD(SetVertexShaderConstantI)(THIS_ UINT RegisterIndex, CONST INT *pConstantData, UINT RegisterCount ) { <span class=\"keywordflow\">return</span> fD3DDevice-&gt;SetVertexShaderConstantI( RegisterIndex, pConstantData, RegisterCount ); }</div>\n\
<div class=\"line\">    STDMETHOD(SetVertexShaderConstantB)(THIS_ UINT RegisterIndex, CONST BOOL *pConstantData, UINT RegisterCount ) { <span class=\"keywordflow\">return</span> fD3DDevice-&gt;SetVertexShaderConstantB( RegisterIndex, pConstantData, RegisterCount ); }</div>\n\
<div class=\"line\">    STDMETHOD(SetPixelShaderConstantF)(THIS_ UINT RegisterIndex, CONST FLOAT *pConstantData, UINT RegisterCount ) { <span class=\"keywordflow\">return</span> fD3DDevice-&gt;SetPixelShaderConstantF( RegisterIndex, pConstantData, RegisterCount ); }</div>\n\
<div class=\"line\">    STDMETHOD(SetPixelShaderConstantI)(THIS_ UINT RegisterIndex, CONST INT *pConstantData, UINT RegisterCount ) { <span class=\"keywordflow\">return</span> fD3DDevice-&gt;SetPixelShaderConstantI( RegisterIndex, pConstantData, RegisterCount ); }</div>\n\
<div class=\"line\">    STDMETHOD(SetPixelShaderConstantB)(THIS_ UINT RegisterIndex, CONST BOOL *pConstantData, UINT RegisterCount ) { <span class=\"keywordflow\">return</span> fD3DDevice-&gt;SetPixelShaderConstantB( RegisterIndex, pConstantData, RegisterCount ); }</div>\n\
<div class=\"line\">    STDMETHOD(QueryInterface)(THIS_ REFIID iid, LPVOID *ppv) { <span class=\"keywordflow\">if</span> (iid == IID_IUnknown || iid == IID_ID3DXEffectStateManager) { *ppv = <span class=\"keyword\">static_cast&lt;</span>ID3DXEffectStateManager*<span class=\"keyword\">&gt;</span>(<span class=\"keyword\">this</span>); } <span class=\"keywordflow\">else</span> { *ppv = NULL; <span class=\"keywordflow\">return</span> E_NOINTERFACE; } <span class=\"keyword\">reinterpret_cast&lt;</span>IUnknown*<span class=\"keyword\">&gt;</span>(<span class=\"keyword\">this</span>)-&gt;AddRef(); <span class=\"keywordflow\">return</span> S_OK; }</div>\n\
<div class=\"line\">    STDMETHOD_(ULONG, AddRef)(THIS) { <span class=\"comment\">/*return (ULONG)InterlockedIncrement( &amp;m_lRef ); */</span> <span class=\"keywordflow\">return</span> 1L; }</div>\n\
<div class=\"line\">    STDMETHOD_(ULONG, Release)(THIS) { <span class=\"comment\">/*if( 0L == InterlockedDecrement( &amp;m_lRef ) ) { delete this; return 0L; } return m_lRef; */</span> <span class=\"keywordflow\">return</span> 1L; }</div>\n\
<div class=\"line\">    LPDIRECT3DDEVICE9 fD3DDevice;</div>\n\
<div class=\"line\"><span class=\"keyword\">protected</span>:</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <span class=\"comment\">// Helper to work out the render cull setting for the current shape/shader cull modes</span></div>\n\
<div class=\"line\">    <span class=\"comment\">// This code assumes that a pass render state selecting a cull direction OVERRIDES any</span></div>\n\
<div class=\"line\">    <span class=\"comment\">// double-sidedness on the shape (given there&#39;s really no point in rendering a back or</span></div>\n\
<div class=\"line\">    <span class=\"comment\">// front of the object when every point is part of the front and the back). You can</span></div>\n\
<div class=\"line\">    <span class=\"comment\">// easily modify this code to preserve double sidedness in these cases by adding a</span></div>\n\
<div class=\"line\">    <span class=\"comment\">// check for fShapeCullMode == kCullNone in the second two fShaderCullMode cases and</span></div>\n\
<div class=\"line\">    <span class=\"comment\">// leave d3dCullMode as NONE to get the other behaviour.</span></div>\n\
<div class=\"line\">    <span class=\"keyword\">inline</span> <span class=\"keywordtype\">void</span> setupCulling()</div>\n\
<div class=\"line\">    {</div>\n\
<div class=\"line\">        DWORD d3dCullMode = D3DCULL_NONE;</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">if</span>( !fShaderSetCullMode)</div>\n\
<div class=\"line\">        {</div>\n\
<div class=\"line\">            <span class=\"keywordflow\">if</span>( fShapeCullMode == <a name=\"a1\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_list.html#ae8a071ea1afbb0c50330deec77c8c2c4af7b5cd77ef1ecfa1ef60046184ed6281\">MGeometryList::kCullCW</a>)</div>\n\
<div class=\"line\">                d3dCullMode = D3DCULL_CW; </div>\n\
<div class=\"line\">            <span class=\"keywordflow\">else</span> <span class=\"keywordflow\">if</span>( fShapeCullMode == <a name=\"a2\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_list.html#ae8a071ea1afbb0c50330deec77c8c2c4a8cdf8a04a488157421df1e0775ebcc5e\">MGeometryList::kCullCCW</a>)</div>\n\
<div class=\"line\">                d3dCullMode = D3DCULL_CCW; </div>\n\
<div class=\"line\">        }</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">else</span> <span class=\"keywordflow\">if</span>( fShaderCullMode == D3DCULL_CCW)</div>\n\
<div class=\"line\">        {</div>\n\
<div class=\"line\">            d3dCullMode = (fShapeCullMode == <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_list.html#ae8a071ea1afbb0c50330deec77c8c2c4a8cdf8a04a488157421df1e0775ebcc5e\">MGeometryList::kCullCCW</a>) ? D3DCULL_CCW : D3DCULL_CW; </div>\n\
<div class=\"line\">        }</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">else</span> <span class=\"keywordflow\">if</span>( fShaderCullMode == D3DCULL_CW)</div>\n\
<div class=\"line\">        {</div>\n\
<div class=\"line\">            d3dCullMode = (fShapeCullMode == <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_list.html#ae8a071ea1afbb0c50330deec77c8c2c4a8cdf8a04a488157421df1e0775ebcc5e\">MGeometryList::kCullCCW</a>) ? D3DCULL_CW : D3DCULL_CCW; </div>\n\
<div class=\"line\">        }</div>\n\
<div class=\"line\">        fD3DDevice-&gt;SetRenderState( D3DRS_CULLMODE, d3dCullMode); </div>\n\
<div class=\"line\">    }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_list.html#ae8a071ea1afbb0c50330deec77c8c2c4\">MGeometryList::MCullMode</a> fShapeCullMode;</div>\n\
<div class=\"line\">    DWORD       fShaderCullMode;</div>\n\
<div class=\"line\">    <span class=\"keywordtype\">bool</span>        fShaderSetCullMode;</div>\n\
<div class=\"line\">};</div>\n\
<div class=\"line\">HLSLStateManager HLSLStateManager::sInstance;</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"><span class=\"comment\">//</span></div>\n\
<div class=\"line\"><span class=\"comment\">// A wee texture cache for our HLSL shaders</span></div>\n\
<div class=\"line\"><span class=\"comment\">//</span></div>\n\
<div class=\"line\"><span class=\"keyword\">class </span>HLSLTextureManager : <span class=\"keyword\">public</span> <a name=\"_a3\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_hwr_callback.html\">MHwrCallback</a></div>\n\
<div class=\"line\">{</div>\n\
<div class=\"line\"><span class=\"keyword\">public</span>:</div>\n\
<div class=\"line\">    <span class=\"keyword\">static</span> HLSLTextureManager sInstance;</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    HLSLTextureManager() </div>\n\
<div class=\"line\">    { </div>\n\
<div class=\"line\">        <a name=\"a4\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_hwr_callback.html#a89455670ecab5d8cfe46ed1e1943415d\">addCallback</a>( <span class=\"keyword\">this</span>); </div>\n\
<div class=\"line\">        sceneCallbackIds[0] = MSceneMessage::addCallback( MSceneMessage::kBeforeNew, HLSLTextureManager::newSceneCallback, (<span class=\"keywordtype\">void</span>*)<span class=\"keyword\">this</span>); </div>\n\
<div class=\"line\">        sceneCallbackIds[1] = MSceneMessage::addCallback( MSceneMessage::kBeforeOpen, HLSLTextureManager::newSceneCallback, (<span class=\"keywordtype\">void</span>*)<span class=\"keyword\">this</span>); </div>\n\
<div class=\"line\">    }</div>\n\
<div class=\"line\">    <span class=\"keyword\">virtual</span> ~HLSLTextureManager() { <a name=\"a5\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_hwr_callback.html#a3bd9b57cb13e6f168ce91bc5dca5954d\">removeCallback</a>( <span class=\"keyword\">this</span>); release(); <span class=\"keywordflow\">for</span>( <span class=\"keywordtype\">int</span> i = 0; i &lt; 2; i++) <a name=\"a6\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_message.html#a50fe995add3ce133b8b56551abb4ed09\">MSceneMessage::removeCallback</a>( sceneCallbackIds[ i]); }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <span class=\"keywordtype\">void</span> bind( <span class=\"keyword\">const</span> <a name=\"_a7\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string.html\">MString</a>&amp; name, <a name=\"_a8\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html\">MUniformParameter</a>&amp; uniform, LPD3DXEFFECT d3dEffect, D3DXHANDLE d3dParameter)</div>\n\
<div class=\"line\">    {</div>\n\
<div class=\"line\">        <span class=\"comment\">// Try and find an existing entry for this parameter</span></div>\n\
<div class=\"line\">        User* user = NULL;</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">for</span>( <span class=\"keywordtype\">int</span> i = users.length(); i--; )</div>\n\
<div class=\"line\">        {</div>\n\
<div class=\"line\">            <span class=\"keywordflow\">if</span>( users[ i].parameter == d3dParameter &amp;&amp; users[ i].effect == d3dEffect)</div>\n\
<div class=\"line\">            {</div>\n\
<div class=\"line\">                user = &amp;users[ i];</div>\n\
<div class=\"line\">                <span class=\"keywordflow\">break</span>;</div>\n\
<div class=\"line\">            }</div>\n\
<div class=\"line\">        }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">        <span class=\"comment\">// If there&#39;s no existing entry and we have a texture, create a new one</span></div>\n\
<div class=\"line\">        <span class=\"keywordflow\">if</span>( !user &amp;&amp; name.<a name=\"a9\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string.html#a580388f31f60c46fac867ca48a48da1e\">length</a>() &gt; 0)</div>\n\
<div class=\"line\">        {</div>\n\
<div class=\"line\">            <span class=\"keywordtype\">int</span> idx = users.length();</div>\n\
<div class=\"line\">            users.length( idx + 1);</div>\n\
<div class=\"line\">            user = &amp;users[ idx];</div>\n\
<div class=\"line\">            DEBUG_TEXTURE_CACHE( printf( <span class=\"stringliteral\">&quot;Registering user %s at %d\\n&quot;</span>, uniform.<a name=\"a10\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html#aca2cba4630391c78dcf1a828986160da\">name</a>().<a name=\"a11\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string.html#aa9ab612f356c53479afc4c648c9ef94d\">asChar</a>(), (int)((<span class=\"keywordtype\">long</span> <span class=\"keywordtype\">long</span>)user)); )</div>\n\
<div class=\"line\">            user-&gt;parameter = d3dParameter;</div>\n\
<div class=\"line\">            user-&gt;effect = d3dEffect;</div>\n\
<div class=\"line\">            user-&gt;uniform = uniform;</div>\n\
<div class=\"line\">        }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">        <span class=\"comment\">// If there is already an entry for this parameter ...</span></div>\n\
<div class=\"line\">        <span class=\"keywordflow\">if</span>( user &amp;&amp; user-&gt;texture)</div>\n\
<div class=\"line\">        {</div>\n\
<div class=\"line\">            <span class=\"comment\">// ... is it using the right texture?</span></div>\n\
<div class=\"line\">            Texture* texture = user-&gt;texture;</div>\n\
<div class=\"line\">            <span class=\"keywordflow\">if</span>( texture-&gt;name == name)</div>\n\
<div class=\"line\">            {</div>\n\
<div class=\"line\">                <span class=\"comment\">// Same texture means reload!</span></div>\n\
<div class=\"line\">                DEBUG_TEXTURE_CACHE( printf( <span class=\"stringliteral\">&quot;Reloading %s\\n&quot;</span>, name.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string.html#aa9ab612f356c53479afc4c648c9ef94d\">asChar</a>()); )</div>\n\
<div class=\"line\">                <span class=\"keywordflow\">if</span>( texture-&gt;texture)</div>\n\
<div class=\"line\">                {</div>\n\
<div class=\"line\">                    texture-&gt;texture-&gt;Release();</div>\n\
<div class=\"line\">                    texture-&gt;texture = NULL;</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">                    <span class=\"comment\">// Now, we&#39;re going to be a little nasty here. If we have multiple shaders attached</span></div>\n\
<div class=\"line\">                    <span class=\"comment\">// to this texture, they&#39;re all going to be trying to reload this texture, and given</span></div>\n\
<div class=\"line\">                    <span class=\"comment\">// we don&#39;t pay attention to which frame the reload was performed in, we&#39;ll reload</span></div>\n\
<div class=\"line\">                    <span class=\"comment\">// the texture once for every user. To avoid this, the easiest solution is simply to</span></div>\n\
<div class=\"line\">                    <span class=\"comment\">// mark all the other users dirty (to make sure they pick up the new texture, and </span></div>\n\
<div class=\"line\">                    <span class=\"comment\">// then delete their usage entries in our cache, so we see them as new users requesting</span></div>\n\
<div class=\"line\">                    <span class=\"comment\">// the texture and don&#39;t reload the texture multiple times.</span></div>\n\
<div class=\"line\">                    <span class=\"keywordflow\">for</span>( <span class=\"keywordtype\">int</span> i = users.length(); i--; )</div>\n\
<div class=\"line\">                    {</div>\n\
<div class=\"line\">                        <span class=\"keywordflow\">if</span>( &amp;users[ i] != user &amp;&amp; users[ i].texture == texture)</div>\n\
<div class=\"line\">                        {</div>\n\
<div class=\"line\">                            DEBUG_TEXTURE_CACHE( printf( <span class=\"stringliteral\">&quot;Breaking texture reference for shared entry %s to avoid duplicate reloads\\n&quot;</span>, users[ i].uniform.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html#aca2cba4630391c78dcf1a828986160da\">name</a>().<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string.html#aa9ab612f356c53479afc4c648c9ef94d\">asChar</a>()); )</div>\n\
<div class=\"line\">                            users[ i].uniform.<a name=\"a12\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html#a92a590790db6444ca7a79eaf5fbcb0d9\">setDirty</a>();</div>\n\
<div class=\"line\">                            users[ i].texture = NULL;</div>\n\
<div class=\"line\">                            texture-&gt;numUsers--;</div>\n\
<div class=\"line\">                        }</div>\n\
<div class=\"line\">                    }</div>\n\
<div class=\"line\">                }</div>\n\
<div class=\"line\">            }</div>\n\
<div class=\"line\">            <span class=\"keywordflow\">else</span></div>\n\
<div class=\"line\">            {</div>\n\
<div class=\"line\">                decUsage( texture);</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">                <span class=\"comment\">// Now forget our texture so the code below will search for the new one</span></div>\n\
<div class=\"line\">                user-&gt;texture = NULL;</div>\n\
<div class=\"line\">            }</div>\n\
<div class=\"line\">        }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">        <span class=\"comment\">// If we don&#39;t have a texture try and find an existing entry we can reuse</span></div>\n\
<div class=\"line\">        <span class=\"keywordflow\">if</span>( user &amp;&amp; !user-&gt;texture &amp;&amp; name.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string.html#a580388f31f60c46fac867ca48a48da1e\">length</a>() &gt; 0)</div>\n\
<div class=\"line\">        {</div>\n\
<div class=\"line\">            <span class=\"keywordflow\">for</span>( <span class=\"keywordtype\">int</span> i = textures.length(); i--; )</div>\n\
<div class=\"line\">            {</div>\n\
<div class=\"line\">                <span class=\"keywordflow\">if</span>( textures[ i].name == name &amp;&amp; textures[ i].type == uniform.<a name=\"a13\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html#ac52395416dfb965501c67061d7198c1c\">type</a>())</div>\n\
<div class=\"line\">                {</div>\n\
<div class=\"line\">                    DEBUG_TEXTURE_CACHE( printf( <span class=\"stringliteral\">&quot;Sharing %s\\n&quot;</span>, textures[ i].name.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string.html#aa9ab612f356c53479afc4c648c9ef94d\">asChar</a>()); )</div>\n\
<div class=\"line\">                    user-&gt;texture = &amp;textures[ i];</div>\n\
<div class=\"line\">                    user-&gt;texture-&gt;numUsers++;</div>\n\
<div class=\"line\">                    <span class=\"keywordflow\">break</span>;</div>\n\
<div class=\"line\">                }</div>\n\
<div class=\"line\">            }</div>\n\
<div class=\"line\">        }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">        <span class=\"comment\">// If we still don&#39;t have a texture, create a new entry</span></div>\n\
<div class=\"line\">        <span class=\"keywordflow\">if</span>( user &amp;&amp; !user-&gt;texture &amp;&amp; name.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string.html#a580388f31f60c46fac867ca48a48da1e\">length</a>() &gt; 0)</div>\n\
<div class=\"line\">        {</div>\n\
<div class=\"line\">            <span class=\"comment\">// Remember the current memory offset in case the array gets reallocated</span></div>\n\
<div class=\"line\">            Texture* oldMem = &amp;textures[ 0];</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">            <span class=\"comment\">// Create a new texture entry</span></div>\n\
<div class=\"line\">            DEBUG_TEXTURE_CACHE( printf( <span class=\"stringliteral\">&quot;Creating %s\\n&quot;</span>, name.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string.html#aa9ab612f356c53479afc4c648c9ef94d\">asChar</a>()); )</div>\n\
<div class=\"line\">            <span class=\"keywordtype\">int</span> idx = textures.length();</div>\n\
<div class=\"line\">            textures.length( idx + 1);</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">            <span class=\"comment\">// Repair our texture pointers if the memory got reallocated</span></div>\n\
<div class=\"line\">            Texture* newMem = &amp;textures[ 0];</div>\n\
<div class=\"line\">            <span class=\"keywordflow\">if</span>( oldMem != newMem)</div>\n\
<div class=\"line\">                <span class=\"keywordflow\">for</span>( <span class=\"keywordtype\">int</span> i = users.length(); i--; )</div>\n\
<div class=\"line\">                    <span class=\"keywordflow\">if</span>( users[ i].texture)</div>\n\
<div class=\"line\">                        users[ i].texture = (Texture*)((<span class=\"keywordtype\">char</span>*)users[ i].texture + ((<span class=\"keywordtype\">char</span>*)newMem - (<span class=\"keywordtype\">char</span>*)oldMem));</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">            <span class=\"comment\">// Now setup our new entry</span></div>\n\
<div class=\"line\">            Texture* texture = &amp;textures[ idx];</div>\n\
<div class=\"line\">            texture-&gt;name = name;</div>\n\
<div class=\"line\">            texture-&gt;type = uniform.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html#ac52395416dfb965501c67061d7198c1c\">type</a>();</div>\n\
<div class=\"line\">            texture-&gt;numUsers = 1;</div>\n\
<div class=\"line\">            user-&gt;texture = texture;</div>\n\
<div class=\"line\">        }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">        <span class=\"comment\">// If our texture entry doesn&#39;t have a d3d texture, load one in!</span></div>\n\
<div class=\"line\">        <span class=\"keywordflow\">if</span>( user &amp;&amp; user-&gt;texture &amp;&amp; !user-&gt;texture-&gt;texture)</div>\n\
<div class=\"line\">        {</div>\n\
<div class=\"line\">            <span class=\"comment\">// Create a new texture for this parameter</span></div>\n\
<div class=\"line\">            <a name=\"_a14\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_d3_d9_renderer.html\">MD3D9Renderer</a> *pRenderer = <a name=\"a15\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_d3_d9_renderer.html#a7e20874dc16aef527b927346672fdbfa\">MD3D9Renderer::theRenderer</a>();</div>\n\
<div class=\"line\">            <span class=\"keywordflow\">if</span> (pRenderer != NULL) {</div>\n\
<div class=\"line\">                IDirect3DDevice9* d3dDevice = pRenderer-&gt;<a name=\"a16\"></a>getD3D9Device();</div>\n\
<div class=\"line\">                <span class=\"keywordflow\">if</span>(d3dDevice != NULL)</div>\n\
<div class=\"line\">                {</div>\n\
<div class=\"line\">                    DEBUG_TEXTURE_CACHE( printf( <span class=\"stringliteral\">&quot;Loading %s\\n&quot;</span>, name.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string.html#aa9ab612f356c53479afc4c648c9ef94d\">asChar</a>()); )</div>\n\
<div class=\"line\">                        <span class=\"keywordflow\">if</span>( uniform.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html#ac52395416dfb965501c67061d7198c1c\">type</a>() == MUniformParameter::kTypeCubeTexture)</div>\n\
<div class=\"line\">                        {</div>\n\
<div class=\"line\">                            LPDIRECT3DCUBETEXTURE9 d3dTexture;</div>\n\
<div class=\"line\">                            <span class=\"keywordflow\">if</span>( D3DXCreateCubeTextureFromFile(d3dDevice, name.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string.html#aa9ab612f356c53479afc4c648c9ef94d\">asChar</a>(), &amp;d3dTexture) == D3D_OK)</div>\n\
<div class=\"line\">                                user-&gt;texture-&gt;texture = d3dTexture;</div>\n\
<div class=\"line\">                        }</div>\n\
<div class=\"line\">                        <span class=\"keywordflow\">else</span> <span class=\"keywordflow\">if</span>( uniform.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html#ac52395416dfb965501c67061d7198c1c\">type</a>() == MUniformParameter::kType3DTexture)</div>\n\
<div class=\"line\">                        {</div>\n\
<div class=\"line\">                            LPDIRECT3DVOLUMETEXTURE9 d3dTexture;</div>\n\
<div class=\"line\">                            <span class=\"keywordflow\">if</span>( D3DXCreateVolumeTextureFromFile( d3dDevice, name.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string.html#aa9ab612f356c53479afc4c648c9ef94d\">asChar</a>(), &amp;d3dTexture) == D3D_OK)</div>\n\
<div class=\"line\">                                user-&gt;texture-&gt;texture = d3dTexture;</div>\n\
<div class=\"line\">                        }</div>\n\
<div class=\"line\">                        <span class=\"keywordflow\">else</span></div>\n\
<div class=\"line\">                        {</div>\n\
<div class=\"line\">                            LPDIRECT3DTEXTURE9 d3dTexture;</div>\n\
<div class=\"line\">                            <span class=\"keywordflow\">if</span>( D3DXCreateTextureFromFile(d3dDevice, name.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string.html#aa9ab612f356c53479afc4c648c9ef94d\">asChar</a>(), &amp;d3dTexture) == D3D_OK)</div>\n\
<div class=\"line\">                                user-&gt;texture-&gt;texture = d3dTexture;</div>\n\
<div class=\"line\">                        }</div>\n\
<div class=\"line\">                }</div>\n\
<div class=\"line\">            }</div>\n\
<div class=\"line\">        }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">        <span class=\"comment\">// Finally, bind our texture to the parameter</span></div>\n\
<div class=\"line\">        d3dEffect-&gt;SetTexture( d3dParameter, (user &amp;&amp; user-&gt;texture) ? user-&gt;texture-&gt;texture : NULL);</div>\n\
<div class=\"line\">    }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <span class=\"comment\">// Drop all the textures being used by the specified effect</span></div>\n\
<div class=\"line\">    <span class=\"keywordtype\">void</span> release( LPD3DXEFFECT effect)</div>\n\
<div class=\"line\">    {</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">for</span>( <span class=\"keywordtype\">int</span> i = users.length(); i--; )</div>\n\
<div class=\"line\">        {</div>\n\
<div class=\"line\">            <span class=\"keywordflow\">if</span>( users[ i].effect == effect)</div>\n\
<div class=\"line\">            {</div>\n\
<div class=\"line\">                DEBUG_TEXTURE_CACHE( printf( <span class=\"stringliteral\">&quot;Releasing effect usage %s\\n&quot;</span>, users[ i].uniform.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html#aca2cba4630391c78dcf1a828986160da\">name</a>().<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string.html#aa9ab612f356c53479afc4c648c9ef94d\">asChar</a>()); )</div>\n\
<div class=\"line\">                <span class=\"keywordflow\">if</span>( users[ i].texture) decUsage( users[ i].texture);</div>\n\
<div class=\"line\">                <span class=\"keywordtype\">int</span> newLength = users.length() - 1;</div>\n\
<div class=\"line\">                <span class=\"keywordflow\">if</span>( i != newLength)</div>\n\
<div class=\"line\">                    users[ i] = users[ newLength];</div>\n\
<div class=\"line\">                users.length( newLength);</div>\n\
<div class=\"line\">            }</div>\n\
<div class=\"line\">        }</div>\n\
<div class=\"line\">    }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <span class=\"keyword\">virtual</span> <span class=\"keywordtype\">void</span> <a name=\"a17\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_hwr_callback.html#a3252d3ddda1ce16cc70ec872bd6ba500\">deviceNew</a>() {}</div>\n\
<div class=\"line\">    <span class=\"keyword\">virtual</span> <span class=\"keywordtype\">void</span> <a name=\"a18\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_hwr_callback.html#a302e6f42aaa50b435c7287432f6c7988\">deviceLost</a>() { release(); }</div>\n\
<div class=\"line\">    <span class=\"keyword\">virtual</span> <span class=\"keywordtype\">void</span> <a name=\"a19\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_hwr_callback.html#a3ae7ee9e49057e1d91837b94fe121e8b\">deviceDeleted</a>() { release(); }</div>\n\
<div class=\"line\">    <span class=\"keyword\">static</span> <span class=\"keywordtype\">void</span> newSceneCallback( <span class=\"keywordtype\">void</span>* ptr) { ((HLSLTextureManager*)ptr)-&gt;release(); }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <span class=\"keyword\">struct </span>Texture</div>\n\
<div class=\"line\">    {</div>\n\
<div class=\"line\">        <span class=\"keyword\">inline</span>          Texture() : numUsers( 0), texture( NULL) {}</div>\n\
<div class=\"line\">        <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string.html\">MString</a>         name;</div>\n\
<div class=\"line\">        MUniformParameter::DataType type;</div>\n\
<div class=\"line\">        LPDIRECT3DBASETEXTURE9 texture;</div>\n\
<div class=\"line\">        <span class=\"keywordtype\">int</span>             numUsers;</div>\n\
<div class=\"line\">    };</div>\n\
<div class=\"line\">    <span class=\"keyword\">struct </span>User</div>\n\
<div class=\"line\">    {</div>\n\
<div class=\"line\">        <span class=\"keyword\">inline</span>          User() : parameter( NULL), effect( NULL), texture( NULL) {}</div>\n\
<div class=\"line\">        D3DXHANDLE      parameter;</div>\n\
<div class=\"line\">        LPD3DXEFFECT    effect;</div>\n\
<div class=\"line\">        <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html\">MUniformParameter</a> uniform;</div>\n\
<div class=\"line\">        Texture*        texture;</div>\n\
<div class=\"line\">    };</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    ObjArray&lt;Texture&gt;   textures;</div>\n\
<div class=\"line\">    ObjArray&lt;User&gt;      users;</div>\n\
<div class=\"line\">    MCallbackId         sceneCallbackIds[ 2];</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <span class=\"keywordtype\">void</span>        release()</div>\n\
<div class=\"line\">    {</div>\n\
<div class=\"line\">        DEBUG_TEXTURE_CACHE( printf( <span class=\"stringliteral\">&quot;Releasing cache with %d textures and %d users\\n&quot;</span>, textures.length(), users.length()); )</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">for</span>( <span class=\"keywordtype\">int</span> i = users.length(); i--; )</div>\n\
<div class=\"line\">            users[ i].uniform.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html#a92a590790db6444ca7a79eaf5fbcb0d9\">setDirty</a>();</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">for</span>( <span class=\"keywordtype\">int</span> i = textures.length(); i--; )</div>\n\
<div class=\"line\">            <span class=\"keywordflow\">if</span>( textures[ i].texture)</div>\n\
<div class=\"line\">                textures[ i].texture-&gt;Release();</div>\n\
<div class=\"line\">        users.length( 0);</div>\n\
<div class=\"line\">        textures.length( 0);</div>\n\
<div class=\"line\">    }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <span class=\"keywordtype\">void</span>        decUsage( Texture* texture)</div>\n\
<div class=\"line\">    {</div>\n\
<div class=\"line\">        <span class=\"comment\">// It&#39;s currently using a different texture</span></div>\n\
<div class=\"line\">        <span class=\"keywordflow\">if</span>( --texture-&gt;numUsers == 0)</div>\n\
<div class=\"line\">        {</div>\n\
<div class=\"line\">            <span class=\"comment\">// Drat! We&#39;re the last user of this texture so we need to remove it</span></div>\n\
<div class=\"line\">            DEBUG_TEXTURE_CACHE( printf( <span class=\"stringliteral\">&quot;Unloading %s\\n&quot;</span>, texture-&gt;name.asChar()); )</div>\n\
<div class=\"line\">            <span class=\"keywordflow\">if</span>( texture-&gt;texture)</div>\n\
<div class=\"line\">                texture-&gt;texture-&gt;Release();</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">            <span class=\"comment\">// If this isn&#39;t the last texture in our list, we need to shuffle our</span></div>\n\
<div class=\"line\">            <span class=\"comment\">// textures around to fill the hole it leaves behind</span></div>\n\
<div class=\"line\">            Texture* lastTexture = &amp;textures[ textures.length() - 1];</div>\n\
<div class=\"line\">            if( texture != lastTexture)</div>\n\
<div class=\"line\">            {</div>\n\
<div class=\"line\">                *texture = *lastTexture;</div>\n\
<div class=\"line\">                <span class=\"keywordflow\">for</span>( <span class=\"keywordtype\">int</span> i = users.length(); i--; )</div>\n\
<div class=\"line\">                    <span class=\"keywordflow\">if</span>( users[ i].texture == lastTexture)</div>\n\
<div class=\"line\">                        users[ i].texture = texture;</div>\n\
<div class=\"line\">            }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">            <span class=\"comment\">// Now remove the unused texture (which is now guaranteed to be at the</span></div>\n\
<div class=\"line\">            <span class=\"comment\">// end of the array) from our list</span></div>\n\
<div class=\"line\">            textures.length( textures.length() - 1);</div>\n\
<div class=\"line\">        }</div>\n\
<div class=\"line\">        DEBUG_TEXTURE_CACHE( <span class=\"keywordflow\">else</span> printf( <span class=\"stringliteral\">&quot;Unsharing %s\\n&quot;</span>, texture-&gt;name.asChar()); )</div>\n\
<div class=\"line\">    }</div>\n\
<div class=\"line\">};</div>\n\
<div class=\"line\">HLSLTextureManager HLSLTextureManager::sInstance;</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"><span class=\"comment\">//</span></div>\n\
<div class=\"line\"><span class=\"comment\">// Find an annotation</span></div>\n\
<div class=\"line\"><span class=\"comment\">//</span></div>\n\
<div class=\"line\"><span class=\"keywordtype\">bool</span> hlslShader::GetAnnotation( D3DXHANDLE parameter, <span class=\"keyword\">const</span> <span class=\"keywordtype\">char</span>* name, LPCSTR&amp; value)</div>\n\
<div class=\"line\">{</div>\n\
<div class=\"line\">    D3DXHANDLE d3dSemantic = fD3DEffect-&gt;GetAnnotationByName( parameter, name);</div>\n\
<div class=\"line\">    <span class=\"keywordflow\">return</span> d3dSemantic &amp;&amp; fD3DEffect-&gt;GetString( d3dSemantic, &amp;value) == D3D_OK &amp;&amp; value != NULL;</div>\n\
<div class=\"line\">}</div>\n\
<div class=\"line\"><span class=\"keywordtype\">bool</span> hlslShader::GetBOOLAnnotation( D3DXHANDLE parameter, <span class=\"keyword\">const</span> <span class=\"keywordtype\">char</span>* name, BOOL&amp; value)</div>\n\
<div class=\"line\">{</div>\n\
<div class=\"line\">    D3DXHANDLE d3dSemantic = fD3DEffect-&gt;GetAnnotationByName( parameter, name);</div>\n\
<div class=\"line\">    <span class=\"keywordflow\">return</span> d3dSemantic &amp;&amp; fD3DEffect-&gt;GetBool( d3dSemantic, &amp;value) == D3D_OK;</div>\n\
<div class=\"line\">}</div>\n\
<div class=\"line\"><span class=\"keywordtype\">bool</span> hlslShader::GetAnnotation( D3DXHANDLE parameter, <span class=\"keyword\">const</span> <span class=\"keywordtype\">char</span>* name, <span class=\"keywordtype\">float</span>&amp; value)</div>\n\
<div class=\"line\">{</div>\n\
<div class=\"line\">    D3DXHANDLE d3dSemantic = fD3DEffect-&gt;GetAnnotationByName( parameter, name);</div>\n\
<div class=\"line\">    <span class=\"keywordflow\">return</span> d3dSemantic &amp;&amp; fD3DEffect-&gt;GetFloat( d3dSemantic, &amp;value) == D3D_OK;</div>\n\
<div class=\"line\">}</div>\n\
<div class=\"line\"><span class=\"keywordtype\">bool</span> hlslShader::GetAnnotation( D3DXHANDLE parameter, <span class=\"keyword\">const</span> <span class=\"keywordtype\">char</span>* name, <span class=\"keywordtype\">int</span>&amp; value)</div>\n\
<div class=\"line\">{</div>\n\
<div class=\"line\">    D3DXHANDLE d3dSemantic = fD3DEffect-&gt;GetAnnotationByName( parameter, name);</div>\n\
<div class=\"line\">    <span class=\"keywordflow\">return</span> d3dSemantic &amp;&amp; fD3DEffect-&gt;GetInt( d3dSemantic, &amp;value) == D3D_OK;</div>\n\
<div class=\"line\">}</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"><span class=\"comment\">// </span></div>\n\
<div class=\"line\"><span class=\"comment\">// Convert a DX type into a Maya type</span></div>\n\
<div class=\"line\"><span class=\"comment\">//</span></div>\n\
<div class=\"line\">MUniformParameter::DataType hlslShader::ConvertType( D3DXHANDLE parameter, D3DXPARAMETER_DESC&amp; description)</div>\n\
<div class=\"line\">{</div>\n\
<div class=\"line\">    MUniformParameter::DataType mtype = MUniformParameter::kTypeUnknown;</div>\n\
<div class=\"line\">    <span class=\"keywordflow\">switch</span>( description.Type)</div>\n\
<div class=\"line\">    {</div>\n\
<div class=\"line\">        <span class=\"comment\">//case D3DXPT_VOID: break; </span></div>\n\
<div class=\"line\">        <span class=\"keywordflow\">case</span> D3DXPT_BOOL: mtype = MUniformParameter::kTypeBool; <span class=\"keywordflow\">break</span>; </div>\n\
<div class=\"line\">        <span class=\"keywordflow\">case</span> D3DXPT_INT: mtype = MUniformParameter::kTypeInt; <span class=\"keywordflow\">break</span>; </div>\n\
<div class=\"line\">        <span class=\"keywordflow\">case</span> D3DXPT_FLOAT: mtype = MUniformParameter::kTypeFloat; <span class=\"keywordflow\">break</span>; </div>\n\
<div class=\"line\">        <span class=\"keywordflow\">case</span> D3DXPT_STRING: mtype = MUniformParameter::kTypeString; <span class=\"keywordflow\">break</span>; </div>\n\
<div class=\"line\">        <span class=\"keywordflow\">case</span> D3DXPT_TEXTURE1D: mtype = MUniformParameter::kType1DTexture; <span class=\"keywordflow\">break</span>; </div>\n\
<div class=\"line\">        <span class=\"keywordflow\">case</span> D3DXPT_TEXTURE2D: mtype = MUniformParameter::kType2DTexture; <span class=\"keywordflow\">break</span>; </div>\n\
<div class=\"line\">        <span class=\"keywordflow\">case</span> D3DXPT_TEXTURE3D: mtype = MUniformParameter::kType3DTexture; <span class=\"keywordflow\">break</span>; </div>\n\
<div class=\"line\">        <span class=\"keywordflow\">case</span> D3DXPT_TEXTURECUBE: mtype = MUniformParameter::kTypeCubeTexture; <span class=\"keywordflow\">break</span>; </div>\n\
<div class=\"line\">        <span class=\"keywordflow\">case</span> D3DXPT_TEXTURE: </div>\n\
<div class=\"line\">        {</div>\n\
<div class=\"line\">            <span class=\"comment\">// The shader hasn&#39;t used a typed texture, so first see if there&#39;s an annotation</span></div>\n\
<div class=\"line\">            <span class=\"comment\">// that tells us which type to use.</span></div>\n\
<div class=\"line\">            <span class=\"comment\">//</span></div>\n\
<div class=\"line\">            LPCSTR textureType;</div>\n\
<div class=\"line\">            <span class=\"keywordflow\">if</span>( ( GetAnnotation( parameter, <span class=\"stringliteral\">&quot;TextureType&quot;</span>, textureType) || GetAnnotation( parameter, <span class=\"stringliteral\">&quot;ResourceType&quot;</span>, textureType)) &amp;&amp; textureType)</div>\n\
<div class=\"line\">            {</div>\n\
<div class=\"line\">                <span class=\"comment\">// Grab the type off from the annotation</span></div>\n\
<div class=\"line\">                <span class=\"comment\">//</span></div>\n\
<div class=\"line\">                     <span class=\"keywordflow\">if</span>( !_stricmp( textureType, <span class=\"stringliteral\">&quot;1D&quot;</span>)) mtype = MUniformParameter::kType1DTexture;</div>\n\
<div class=\"line\">                <span class=\"keywordflow\">else</span> <span class=\"keywordflow\">if</span>( !_stricmp( textureType, <span class=\"stringliteral\">&quot;2D&quot;</span>)) mtype = MUniformParameter::kType2DTexture;</div>\n\
<div class=\"line\">                <span class=\"keywordflow\">else</span> <span class=\"keywordflow\">if</span>( !_stricmp( textureType, <span class=\"stringliteral\">&quot;3D&quot;</span>)) mtype = MUniformParameter::kType3DTexture;</div>\n\
<div class=\"line\">                <span class=\"keywordflow\">else</span> <span class=\"keywordflow\">if</span>( !_stricmp( textureType, <span class=\"stringliteral\">&quot;Cube&quot;</span>)) mtype = MUniformParameter::kTypeCubeTexture;</div>\n\
<div class=\"line\">                <span class=\"keywordflow\">else</span> </div>\n\
<div class=\"line\">                {</div>\n\
<div class=\"line\">                    fDiagnostics += <span class=\"stringliteral\">&quot;Unrecognised texture type semantic &quot;</span>;</div>\n\
<div class=\"line\">                    fDiagnostics += textureType;</div>\n\
<div class=\"line\">                    fDiagnostics += <span class=\"stringliteral\">&quot; on parameter &quot;</span>;</div>\n\
<div class=\"line\">                    fDiagnostics += description.Name;</div>\n\
<div class=\"line\">                    fDiagnostics += <span class=\"stringliteral\">&quot;\\n&quot;</span>;</div>\n\
<div class=\"line\">                }</div>\n\
<div class=\"line\">            }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">            <span class=\"keywordflow\">if</span>( mtype == MUniformParameter::kTypeUnknown)</div>\n\
<div class=\"line\">            {</div>\n\
<div class=\"line\">                <span class=\"comment\">// No explicit type. At this stage, it would be nice to take a look at the </span></div>\n\
<div class=\"line\">                <span class=\"comment\">// sampler which uses the texture and grab the type of that, but I can&#39;t see</span></div>\n\
<div class=\"line\">                <span class=\"comment\">// any way to query for the sampler -&gt; texture bindings through the effect</span></div>\n\
<div class=\"line\">                <span class=\"comment\">// API. </span></div>\n\
<div class=\"line\">                <span class=\"comment\">//</span></div>\n\
<div class=\"line\">                mtype = MUniformParameter::kType2DTexture;</div>\n\
<div class=\"line\">                fDiagnostics += <span class=\"stringliteral\">&quot;No texture type provided for &quot;</span>;</div>\n\
<div class=\"line\">                fDiagnostics += description.Name;</div>\n\
<div class=\"line\">                fDiagnostics += <span class=\"stringliteral\">&quot;, assuming 2D\\n&quot;</span>;</div>\n\
<div class=\"line\">            }</div>\n\
<div class=\"line\">            </div>\n\
<div class=\"line\">            <span class=\"keywordflow\">break</span>; </div>\n\
<div class=\"line\">        }</div>\n\
<div class=\"line\">        <span class=\"comment\">//case D3DXPT_SAMPLER: break; </span></div>\n\
<div class=\"line\">        <span class=\"comment\">//case D3DXPT_SAMPLER1D: break; </span></div>\n\
<div class=\"line\">        <span class=\"comment\">//case D3DXPT_SAMPLER2D: break; </span></div>\n\
<div class=\"line\">        <span class=\"comment\">//case D3DXPT_SAMPLER3D: break; </span></div>\n\
<div class=\"line\">        <span class=\"comment\">//case D3DXPT_SAMPLERCUBE: break; </span></div>\n\
<div class=\"line\">        <span class=\"comment\">//case D3DXPT_PIXELSHADER: break; </span></div>\n\
<div class=\"line\">        <span class=\"comment\">//case D3DXPT_VERTEXSHADER: break; </span></div>\n\
<div class=\"line\">        <span class=\"comment\">//case D3DXPT_PIXELFRAGMENT: break; </span></div>\n\
<div class=\"line\">        <span class=\"comment\">//case D3DXPT_VERTEXFRAGMENT: break; </span></div>\n\
<div class=\"line\">        <span class=\"keywordflow\">default</span>: <span class=\"keywordflow\">break</span>;</div>\n\
<div class=\"line\">    }</div>\n\
<div class=\"line\">    <span class=\"keywordflow\">return</span> mtype;</div>\n\
<div class=\"line\">}</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"><span class=\"comment\">//</span></div>\n\
<div class=\"line\"><span class=\"comment\">// Convert a DX space into a Maya space</span></div>\n\
<div class=\"line\"><span class=\"comment\">//</span></div>\n\
<div class=\"line\">MUniformParameter::DataSemantic hlslShader::ConvertSpace( D3DXHANDLE parameter, D3DXPARAMETER_DESC&amp; description, MUniformParameter::DataSemantic defaultSpace)</div>\n\
<div class=\"line\">{</div>\n\
<div class=\"line\">    MUniformParameter::DataSemantic space = defaultSpace;</div>\n\
<div class=\"line\">    LPCSTR ann;</div>\n\
<div class=\"line\">    <span class=\"keywordflow\">if</span>( GetAnnotation( parameter, <span class=\"stringliteral\">&quot;Space&quot;</span>, ann) &amp;&amp; ann)</div>\n\
<div class=\"line\">    {</div>\n\
<div class=\"line\">             <span class=\"keywordflow\">if</span>( !_stricmp( ann, <span class=\"stringliteral\">&quot;Object&quot;</span>)) space = defaultSpace &gt;= MUniformParameter::kSemanticObjectPos ? MUniformParameter::kSemanticObjectPos : MUniformParameter::kSemanticObjectDir;</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">else</span> <span class=\"keywordflow\">if</span>( !_stricmp( ann, <span class=\"stringliteral\">&quot;World&quot;</span>)) space = defaultSpace &gt;= MUniformParameter::kSemanticObjectPos ? MUniformParameter::kSemanticWorldPos : MUniformParameter::kSemanticWorldDir;</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">else</span> <span class=\"keywordflow\">if</span>( !_stricmp( ann, <span class=\"stringliteral\">&quot;View&quot;</span>)) space = defaultSpace &gt;= MUniformParameter::kSemanticObjectPos ? MUniformParameter::kSemanticViewPos : MUniformParameter::kSemanticViewDir;</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">else</span> <span class=\"keywordflow\">if</span>( !_stricmp( ann, <span class=\"stringliteral\">&quot;Camera&quot;</span>)) space = defaultSpace &gt;= MUniformParameter::kSemanticObjectPos ? MUniformParameter::kSemanticViewPos : MUniformParameter::kSemanticViewDir;</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">else</span></div>\n\
<div class=\"line\">        {</div>\n\
<div class=\"line\">            fDiagnostics += <span class=\"stringliteral\">&quot;Unrecognised space &quot;</span>;</div>\n\
<div class=\"line\">            fDiagnostics += ann;</div>\n\
<div class=\"line\">            fDiagnostics += <span class=\"stringliteral\">&quot; on parameter &quot;</span>;</div>\n\
<div class=\"line\">            fDiagnostics += description.Name;</div>\n\
<div class=\"line\">            fDiagnostics += <span class=\"stringliteral\">&quot;\\n&quot;</span>;</div>\n\
<div class=\"line\">        }</div>\n\
<div class=\"line\">    }</div>\n\
<div class=\"line\">    <span class=\"keywordflow\">return</span> space;</div>\n\
<div class=\"line\">}</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"><span class=\"comment\">//</span></div>\n\
<div class=\"line\"><span class=\"comment\">// Convert a DX semantic into a Maya semantic</span></div>\n\
<div class=\"line\"><span class=\"comment\">//</span></div>\n\
<div class=\"line\">MUniformParameter::DataSemantic hlslShader::ConvertSemantic( D3DXHANDLE parameter, D3DXPARAMETER_DESC&amp; description)</div>\n\
<div class=\"line\">{</div>\n\
<div class=\"line\">    MUniformParameter::DataSemantic msemantic = MUniformParameter::kSemanticUnknown;</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <span class=\"comment\">// First try the explicit semantic</span></div>\n\
<div class=\"line\">    <span class=\"keywordflow\">if</span>( description.Semantic &amp;&amp; *description.Semantic)</div>\n\
<div class=\"line\">    {</div>\n\
<div class=\"line\">             <span class=\"keywordflow\">if</span>( !_stricmp( description.Semantic, <span class=\"stringliteral\">&quot;World&quot;</span>))                             msemantic = MUniformParameter::kSemanticWorldMatrix;</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">else</span> <span class=\"keywordflow\">if</span>( !_stricmp( description.Semantic, <span class=\"stringliteral\">&quot;WorldInverse&quot;</span>))                      msemantic = MUniformParameter::kSemanticWorldInverseMatrix;</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">else</span> <span class=\"keywordflow\">if</span>( !_stricmp( description.Semantic, <span class=\"stringliteral\">&quot;WorldInverseTranspose&quot;</span>))             msemantic = MUniformParameter::kSemanticWorldInverseTransposeMatrix;</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">else</span> <span class=\"keywordflow\">if</span>( !_stricmp( description.Semantic, <span class=\"stringliteral\">&quot;View&quot;</span>))                              msemantic = MUniformParameter::kSemanticViewMatrix;</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">else</span> <span class=\"keywordflow\">if</span>( !_stricmp( description.Semantic, <span class=\"stringliteral\">&quot;ViewInverse&quot;</span>))                       msemantic = MUniformParameter::kSemanticViewInverseMatrix;</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">else</span> <span class=\"keywordflow\">if</span>( !_stricmp( description.Semantic, <span class=\"stringliteral\">&quot;ViewInverseTranspose&quot;</span>))              msemantic = MUniformParameter::kSemanticViewInverseTransposeMatrix;</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">else</span> <span class=\"keywordflow\">if</span>( !_stricmp( description.Semantic, <span class=\"stringliteral\">&quot;Projection&quot;</span>))                            msemantic = MUniformParameter::kSemanticProjectionMatrix;</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">else</span> <span class=\"keywordflow\">if</span>( !_stricmp( description.Semantic, <span class=\"stringliteral\">&quot;ProjectionInverse&quot;</span>))                 msemantic = MUniformParameter::kSemanticProjectionInverseMatrix;</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">else</span> <span class=\"keywordflow\">if</span>( !_stricmp( description.Semantic, <span class=\"stringliteral\">&quot;ProjectionInverseTranspose&quot;</span>))            msemantic = MUniformParameter::kSemanticProjectionInverseTransposeMatrix;</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">else</span> <span class=\"keywordflow\">if</span>( !_stricmp( description.Semantic, <span class=\"stringliteral\">&quot;WorldView&quot;</span>))                         msemantic = MUniformParameter::kSemanticWorldViewMatrix;</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">else</span> <span class=\"keywordflow\">if</span>( !_stricmp( description.Semantic, <span class=\"stringliteral\">&quot;WorldViewInverse&quot;</span>))                  msemantic = MUniformParameter::kSemanticWorldViewInverseMatrix;</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">else</span> <span class=\"keywordflow\">if</span>( !_stricmp( description.Semantic, <span class=\"stringliteral\">&quot;WorldViewInverseTranspose&quot;</span>))         msemantic = MUniformParameter::kSemanticWorldViewInverseTransposeMatrix;</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">else</span> <span class=\"keywordflow\">if</span>( !_stricmp( description.Semantic, <span class=\"stringliteral\">&quot;WorldViewProjection&quot;</span>))               msemantic = MUniformParameter::kSemanticWorldViewProjectionMatrix;</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">else</span> <span class=\"keywordflow\">if</span>( !_stricmp( description.Semantic, <span class=\"stringliteral\">&quot;WorldViewProjectionInverse&quot;</span>))            msemantic = MUniformParameter::kSemanticWorldViewProjectionInverseMatrix;</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">else</span> <span class=\"keywordflow\">if</span>( !_stricmp( description.Semantic, <span class=\"stringliteral\">&quot;WorldViewProjectionInverseTranspose&quot;</span>))msemantic = MUniformParameter::kSemanticWorldViewProjectionInverseTransposeMatrix;</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">else</span> <span class=\"keywordflow\">if</span>( !_stricmp( description.Semantic, <span class=\"stringliteral\">&quot;Diffuse&quot;</span>))                           msemantic = MUniformParameter::kSemanticColor;</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">else</span> <span class=\"keywordflow\">if</span>( !_stricmp( description.Semantic, <span class=\"stringliteral\">&quot;Specular&quot;</span>))                          msemantic = MUniformParameter::kSemanticColor;</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">else</span> <span class=\"keywordflow\">if</span>( !_stricmp( description.Semantic, <span class=\"stringliteral\">&quot;Ambient&quot;</span>))                           msemantic = MUniformParameter::kSemanticColor;</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">else</span> <span class=\"keywordflow\">if</span>( !_stricmp( description.Semantic, <span class=\"stringliteral\">&quot;Color&quot;</span>))                             msemantic = MUniformParameter::kSemanticColor;</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">else</span> <span class=\"keywordflow\">if</span>( !_stricmp( description.Semantic, <span class=\"stringliteral\">&quot;Normal&quot;</span>))                                msemantic = MUniformParameter::kSemanticNormal;</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">else</span> <span class=\"keywordflow\">if</span>( !_stricmp( description.Semantic, <span class=\"stringliteral\">&quot;Bump&quot;</span>))                              msemantic = MUniformParameter::kSemanticBump;</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">else</span> <span class=\"keywordflow\">if</span>( !_stricmp( description.Semantic, <span class=\"stringliteral\">&quot;Environment&quot;</span>))                       msemantic = MUniformParameter::kSemanticEnvironment;</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">else</span> <span class=\"keywordflow\">if</span>( !_stricmp( description.Semantic, <span class=\"stringliteral\">&quot;Time&quot;</span>))                              msemantic = MUniformParameter::kSemanticTime;</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">else</span> <span class=\"keywordflow\">if</span>( !_stricmp( description.Semantic, <span class=\"stringliteral\">&quot;Position&quot;</span>))                          msemantic = ConvertSpace( parameter, description, MUniformParameter::kSemanticWorldPos);</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">else</span> <span class=\"keywordflow\">if</span>( !_stricmp( description.Semantic, <span class=\"stringliteral\">&quot;Direction&quot;</span>))                         msemantic = ConvertSpace( parameter, description, MUniformParameter::kSemanticViewDir);</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">else</span> </div>\n\
<div class=\"line\">        {</div>\n\
<div class=\"line\">            fDiagnostics += <span class=\"stringliteral\">&quot;Unrecognised semantic &quot;</span>;</div>\n\
<div class=\"line\">            fDiagnostics += description.Semantic;</div>\n\
<div class=\"line\">            fDiagnostics += <span class=\"stringliteral\">&quot; on parameter &quot;</span>;</div>\n\
<div class=\"line\">            fDiagnostics += description.Name;</div>\n\
<div class=\"line\">            fDiagnostics += <span class=\"stringliteral\">&quot;\\n&quot;</span>;</div>\n\
<div class=\"line\">        }</div>\n\
<div class=\"line\">    }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <span class=\"comment\">// Next, try annotation semantic</span></div>\n\
<div class=\"line\">    <span class=\"keywordflow\">if</span>( msemantic == MUniformParameter::kSemanticUnknown)</div>\n\
<div class=\"line\">    {</div>\n\
<div class=\"line\">        LPCSTR sasSemantic;</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">if</span>( GetAnnotation( parameter, <span class=\"stringliteral\">&quot;SasBindAddress&quot;</span>, sasSemantic) &amp;&amp; *sasSemantic)</div>\n\
<div class=\"line\">        {</div>\n\
<div class=\"line\">            <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string.html\">MString</a> str( sasSemantic);</div>\n\
<div class=\"line\">                 <span class=\"keywordflow\">if</span>( !_stricmp( sasSemantic, <span class=\"stringliteral\">&quot;Sas.Skeleton.MeshToJointToWorld[0]&quot;</span>)) msemantic = MUniformParameter::kSemanticWorldMatrix;</div>\n\
<div class=\"line\">            <span class=\"keywordflow\">else</span> <span class=\"keywordflow\">if</span>( !_stricmp( sasSemantic, <span class=\"stringliteral\">&quot;Sas.Camera.WorldToView&quot;</span>))             msemantic = MUniformParameter::kSemanticViewMatrix;</div>\n\
<div class=\"line\">            <span class=\"keywordflow\">else</span> <span class=\"keywordflow\">if</span>( !_stricmp( sasSemantic, <span class=\"stringliteral\">&quot;Sas.Camera.Projection&quot;</span>))              msemantic = MUniformParameter::kSemanticProjectionMatrix;</div>\n\
<div class=\"line\">            <span class=\"keywordflow\">else</span> <span class=\"keywordflow\">if</span>( !_stricmp( sasSemantic, <span class=\"stringliteral\">&quot;Sas.Time.Now&quot;</span>))                       msemantic = MUniformParameter::kSemanticTime;</div>\n\
<div class=\"line\">            <span class=\"keywordflow\">else</span> <span class=\"keywordflow\">if</span>( str.rindexW( <span class=\"stringliteral\">&quot;.Position&quot;</span>) &gt;= 0)                                msemantic = ConvertSpace( parameter, description, MUniformParameter::kSemanticWorldPos);</div>\n\
<div class=\"line\">            <span class=\"keywordflow\">else</span> <span class=\"keywordflow\">if</span>( str.rindexW( <span class=\"stringliteral\">&quot;.Direction&quot;</span>) &gt;= 0 &amp;&amp; str.rindexW( <span class=\"stringliteral\">&quot;.Direction&quot;</span>) != str.rindexW( <span class=\"stringliteral\">&quot;.Directional&quot;</span>)) msemantic = ConvertSpace( parameter, description, MUniformParameter::kSemanticViewDir);</div>\n\
<div class=\"line\">            <span class=\"keywordflow\">else</span> </div>\n\
<div class=\"line\">            {</div>\n\
<div class=\"line\">                fDiagnostics += <span class=\"stringliteral\">&quot;Unrecognised semantic &quot;</span>;</div>\n\
<div class=\"line\">                fDiagnostics += sasSemantic;</div>\n\
<div class=\"line\">                fDiagnostics += <span class=\"stringliteral\">&quot; on parameter &quot;</span>;</div>\n\
<div class=\"line\">                fDiagnostics += description.Name;</div>\n\
<div class=\"line\">                fDiagnostics += <span class=\"stringliteral\">&quot;\\n&quot;</span>;</div>\n\
<div class=\"line\">            }</div>\n\
<div class=\"line\">        }</div>\n\
<div class=\"line\">    }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <span class=\"comment\">// Next try control type</span></div>\n\
<div class=\"line\">    <span class=\"keywordflow\">if</span>( msemantic == MUniformParameter::kSemanticUnknown)</div>\n\
<div class=\"line\">    {</div>\n\
<div class=\"line\">        LPCSTR sasSemantic;</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">if</span>( GetAnnotation( parameter, <span class=\"stringliteral\">&quot;SasUiControl&quot;</span>, sasSemantic) &amp;&amp; *sasSemantic)</div>\n\
<div class=\"line\">        {</div>\n\
<div class=\"line\">                 <span class=\"keywordflow\">if</span>( !_stricmp( sasSemantic, <span class=\"stringliteral\">&quot;ColorPicker&quot;</span>))                            msemantic = MUniformParameter::kSemanticColor;</div>\n\
<div class=\"line\">        }</div>\n\
<div class=\"line\">    }</div>\n\
<div class=\"line\">    </div>\n\
<div class=\"line\">    <span class=\"comment\">// As a last ditch effort, look for an obvious parameter name</span></div>\n\
<div class=\"line\">    <span class=\"keywordflow\">if</span>( msemantic == MUniformParameter::kSemanticUnknown)</div>\n\
<div class=\"line\">    {</div>\n\
<div class=\"line\">        <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string.html\">MString</a> name( description.Name);</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">if</span>( name.rindexW( <span class=\"stringliteral\">&quot;Position&quot;</span>) &gt;= 0)                                 msemantic = ConvertSpace( parameter, description, MUniformParameter::kSemanticWorldPos);</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">else</span> <span class=\"keywordflow\">if</span>( name.rindexW( <span class=\"stringliteral\">&quot;Direction&quot;</span>) &gt;= 0 &amp;&amp; name.rindexW( <span class=\"stringliteral\">&quot;Direction&quot;</span>) != name.rindexW( <span class=\"stringliteral\">&quot;Directional&quot;</span>)) msemantic = ConvertSpace( parameter, description, MUniformParameter::kSemanticWorldDir);</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">else</span> <span class=\"keywordflow\">if</span>( name.rindexW( <span class=\"stringliteral\">&quot;Color&quot;</span>) &gt;= 0 || name.rindexW( <span class=\"stringliteral\">&quot;Colour&quot;</span>) &gt;= 0 || name.rindexW( <span class=\"stringliteral\">&quot;Diffuse&quot;</span>) &gt;= 0 || name.rindexW( <span class=\"stringliteral\">&quot;Specular&quot;</span>) &gt;= 0 || name.rindexW( <span class=\"stringliteral\">&quot;Ambient&quot;</span>) &gt;= 0)</div>\n\
<div class=\"line\">                                                                                    msemantic = MUniformParameter::kSemanticColor;</div>\n\
<div class=\"line\">    }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <span class=\"keywordflow\">return</span> msemantic;</div>\n\
<div class=\"line\">}</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"><span class=\"comment\">// This typeid must be unique across the universe of Maya plug-ins.  </span></div>\n\
<div class=\"line\"><span class=\"comment\">//</span></div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"><a name=\"_a20\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_type_id.html\">MTypeId</a>     hlslShader::sId( 0xF3560C30 );</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"><span class=\"comment\">// Our rendering profile</span></div>\n\
<div class=\"line\"><span class=\"comment\">//</span></div>\n\
<div class=\"line\"><a name=\"_a21\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_render_profile.html\">MRenderProfile</a> hlslShader::sProfile;</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"><span class=\"comment\">// Attribute declarations</span></div>\n\
<div class=\"line\"><span class=\"comment\">// </span></div>\n\
<div class=\"line\"><a name=\"_a22\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_object.html\">MObject</a>     hlslShader::sShader;</div>\n\
<div class=\"line\"><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_object.html\">MObject</a>     hlslShader::sTechnique;</div>\n\
<div class=\"line\"><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_object.html\">MObject</a>     hlslShader::sTechniques;</div>\n\
<div class=\"line\"><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_object.html\">MObject</a>     hlslShader::sDescription;</div>\n\
<div class=\"line\"><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_object.html\">MObject</a>     hlslShader::sDiagnostics;</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"><span class=\"preprocessor\">#define M_CHECK(assertion)  if (assertion) ; else throw ((hlsl::InternalError*)__LINE__)</span></div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"><span class=\"keyword\">namespace </span>hlsl</div>\n\
<div class=\"line\">{</div>\n\
<div class=\"line\">    <span class=\"keyword\">struct </span>InternalError</div>\n\
<div class=\"line\">    {</div>\n\
<div class=\"line\">        <span class=\"keywordtype\">char</span>* message;</div>\n\
<div class=\"line\">    };</div>\n\
<div class=\"line\">    <span class=\"comment\">//   throw (InternalError*)__LINE__;</span></div>\n\
<div class=\"line\">}</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"><span class=\"comment\">//--------------------------------------------------------------------//</span></div>\n\
<div class=\"line\"><span class=\"comment\">// Constructor:</span></div>\n\
<div class=\"line\"><span class=\"comment\">//</span></div>\n\
<div class=\"line\">hlslShader::hlslShader()</div>\n\
<div class=\"line\">: fErrorCount( 0), fD3DEffect( NULL), fD3DTechnique( NULL), </div>\n\
<div class=\"line\">  fD3DVertexDeclaration( NULL), fVertexStructure( <span class=\"stringliteral\">&quot;VertexStructure&quot;</span>, <a name=\"_a23\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_varying_parameter.html\">MVaryingParameter</a>::kStructure), </div>\n\
<div class=\"line\">  fDeviceManager( me()),</div>\n\
<div class=\"line\">  fTechniqueHasBlending( false ),</div>\n\
<div class=\"line\">  fPostDuplicateCallbackId( NULL )</div>\n\
<div class=\"line\">{</div>\n\
<div class=\"line\">}</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"><span class=\"comment\">// Post-constructor</span></div>\n\
<div class=\"line\"><span class=\"keywordtype\">void</span></div>\n\
<div class=\"line\">hlslShader::postConstructor()</div>\n\
<div class=\"line\">{</div>\n\
<div class=\"line\">    <span class=\"comment\">// Don&#39;t create any default varying parameters (e.g. position + normal) for empty</span></div>\n\
<div class=\"line\">    <span class=\"comment\">// shaders as this just bloats the cache with a useless structure that is currently</span></div>\n\
<div class=\"line\">    <span class=\"comment\">// not flushed out of the cache until the geometry changes. Instead, just render</span></div>\n\
<div class=\"line\">    <span class=\"comment\">// the default geometry directly off the position array in the cache</span></div>\n\
<div class=\"line\">}</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"><span class=\"comment\">// Destructor:</span></div>\n\
<div class=\"line\"><span class=\"comment\">//</span></div>\n\
<div class=\"line\">hlslShader::~hlslShader()</div>\n\
<div class=\"line\">{</div>\n\
<div class=\"line\">    release();</div>\n\
<div class=\"line\">}</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"><span class=\"comment\">//</span></div>\n\
<div class=\"line\"><span class=\"comment\">// Release all our device handles</span></div>\n\
<div class=\"line\"><span class=\"comment\">//</span></div>\n\
<div class=\"line\"><span class=\"keywordtype\">void</span> hlslShader::release()</div>\n\
<div class=\"line\">{</div>\n\
<div class=\"line\">    releaseVertexDeclaration();</div>\n\
<div class=\"line\">    <span class=\"keywordflow\">if</span>( fD3DEffect) </div>\n\
<div class=\"line\">    {</div>\n\
<div class=\"line\">        HLSLTextureManager::sInstance.release( fD3DEffect);</div>\n\
<div class=\"line\">        fD3DEffect-&gt;Release();</div>\n\
<div class=\"line\">        fD3DEffect = NULL;</div>\n\
<div class=\"line\">    }</div>\n\
<div class=\"line\">    fD3DTechnique = NULL;</div>\n\
<div class=\"line\">    fTechniqueHasBlending = <span class=\"keyword\">false</span>;</div>\n\
<div class=\"line\">}</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"><span class=\"comment\">//</span></div>\n\
<div class=\"line\"><span class=\"comment\">// Release our vertex declaration</span></div>\n\
<div class=\"line\"><span class=\"comment\">//</span></div>\n\
<div class=\"line\"><span class=\"keywordtype\">void</span> hlslShader::releaseVertexDeclaration()</div>\n\
<div class=\"line\">{</div>\n\
<div class=\"line\">    <span class=\"keywordflow\">if</span>( fD3DVertexDeclaration) </div>\n\
<div class=\"line\">    {</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">for</span>( <span class=\"keywordtype\">unsigned</span> <span class=\"keywordtype\">int</span> p = 0; p &lt; fD3DTechniqueDesc.Passes; p++)</div>\n\
<div class=\"line\">            <span class=\"keywordflow\">if</span>( fD3DVertexDeclaration[ p])</div>\n\
<div class=\"line\">                fD3DVertexDeclaration[ p]-&gt;Release();</div>\n\
<div class=\"line\">        <span class=\"keyword\">delete</span>[] fD3DVertexDeclaration;</div>\n\
<div class=\"line\">        fD3DVertexDeclaration = NULL;</div>\n\
<div class=\"line\">    }</div>\n\
<div class=\"line\">}</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"><span class=\"comment\">// ========== hlslShader::creator ==========</span></div>\n\
<div class=\"line\"><span class=\"comment\">//</span></div>\n\
<div class=\"line\"><span class=\"comment\">//  Description:</span></div>\n\
<div class=\"line\"><span class=\"comment\">//      this method exists to give Maya a way to create new objects</span></div>\n\
<div class=\"line\"><span class=\"comment\">//      of this type.</span></div>\n\
<div class=\"line\"><span class=\"comment\">//</span></div>\n\
<div class=\"line\"><span class=\"comment\">//  Return Value:</span></div>\n\
<div class=\"line\"><span class=\"comment\">//      a new object of this type.</span></div>\n\
<div class=\"line\"><span class=\"comment\">//</span></div>\n\
<div class=\"line\"><span class=\"comment\">/* static */</span></div>\n\
<div class=\"line\"><span class=\"keywordtype\">void</span>* hlslShader::creator()</div>\n\
<div class=\"line\">{</div>\n\
<div class=\"line\">    <span class=\"keywordflow\">return</span> <span class=\"keyword\">new</span> hlslShader();</div>\n\
<div class=\"line\">}</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"><span class=\"comment\">// ========== hlslShader::initialize ==========</span></div>\n\
<div class=\"line\"><span class=\"comment\">//</span></div>\n\
<div class=\"line\"><span class=\"comment\">//  Description:</span></div>\n\
<div class=\"line\"><span class=\"comment\">//      This method is called to create and initialize all of the attributes</span></div>\n\
<div class=\"line\"><span class=\"comment\">//      and attribute dependencies for this node type.  This is only called </span></div>\n\
<div class=\"line\"><span class=\"comment\">//      once when the node type is registered with Maya.</span></div>\n\
<div class=\"line\"><span class=\"comment\">//</span></div>\n\
<div class=\"line\"><span class=\"comment\">//  Return Values:</span></div>\n\
<div class=\"line\"><span class=\"comment\">//      MS::kSuccess</span></div>\n\
<div class=\"line\"><span class=\"comment\">//      MS::kFailure</span></div>\n\
<div class=\"line\"><span class=\"comment\">//      </span></div>\n\
<div class=\"line\"><span class=\"comment\">/* static */</span></div>\n\
<div class=\"line\"><a name=\"_a24\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_status.html\">MStatus</a></div>\n\
<div class=\"line\">hlslShader::initialize()</div>\n\
<div class=\"line\">{</div>\n\
<div class=\"line\">    <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_status.html\">MStatus</a> ms;</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <span class=\"keywordflow\">try</span></div>\n\
<div class=\"line\">    {</div>\n\
<div class=\"line\">        initializeNodeAttrs();</div>\n\
<div class=\"line\">    }</div>\n\
<div class=\"line\">    <span class=\"keywordflow\">catch</span> ( ... )</div>\n\
<div class=\"line\">    {</div>\n\
<div class=\"line\">        <span class=\"comment\">// [mashworth] Don&#39;t forget I18N</span></div>\n\
<div class=\"line\">        <a name=\"a25\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_global.html#a4ddbe97e58a90e1ab05d45a62c006cf0\">MGlobal::displayError</a>( <span class=\"stringliteral\">&quot;hlslShader internal error: Unhandled exception in initialize&quot;</span> );</div>\n\
<div class=\"line\">        ms = MS::kFailure;</div>\n\
<div class=\"line\">    }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    sProfile.addRenderer( MRenderProfile::kMayaD3D);</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <span class=\"keywordflow\">return</span> ms;</div>\n\
<div class=\"line\">}</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"><span class=\"comment\">// Create all the attributes. </span></div>\n\
<div class=\"line\"><span class=\"comment\">/* static */</span></div>\n\
<div class=\"line\"><span class=\"keywordtype\">void</span></div>\n\
<div class=\"line\">hlslShader::initializeNodeAttrs()</div>\n\
<div class=\"line\">{</div>\n\
<div class=\"line\">    <a name=\"_a26\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_fn_typed_attribute.html\">MFnTypedAttribute</a>   typedAttr;</div>\n\
<div class=\"line\">    <a name=\"_a27\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_fn_string_data.html\">MFnStringData</a>       stringData;</div>\n\
<div class=\"line\">    <a name=\"_a28\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_fn_string_array_data.html\">MFnStringArrayData</a>  stringArrayData;</div>\n\
<div class=\"line\">    <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_status.html\">MStatus</a>             stat, stat2;</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <span class=\"comment\">// The shader attribute holds the name of the .fx file that defines</span></div>\n\
<div class=\"line\">    <span class=\"comment\">// the shader</span></div>\n\
<div class=\"line\">    <span class=\"comment\">//</span></div>\n\
<div class=\"line\">    sShader = typedAttr.<a name=\"a29\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_fn_typed_attribute.html#af785af0a66bd4a4da1d9f7bd74d4de0a\">create</a>(<span class=\"stringliteral\">&quot;shader&quot;</span>, <span class=\"stringliteral\">&quot;s&quot;</span>, MFnData::kString, stringData.<a name=\"a30\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_fn_string_data.html#a2a76d6e5a305b483c5d9b8444fb79126\">create</a>(&amp;stat2), &amp;stat); </div>\n\
<div class=\"line\">    M_CHECK( stat );</div>\n\
<div class=\"line\">    typedAttr.<a name=\"a31\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_fn_attribute.html#ae27cf2fd28a3c69b880b1096ea9e0103\">setInternal</a>( <span class=\"keyword\">true</span>); </div>\n\
<div class=\"line\">    typedAttr.<a name=\"a32\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_fn_attribute.html#a9e68a8b4af016b37f6567cfa6d68e551\">setKeyable</a>( <span class=\"keyword\">false</span>); </div>\n\
<div class=\"line\">    stat = addAttribute(sShader); </div>\n\
<div class=\"line\">    M_CHECK( stat );</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <span class=\"comment\">//</span></div>\n\
<div class=\"line\">    <span class=\"comment\">// technique</span></div>\n\
<div class=\"line\">    <span class=\"comment\">//</span></div>\n\
<div class=\"line\">    sTechnique = typedAttr.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_fn_typed_attribute.html#af785af0a66bd4a4da1d9f7bd74d4de0a\">create</a>(<span class=\"stringliteral\">&quot;technique&quot;</span>, <span class=\"stringliteral\">&quot;t&quot;</span>, MFnData::kString, stringData.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_fn_string_data.html#a2a76d6e5a305b483c5d9b8444fb79126\">create</a>(&amp;stat2), &amp;stat); </div>\n\
<div class=\"line\">    M_CHECK( stat );</div>\n\
<div class=\"line\">    typedAttr.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_fn_attribute.html#ae27cf2fd28a3c69b880b1096ea9e0103\">setInternal</a>( <span class=\"keyword\">true</span>);</div>\n\
<div class=\"line\">    typedAttr.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_fn_attribute.html#a9e68a8b4af016b37f6567cfa6d68e551\">setKeyable</a>( <span class=\"keyword\">true</span>);</div>\n\
<div class=\"line\">    stat = addAttribute(sTechnique);</div>\n\
<div class=\"line\">    M_CHECK( stat );</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <span class=\"comment\">//</span></div>\n\
<div class=\"line\">    <span class=\"comment\">// technique list</span></div>\n\
<div class=\"line\">    <span class=\"comment\">//</span></div>\n\
<div class=\"line\">    sTechniques = typedAttr.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_fn_typed_attribute.html#af785af0a66bd4a4da1d9f7bd74d4de0a\">create</a>(<span class=\"stringliteral\">&quot;techniques&quot;</span>, <span class=\"stringliteral\">&quot;ts&quot;</span>, MFnData::kStringArray, stringArrayData.<a name=\"a33\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_fn_string_array_data.html#af1adb4abaf5243c6c0749bcca7b5c418\">create</a>(&amp;stat2), &amp;stat); </div>\n\
<div class=\"line\">    M_CHECK( stat );</div>\n\
<div class=\"line\">    typedAttr.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_fn_attribute.html#ae27cf2fd28a3c69b880b1096ea9e0103\">setInternal</a>( <span class=\"keyword\">true</span>);</div>\n\
<div class=\"line\">    typedAttr.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_fn_attribute.html#a9e68a8b4af016b37f6567cfa6d68e551\">setKeyable</a>( <span class=\"keyword\">false</span>);</div>\n\
<div class=\"line\">    typedAttr.<a name=\"a34\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_fn_attribute.html#a8d2be80de133a200a455bf9e2ac1b709\">setStorable</a>( <span class=\"keyword\">false</span>);</div>\n\
<div class=\"line\">    typedAttr.<a name=\"a35\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_fn_attribute.html#a98bb3089ec3b7442383da68a5ef424c7\">setWritable</a>( <span class=\"keyword\">false</span>);</div>\n\
<div class=\"line\">    stat = addAttribute(sTechniques);</div>\n\
<div class=\"line\">    M_CHECK( stat );</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <span class=\"comment\">// The description field where we pass compile errors etc back for the user to see</span></div>\n\
<div class=\"line\">    <span class=\"comment\">//</span></div>\n\
<div class=\"line\">    sDescription = typedAttr.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_fn_typed_attribute.html#af785af0a66bd4a4da1d9f7bd74d4de0a\">create</a>(<span class=\"stringliteral\">&quot;description&quot;</span>, <span class=\"stringliteral\">&quot;desc&quot;</span>, MFnData::kString, stringData.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_fn_string_data.html#a2a76d6e5a305b483c5d9b8444fb79126\">create</a>(&amp;stat2), &amp;stat); </div>\n\
<div class=\"line\">    M_CHECK( stat );</div>\n\
<div class=\"line\">    typedAttr.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_fn_attribute.html#a9e68a8b4af016b37f6567cfa6d68e551\">setKeyable</a>( <span class=\"keyword\">false</span>); </div>\n\
<div class=\"line\">    typedAttr.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_fn_attribute.html#a98bb3089ec3b7442383da68a5ef424c7\">setWritable</a>( <span class=\"keyword\">false</span>); </div>\n\
<div class=\"line\">    typedAttr.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_fn_attribute.html#a8d2be80de133a200a455bf9e2ac1b709\">setStorable</a>( <span class=\"keyword\">false</span>); </div>\n\
<div class=\"line\">    stat = addAttribute(sDescription); </div>\n\
<div class=\"line\">    M_CHECK( stat );</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <span class=\"comment\">// The feedback field where we pass compile errors etc back for the user to see</span></div>\n\
<div class=\"line\">    <span class=\"comment\">//</span></div>\n\
<div class=\"line\">    sDiagnostics = typedAttr.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_fn_typed_attribute.html#af785af0a66bd4a4da1d9f7bd74d4de0a\">create</a>(<span class=\"stringliteral\">&quot;diagnostics&quot;</span>, <span class=\"stringliteral\">&quot;diag&quot;</span>, MFnData::kString, stringData.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_fn_string_data.html#a2a76d6e5a305b483c5d9b8444fb79126\">create</a>(&amp;stat2), &amp;stat); </div>\n\
<div class=\"line\">    M_CHECK( stat );</div>\n\
<div class=\"line\">    typedAttr.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_fn_attribute.html#a9e68a8b4af016b37f6567cfa6d68e551\">setKeyable</a>( <span class=\"keyword\">false</span>); </div>\n\
<div class=\"line\">    typedAttr.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_fn_attribute.html#a98bb3089ec3b7442383da68a5ef424c7\">setWritable</a>( <span class=\"keyword\">false</span>); </div>\n\
<div class=\"line\">    typedAttr.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_fn_attribute.html#a8d2be80de133a200a455bf9e2ac1b709\">setStorable</a>( <span class=\"keyword\">false</span>); </div>\n\
<div class=\"line\">    stat = addAttribute(sDiagnostics); </div>\n\
<div class=\"line\">    M_CHECK( stat );</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <span class=\"comment\">// </span></div>\n\
<div class=\"line\">    <span class=\"comment\">// Specify our dependencies</span></div>\n\
<div class=\"line\">    <span class=\"comment\">//</span></div>\n\
<div class=\"line\">    attributeAffects( sShader, sTechniques);</div>\n\
<div class=\"line\">    attributeAffects( sShader, sTechnique);</div>\n\
<div class=\"line\">}</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"><span class=\"keywordtype\">void</span></div>\n\
<div class=\"line\">hlslShader::copyInternalData( <a name=\"_a36\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_px_node.html\">MPxNode</a>* pSrc )</div>\n\
<div class=\"line\">{</div>\n\
<div class=\"line\">    <span class=\"keyword\">const</span> hlslShader&amp; src = *(hlslShader*)pSrc;</div>\n\
<div class=\"line\">    fTechnique = src.fTechnique;</div>\n\
<div class=\"line\">    fTechniqueHasBlending = src.fTechniqueHasBlending;</div>\n\
<div class=\"line\">    fShader = src.fShader;</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <span class=\"comment\">// It&#39;s too early to reload the shader. Maya has not completely duplicate</span></div>\n\
<div class=\"line\">    <span class=\"comment\">// the internal data structures. We delay the reload a little.</span></div>\n\
<div class=\"line\">    fPostDuplicateCallbackId = <a name=\"a37\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_model_message.html#a74cd7260902a3dd9aa27950385408735\">MModelMessage::addAfterDuplicateCallback</a>(postDuplicateCB, <span class=\"keyword\">this</span>);</div>\n\
<div class=\"line\">}</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"><span class=\"keywordtype\">bool</span> hlslShader::setInternalValue( <span class=\"keyword\">const</span> <a name=\"_a38\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_plug.html\">MPlug</a> &amp; plug, <span class=\"keyword\">const</span> <a name=\"_a39\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_data_handle.html\">MDataHandle</a> &amp;  handle)</div>\n\
<div class=\"line\">{</div>\n\
<div class=\"line\">    <span class=\"keywordtype\">bool</span> retVal = <span class=\"keyword\">true</span>;</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <span class=\"keywordflow\">try</span></div>\n\
<div class=\"line\">    {</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">if</span> (plug == sShader)</div>\n\
<div class=\"line\">        {</div>\n\
<div class=\"line\">            setShader( handle.<a name=\"a40\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_data_handle.html#a858b071eda071f265c130e30d0b98622\">asString</a>());</div>\n\
<div class=\"line\">        }</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">else</span> <span class=\"keywordflow\">if</span> (plug == sTechnique)</div>\n\
<div class=\"line\">        {</div>\n\
<div class=\"line\">            setTechnique( handle.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_data_handle.html#a858b071eda071f265c130e30d0b98622\">asString</a>());</div>\n\
<div class=\"line\">        }</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">else</span></div>\n\
<div class=\"line\">        {</div>\n\
<div class=\"line\">            retVal = <a name=\"a41\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_px_node.html#a6caab4434e836748680958883564af35\">MPxHardwareShader::setInternalValue</a>( plug, handle);</div>\n\
<div class=\"line\">        }</div>\n\
<div class=\"line\">    }</div>\n\
<div class=\"line\">    <span class=\"keywordflow\">catch</span> ( ... )</div>\n\
<div class=\"line\">    {</div>\n\
<div class=\"line\">        reportInternalError( __FILE__, __LINE__ );</div>\n\
<div class=\"line\">        retVal = <span class=\"keyword\">false</span>;</div>\n\
<div class=\"line\">    }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <span class=\"keywordflow\">return</span> retVal;</div>\n\
<div class=\"line\">}</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"><span class=\"comment\">/* virtual */</span></div>\n\
<div class=\"line\"><span class=\"keywordtype\">bool</span> hlslShader::getInternalValue( <span class=\"keyword\">const</span> <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_plug.html\">MPlug</a> &amp; plug, <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_data_handle.html\">MDataHandle</a> &amp; handle)</div>\n\
<div class=\"line\">{</div>\n\
<div class=\"line\">    <span class=\"keywordtype\">bool</span> retVal = <span class=\"keyword\">true</span>;</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <span class=\"keywordflow\">try</span></div>\n\
<div class=\"line\">    {</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">if</span> (plug == sShader)</div>\n\
<div class=\"line\">        {</div>\n\
<div class=\"line\">            handle.<a name=\"a42\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_data_handle.html#a2a75482f517f405a641c0eee0bd995ac\">set</a>( fShader);</div>\n\
<div class=\"line\">        }</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">else</span> <span class=\"keywordflow\">if</span> (plug == sTechnique)</div>\n\
<div class=\"line\">        {</div>\n\
<div class=\"line\">            handle.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_data_handle.html#a2a75482f517f405a641c0eee0bd995ac\">set</a>( fTechnique);</div>\n\
<div class=\"line\">        }</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">else</span> <span class=\"keywordflow\">if</span> (plug == sTechniques)</div>\n\
<div class=\"line\">        {</div>\n\
<div class=\"line\">            handle.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_data_handle.html#a2a75482f517f405a641c0eee0bd995ac\">set</a>( <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_fn_string_array_data.html\">MFnStringArrayData</a>().create( fTechniques));</div>\n\
<div class=\"line\">        }</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">else</span></div>\n\
<div class=\"line\">        {</div>\n\
<div class=\"line\">            retVal = <a name=\"a43\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_px_node.html#aa88f4dd4cfd3e964e0806d6e5b253347\">MPxHardwareShader::getInternalValue</a>( plug, handle);</div>\n\
<div class=\"line\">        }</div>\n\
<div class=\"line\">    }</div>\n\
<div class=\"line\">    <span class=\"keywordflow\">catch</span> ( ... )</div>\n\
<div class=\"line\">    {</div>\n\
<div class=\"line\">        reportInternalError( __FILE__, __LINE__ );</div>\n\
<div class=\"line\">        retVal = <span class=\"keyword\">false</span>;</div>\n\
<div class=\"line\">    }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <span class=\"keywordflow\">return</span> retVal;</div>\n\
<div class=\"line\">}</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"><span class=\"comment\">// Override geometry rendering</span></div>\n\
<div class=\"line\"><span class=\"comment\">//</span></div>\n\
<div class=\"line\"><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_status.html\">MStatus</a> hlslShader::render( <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_list.html\">MGeometryList</a>&amp; iter)</div>\n\
<div class=\"line\">{</div>\n\
<div class=\"line\">    <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_d3_d9_renderer.html\">MD3D9Renderer</a> *pRenderer = <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_d3_d9_renderer.html#a7e20874dc16aef527b927346672fdbfa\">MD3D9Renderer::theRenderer</a>();</div>\n\
<div class=\"line\">    <span class=\"keywordflow\">if</span> (pRenderer == NULL) </div>\n\
<div class=\"line\">    {</div>\n\
<div class=\"line\">        <span class=\"comment\">// If there isn&#39;t a render, we can&#39;t render anything</span></div>\n\
<div class=\"line\">        <span class=\"keywordflow\">return</span> <a name=\"a44\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_status.html#a02ab596f4febca68da503aaf8dde3a80a1ef6c2d725fb4bec3e7e840d28adbc00\">MStatus::kFailure</a>;</div>\n\
<div class=\"line\">    }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    IDirect3DDevice9* d3dDevice = pRenderer-&gt;getD3D9Device();   </div>\n\
<div class=\"line\">    <span class=\"keywordflow\">if</span> ( NULL == d3dDevice ) </div>\n\
<div class=\"line\">    {</div>\n\
<div class=\"line\">        <span class=\"comment\">// If there isn&#39;t a valid device, we can&#39;t render anything</span></div>\n\
<div class=\"line\">        <span class=\"keywordflow\">return</span> <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_status.html#a02ab596f4febca68da503aaf8dde3a80a1ef6c2d725fb4bec3e7e840d28adbc00\">MStatus::kFailure</a>;   </div>\n\
<div class=\"line\">    }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <span class=\"keywordflow\">if</span> (fDeviceManager.deviceState() == hlslDeviceManager::kReset)</div>\n\
<div class=\"line\">    {</div>\n\
<div class=\"line\">        fDeviceManager.resetShader();</div>\n\
<div class=\"line\">    }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <span class=\"comment\">// We have a device, now do we have a valid effect, or should we render </span></div>\n\
<div class=\"line\">    <span class=\"comment\">// some stand-in geometry?</span></div>\n\
<div class=\"line\">    <span class=\"comment\">//</span></div>\n\
<div class=\"line\">    HLSLStateManager::sInstance.fD3DDevice = d3dDevice;</div>\n\
<div class=\"line\">    <span class=\"keywordflow\">if</span>( fD3DEffect &amp;&amp; fD3DVertexDeclaration)</div>\n\
<div class=\"line\">    {</div>\n\
<div class=\"line\">        UINT numPasses = 0;</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">        fD3DEffect-&gt;Begin( &amp;numPasses, 0); <span class=\"comment\">// The 0 tells DX to save and restore all state modified by the effect ... hmmmm perf hit?</span></div>\n\
<div class=\"line\">        <span class=\"keywordtype\">bool</span> firstShape = <span class=\"keyword\">true</span>;</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">for</span>( ; !iter.<a name=\"a45\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_list.html#add4bf50abae421d88b5549de6c11fc75\">isDone</a>(); iter.<a name=\"a46\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_list.html#a041249f802c5bf4c2deae666610e03c4\">next</a>())</div>\n\
<div class=\"line\">        {</div>\n\
<div class=\"line\">            <span class=\"comment\">// Setup our shape dependent parameters</span></div>\n\
<div class=\"line\">            <span class=\"keywordflow\">for</span>( <span class=\"keywordtype\">int</span> u = fUniformParameters.length(); u--; )</div>\n\
<div class=\"line\">            {</div>\n\
<div class=\"line\">                <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html\">MUniformParameter</a> uniform = fUniformParameters.getElement( u);</div>\n\
<div class=\"line\">                <span class=\"keywordflow\">if</span>( uniform.<a name=\"a47\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html#a9d4d257e5bb7e85eb9fdeca499dc9361\">hasChanged</a>( iter))</div>\n\
<div class=\"line\">                {</div>\n\
<div class=\"line\">                    D3DXHANDLE d3dParameter = (D3DXHANDLE)uniform.<a name=\"a48\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html#aabc6dea98709831626d182f1bce0c69a\">userData</a>();</div>\n\
<div class=\"line\">                    <span class=\"keywordflow\">if</span>( d3dParameter)</div>\n\
<div class=\"line\">                    {</div>\n\
<div class=\"line\">                        <span class=\"keywordflow\">switch</span>( uniform.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html#ac52395416dfb965501c67061d7198c1c\">type</a>())</div>\n\
<div class=\"line\">                        {</div>\n\
<div class=\"line\">                            <span class=\"keywordflow\">case</span> MUniformParameter::kTypeFloat: </div>\n\
<div class=\"line\">                                {</div>\n\
<div class=\"line\">                                <span class=\"keyword\">const</span> <span class=\"keywordtype\">float</span>* data = uniform.<a name=\"a49\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html#adeb3f26c0cb456d9028fb6e6d71cc51a\">getAsFloatArray</a>( iter);</div>\n\
<div class=\"line\">                                <span class=\"keywordflow\">if</span>( data) fD3DEffect-&gt;SetValue( d3dParameter, data, uniform.<a name=\"a50\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html#ac7fba35931cc9a520837b0a752352e16\">numElements</a>() * <span class=\"keyword\">sizeof</span>( float));</div>\n\
<div class=\"line\">                                }</div>\n\
<div class=\"line\">                                <span class=\"keywordflow\">break</span>;</div>\n\
<div class=\"line\">                            <span class=\"keywordflow\">case</span> MUniformParameter::kTypeInt: </div>\n\
<div class=\"line\">                                fD3DEffect-&gt;SetInt( d3dParameter, uniform.<a name=\"a51\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html#ac4394d7d6b3a9352b2aa83b77b3cac8e\">getAsInt</a>( iter));</div>\n\
<div class=\"line\">                                <span class=\"keywordflow\">break</span>;</div>\n\
<div class=\"line\">                            <span class=\"keywordflow\">case</span> MUniformParameter::kTypeBool: </div>\n\
<div class=\"line\">                                fD3DEffect-&gt;SetBool( d3dParameter, uniform.<a name=\"a52\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html#a528943f9cbfb601fc64e343a3e7072ec\">getAsBool</a>( iter));</div>\n\
<div class=\"line\">                                <span class=\"keywordflow\">break</span>;</div>\n\
<div class=\"line\">                            <span class=\"keywordflow\">case</span> MUniformParameter::kTypeString: </div>\n\
<div class=\"line\">                                fD3DEffect-&gt;SetString( d3dParameter, uniform.<a name=\"a53\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html#ae9f61935fee5d55a0df8bd4b2013a679\">getAsString</a>( iter).<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string.html#aa9ab612f356c53479afc4c648c9ef94d\">asChar</a>());</div>\n\
<div class=\"line\">                                <span class=\"keywordflow\">break</span>;</div>\n\
<div class=\"line\">                            <span class=\"keywordflow\">default</span>:</div>\n\
<div class=\"line\">                                <span class=\"keywordflow\">if</span>( uniform.<a name=\"a54\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html#a37357b066d4c628b1fae2f1ee08b2b12\">isATexture</a>())</div>\n\
<div class=\"line\">                                    HLSLTextureManager::sInstance.bind( uniform.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html#ae9f61935fee5d55a0df8bd4b2013a679\">getAsString</a>( iter).<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string.html#aa9ab612f356c53479afc4c648c9ef94d\">asChar</a>(), uniform, fD3DEffect, d3dParameter);</div>\n\
<div class=\"line\">                                <span class=\"keywordflow\">break</span>;</div>\n\
<div class=\"line\">                        }</div>\n\
<div class=\"line\">                    }</div>\n\
<div class=\"line\">                }</div>\n\
<div class=\"line\">            }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">            <a name=\"_a55\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_legacy.html\">MGeometryLegacy</a>&amp; geometry = iter.<a name=\"a56\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_list.html#a2c08d17ca16945612458abffaa4e9744\">geometry</a>( <a name=\"a57\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_list.html#a726ca809ffd3d67ab4b8476646f26635a634ee767a8e90ff4d56e140459cca31f\">MGeometryList::kNone</a>);</div>\n\
<div class=\"line\">            <span class=\"keyword\">const</span> <span class=\"keywordtype\">void</span>* data;</div>\n\
<div class=\"line\">            <span class=\"keywordtype\">unsigned</span> <span class=\"keywordtype\">int</span> elements, count;</div>\n\
<div class=\"line\">            <span class=\"keywordflow\">if</span>( fVertexStructure.numElements() &amp;&amp; fVertexStructure.getBuffer( geometry, data, elements, count) == <a name=\"a58\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_status.html#a02ab596f4febca68da503aaf8dde3a80af0536797208144380691e2b376ffc1d1\">MStatus::kSuccess</a>)</div>\n\
<div class=\"line\">            {</div>\n\
<div class=\"line\">                <a name=\"_a59\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_primitive.html\">MGeometryPrimitive</a> primitives = geometry.<a name=\"a60\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_legacy.html#ad0b84023dd720ca2b0b8b05893dab358\">primitiveArray</a>( 0);</div>\n\
<div class=\"line\">                HLSLStateManager::sInstance.shapeCullMode( iter.<a name=\"a61\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_list.html#abadce204d1b2b8fab91dcad7581a359d\">cullMode</a>());</div>\n\
<div class=\"line\">                <span class=\"keywordflow\">for</span>( UINT p = 0; p &lt; numPasses; p++)</div>\n\
<div class=\"line\">                {</div>\n\
<div class=\"line\">                    <span class=\"keywordflow\">if</span>( !fD3DVertexDeclaration[ p]) <span class=\"keywordflow\">continue</span>;</div>\n\
<div class=\"line\">                    <span class=\"keywordflow\">if</span>( numPasses &gt; 1 || firstShape) </div>\n\
<div class=\"line\">                        HLSLStateManager::sInstance.BeginPass( fD3DEffect, p);</div>\n\
<div class=\"line\">                    <span class=\"keywordflow\">else</span> </div>\n\
<div class=\"line\">                        fD3DEffect-&gt;CommitChanges(); <span class=\"comment\">// Make sure any shape-dependent uniforms get sent down the to effect when rendering a single pass effect!</span></div>\n\
<div class=\"line\">                    firstShape = <span class=\"keyword\">false</span>;</div>\n\
<div class=\"line\">                    d3dDevice-&gt;SetVertexDeclaration( fD3DVertexDeclaration[ p]); </div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"><span class=\"preprocessor\">#ifdef MAX_SEGMENTED_BATCH_SIZE</span></div>\n\
<div class=\"line\">                    <span class=\"keywordtype\">unsigned</span> <span class=\"keywordtype\">int</span> numPrimitives = primitives.<a name=\"a62\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_primitive.html#ac9580a2ec3ad9690d0fb0ea0b3179fec\">elementCount</a>() / 3;</div>\n\
<div class=\"line\">                    <span class=\"keywordtype\">unsigned</span> <span class=\"keywordtype\">int</span> batchSize = numPrimitives / (numPrimitives / MAX_SEGMENTED_BATCH_SIZE + 1) + 1;</div>\n\
<div class=\"line\">                    <span class=\"keywordflow\">for</span>( <span class=\"keywordtype\">unsigned</span> <span class=\"keywordtype\">int</span> start = 0; start &lt; numPrimitives; )</div>\n\
<div class=\"line\">                    {</div>\n\
<div class=\"line\">                        <span class=\"keywordtype\">unsigned</span> <span class=\"keywordtype\">int</span> end = start + batchSize;</div>\n\
<div class=\"line\">                        <span class=\"keywordflow\">if</span>( end &gt; numPrimitives) end = numPrimitives;</div>\n\
<div class=\"line\">                        d3dDevice-&gt;DrawIndexedPrimitiveUP( D3DPT_TRIANGLELIST, 0, count, end - start, ((<span class=\"keyword\">const</span> <span class=\"keywordtype\">unsigned</span> <span class=\"keywordtype\">int</span>*)primitives.<a name=\"a63\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_primitive.html#ad3b74abc0bab69f337c70783e73f5bef\">data</a>()) + (start * 3), D3DFMT_INDEX32, data, elements);</div>\n\
<div class=\"line\">                        start = end;</div>\n\
<div class=\"line\">                    }</div>\n\
<div class=\"line\"><span class=\"preprocessor\">#else</span></div>\n\
<div class=\"line\">                    d3dDevice-&gt;DrawIndexedPrimitiveUP( D3DPT_TRIANGLELIST, 0, count, primitives.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_primitive.html#ac9580a2ec3ad9690d0fb0ea0b3179fec\">elementCount</a>() / 3, primitives.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_primitive.html#ad3b74abc0bab69f337c70783e73f5bef\">data</a>(), D3DFMT_INDEX32, data, elements);</div>\n\
<div class=\"line\"><span class=\"preprocessor\">#endif</span></div>\n\
<div class=\"line\">                    <span class=\"keywordflow\">if</span>( numPasses &gt; 1) fD3DEffect-&gt;EndPass();</div>\n\
<div class=\"line\">                }</div>\n\
<div class=\"line\">            }</div>\n\
<div class=\"line\">        }</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">if</span>( numPasses == 1) fD3DEffect-&gt;EndPass();</div>\n\
<div class=\"line\">        fD3DEffect-&gt;End();</div>\n\
<div class=\"line\">    }</div>\n\
<div class=\"line\">    <span class=\"keywordflow\">else</span></div>\n\
<div class=\"line\">    {</div>\n\
<div class=\"line\">        <span class=\"comment\">// Hokey DX draw</span></div>\n\
<div class=\"line\">        <span class=\"comment\">// There is no lighting so the only color will be the emissive color</span></div>\n\
<div class=\"line\">        D3DMATERIAL9 Material;</div>\n\
<div class=\"line\">        Material.Emissive.r = 0.0f; </div>\n\
<div class=\"line\">        Material.Emissive.g = 0.6f; </div>\n\
<div class=\"line\">        Material.Emissive.b = 0.0f; </div>\n\
<div class=\"line\">        Material.Emissive.a = 1.0f; </div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">        d3dDevice-&gt;SetMaterial( &amp;Material);</div>\n\
<div class=\"line\">        d3dDevice-&gt;LightEnable( 0, <span class=\"keyword\">false</span>);</div>\n\
<div class=\"line\">        d3dDevice-&gt;LightEnable( 1, <span class=\"keyword\">false</span>);</div>\n\
<div class=\"line\">        d3dDevice-&gt;SetFVF( D3DFVF_XYZ );</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">        <span class=\"keywordflow\">for</span>( ; !iter.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_list.html#add4bf50abae421d88b5549de6c11fc75\">isDone</a>(); iter.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_list.html#a041249f802c5bf4c2deae666610e03c4\">next</a>())</div>\n\
<div class=\"line\">        {</div>\n\
<div class=\"line\">            <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_legacy.html\">MGeometryLegacy</a>&amp; geometry = iter.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_list.html#a2c08d17ca16945612458abffaa4e9744\">geometry</a>( <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_list.html#a726ca809ffd3d67ab4b8476646f26635a634ee767a8e90ff4d56e140459cca31f\">MGeometryList::kNone</a> );</div>\n\
<div class=\"line\">            <span class=\"keyword\">const</span> <a name=\"_a64\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_data.html\">MGeometryData</a> position = geometry.<a name=\"a65\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_legacy.html#a117087d6021defde4f3202650c48f3ce\">position</a>();</div>\n\
<div class=\"line\">            <span class=\"keywordflow\">if</span>( position.<a name=\"a66\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_data.html#ac73113f892730ec6fce5da7e3273c9cd\">data</a>())</div>\n\
<div class=\"line\">            {</div>\n\
<div class=\"line\">                <span class=\"comment\">// set up the matrices as this aren&#39;t picked up automatically as may be</span></div>\n\
<div class=\"line\">                <span class=\"comment\">// different in the case of swatch rendering from the current directX state.</span></div>\n\
<div class=\"line\">                <span class=\"comment\">//</span></div>\n\
<div class=\"line\">                <span class=\"keyword\">const</span> <a name=\"_a67\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_matrix.html\">MMatrix</a>&amp; mtm = iter.<a name=\"a68\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_list.html#acd8c4aab0285c0e0077b1c12d8cfda9a\">objectToWorldMatrix</a>();</div>\n\
<div class=\"line\">                D3DXMATRIXA16 tm( (<span class=\"keywordtype\">float</span>)mtm.<a name=\"a69\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_matrix.html#a527b102f4eb0951cf4f391f828d3ca34\">matrix</a>[0][0], (<span class=\"keywordtype\">float</span>)mtm.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_matrix.html#a527b102f4eb0951cf4f391f828d3ca34\">matrix</a>[0][1], (<span class=\"keywordtype\">float</span>)mtm.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_matrix.html#a527b102f4eb0951cf4f391f828d3ca34\">matrix</a>[0][2], (<span class=\"keywordtype\">float</span>)mtm.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_matrix.html#a527b102f4eb0951cf4f391f828d3ca34\">matrix</a>[0][3], </div>\n\
<div class=\"line\">                                  (<span class=\"keywordtype\">float</span>)mtm.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_matrix.html#a527b102f4eb0951cf4f391f828d3ca34\">matrix</a>[1][0], (<span class=\"keywordtype\">float</span>)mtm.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_matrix.html#a527b102f4eb0951cf4f391f828d3ca34\">matrix</a>[1][1], (<span class=\"keywordtype\">float</span>)mtm.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_matrix.html#a527b102f4eb0951cf4f391f828d3ca34\">matrix</a>[1][2], (<span class=\"keywordtype\">float</span>)mtm.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_matrix.html#a527b102f4eb0951cf4f391f828d3ca34\">matrix</a>[1][3], </div>\n\
<div class=\"line\">                                  (<span class=\"keywordtype\">float</span>)mtm.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_matrix.html#a527b102f4eb0951cf4f391f828d3ca34\">matrix</a>[2][0], (<span class=\"keywordtype\">float</span>)mtm.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_matrix.html#a527b102f4eb0951cf4f391f828d3ca34\">matrix</a>[2][1], (<span class=\"keywordtype\">float</span>)mtm.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_matrix.html#a527b102f4eb0951cf4f391f828d3ca34\">matrix</a>[2][2], (<span class=\"keywordtype\">float</span>)mtm.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_matrix.html#a527b102f4eb0951cf4f391f828d3ca34\">matrix</a>[2][3], </div>\n\
<div class=\"line\">                                  (<span class=\"keywordtype\">float</span>)mtm.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_matrix.html#a527b102f4eb0951cf4f391f828d3ca34\">matrix</a>[3][0], (<span class=\"keywordtype\">float</span>)mtm.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_matrix.html#a527b102f4eb0951cf4f391f828d3ca34\">matrix</a>[3][1], (<span class=\"keywordtype\">float</span>)mtm.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_matrix.html#a527b102f4eb0951cf4f391f828d3ca34\">matrix</a>[3][2], (<span class=\"keywordtype\">float</span>)mtm.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_matrix.html#a527b102f4eb0951cf4f391f828d3ca34\">matrix</a>[3][3]);</div>\n\
<div class=\"line\">                </div>\n\
<div class=\"line\">                d3dDevice-&gt;SetTransform( D3DTS_WORLD, &amp;tm);</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">                <span class=\"comment\">// Setup the camera for drawing new stuff</span></div>\n\
<div class=\"line\">                <span class=\"keyword\">const</span> <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_matrix.html\">MMatrix</a>&amp; mproject = iter.<a name=\"a70\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_list.html#ab1858a6f233c72075f40621f70f137b5\">projectionMatrix</a>();</div>\n\
<div class=\"line\">                D3DXMATRIXA16 projection( (<span class=\"keywordtype\">float</span>)mproject.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_matrix.html#a527b102f4eb0951cf4f391f828d3ca34\">matrix</a>[0][0], (<span class=\"keywordtype\">float</span>)mproject.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_matrix.html#a527b102f4eb0951cf4f391f828d3ca34\">matrix</a>[0][1], (<span class=\"keywordtype\">float</span>)mproject.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_matrix.html#a527b102f4eb0951cf4f391f828d3ca34\">matrix</a>[0][2], (<span class=\"keywordtype\">float</span>)mproject.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_matrix.html#a527b102f4eb0951cf4f391f828d3ca34\">matrix</a>[0][3], </div>\n\
<div class=\"line\">                                  (<span class=\"keywordtype\">float</span>)mproject.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_matrix.html#a527b102f4eb0951cf4f391f828d3ca34\">matrix</a>[1][0], (<span class=\"keywordtype\">float</span>)mproject.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_matrix.html#a527b102f4eb0951cf4f391f828d3ca34\">matrix</a>[1][1], (<span class=\"keywordtype\">float</span>)mproject.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_matrix.html#a527b102f4eb0951cf4f391f828d3ca34\">matrix</a>[1][2], (<span class=\"keywordtype\">float</span>)mproject.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_matrix.html#a527b102f4eb0951cf4f391f828d3ca34\">matrix</a>[1][3], </div>\n\
<div class=\"line\">                                  (<span class=\"keywordtype\">float</span>)mproject.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_matrix.html#a527b102f4eb0951cf4f391f828d3ca34\">matrix</a>[2][0], (<span class=\"keywordtype\">float</span>)mproject.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_matrix.html#a527b102f4eb0951cf4f391f828d3ca34\">matrix</a>[2][1], (<span class=\"keywordtype\">float</span>)mproject.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_matrix.html#a527b102f4eb0951cf4f391f828d3ca34\">matrix</a>[2][2], (<span class=\"keywordtype\">float</span>)mproject.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_matrix.html#a527b102f4eb0951cf4f391f828d3ca34\">matrix</a>[2][3], </div>\n\
<div class=\"line\">                                  (<span class=\"keywordtype\">float</span>)mproject.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_matrix.html#a527b102f4eb0951cf4f391f828d3ca34\">matrix</a>[3][0], (<span class=\"keywordtype\">float</span>)mproject.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_matrix.html#a527b102f4eb0951cf4f391f828d3ca34\">matrix</a>[3][1], (<span class=\"keywordtype\">float</span>)mproject.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_matrix.html#a527b102f4eb0951cf4f391f828d3ca34\">matrix</a>[3][2], (<span class=\"keywordtype\">float</span>)mproject.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_matrix.html#a527b102f4eb0951cf4f391f828d3ca34\">matrix</a>[3][3]);</div>\n\
<div class=\"line\">                d3dDevice-&gt;SetTransform( D3DTS_PROJECTION, &amp;projection );</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">                <span class=\"keyword\">const</span> <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_matrix.html\">MMatrix</a>&amp; mview = iter.<a name=\"a71\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_list.html#a53c16ec1239d17f326fb7216ba8b91d8\">viewMatrix</a>();</div>\n\
<div class=\"line\">                D3DXMATRIXA16 view( (<span class=\"keywordtype\">float</span>)mview.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_matrix.html#a527b102f4eb0951cf4f391f828d3ca34\">matrix</a>[0][0], (<span class=\"keywordtype\">float</span>)mview.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_matrix.html#a527b102f4eb0951cf4f391f828d3ca34\">matrix</a>[0][1], (<span class=\"keywordtype\">float</span>)mview.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_matrix.html#a527b102f4eb0951cf4f391f828d3ca34\">matrix</a>[0][2], (<span class=\"keywordtype\">float</span>)mview.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_matrix.html#a527b102f4eb0951cf4f391f828d3ca34\">matrix</a>[0][3], </div>\n\
<div class=\"line\">                                  (<span class=\"keywordtype\">float</span>)mview.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_matrix.html#a527b102f4eb0951cf4f391f828d3ca34\">matrix</a>[1][0], (<span class=\"keywordtype\">float</span>)mview.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_matrix.html#a527b102f4eb0951cf4f391f828d3ca34\">matrix</a>[1][1], (<span class=\"keywordtype\">float</span>)mview.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_matrix.html#a527b102f4eb0951cf4f391f828d3ca34\">matrix</a>[1][2], (<span class=\"keywordtype\">float</span>)mview.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_matrix.html#a527b102f4eb0951cf4f391f828d3ca34\">matrix</a>[1][3], </div>\n\
<div class=\"line\">                                  (<span class=\"keywordtype\">float</span>)mview.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_matrix.html#a527b102f4eb0951cf4f391f828d3ca34\">matrix</a>[2][0], (<span class=\"keywordtype\">float</span>)mview.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_matrix.html#a527b102f4eb0951cf4f391f828d3ca34\">matrix</a>[2][1], (<span class=\"keywordtype\">float</span>)mview.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_matrix.html#a527b102f4eb0951cf4f391f828d3ca34\">matrix</a>[2][2], (<span class=\"keywordtype\">float</span>)mview.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_matrix.html#a527b102f4eb0951cf4f391f828d3ca34\">matrix</a>[2][3], </div>\n\
<div class=\"line\">                                  (<span class=\"keywordtype\">float</span>)mview.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_matrix.html#a527b102f4eb0951cf4f391f828d3ca34\">matrix</a>[3][0], (<span class=\"keywordtype\">float</span>)mview.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_matrix.html#a527b102f4eb0951cf4f391f828d3ca34\">matrix</a>[3][1], (<span class=\"keywordtype\">float</span>)mview.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_matrix.html#a527b102f4eb0951cf4f391f828d3ca34\">matrix</a>[3][2], (<span class=\"keywordtype\">float</span>)mview.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_matrix.html#a527b102f4eb0951cf4f391f828d3ca34\">matrix</a>[3][3]);</div>\n\
<div class=\"line\">                d3dDevice-&gt;SetTransform( D3DTS_VIEW, &amp;view );</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">                HLSLStateManager::sInstance.shapeCullMode( iter.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_list.html#abadce204d1b2b8fab91dcad7581a359d\">cullMode</a>(), <span class=\"keyword\">true</span>);</div>\n\
<div class=\"line\">                <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_primitive.html\">MGeometryPrimitive</a> primitives = geometry.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_legacy.html#ad0b84023dd720ca2b0b8b05893dab358\">primitiveArray</a>( 0);</div>\n\
<div class=\"line\">                d3dDevice-&gt;DrawIndexedPrimitiveUP( D3DPT_TRIANGLELIST, 0, position.<a name=\"a72\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_data.html#ac9580a2ec3ad9690d0fb0ea0b3179fec\">elementCount</a>(), primitives.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_primitive.html#ac9580a2ec3ad9690d0fb0ea0b3179fec\">elementCount</a>() / 3, primitives.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_primitive.html#ad3b74abc0bab69f337c70783e73f5bef\">data</a>(), D3DFMT_INDEX32, position.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_data.html#ac73113f892730ec6fce5da7e3273c9cd\">data</a>(), 3 * <span class=\"keyword\">sizeof</span>( float));</div>\n\
<div class=\"line\">            } </div>\n\
<div class=\"line\">            <span class=\"keywordflow\">else</span> </div>\n\
<div class=\"line\">            {</div>\n\
<div class=\"line\">                 <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_status.html#a02ab596f4febca68da503aaf8dde3a80a1ef6c2d725fb4bec3e7e840d28adbc00\">MStatus::kFailure</a>;</div>\n\
<div class=\"line\">            }</div>\n\
<div class=\"line\">        }</div>\n\
<div class=\"line\">    }</div>\n\
<div class=\"line\">    <span class=\"keywordflow\">return</span> <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_status.html#a02ab596f4febca68da503aaf8dde3a80af0536797208144380691e2b376ffc1d1\">MStatus::kSuccess</a>;</div>\n\
<div class=\"line\">}</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"><span class=\"comment\">/* virtual */</span></div>\n\
<div class=\"line\"><span class=\"keywordtype\">unsigned</span> <span class=\"keywordtype\">int</span> hlslShader::transparencyOptions()</div>\n\
<div class=\"line\">{</div>\n\
<div class=\"line\">    <span class=\"keywordflow\">if</span> (fTechniqueHasBlending)</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">return</span> ( kIsTransparent | kNoTransparencyFrontBackCull | kNoTransparencyPolygonSort );</div>\n\
<div class=\"line\">    <span class=\"keywordflow\">return</span> 0;</div>\n\
<div class=\"line\">}</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"><span class=\"comment\">// Query the renderers supported by this shader</span></div>\n\
<div class=\"line\"><span class=\"comment\">//</span></div>\n\
<div class=\"line\"><span class=\"keyword\">const</span> <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_render_profile.html\">MRenderProfile</a>&amp; hlslShader::profile() { <span class=\"keywordflow\">return</span> sProfile; }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"><span class=\"keywordtype\">void</span> hlslShader::setupUniform( D3DXHANDLE d3dParameter, <span class=\"keyword\">const</span> <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string.html\">MString</a>&amp; prefix)</div>\n\
<div class=\"line\">{</div>\n\
<div class=\"line\">    <span class=\"keywordflow\">if</span>( d3dParameter)</div>\n\
<div class=\"line\">    {</div>\n\
<div class=\"line\">        D3DXPARAMETER_DESC parameterDesc;</div>\n\
<div class=\"line\">        fD3DEffect-&gt;GetParameterDesc( d3dParameter, &amp;parameterDesc);</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">if</span>( parameterDesc.Class == D3DXPC_STRUCT)</div>\n\
<div class=\"line\">        {</div>\n\
<div class=\"line\">            <span class=\"keywordflow\">for</span>( <span class=\"keywordtype\">unsigned</span> <span class=\"keywordtype\">int</span> p = 0; p &lt; parameterDesc.StructMembers; p++)</div>\n\
<div class=\"line\">            {</div>\n\
<div class=\"line\">                setupUniform( fD3DEffect-&gt;GetParameter( d3dParameter, p), prefix + <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string.html\">MString</a>( parameterDesc.Name) + <span class=\"stringliteral\">&quot;.&quot;</span>);</div>\n\
<div class=\"line\">            }</div>\n\
<div class=\"line\">        }</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">else</span></div>\n\
<div class=\"line\">        {</div>\n\
<div class=\"line\">            <span class=\"comment\">// Is this a special parameter?</span></div>\n\
<div class=\"line\">            <span class=\"keywordflow\">if</span>( parameterDesc.Semantic &amp;&amp; !_stricmp( parameterDesc.Semantic, <span class=\"stringliteral\">&quot;SasGlobal&quot;</span>))</div>\n\
<div class=\"line\">            {</div>\n\
<div class=\"line\">                LPCSTR sasDescription;</div>\n\
<div class=\"line\">                <span class=\"keywordflow\">if</span>( GetAnnotation( d3dParameter, <span class=\"stringliteral\">&quot;SasEffectDescription&quot;</span>, sasDescription) &amp;&amp; *sasDescription)</div>\n\
<div class=\"line\">                    fDescription += sasDescription;</div>\n\
<div class=\"line\">                <span class=\"keywordflow\">return</span>;</div>\n\
<div class=\"line\">            }</div>\n\
<div class=\"line\">            <span class=\"keywordflow\">else</span> <span class=\"keywordflow\">if</span>( parameterDesc.Name &amp;&amp; !_stricmp( parameterDesc.Name, <span class=\"stringliteral\">&quot;description&quot;</span>) &amp;&amp; parameterDesc.Type == D3DXPT_STRING)</div>\n\
<div class=\"line\">            {</div>\n\
<div class=\"line\">                LPCSTR Value; </div>\n\
<div class=\"line\">                <span class=\"keywordflow\">if</span>( fD3DEffect-&gt;GetString( d3dParameter, &amp;Value) == D3D_OK) </div>\n\
<div class=\"line\">                    fDescription += Value;</div>\n\
<div class=\"line\">                <span class=\"keywordflow\">return</span>;</div>\n\
<div class=\"line\">            }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">            MUniformParameter::DataType type = ConvertType( d3dParameter, parameterDesc);</div>\n\
<div class=\"line\">            <span class=\"keywordflow\">if</span>( type != MUniformParameter::kTypeUnknown)</div>\n\
<div class=\"line\">            {</div>\n\
<div class=\"line\">                MUniformParameter::DataSemantic semantic = ConvertSemantic( d3dParameter, parameterDesc);</div>\n\
<div class=\"line\">                <span class=\"keywordtype\">int</span> rows = parameterDesc.Rows;</div>\n\
<div class=\"line\">                <span class=\"keywordtype\">int</span> columns = parameterDesc.Columns;</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">                <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string.html\">MString</a> uiName = prefix + parameterDesc.Name;</div>\n\
<div class=\"line\">                <span class=\"comment\">//Try replacing name by the uiname if it is specified</span></div>\n\
<div class=\"line\">                LPCSTR uiNameValue = NULL ;</div>\n\
<div class=\"line\">                <span class=\"keywordtype\">bool</span> hasUIName = GetAnnotation(d3dParameter, <span class=\"stringliteral\">&quot;UIName&quot;</span>, uiNameValue) &amp;&amp; uiNameValue;</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">                <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html\">MUniformParameter</a> uniform( uiName, type, semantic, rows, columns, (<span class=\"keywordtype\">void</span>*)d3dParameter);</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">                <span class=\"comment\">// If shader author has provided a UIName, then</span></div>\n\
<div class=\"line\">                <span class=\"comment\">// tell Maya to use the UIName for the attribute&#39;s &#39;Nice Name&#39;:</span></div>\n\
<div class=\"line\">                <span class=\"keywordflow\">if</span> (hasUIName)</div>\n\
<div class=\"line\">                    uniform.<a name=\"a73\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html#ae6a07a795a6f2ad194e14c6735f44450\">setUINiceName</a>( uiNameValue );</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">                updateUIVisibilityFromAnnotation( d3dParameter, uniform );</div>\n\
<div class=\"line\">                updateRangeFromAnnotation( d3dParameter, uniform );</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">                <span class=\"keywordflow\">switch</span>( type)</div>\n\
<div class=\"line\">                {</div>\n\
<div class=\"line\">                    <span class=\"keywordflow\">case</span> MUniformParameter::kTypeFloat: </div>\n\
<div class=\"line\">                        { </div>\n\
<div class=\"line\">                            <span class=\"keywordtype\">int</span> length = rows * columns;</div>\n\
<div class=\"line\">                            FLOAT* Value = <span class=\"keyword\">new</span> FLOAT[ length];</div>\n\
<div class=\"line\">                            <span class=\"keywordflow\">if</span>( Value)</div>\n\
<div class=\"line\">                            {</div>\n\
<div class=\"line\">                                <span class=\"keywordflow\">if</span>( fD3DEffect-&gt;GetFloatArray( d3dParameter, Value, length) == D3D_OK) </div>\n\
<div class=\"line\">                                    uniform.<a name=\"a74\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html#a71c021490db45149a9bb635bfe04cddd\">setAsFloatArray</a>( Value, length); </div>\n\
<div class=\"line\">                                <span class=\"keyword\">delete</span> [] Value;</div>\n\
<div class=\"line\">                            }</div>\n\
<div class=\"line\">                            <span class=\"keywordflow\">break</span>; </div>\n\
<div class=\"line\">                        }</div>\n\
<div class=\"line\">                    <span class=\"keywordflow\">case</span> MUniformParameter::kTypeString: { LPCSTR Value; <span class=\"keywordflow\">if</span>( fD3DEffect-&gt;GetString( d3dParameter, &amp;Value) == D3D_OK) uniform.<a name=\"a75\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html#a702414289a74bf62b6ef182c64378292\">setAsString</a>( <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string.html\">MString</a>( Value)); <span class=\"keywordflow\">break</span>; }</div>\n\
<div class=\"line\">                    <span class=\"keywordflow\">case</span> MUniformParameter::kTypeBool: { BOOL Value; <span class=\"keywordflow\">if</span>( fD3DEffect-&gt;GetBool( d3dParameter, &amp;Value) == D3D_OK) uniform.<a name=\"a76\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html#adce6ab6521852e06df1e9ac4a5cda02d\">setAsBool</a>( Value ? <span class=\"keyword\">true</span> : <span class=\"keyword\">false</span>); <span class=\"keywordflow\">break</span>; }</div>\n\
<div class=\"line\">                    <span class=\"keywordflow\">case</span> MUniformParameter::kTypeInt: { INT Value; <span class=\"keywordflow\">if</span>( fD3DEffect-&gt;GetInt( d3dParameter, &amp;Value) == D3D_OK) uniform.<a name=\"a77\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html#ad71d705cfb54ef95d43a83d555115f43\">setAsInt</a>( Value); <span class=\"keywordflow\">break</span>; }</div>\n\
<div class=\"line\">                    <span class=\"keywordflow\">default</span>:</div>\n\
<div class=\"line\">                        <span class=\"keywordflow\">if</span>( type &gt;= MUniformParameter::kType1DTexture &amp;&amp; type &lt;= MUniformParameter::kTypeEnvTexture)</div>\n\
<div class=\"line\">                        {</div>\n\
<div class=\"line\">                            LPCSTR resource;</div>\n\
<div class=\"line\">                            <span class=\"keywordflow\">if</span>( GetAnnotation( d3dParameter, <span class=\"stringliteral\">&quot;ResourceName&quot;</span>, resource) &amp;&amp; *resource)</div>\n\
<div class=\"line\">                                uniform.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html#a702414289a74bf62b6ef182c64378292\">setAsString</a>( findResource( <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string.html\">MString</a>( resource), fShader));</div>\n\
<div class=\"line\">                            <span class=\"keywordflow\">else</span> <span class=\"keywordflow\">if</span>( GetAnnotation( d3dParameter, <span class=\"stringliteral\">&quot;SasResourceAddress&quot;</span>, resource) &amp;&amp; *resource)</div>\n\
<div class=\"line\">                                uniform.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html#a702414289a74bf62b6ef182c64378292\">setAsString</a>( findResource( <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string.html\">MString</a>( resource), fShader));</div>\n\
<div class=\"line\">                        }</div>\n\
<div class=\"line\">                }</div>\n\
<div class=\"line\">                fUniformParameters.append( uniform);</div>\n\
<div class=\"line\">            }</div>\n\
<div class=\"line\">        }</div>\n\
<div class=\"line\">    }</div>\n\
<div class=\"line\">}</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"><span class=\"keywordtype\">void</span> hlslShader::updateUIVisibilityFromAnnotation( D3DXHANDLE d3dParameter, <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html\">MUniformParameter</a>&amp; uniform )</div>\n\
<div class=\"line\">{</div>\n\
<div class=\"line\">    BOOL visible = <span class=\"keyword\">true</span>;</div>\n\
<div class=\"line\">    <span class=\"keywordflow\">if</span>( GetBOOLAnnotation( d3dParameter, <span class=\"stringliteral\">&quot;SasUiVisible&quot;</span>, visible) )</div>\n\
<div class=\"line\">    {</div>\n\
<div class=\"line\">        uniform.<a name=\"a78\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html#ab5ef06b49e994b093b442788b96167d5\">setUIHidden</a>(!visible);</div>\n\
<div class=\"line\">    }</div>\n\
<div class=\"line\">    <span class=\"keywordflow\">else</span></div>\n\
<div class=\"line\">    {</div>\n\
<div class=\"line\">        LPCSTR uiTypeValue = NULL;</div>\n\
<div class=\"line\">        <span class=\"keywordtype\">bool</span>  foundUIType = GetAnnotation( d3dParameter, <span class=\"stringliteral\">&quot;UIType&quot;</span>, uiTypeValue);</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">if</span> (foundUIType &amp;&amp; !_stricmp(uiTypeValue, <span class=\"stringliteral\">&quot;None&quot;</span>))</div>\n\
<div class=\"line\">        {</div>\n\
<div class=\"line\">            uniform.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html#ab5ef06b49e994b093b442788b96167d5\">setUIHidden</a>(<span class=\"keyword\">true</span>);</div>\n\
<div class=\"line\">        }</div>\n\
<div class=\"line\">        <span class=\"comment\">// As per NVidia SAS docs v1.0.3:</span></div>\n\
<div class=\"line\">        LPCSTR uiWidgetValue = NULL;</div>\n\
<div class=\"line\">        foundUIType = GetAnnotation( d3dParameter, <span class=\"stringliteral\">&quot;UIWidget&quot;</span>, uiWidgetValue);</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">if</span> (foundUIType &amp;&amp; !_stricmp(uiWidgetValue, <span class=\"stringliteral\">&quot;None&quot;</span>))</div>\n\
<div class=\"line\">        {</div>\n\
<div class=\"line\">            uniform.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html#ab5ef06b49e994b093b442788b96167d5\">setUIHidden</a>(<span class=\"keyword\">true</span>);</div>\n\
<div class=\"line\">        }</div>\n\
<div class=\"line\">    }</div>\n\
<div class=\"line\">}</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"><span class=\"keywordtype\">void</span> hlslShader::updateRangeFromAnnotation( D3DXHANDLE d3dParameter, <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html\">MUniformParameter</a>&amp; uniform)</div>\n\
<div class=\"line\">{</div>\n\
<div class=\"line\">    <span class=\"keywordflow\">switch</span>(uniform.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html#ac52395416dfb965501c67061d7198c1c\">type</a>())</div>\n\
<div class=\"line\">    {</div>\n\
<div class=\"line\">    <span class=\"keywordflow\">case</span> MUniformParameter::kTypeFloat:</div>\n\
<div class=\"line\">        {</div>\n\
<div class=\"line\">            <span class=\"keywordtype\">float</span> uiMinFloat = NULL;</div>\n\
<div class=\"line\">            <span class=\"keywordflow\">if</span>(GetAnnotation(d3dParameter, <span class=\"stringliteral\">&quot;SasUiMin&quot;</span>,uiMinFloat))</div>\n\
<div class=\"line\">            {</div>\n\
<div class=\"line\">                <span class=\"keywordtype\">double</span> uiMin = uiMinFloat;</div>\n\
<div class=\"line\">                uniform.<a name=\"a79\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html#a85e791f9ffcc0664e26d39249e9f3576\">setRangeMin</a>(uiMin);</div>\n\
<div class=\"line\">            }</div>\n\
<div class=\"line\">            <span class=\"keywordflow\">else</span> <span class=\"keywordflow\">if</span>(GetAnnotation(d3dParameter, <span class=\"stringliteral\">&quot;UIMin&quot;</span>,uiMinFloat))</div>\n\
<div class=\"line\">            {</div>\n\
<div class=\"line\">                <span class=\"keywordtype\">double</span> uiMin = uiMinFloat;</div>\n\
<div class=\"line\">                uniform.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html#a85e791f9ffcc0664e26d39249e9f3576\">setRangeMin</a>(uiMin);</div>\n\
<div class=\"line\">            }</div>\n\
<div class=\"line\">            <span class=\"keywordflow\">else</span> <span class=\"keywordflow\">if</span>(GetAnnotation(d3dParameter, <span class=\"stringliteral\">&quot;uimin&quot;</span>,uiMinFloat))</div>\n\
<div class=\"line\">            {</div>\n\
<div class=\"line\">                <span class=\"keywordtype\">double</span> uiMin = uiMinFloat;</div>\n\
<div class=\"line\">                uniform.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html#a85e791f9ffcc0664e26d39249e9f3576\">setRangeMin</a>(uiMin);</div>\n\
<div class=\"line\">            }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">            <span class=\"keywordtype\">float</span> uiMaxFloat = NULL;</div>\n\
<div class=\"line\">            <span class=\"keywordflow\">if</span>(GetAnnotation(d3dParameter, <span class=\"stringliteral\">&quot;SasUiMax&quot;</span>,uiMaxFloat))</div>\n\
<div class=\"line\">            {</div>\n\
<div class=\"line\">                <span class=\"keywordtype\">double</span> uiMax = uiMaxFloat;</div>\n\
<div class=\"line\">                uniform.<a name=\"a80\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html#aa5e8b1737ecebe3761c33ba56454849c\">setRangeMax</a>(uiMax);</div>\n\
<div class=\"line\">            }</div>\n\
<div class=\"line\">            <span class=\"keywordflow\">else</span> <span class=\"keywordflow\">if</span>(GetAnnotation(d3dParameter, <span class=\"stringliteral\">&quot;UIMax&quot;</span>,uiMaxFloat))</div>\n\
<div class=\"line\">            {</div>\n\
<div class=\"line\">                <span class=\"keywordtype\">double</span> uiMax = uiMaxFloat;</div>\n\
<div class=\"line\">                uniform.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html#aa5e8b1737ecebe3761c33ba56454849c\">setRangeMax</a>(uiMax);</div>\n\
<div class=\"line\">            }</div>\n\
<div class=\"line\">            <span class=\"keywordflow\">else</span> <span class=\"keywordflow\">if</span>(GetAnnotation(d3dParameter, <span class=\"stringliteral\">&quot;uimax&quot;</span>,uiMaxFloat))</div>\n\
<div class=\"line\">            {</div>\n\
<div class=\"line\">                <span class=\"keywordtype\">double</span> uiMax = uiMaxFloat;</div>\n\
<div class=\"line\">                uniform.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html#aa5e8b1737ecebe3761c33ba56454849c\">setRangeMax</a>(uiMax);</div>\n\
<div class=\"line\">            }</div>\n\
<div class=\"line\">        }</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">break</span>;</div>\n\
<div class=\"line\">    <span class=\"keywordflow\">case</span> MUniformParameter::kTypeInt:</div>\n\
<div class=\"line\">        {</div>\n\
<div class=\"line\">            <span class=\"keywordtype\">int</span> uiMinInt = NULL;</div>\n\
<div class=\"line\">            <span class=\"keywordflow\">if</span>(GetAnnotation(d3dParameter, <span class=\"stringliteral\">&quot;SasUiMin&quot;</span>,uiMinInt))</div>\n\
<div class=\"line\">            {</div>\n\
<div class=\"line\">                <span class=\"keywordtype\">double</span> uiMin = uiMinInt;</div>\n\
<div class=\"line\">                uniform.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html#a85e791f9ffcc0664e26d39249e9f3576\">setRangeMin</a>(uiMin);</div>\n\
<div class=\"line\">            }</div>\n\
<div class=\"line\">            <span class=\"keywordflow\">else</span> <span class=\"keywordflow\">if</span>(GetAnnotation(d3dParameter, <span class=\"stringliteral\">&quot;UIMin&quot;</span>,uiMinInt))</div>\n\
<div class=\"line\">            {</div>\n\
<div class=\"line\">                <span class=\"keywordtype\">double</span> uiMin = uiMinInt;</div>\n\
<div class=\"line\">                uniform.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html#a85e791f9ffcc0664e26d39249e9f3576\">setRangeMin</a>(uiMin);</div>\n\
<div class=\"line\">            }</div>\n\
<div class=\"line\">            <span class=\"keywordflow\">else</span> <span class=\"keywordflow\">if</span>(GetAnnotation(d3dParameter, <span class=\"stringliteral\">&quot;uimin&quot;</span>,uiMinInt))</div>\n\
<div class=\"line\">            {</div>\n\
<div class=\"line\">                <span class=\"keywordtype\">double</span> uiMin = uiMinInt;</div>\n\
<div class=\"line\">                uniform.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html#a85e791f9ffcc0664e26d39249e9f3576\">setRangeMin</a>(uiMin);</div>\n\
<div class=\"line\">            }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">            <span class=\"keywordtype\">int</span> uiMaxInt = NULL;</div>\n\
<div class=\"line\">            <span class=\"keywordflow\">if</span>(GetAnnotation(d3dParameter, <span class=\"stringliteral\">&quot;SasUiMax&quot;</span>,uiMaxInt))</div>\n\
<div class=\"line\">            {</div>\n\
<div class=\"line\">                <span class=\"keywordtype\">double</span> uiMax = uiMaxInt;</div>\n\
<div class=\"line\">                uniform.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html#aa5e8b1737ecebe3761c33ba56454849c\">setRangeMax</a>(uiMax);</div>\n\
<div class=\"line\">            }</div>\n\
<div class=\"line\">            <span class=\"keywordflow\">else</span> <span class=\"keywordflow\">if</span>(GetAnnotation(d3dParameter, <span class=\"stringliteral\">&quot;UIMax&quot;</span>,uiMaxInt))</div>\n\
<div class=\"line\">            {</div>\n\
<div class=\"line\">                <span class=\"keywordtype\">double</span> uiMax = uiMaxInt;</div>\n\
<div class=\"line\">                uniform.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html#aa5e8b1737ecebe3761c33ba56454849c\">setRangeMax</a>(uiMax);</div>\n\
<div class=\"line\">            }</div>\n\
<div class=\"line\">            <span class=\"keywordflow\">else</span> <span class=\"keywordflow\">if</span>(GetAnnotation(d3dParameter, <span class=\"stringliteral\">&quot;uimax&quot;</span>,uiMaxInt))</div>\n\
<div class=\"line\">            {</div>\n\
<div class=\"line\">                <span class=\"keywordtype\">double</span> uiMax = uiMaxInt;</div>\n\
<div class=\"line\">                uniform.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html#aa5e8b1737ecebe3761c33ba56454849c\">setRangeMax</a>(uiMax);</div>\n\
<div class=\"line\">            }</div>\n\
<div class=\"line\">        }</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">break</span>;</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <span class=\"keywordflow\">default</span>:</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">break</span>;</div>\n\
<div class=\"line\">    };</div>\n\
<div class=\"line\">}</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"><span class=\"keywordtype\">void</span> hlslShader::postDuplicateCB(<span class=\"keywordtype\">void</span>* data)</div>\n\
<div class=\"line\">{</div>\n\
<div class=\"line\">    hlslShader* shader = (hlslShader*)data;</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <span class=\"comment\">// Remove the callback.</span></div>\n\
<div class=\"line\">    <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_message.html#a50fe995add3ce133b8b56551abb4ed09\">MMessage::removeCallback</a>(shader-&gt;fPostDuplicateCallbackId);</div>\n\
<div class=\"line\">    shader-&gt;fPostDuplicateCallbackId = NULL;</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <span class=\"comment\">// Reload the shader file.</span></div>\n\
<div class=\"line\">    shader-&gt;setShader(shader-&gt;fShader);</div>\n\
<div class=\"line\">}</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"><span class=\"comment\">//</span></div>\n\
<div class=\"line\"><span class=\"comment\">// Set the shader we&#39;re using</span></div>\n\
<div class=\"line\"><span class=\"comment\">//</span></div>\n\
<div class=\"line\"><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_status.html\">MStatus</a> hlslShader::setShader( <span class=\"keyword\">const</span> <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string.html\">MString</a>&amp; shader)</div>\n\
<div class=\"line\">{</div>\n\
<div class=\"line\">    fDiagnostics = <span class=\"stringliteral\">&quot;&quot;</span>;</div>\n\
<div class=\"line\">    fDescription = <span class=\"stringliteral\">&quot;&quot;</span>;</div>\n\
<div class=\"line\">    fShader = shader;</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_d3_d9_renderer.html\">MD3D9Renderer</a> *pRenderer = <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_d3_d9_renderer.html#a7e20874dc16aef527b927346672fdbfa\">MD3D9Renderer::theRenderer</a>();</div>\n\
<div class=\"line\">    <span class=\"keywordflow\">if</span> (pRenderer != NULL) {</div>\n\
<div class=\"line\">        IDirect3DDevice9* pDevice = pRenderer-&gt;getD3D9Device();</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">if</span>( pDevice )</div>\n\
<div class=\"line\">        {</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">            release();</div>\n\
<div class=\"line\">            fTechniques.setLength( 0);</div>\n\
<div class=\"line\">            LPD3DXBUFFER errors = NULL;</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">            <span class=\"comment\">// Make sure the shader&#39;s directory is current, as the compiler will try and resolve</span></div>\n\
<div class=\"line\">            <span class=\"comment\">// everything relative to that</span></div>\n\
<div class=\"line\">            <span class=\"comment\">//</span></div>\n\
<div class=\"line\">            <a name=\"_a81\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_file_object.html\">MFileObject</a> fileObject;</div>\n\
<div class=\"line\">            <span class=\"comment\">// we remove &quot;/&quot; or &quot;\\\\&quot; at the beginning of variable shader </span></div>\n\
<div class=\"line\">            <span class=\"comment\">// if it is relative path</span></div>\n\
<div class=\"line\">            <span class=\"keyword\">struct </span>stat statBuf;</div>\n\
<div class=\"line\">            <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string.html\">MString</a> shaderSimpleName;</div>\n\
<div class=\"line\">            <span class=\"keywordflow\">if</span> (stat(shader.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string.html#aa9ab612f356c53479afc4c648c9ef94d\">asChar</a>(), &amp;statBuf) == -1)</div>\n\
<div class=\"line\">            {</div>\n\
<div class=\"line\">                <span class=\"keywordflow\">if</span>(shader.<a name=\"a82\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string.html#a7487f32861d955d3ac0d8722cc5797b2\">index</a>(<span class=\"charliteral\">&#39;/&#39;</span>) == 0 || shader.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string.html#a7487f32861d955d3ac0d8722cc5797b2\">index</a>(<span class=\"charliteral\">&#39;\\\\&#39;</span>) == 0)</div>\n\
<div class=\"line\">                    shaderSimpleName = shader.<a name=\"a83\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string.html#a41ba57372bc1082383b4f1929a8030fa\">substring</a>(1, shader.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string.html#a580388f31f60c46fac867ca48a48da1e\">length</a>() - 1);</div>\n\
<div class=\"line\">                <span class=\"keywordflow\">else</span></div>\n\
<div class=\"line\">                    shaderSimpleName = shader;</div>\n\
<div class=\"line\">            }</div>\n\
<div class=\"line\">            <span class=\"keywordflow\">else</span></div>\n\
<div class=\"line\">            {</div>\n\
<div class=\"line\">                shaderSimpleName = shader;</div>\n\
<div class=\"line\">            }</div>\n\
<div class=\"line\">            </div>\n\
<div class=\"line\">            fileObject.<a name=\"a84\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_file_object.html#a4b3d5deec3dc9475f712c8e0f2f4d9a2\">setResolveMethod</a>( MFileObject::kInputFile);</div>\n\
<div class=\"line\">            fileObject.<a name=\"a85\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_file_object.html#ac14aefbfe38c2711256eb8c14a3194ee\">setRawFullName</a>( shaderSimpleName);</div>\n\
<div class=\"line\">            <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string.html\">MString</a> resolvedPath ;</div>\n\
<div class=\"line\">            resolvedPath = fileObject.<a name=\"a86\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_file_object.html#a7a4d2fada6eb436c6e74f1e62212c218\">resolvedPath</a>();</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">            <span class=\"comment\">// for bug 275673</span></div>\n\
<div class=\"line\">            <span class=\"comment\">// if shader include directory name, for example /shader/...</span></div>\n\
<div class=\"line\">            <span class=\"comment\">// resolvePath will combine the directory, so directory name in variable shader</span></div>\n\
<div class=\"line\">            <span class=\"comment\">// is redundant. We remove directory name in variable shader</span></div>\n\
<div class=\"line\">            <span class=\"keywordtype\">int</span> idx = shaderSimpleName.<a name=\"a87\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string.html#a2f0c58e22c8c209d0ea924de9913993a\">rindex</a>(<span class=\"charliteral\">&#39;/&#39;</span>);</div>\n\
<div class=\"line\">            <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string.html\">MString</a> shaderName;</div>\n\
<div class=\"line\">            <span class=\"keywordflow\">if</span>(idx == -1)</div>\n\
<div class=\"line\">            {</div>\n\
<div class=\"line\">                shaderName = shaderSimpleName;</div>\n\
<div class=\"line\">            }</div>\n\
<div class=\"line\">            <span class=\"keywordflow\">else</span></div>\n\
<div class=\"line\">            {</div>\n\
<div class=\"line\">                shaderName = shaderSimpleName.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string.html#a41ba57372bc1082383b4f1929a8030fa\">substring</a>(idx + 1, shaderSimpleName.length() - 1);</div>\n\
<div class=\"line\">            }</div>\n\
<div class=\"line\">            TCHAR pwd[ MAX_PATH];</div>\n\
<div class=\"line\">            <span class=\"keywordflow\">if</span>( resolvedPath.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string.html#a580388f31f60c46fac867ca48a48da1e\">length</a>() &gt; 0)</div>\n\
<div class=\"line\">            {</div>\n\
<div class=\"line\">                ::GetCurrentDirectory( MAX_PATH, pwd);</div>\n\
<div class=\"line\">                ::SetCurrentDirectory( resolvedPath.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string.html#aa9ab612f356c53479afc4c648c9ef94d\">asChar</a>());</div>\n\
<div class=\"line\">            }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">            <span class=\"comment\">// Note that for some strange reason, DX9 doesn&#39;t support D3DXSHADER_ENABLE_BACKWARDS_COMPATIBILITY,</span></div>\n\
<div class=\"line\">            <span class=\"comment\">// so we try the old DX9 compiler separately. We can remove the second attempt once we move to DX10</span></div>\n\
<div class=\"line\">            <span class=\"comment\">// (which doesn&#39;t support the D3DXSHADER_USE_LEGACY_D3DX9_31_DLL  flag)</span></div>\n\
<div class=\"line\">            <span class=\"comment\">//</span></div>\n\
<div class=\"line\"><span class=\"preprocessor\">#ifndef D3DXSHADER_ENABLE_BACKWARDS_COMPATIBILITY</span></div>\n\
<div class=\"line\"><span class=\"preprocessor\">#define D3DXSHADER_ENABLE_BACKWARDS_COMPATIBILITY 0</span></div>\n\
<div class=\"line\"><span class=\"preprocessor\">#endif</span></div>\n\
<div class=\"line\">            <span class=\"keywordflow\">if</span>( FAILED( D3DXCreateEffectFromFile( pDevice, shaderName.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string.html#aa9ab612f356c53479afc4c648c9ef94d\">asChar</a>(), NULL, NULL, D3DXSHADER_ENABLE_BACKWARDS_COMPATIBILITY, NULL, &amp;fD3DEffect, &amp;errors)) </div>\n\
<div class=\"line\"><span class=\"preprocessor\">#ifdef D3DXSHADER_USE_LEGACY_D3DX9_31_DLL</span></div>\n\
<div class=\"line\">             &amp;&amp; FAILED( D3DXCreateEffectFromFile( pDevice, shaderName.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string.html#aa9ab612f356c53479afc4c648c9ef94d\">asChar</a>(), NULL, NULL, D3DXSHADER_USE_LEGACY_D3DX9_31_DLL, NULL, &amp;fD3DEffect, NULL))</div>\n\
<div class=\"line\"><span class=\"preprocessor\">#endif</span></div>\n\
<div class=\"line\">                )</div>\n\
<div class=\"line\">            {</div>\n\
<div class=\"line\">                fDiagnostics += <span class=\"stringliteral\">&quot;Error trying to create effect &quot;</span> + shader + <span class=\"stringliteral\">&quot;:\\n\\t&quot;</span>;</div>\n\
<div class=\"line\">                <span class=\"keywordflow\">if</span>( errors)</div>\n\
<div class=\"line\">                    fDiagnostics += (<span class=\"keyword\">const</span> <span class=\"keywordtype\">char</span>*)errors-&gt;GetBufferPointer();</div>\n\
<div class=\"line\">                fDiagnostics += <span class=\"stringliteral\">&quot;\\n&quot;</span>;</div>\n\
<div class=\"line\">            }</div>\n\
<div class=\"line\">            <span class=\"keywordflow\">else</span></div>\n\
<div class=\"line\">            {</div>\n\
<div class=\"line\">                <span class=\"keywordflow\">if</span>( errors)</div>\n\
<div class=\"line\">                    fDiagnostics += (<span class=\"keyword\">const</span> <span class=\"keywordtype\">char</span>*)errors-&gt;GetBufferPointer();</div>\n\
<div class=\"line\">                fD3DEffect-&gt;SetStateManager( &amp;HLSLStateManager::sInstance);</div>\n\
<div class=\"line\">                fD3DEffect-&gt;GetDesc( &amp;fD3DEffectDesc);</div>\n\
<div class=\"line\">                <span class=\"keywordflow\">for</span>( <span class=\"keywordtype\">unsigned</span> <span class=\"keywordtype\">int</span> t = 0; t &lt; fD3DEffectDesc.Techniques; t++)</div>\n\
<div class=\"line\">                {</div>\n\
<div class=\"line\">                    D3DXHANDLE technique = fD3DEffect-&gt;GetTechnique( t);</div>\n\
<div class=\"line\">                    <span class=\"keywordflow\">if</span>( technique)</div>\n\
<div class=\"line\">                    {</div>\n\
<div class=\"line\"><span class=\"preprocessor\">#ifdef VALIDATE_TECHNIQUE_LIST</span></div>\n\
<div class=\"line\">                        <span class=\"keywordflow\">if</span>( fD3DEffect-&gt;ValidateTechnique( technique))</div>\n\
<div class=\"line\">#endif</div>\n\
<div class=\"line\">                        {</div>\n\
<div class=\"line\">                            D3DXTECHNIQUE_DESC techniqueDesc;</div>\n\
<div class=\"line\">                            fD3DEffect-&gt;GetTechniqueDesc( technique, &amp;techniqueDesc);</div>\n\
<div class=\"line\">                            fTechniques.append( techniqueDesc.Name);</div>\n\
<div class=\"line\">                        }</div>\n\
<div class=\"line\">                    }</div>\n\
<div class=\"line\">                }</div>\n\
<div class=\"line\">            }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">            <span class=\"comment\">// Restore the previous working directory if we changed it</span></div>\n\
<div class=\"line\">            <span class=\"keywordflow\">if</span>( resolvedPath.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string.html#a580388f31f60c46fac867ca48a48da1e\">length</a>() &gt; 0)</div>\n\
<div class=\"line\">            {</div>\n\
<div class=\"line\">                ::SetCurrentDirectory( pwd);</div>\n\
<div class=\"line\">            }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">            <span class=\"comment\">// Update our uniform parameters</span></div>\n\
<div class=\"line\">            <span class=\"keywordflow\">if</span>( fD3DEffect)</div>\n\
<div class=\"line\">            {</div>\n\
<div class=\"line\">                fUniformParameters.setLength( 0);</div>\n\
<div class=\"line\">                <span class=\"keywordflow\">for</span>( <span class=\"keywordtype\">unsigned</span> <span class=\"keywordtype\">int</span> p = 0; p &lt; fD3DEffectDesc.Parameters; p++)</div>\n\
<div class=\"line\">                {</div>\n\
<div class=\"line\">                    setupUniform( fD3DEffect-&gt;GetParameter( NULL, p), <span class=\"stringliteral\">&quot;&quot;</span>);</div>\n\
<div class=\"line\">                }</div>\n\
<div class=\"line\">                setUniformParameters( fUniformParameters);</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">                <span class=\"comment\">// And re-select our current technique (which triggers a UI change</span></div>\n\
<div class=\"line\">                <span class=\"comment\">// and also handles the case where the current technique doesn&#39;t </span></div>\n\
<div class=\"line\">                <span class=\"comment\">// exist in this effect</span></div>\n\
<div class=\"line\">                <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_plug.html\">MPlug</a>( thisMObject(), sTechnique).<a name=\"a88\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_plug.html#aec7c3792a53d27a61ece4f7b81cc123b\">setValue</a>( fTechnique);</div>\n\
<div class=\"line\">            }</div>\n\
<div class=\"line\">        }</div>\n\
<div class=\"line\">    }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <span class=\"comment\">// Update our shader info attributes</span></div>\n\
<div class=\"line\">    <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_plug.html\">MPlug</a> diagnosticsPlug( thisMObject(), sDiagnostics);</div>\n\
<div class=\"line\">    diagnosticsPlug.setValue( fDiagnostics);</div>\n\
<div class=\"line\">    <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_plug.html\">MPlug</a> descriptionPlug( thisMObject(), sDescription);</div>\n\
<div class=\"line\">    descriptionPlug.setValue( fDescription);</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <span class=\"keywordflow\">return</span> MS::kSuccess;</div>\n\
<div class=\"line\">}</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"><span class=\"keywordtype\">bool</span> hlslShader::passHasTranparency( D3DXHANDLE d3dPass )</div>\n\
<div class=\"line\">{</div>\n\
<div class=\"line\">    <span class=\"keywordtype\">bool</span> hasTransparency = <span class=\"keyword\">false</span>;</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <span class=\"comment\">//printf(&quot;Pass %s has %d annotations\\n&quot;, passDesc.Name, passDesc.Annotations);</span></div>\n\
<div class=\"line\">    BOOL boolParameter;</div>\n\
<div class=\"line\">    INT intParameter1, intParameter2;</div>\n\
<div class=\"line\">    boolParameter = <span class=\"keyword\">false</span>;</div>\n\
<div class=\"line\">    {</div>\n\
<div class=\"line\">        BOOL getAnnot = GetBOOLAnnotation( d3dPass, <span class=\"stringliteral\">&quot;Zenable&quot;</span>, boolParameter);</div>\n\
<div class=\"line\">        <span class=\"comment\">//printf(&quot;Get zenable %d, %d\\n&quot;, getAnnot, boolParameter);</span></div>\n\
<div class=\"line\">        getAnnot = GetBOOLAnnotation( d3dPass, <span class=\"stringliteral\">&quot;ZWriteEnable&quot;</span>, boolParameter);</div>\n\
<div class=\"line\">        <span class=\"comment\">//printf(&quot;Get zwriteenable %d, %d\\n&quot;, getAnnot, boolParameter);</span></div>\n\
<div class=\"line\">    }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    BOOL getAnnot = <span class=\"keyword\">false</span>;</div>\n\
<div class=\"line\">    {</div>\n\
<div class=\"line\">        D3DXHANDLE d3dSemantic = fD3DEffect-&gt;GetAnnotationByName( d3dPass, <span class=\"stringliteral\">&quot;AlphaBlendEnable&quot;</span>);</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">if</span> (d3dSemantic)</div>\n\
<div class=\"line\">        {</div>\n\
<div class=\"line\">            fD3DEffect-&gt;GetBool( d3dSemantic, &amp;boolParameter);</div>\n\
<div class=\"line\">            getAnnot = <span class=\"keyword\">true</span>;</div>\n\
<div class=\"line\">        }</div>\n\
<div class=\"line\">    }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <span class=\"comment\">//printf(&quot;Alpha blend found %d, is enabled %d !\\n&quot;, getAnnot, boolParameter);</span></div>\n\
<div class=\"line\">    <span class=\"keywordflow\">if</span> (getAnnot &amp;&amp; boolParameter)</div>\n\
<div class=\"line\">    {</div>\n\
<div class=\"line\">        hasTransparency = <span class=\"keyword\">true</span>;</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">        {</div>\n\
<div class=\"line\">            D3DXHANDLE d3dSemantic = fD3DEffect-&gt;GetAnnotationByName( d3dPass, <span class=\"stringliteral\">&quot;SrcBlend&quot;</span>);</div>\n\
<div class=\"line\">            <span class=\"keywordflow\">if</span> (d3dSemantic)</div>\n\
<div class=\"line\">                fD3DEffect-&gt;GetInt( d3dSemantic, &amp;intParameter1);</div>\n\
<div class=\"line\">        }</div>\n\
<div class=\"line\">        {</div>\n\
<div class=\"line\">            D3DXHANDLE d3dSemantic = fD3DEffect-&gt;GetAnnotationByName( d3dPass, <span class=\"stringliteral\">&quot;DestBlend&quot;</span>);</div>\n\
<div class=\"line\">            <span class=\"keywordflow\">if</span> (d3dSemantic)</div>\n\
<div class=\"line\">                fD3DEffect-&gt;GetInt( d3dSemantic, &amp;intParameter2);</div>\n\
<div class=\"line\">        }</div>\n\
<div class=\"line\">    }               </div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <span class=\"keywordflow\">return</span> hasTransparency;</div>\n\
<div class=\"line\">}</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"><span class=\"comment\">//</span></div>\n\
<div class=\"line\"><span class=\"comment\">// Set the technique we&#39;re using</span></div>\n\
<div class=\"line\"><span class=\"comment\">//</span></div>\n\
<div class=\"line\"><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_status.html\">MStatus</a> hlslShader::setTechnique( <span class=\"keyword\">const</span> <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string.html\">MString</a>&amp; technique)</div>\n\
<div class=\"line\">{</div>\n\
<div class=\"line\">    <span class=\"comment\">// We&#39;re changing technique, blow away any existing vertex declaration</span></div>\n\
<div class=\"line\">    releaseVertexDeclaration();</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <span class=\"comment\">// Now, if we have an effect update our internal data and parameter list</span></div>\n\
<div class=\"line\">    <span class=\"comment\">// (otherwise just leave the current parameters in place)</span></div>\n\
<div class=\"line\">    <span class=\"keywordflow\">if</span>( fD3DEffect &amp;&amp; fTechniques.length())</div>\n\
<div class=\"line\">    {</div>\n\
<div class=\"line\">        <span class=\"comment\">// Try and switch to this technique</span></div>\n\
<div class=\"line\">        fD3DTechnique = fD3DEffect-&gt;GetTechniqueByName( technique.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string.html#aa9ab612f356c53479afc4c648c9ef94d\">asChar</a>());</div>\n\
<div class=\"line\"><span class=\"preprocessor\">#ifdef VALIDATE_TECHNIQUES</span></div>\n\
<div class=\"line\">        <span class=\"keywordflow\">if</span>( !fD3DTechnique || !fD3DEffect-&gt;ValidateTechnique( fD3DTechnique))</div>\n\
<div class=\"line\">#<span class=\"keywordflow\">else</span></div>\n\
<div class=\"line\">        <span class=\"keywordflow\">if</span>( !fD3DTechnique)</div>\n\
<div class=\"line\"><span class=\"preprocessor\">#endif</span></div>\n\
<div class=\"line\">        {</div>\n\
<div class=\"line\">            fD3DTechnique = fD3DEffect-&gt;GetTechniqueByName( fTechnique.asChar());</div>\n\
<div class=\"line\"><span class=\"preprocessor\">#ifdef VALIDATE_TECHNIQUES</span></div>\n\
<div class=\"line\">            <span class=\"keywordflow\">if</span>( !fD3DTechnique || !fD3DEffect-&gt;ValidateTechnique( fD3DTechnique))</div>\n\
<div class=\"line\">#<span class=\"keywordflow\">else</span></div>\n\
<div class=\"line\">            <span class=\"keywordflow\">if</span>( !fD3DTechnique)</div>\n\
<div class=\"line\"><span class=\"preprocessor\">#endif</span></div>\n\
<div class=\"line\">            {</div>\n\
<div class=\"line\"><span class=\"preprocessor\">#ifdef VALIDATE_TECHNIQUES</span></div>\n\
<div class=\"line\">                <span class=\"keywordflow\">if</span>( FAILED( fD3DEffect-&gt;FindNextValidTechnique( fD3DTechnique, &amp;fD3DTechnique)))</div>\n\
<div class=\"line\">                {</div>\n\
<div class=\"line\">                    fD3DTechnique = NULL;</div>\n\
<div class=\"line\">                }</div>\n\
<div class=\"line\"><span class=\"preprocessor\">#else</span></div>\n\
<div class=\"line\">                fD3DTechnique = fD3DEffect-&gt;GetTechnique( 0);</div>\n\
<div class=\"line\"><span class=\"preprocessor\">#endif</span></div>\n\
<div class=\"line\">            }</div>\n\
<div class=\"line\">        }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">        <span class=\"comment\">// Now suck the name back out</span></div>\n\
<div class=\"line\">        fD3DEffect-&gt;GetTechniqueDesc( fD3DTechnique, &amp;fD3DTechniqueDesc);</div>\n\
<div class=\"line\">        fTechnique = fD3DTechniqueDesc.Name;</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">        <span class=\"comment\">// Make this the active technique</span></div>\n\
<div class=\"line\">        fD3DEffect-&gt;SetTechnique( fD3DTechnique);</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">        <span class=\"comment\">// Update our passes and varying parameters</span></div>\n\
<div class=\"line\">        fVertexStructure.removeElements();</div>\n\
<div class=\"line\">        fD3DVertexDeclaration = <span class=\"keyword\">new</span> IDirect3DVertexDeclaration9*[ fD3DTechniqueDesc.Passes];</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">        <span class=\"keywordtype\">int</span> offset = 0;</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">for</span>( <span class=\"keywordtype\">unsigned</span> <span class=\"keywordtype\">int</span> p = 0; p &lt; fD3DTechniqueDesc.Passes; p++)</div>\n\
<div class=\"line\">        {</div>\n\
<div class=\"line\">            D3DXHANDLE d3dPass = fD3DEffect-&gt;GetPass( fD3DTechnique, p);</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"><span class=\"preprocessor\">#if defined(_BLENDPARSING_READY_)</span></div>\n\
<div class=\"line\">            <span class=\"keywordflow\">if</span> (p == 0)</div>\n\
<div class=\"line\">                fTechniqueHasBlending = passHasTranparency( d3dPass );</div>\n\
<div class=\"line\"><span class=\"preprocessor\">#endif</span></div>\n\
<div class=\"line\">            D3DXPASS_DESC passDesc;</div>\n\
<div class=\"line\">            fD3DEffect-&gt;GetPassDesc( d3dPass, &amp;passDesc);</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">            D3DXSEMANTIC Semantics[ MAXD3DDECLLENGTH];</div>\n\
<div class=\"line\">            D3DVERTEXELEMENT9 VertexElements[ MAXD3DDECLLENGTH + 1];</div>\n\
<div class=\"line\">            UINT NumSemantics = 0;</div>\n\
<div class=\"line\">            D3DXGetShaderInputSemantics( passDesc.pVertexShaderFunction, Semantics, &amp;NumSemantics);</div>\n\
<div class=\"line\">            <span class=\"keywordflow\">for</span>( <span class=\"keywordtype\">unsigned</span> <span class=\"keywordtype\">int</span> s = 0; s &lt; NumSemantics; s++)</div>\n\
<div class=\"line\">            {</div>\n\
<div class=\"line\">                <span class=\"keyword\">const</span> SemanticInfo&amp; Info = gSemanticInfo[ Semantics[ s].Usage];</div>\n\
<div class=\"line\">                <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string.html\">MString</a> Name = Info.Name; <span class=\"comment\">// Can&#39;t get the name through DX so use a semantic based name =(</span></div>\n\
<div class=\"line\">                <span class=\"keywordflow\">if</span>( Info.Type != MVaryingParameter::kPosition &amp;&amp; Info.Type != MVaryingParameter::kNormal)</div>\n\
<div class=\"line\">                    Name += Semantics[ s].UsageIndex;</div>\n\
<div class=\"line\">                <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_varying_parameter.html\">MVaryingParameter</a> varying( Name, MVaryingParameter::kFloat, Info.MinElements, Info.MaxElements, Info.Type, Info.Type == MVaryingParameter::kTexCoord ? <span class=\"keyword\">true</span> : <span class=\"keyword\">false</span>);</div>\n\
<div class=\"line\">                fVertexStructure.addElement( varying);</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">                VertexElements[ s].Stream = 0;</div>\n\
<div class=\"line\">                VertexElements[ s].Offset = (WORD)offset;</div>\n\
<div class=\"line\">                VertexElements[ s].Type = Info.D3DType;</div>\n\
<div class=\"line\">                VertexElements[ s].Method = D3DDECLMETHOD_DEFAULT;</div>\n\
<div class=\"line\">                VertexElements[ s].Usage = (BYTE)Semantics[ s].Usage;</div>\n\
<div class=\"line\">                VertexElements[ s].UsageIndex = (BYTE)Semantics[ s].UsageIndex;</div>\n\
<div class=\"line\">                offset += varying.getMaximumStride();</div>\n\
<div class=\"line\">            }</div>\n\
<div class=\"line\">            <span class=\"keyword\">static</span> D3DVERTEXELEMENT9 VertexElementEnd = D3DDECL_END();</div>\n\
<div class=\"line\">            VertexElements[ NumSemantics] = VertexElementEnd;</div>\n\
<div class=\"line\">            </div>\n\
<div class=\"line\">            <span class=\"comment\">// Make sure that the point is initialized in case something fails</span></div>\n\
<div class=\"line\">            fD3DVertexDeclaration[p] = NULL;</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">            <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_d3_d9_renderer.html\">MD3D9Renderer</a>* pRenderer = <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_d3_d9_renderer.html#a7e20874dc16aef527b927346672fdbfa\">MD3D9Renderer::theRenderer</a>();</div>\n\
<div class=\"line\">            <span class=\"keywordflow\">if</span> (pRenderer != NULL) {</div>\n\
<div class=\"line\">                IDirect3DDevice9* d3dDevice = pRenderer-&gt;getD3D9Device();</div>\n\
<div class=\"line\">                <span class=\"keywordflow\">if</span>( d3dDevice) {</div>\n\
<div class=\"line\">                    d3dDevice-&gt;CreateVertexDeclaration( VertexElements, &amp;fD3DVertexDeclaration[ p]);</div>\n\
<div class=\"line\">                }</div>\n\
<div class=\"line\">            }</div>\n\
<div class=\"line\">        }</div>\n\
<div class=\"line\">        <a name=\"_a89\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_varying_parameter_list.html\">MVaryingParameterList</a> list;</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">if</span>( fVertexStructure.numElements() &gt; 0)</div>\n\
<div class=\"line\">        {</div>\n\
<div class=\"line\">            <span class=\"comment\">// Only add our parameters if we have some - otherwise the empty structure</span></div>\n\
<div class=\"line\">            <span class=\"comment\">// shows up in the UI which is a bit ugly</span></div>\n\
<div class=\"line\">            list.<a name=\"a90\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_varying_parameter_list.html#a5dca32aa8a764505aba6f29d1acf37c4\">append</a>( fVertexStructure);</div>\n\
<div class=\"line\">        }</div>\n\
<div class=\"line\">        setVaryingParameters( list);</div>\n\
<div class=\"line\">    }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <span class=\"keywordflow\">return</span> MS::kSuccess;</div>\n\
<div class=\"line\">}</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"><span class=\"comment\">// Error reporting</span></div>\n\
<div class=\"line\"><span class=\"keywordtype\">void</span> hlslShader::reportInternalError( <span class=\"keyword\">const</span> <span class=\"keywordtype\">char</span>* <span class=\"keyword\">function</span>, <span class=\"keywordtype\">size_t</span> errcode )</div>\n\
<div class=\"line\">{</div>\n\
<div class=\"line\">    <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string.html\">MString</a> es = <span class=\"stringliteral\">&quot;hlslShader&quot;</span>;</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <span class=\"keywordflow\">try</span></div>\n\
<div class=\"line\">    {</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">if</span> ( <span class=\"keyword\">this</span> )</div>\n\
<div class=\"line\">        {</div>\n\
<div class=\"line\">            <span class=\"keywordflow\">if</span> ( ++fErrorCount &gt; ERROR_LIMIT ) </div>\n\
<div class=\"line\">                <span class=\"keywordflow\">return</span>;</div>\n\
<div class=\"line\">            <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string.html\">MString</a> s;</div>\n\
<div class=\"line\">            s += <span class=\"stringliteral\">&quot;\\&quot;&quot;</span>;</div>\n\
<div class=\"line\">            s += name();</div>\n\
<div class=\"line\">            s += <span class=\"stringliteral\">&quot;\\&quot;: &quot;</span>;</div>\n\
<div class=\"line\">            s += typeName();</div>\n\
<div class=\"line\">            es = s;</div>\n\
<div class=\"line\">        }</div>\n\
<div class=\"line\">    }</div>\n\
<div class=\"line\">    <span class=\"keywordflow\">catch</span> ( ... )</div>\n\
<div class=\"line\">    {}</div>\n\
<div class=\"line\">    es += <span class=\"stringliteral\">&quot; internal error &quot;</span>;</div>\n\
<div class=\"line\">    es += (int)errcode;</div>\n\
<div class=\"line\">    es += <span class=\"stringliteral\">&quot; in &quot;</span>;</div>\n\
<div class=\"line\">    es += <span class=\"keyword\">function</span>;</div>\n\
<div class=\"line\">    <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_global.html#a4ddbe97e58a90e1ab05d45a62c006cf0\">MGlobal::displayError</a>( es );</div>\n\
<div class=\"line\">}                                      <span class=\"comment\">// hlslShader::reportInternalError</span></div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"><span class=\"keywordtype\">void</span> parameterRequirements(<span class=\"keyword\">const</span> <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_varying_parameter.html\">MVaryingParameter</a>&amp; parameter, <a name=\"_a91\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_requirements_legacy.html\">MGeometryRequirementsLegacy</a>&amp; requirements)</div>\n\
<div class=\"line\"><span class=\"comment\">// recursive requirements </span></div>\n\
<div class=\"line\">{</div>\n\
<div class=\"line\">    <span class=\"keywordflow\">if</span> (parameter.<a name=\"a92\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_varying_parameter.html#ac7fba35931cc9a520837b0a752352e16\">numElements</a>() == 0) {</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">        <span class=\"keywordflow\">switch</span>( parameter.<a name=\"a93\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_varying_parameter.html#aa54f29a363de8795281d2e6e978e894c\">semantic</a>())</div>\n\
<div class=\"line\">        {</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">        <span class=\"keywordflow\">case</span> (MVaryingParameter::kTexCoord) :</div>\n\
<div class=\"line\">            requirements.<a name=\"a94\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_requirements_legacy.html#afd5a8b1052778de698bfce452630541c\">addTexCoord</a>(parameter.<a name=\"a95\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_varying_parameter.html#a2e8d4c38a60806df8c2ffd6d09e70b96\">name</a>()); </div>\n\
<div class=\"line\">            <span class=\"keywordflow\">break</span>;</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">case</span> (MVaryingParameter::kPosition) :</div>\n\
<div class=\"line\">            requirements.<a name=\"a96\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_requirements_legacy.html#ac06310a311e21853120d0cc6f0e10fa1\">addPosition</a>();</div>\n\
<div class=\"line\">            <span class=\"keywordflow\">break</span>;</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">case</span> (MVaryingParameter::kNormal) :</div>\n\
<div class=\"line\">            requirements.<a name=\"a97\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_requirements_legacy.html#ac225c13948fae1c5058e28da27fb1cc4\">addNormal</a>();</div>\n\
<div class=\"line\">            <span class=\"keywordflow\">break</span>;</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">case</span> (MVaryingParameter::kColor) :</div>\n\
<div class=\"line\">            requirements.<a name=\"a98\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_requirements_legacy.html#a41fbeecafb7fc5f4aca13539dc008d07\">addColor</a>(parameter.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_varying_parameter.html#a2e8d4c38a60806df8c2ffd6d09e70b96\">name</a>());</div>\n\
<div class=\"line\">            <span class=\"keywordflow\">break</span>;</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">default</span>:</div>\n\
<div class=\"line\">            <span class=\"comment\">// don&#39;t know what it is.</span></div>\n\
<div class=\"line\">            <span class=\"keywordflow\">break</span>;</div>\n\
<div class=\"line\">        }</div>\n\
<div class=\"line\">    }</div>\n\
<div class=\"line\">    <span class=\"keywordflow\">else</span> {</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">for</span> (<span class=\"keywordtype\">unsigned</span> <span class=\"keywordtype\">int</span> i = 0; i &lt; parameter.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_varying_parameter.html#ac7fba35931cc9a520837b0a752352e16\">numElements</a>(); ++i) {</div>\n\
<div class=\"line\">            parameterRequirements(parameter.<a name=\"a99\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_varying_parameter.html#a40cde1a792fb9a978d3a3a68414fb865\">getElement</a>(i), requirements);</div>\n\
<div class=\"line\">        }</div>\n\
<div class=\"line\">    }</div>\n\
<div class=\"line\">}</div>\n\
<div class=\"line\"> </div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"><span class=\"comment\">/* virtual */</span></div>\n\
<div class=\"line\"><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_status.html\">MStatus</a> hlslShader::renderSwatchImage(<a name=\"_a100\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_image.html\">MImage</a>&amp; image)</div>\n\
<div class=\"line\"><span class=\"comment\">// Override this method to draw a image for swatch rendering.</span></div>\n\
<div class=\"line\"><span class=\"comment\"></span>{</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"><span class=\"comment\">// #define _USE_OPENGL_</span></div>\n\
<div class=\"line\"><span class=\"preprocessor\">#if defined _USE_OPENGL_    // </span></div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_status.html\">MStatus</a> status = <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_status.html#a02ab596f4febca68da503aaf8dde3a80a1ef6c2d725fb4bec3e7e840d28adbc00\">MStatus::kFailure</a>;</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <span class=\"comment\">// Get the hardware openGL renderer utility class</span></div>\n\
<div class=\"line\">    <a name=\"_a101\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_hardware_renderer.html\">MHardwareRenderer</a> *pRenderer = <a name=\"a102\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_hardware_renderer.html#a93fef222f7278c123e8df750f7f0ea5b\">MHardwareRenderer::theRenderer</a>();</div>\n\
<div class=\"line\">    <span class=\"keywordflow\">if</span> (pRenderer)</div>\n\
<div class=\"line\">    {</div>\n\
<div class=\"line\">        <span class=\"keyword\">const</span> <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string.html\">MString</a>&amp; backEndStr = pRenderer-&gt;<a name=\"a103\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_hardware_renderer.html#afd786038730d9c301a6b3a489d22d816\">backEndString</a>();</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">        <span class=\"comment\">// get the geometry requirements</span></div>\n\
<div class=\"line\">        <a name=\"_a104\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_dag_path.html\">MDagPath</a> path;                          <span class=\"comment\">// NULL path</span></div>\n\
<div class=\"line\">        MGeometryRequirements requirements;</div>\n\
<div class=\"line\">        requirements.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_requirements_legacy.html#ac06310a311e21853120d0cc6f0e10fa1\">addPosition</a>();</div>\n\
<div class=\"line\">        requirements.addNormal();</div>\n\
<div class=\"line\">        requirements.addTexCoord(<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string.html\">MString</a>(<span class=\"stringliteral\">&quot;map1&quot;</span>));  </div>\n\
<div class=\"line\">        requirements.addComponentId();</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">        <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_manager.html#a5f45789e2294fc128af5b04595d96505\">MGeometryManager::GeometricShape</a> shape = <a name=\"a105\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_manager.html#a5f45789e2294fc128af5b04595d96505acb4a5f68a3b6cd8c05b1dc9c5a487c88\">MGeometryManager::kDefaultSphere</a>;</div>\n\
<div class=\"line\">        <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_list.html\">MGeometryList</a>* geomIter = <a name=\"a106\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_manager.html#acd13b8ee8e78f0238fb7968af1e35e80\">MGeometryManager::referenceDefaultGeometry</a>(shape, requirements);</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">        <span class=\"keywordflow\">if</span>(geomIter == NULL) {</div>\n\
<div class=\"line\">            <span class=\"keywordflow\">return</span> <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_status.html#a02ab596f4febca68da503aaf8dde3a80a1ef6c2d725fb4bec3e7e840d28adbc00\">MStatus::kFailure</a>;</div>\n\
<div class=\"line\">        }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">        <span class=\"comment\">// Make the swatch context current</span></div>\n\
<div class=\"line\">        <span class=\"comment\">// ===============================</span></div>\n\
<div class=\"line\">        <span class=\"comment\">//</span></div>\n\
<div class=\"line\">        <span class=\"keywordtype\">unsigned</span> <span class=\"keywordtype\">int</span> width, height;</div>\n\
<div class=\"line\">        image.<a name=\"a107\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_image.html#acab1f6acf34fc74e4d717322fa35241a\">getSize</a>(width, height);</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">        <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_status.html\">MStatus</a> status2 = pRenderer-&gt;<a name=\"a108\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_hardware_renderer.html#a4d85f022b09d72ce1f6a17ad4fa41be4\">makeSwatchContextCurrent</a>( backEndStr, width, height );</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">        glPushAttrib(GL_ALL_ATTRIB_BITS);</div>\n\
<div class=\"line\">        glPushClientAttrib(GL_CLIENT_VERTEX_ARRAY_BIT);</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">        <span class=\"keywordflow\">if</span>( status2 != MS::kSuccess ) {</div>\n\
<div class=\"line\">            <a name=\"a109\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_manager.html#af5a7f7bce62d712ed57586e6cf9c43f0\">MGeometryManager::dereferenceDefaultGeometry</a>(geomIter);</div>\n\
<div class=\"line\">        }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">        <span class=\"comment\">// Get the light direction from the API, and use it</span></div>\n\
<div class=\"line\">        <span class=\"comment\">// =============================================</span></div>\n\
<div class=\"line\">        {    </div>\n\
<div class=\"line\">            <span class=\"keyword\">static</span> <span class=\"keywordtype\">float</span>  specular[] = { 0.7f, 0.7f, 0.7f, 1.0f};</div>\n\
<div class=\"line\">            <span class=\"keyword\">static</span> <span class=\"keywordtype\">float</span>  shine[] = { 100.0f };</div>\n\
<div class=\"line\">            <span class=\"keyword\">static</span> <span class=\"keywordtype\">float</span>  ambient[] = { 0.2f, 0.2f, 0.2f, 1.0f };</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">            glEnable(GL_LIGHTING);</div>\n\
<div class=\"line\">            glColorMaterial(GL_FRONT_AND_BACK, GL_DIFFUSE);</div>\n\
<div class=\"line\">            glMaterialfv(GL_FRONT_AND_BACK, GL_SPECULAR, specular);</div>\n\
<div class=\"line\">            glMaterialfv(GL_FRONT_AND_BACK, GL_SHININESS, shine);</div>\n\
<div class=\"line\">            glMaterialfv(GL_FRONT_AND_BACK, GL_AMBIENT, ambient);</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">            <span class=\"keywordtype\">float</span> lightPos[4];</div>\n\
<div class=\"line\">            pRenderer-&gt;<a name=\"a110\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_hardware_renderer.html#a4fa0ae8729daf1a0125906fad0fc1704\">getSwatchLightDirection</a>( lightPos[0], lightPos[1], lightPos[2], lightPos[3] );</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">            <span class=\"keyword\">static</span> <span class=\"keywordtype\">float</span> default_ambient_light[]={0.4f, 0.4f, 0.4f, 1.0f};</div>\n\
<div class=\"line\">            <span class=\"keyword\">static</span> <span class=\"keywordtype\">float</span> default_diffuse_light[]={0.8f, 0.8f, 0.8f, 1.0f};</div>\n\
<div class=\"line\">            <span class=\"keyword\">static</span> <span class=\"keywordtype\">float</span> default_specular_light[]={1.0f, 1.0f, 1.0f, 1.0f};</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">            glLightfv(GL_LIGHT0, GL_AMBIENT, default_ambient_light);</div>\n\
<div class=\"line\">            glLightfv(GL_LIGHT0, GL_DIFFUSE, default_diffuse_light);</div>\n\
<div class=\"line\">            glLightfv(GL_LIGHT0, GL_SPECULAR, default_specular_light);</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">            glPushMatrix();</div>\n\
<div class=\"line\">            glLoadIdentity();</div>\n\
<div class=\"line\">            glLightfv(GL_LIGHT0, GL_POSITION, lightPos);</div>\n\
<div class=\"line\">            glEnable(GL_LIGHT0);</div>\n\
<div class=\"line\">            glPopMatrix();</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">        }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">        <span class=\"comment\">// Get camera</span></div>\n\
<div class=\"line\">        <span class=\"comment\">// ==========</span></div>\n\
<div class=\"line\">        {</div>\n\
<div class=\"line\">            <span class=\"comment\">// Get the camera frustum from the API</span></div>\n\
<div class=\"line\">            glMatrixMode(GL_PROJECTION);</div>\n\
<div class=\"line\">            glLoadIdentity();</div>\n\
<div class=\"line\">            <span class=\"keywordtype\">double</span> l, r, b, t, n, f;</div>\n\
<div class=\"line\">            pRenderer-&gt;<a name=\"a111\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_hardware_renderer.html#a14d1484740450d30fa540baf31f47a09\">getSwatchPerspectiveCameraSetting</a>( l, r, b, t, n, f );</div>\n\
<div class=\"line\">            glFrustum( l, r, b, t, n, f );</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">            <span class=\"comment\">// want to store these into the </span></div>\n\
<div class=\"line\">        }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">        <span class=\"comment\">// Get the default background color and clear the background</span></div>\n\
<div class=\"line\">        <span class=\"comment\">//</span></div>\n\
<div class=\"line\">        <span class=\"keywordtype\">float</span> r, g, b, a;</div>\n\
<div class=\"line\">        <a name=\"a112\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_h_w_shader_swatch_generator.html#a95a6855572205246f2741796ed8c5bdc\">MHWShaderSwatchGenerator::getSwatchBackgroundColor</a>( r, g, b, a );</div>\n\
<div class=\"line\">        glClearColor( r, g, b, a );</div>\n\
<div class=\"line\">        glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">        glShadeModel(GL_SMOOTH);</div>\n\
<div class=\"line\">        glEnable(GL_DEPTH_TEST);</div>\n\
<div class=\"line\">        glDepthFunc(GL_LEQUAL);</div>\n\
<div class=\"line\">        glHint(GL_PERSPECTIVE_CORRECTION_HINT, GL_NICEST);</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">        <span class=\"keywordflow\">for</span>( ; !geomIter-&gt;<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_list.html#add4bf50abae421d88b5549de6c11fc75\">isDone</a>(); geomIter-&gt;<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_list.html#a041249f802c5bf4c2deae666610e03c4\">next</a>())</div>\n\
<div class=\"line\">        {</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">            MGeometry&amp; geometry = geomIter-&gt;<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_list.html#a2c08d17ca16945612458abffaa4e9744\">geometry</a>(<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_list.html#a726ca809ffd3d67ab4b8476646f26635a634ee767a8e90ff4d56e140459cca31f\">MGeometryList::kNone</a>);</div>\n\
<div class=\"line\">            <span class=\"keyword\">const</span> <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_matrix.html\">MMatrix</a>&amp; mtm = geomIter-&gt;<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_list.html#acd8c4aab0285c0e0077b1c12d8cfda9a\">objectToWorldMatrix</a>();</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">            glMatrixMode(GL_MODELVIEW);</div>\n\
<div class=\"line\">            glLoadMatrixd(mtm[0]);</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">            <span class=\"comment\">// TO DO the geomIterator needs to give up the project matrix.</span></div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">            <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_primitive.html\">MGeometryPrimitive</a> primitives = geometry.primitiveArray(0);</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">            <span class=\"keyword\">const</span> <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_data.html\">MGeometryData</a> pos = geometry.position();</div>\n\
<div class=\"line\">            <span class=\"keyword\">const</span> <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_data.html\">MGeometryData</a> normal = geometry.normal();</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">            <span class=\"comment\">// Draw The Swatch</span></div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">            <span class=\"keywordflow\">if</span> (pos.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_data.html#ac73113f892730ec6fce5da7e3273c9cd\">data</a>() != NULL &amp;&amp; primitives.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_primitive.html#ad3b74abc0bab69f337c70783e73f5bef\">data</a>() != NULL) {</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">                glEnableClientState(GL_VERTEX_ARRAY);</div>\n\
<div class=\"line\">                glVertexPointer(3, GL_FLOAT, 0, (<span class=\"keywordtype\">float</span>*) pos.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_data.html#ac73113f892730ec6fce5da7e3273c9cd\">data</a>());</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">                <span class=\"keywordflow\">if</span> (normal.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_data.html#ac73113f892730ec6fce5da7e3273c9cd\">data</a>()) {</div>\n\
<div class=\"line\">                    glEnableClientState(GL_NORMAL_ARRAY);</div>\n\
<div class=\"line\">                    glNormalPointer(GL_FLOAT, 0,  normal.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_data.html#ac73113f892730ec6fce5da7e3273c9cd\">data</a>());</div>\n\
<div class=\"line\">                }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">                <span class=\"comment\">// get the first texture and blind it</span></div>\n\
<div class=\"line\">                <span class=\"keywordtype\">bool</span> boundTexture = <span class=\"keyword\">false</span>;</div>\n\
<div class=\"line\">                <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string.html\">MString</a> defaultMap(<span class=\"stringliteral\">&quot;map1&quot;</span>);</div>\n\
<div class=\"line\">                <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_data.html\">MGeometryData</a> uvCoord = geometry.texCoord(defaultMap);</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">                <span class=\"comment\">// Setup our shape dependent parameters</span></div>\n\
<div class=\"line\">                <span class=\"keywordflow\">for</span>( <span class=\"keywordtype\">int</span> u = fUniformParameters.length(); u--; ){</div>\n\
<div class=\"line\">                    <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html\">MUniformParameter</a> uniform = fUniformParameters.getElement( u);</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">                    <span class=\"keywordflow\">if</span> ( uniform.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html#a37357b066d4c628b1fae2f1ee08b2b12\">isATexture</a>()) {</div>\n\
<div class=\"line\">                        <span class=\"comment\">// make sure that it a 2d texture as we can&#39;t handle anything else.</span></div>\n\
<div class=\"line\">                        <span class=\"keywordflow\">if</span>( uniform.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html#ac52395416dfb965501c67061d7198c1c\">type</a>() == MUniformParameter::kType2DTexture) </div>\n\
<div class=\"line\">                        {</div>\n\
<div class=\"line\">                            <span class=\"comment\">// Get the plug used for the first texture - but be careful to preserve</span></div>\n\
<div class=\"line\">                            <span class=\"comment\">// the hasChanged state so that the shader correctly updates this parameter</span></div>\n\
<div class=\"line\">                            <span class=\"comment\">// (otherwise it may never setup the texture parameter because we suppressed</span></div>\n\
<div class=\"line\">                            <span class=\"comment\">// the initial hasChanged trigger)</span></div>\n\
<div class=\"line\">                            <span class=\"keywordtype\">bool</span> wasDirty = uniform.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html#a9d4d257e5bb7e85eb9fdeca499dc9361\">hasChanged</a>( *geomIter);</div>\n\
<div class=\"line\">                            <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_plug.html\">MPlug</a> plug = uniform.<a name=\"a113\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html#a000c434a3beb6c2cc9681d9e445cf0eb\">getSource</a>();</div>\n\
<div class=\"line\">                            <span class=\"keywordflow\">if</span>( wasDirty) uniform.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html#a92a590790db6444ca7a79eaf5fbcb0d9\">setDirty</a>();</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">                            <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_image_file_info.html#a9b0c9320a802a00a718bcab75ba40550\">MImageFileInfo::MHwTextureType</a> hwType;</div>\n\
<div class=\"line\">                            <span class=\"keywordflow\">if</span> (MS::kSuccess == <a name=\"a114\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_hw_texture_manager.html#af1077c5a30b589e36b864c09876fbc44\">MHwTextureManager::glBind</a>(plug, hwType))</div>\n\
<div class=\"line\">                            {</div>\n\
<div class=\"line\">                                boundTexture = <span class=\"keyword\">true</span>;</div>\n\
<div class=\"line\">                                <span class=\"keywordflow\">break</span>;</div>\n\
<div class=\"line\">                            }</div>\n\
<div class=\"line\">                        }</div>\n\
<div class=\"line\">                    }</div>\n\
<div class=\"line\">                }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">                <span class=\"keywordflow\">if</span> (uvCoord.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_data.html#ac73113f892730ec6fce5da7e3273c9cd\">data</a>() &amp;&amp; boundTexture) {</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">                    glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_S, GL_REPEAT);</div>\n\
<div class=\"line\">                    glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_T, GL_REPEAT);</div>\n\
<div class=\"line\">                    glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_LINEAR);</div>\n\
<div class=\"line\">                    glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_LINEAR);</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">                    glEnableClientState(GL_TEXTURE_COORD_ARRAY);</div>\n\
<div class=\"line\">                    glTexCoordPointer(2, GL_FLOAT, 0, uvCoord.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_data.html#ac73113f892730ec6fce5da7e3273c9cd\">data</a>());</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">                    <span class=\"comment\">// Base colour is always white</span></div>\n\
<div class=\"line\">                    glColor4f(1.0f, 1.0f, 1.0f, 1.0f);</div>\n\
<div class=\"line\">                }</div>\n\
<div class=\"line\">                <span class=\"keywordflow\">else</span> {</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">                    glDisable(GL_TEXTURE_2D);</div>\n\
<div class=\"line\">                    glBindTexture(GL_TEXTURE_2D, 0);</div>\n\
<div class=\"line\">                    glColor4f(0.1f, 0.7f, 0.7f, 1.0f);</div>\n\
<div class=\"line\">                }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">                <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_primitive.html\">MGeometryPrimitive</a> primitives = geometry.primitiveArray(0);</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">                <span class=\"comment\">// renderer</span></div>\n\
<div class=\"line\">                glDrawElements(GL_TRIANGLES, primitives.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_primitive.html#ac9580a2ec3ad9690d0fb0ea0b3179fec\">elementCount</a>(), GL_UNSIGNED_INT, primitives.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_primitive.html#ad3b74abc0bab69f337c70783e73f5bef\">data</a>());</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">                <span class=\"comment\">// Read pixels back from swatch context to MImage</span></div>\n\
<div class=\"line\">                pRenderer-&gt;<a name=\"a115\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_hardware_renderer.html#ae2bc38072d14c1b8e1988e1f2ae73066\">readSwatchContextPixels</a>( backEndStr, image );</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">                <span class=\"comment\">// Double check the outing going image size as image resizing</span></div>\n\
<div class=\"line\">                <span class=\"comment\">// was required to properly read from the swatch context</span></div>\n\
<div class=\"line\">                image.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_image.html#acab1f6acf34fc74e4d717322fa35241a\">getSize</a>( width, height );</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">                glPopAttrib();</div>\n\
<div class=\"line\">                glPopClientAttrib();</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">                status = <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_status.html#a02ab596f4febca68da503aaf8dde3a80af0536797208144380691e2b376ffc1d1\">MStatus::kSuccess</a>;</div>\n\
<div class=\"line\">            }</div>\n\
<div class=\"line\">        }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">        <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_manager.html#af5a7f7bce62d712ed57586e6cf9c43f0\">MGeometryManager::dereferenceDefaultGeometry</a>(geomIter);</div>\n\
<div class=\"line\">    }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"><span class=\"preprocessor\">#else</span></div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_status.html\">MStatus</a> status = <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_status.html#a02ab596f4febca68da503aaf8dde3a80a1ef6c2d725fb4bec3e7e840d28adbc00\">MStatus::kFailure</a>;</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <span class=\"keywordtype\">unsigned</span> <span class=\"keywordtype\">int</span> width, height;</div>\n\
<div class=\"line\">    image.<a name=\"a116\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_image.html#ac5d25e7e2d395f432b5a8077024e34c4\">setRGBA</a>(<span class=\"keyword\">true</span>);</div>\n\
<div class=\"line\">    image.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_image.html#acab1f6acf34fc74e4d717322fa35241a\">getSize</a>(width, height);</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <span class=\"comment\">// get the geometry requirements</span></div>\n\
<div class=\"line\">    ShaderContext context;                  <span class=\"comment\">// NULL path and shading engine</span></div>\n\
<div class=\"line\">    <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_requirements_legacy.html\">MGeometryRequirementsLegacy</a> requirements;</div>\n\
<div class=\"line\">    populateRequirements(context, requirements);</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_d3_d9_renderer.html\">MD3D9Renderer</a>*  Render = <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_d3_d9_renderer.html#a7e20874dc16aef527b927346672fdbfa\">MD3D9Renderer::theRenderer</a>();</div>\n\
<div class=\"line\">    <span class=\"keywordflow\">if</span> (Render != NULL) {</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">        Render-&gt;<a name=\"a117\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_d3_d9_renderer.html#a365d315999f5037edaa24368fe70dcdc\">makeSwatchContextCurrent</a>(width, height);</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">        <span class=\"comment\">// render the back ground</span></div>\n\
<div class=\"line\">        Render-&gt;<a name=\"a118\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_d3_d9_renderer.html#a18b658ea5bf9d773516baaa2ab849659\">setBackgroundColor</a>(<a name=\"_a119\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_color.html\">MColor</a>(0.1f, 0.1f, 0.1f));</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">        <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_list.html\">MGeometryList</a>* geomIter = <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_manager.html#acd13b8ee8e78f0238fb7968af1e35e80\">MGeometryManager::referenceDefaultGeometry</a>(<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_manager.html#a5f45789e2294fc128af5b04595d96505acb4a5f68a3b6cd8c05b1dc9c5a487c88\">MGeometryManager::kDefaultSphere</a>, </div>\n\
<div class=\"line\">            requirements);</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">        <span class=\"keywordflow\">if</span> (geomIter == NULL) {</div>\n\
<div class=\"line\">            <span class=\"keywordflow\">return</span> status;</div>\n\
<div class=\"line\">        }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">        <span class=\"comment\">// set up lighting</span></div>\n\
<div class=\"line\">        <span class=\"comment\">// TO DO</span></div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">        <span class=\"comment\">// render the object this the shader and defaulting geometry</span></div>\n\
<div class=\"line\">        <span class=\"keywordflow\">if</span> (render(*geomIter) != <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_status.html#a02ab596f4febca68da503aaf8dde3a80af0536797208144380691e2b376ffc1d1\">MStatus::kSuccess</a>) {</div>\n\
<div class=\"line\">            <span class=\"comment\">// revert to a simple fixed color material render</span></div>\n\
<div class=\"line\">            <span class=\"comment\">// TO DO</span></div>\n\
<div class=\"line\">        }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">        <span class=\"comment\">// read back the image</span></div>\n\
<div class=\"line\">        Render-&gt;<a name=\"a120\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_d3_d9_renderer.html#a7c665a339c86e26197266d74975e083e\">readSwatchContextPixels</a>(image);</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">        <span class=\"comment\">// let go of the geoemtry</span></div>\n\
<div class=\"line\">        <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_geometry_manager.html#af5a7f7bce62d712ed57586e6cf9c43f0\">MGeometryManager::dereferenceDefaultGeometry</a>(geomIter);</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">        status = <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_status.html#a02ab596f4febca68da503aaf8dde3a80af0536797208144380691e2b376ffc1d1\">MStatus::kSuccess</a>;</div>\n\
<div class=\"line\">    }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"><span class=\"preprocessor\">#endif</span></div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <span class=\"keywordflow\">return</span> status;</div>\n\
<div class=\"line\">}</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"><span class=\"comment\">/* virtual */</span></div>\n\
<div class=\"line\"><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_status.html\">MStatus</a> hlslShader::getAvailableImages( <span class=\"keyword\">const</span> <a name=\"_a121\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/struct_m_px_hardware_shader_1_1_shader_context.html\">MPxHardwareShader::ShaderContext</a> &amp;context,</div>\n\
<div class=\"line\">                                        <span class=\"keyword\">const</span> <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string.html\">MString</a> &amp;uvSetName,</div>\n\
<div class=\"line\">                                        <a name=\"_a122\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string_array.html\">MStringArray</a> &amp;imageNames )</div>\n\
<div class=\"line\">{</div>\n\
<div class=\"line\">    <span class=\"comment\">// Only scan for available images if we have a valid effect.</span></div>\n\
<div class=\"line\">    <span class=\"comment\">//</span></div>\n\
<div class=\"line\">    <span class=\"keywordflow\">if</span>( !fD3DEffect )</div>\n\
<div class=\"line\">    {</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">return</span> <a name=\"a123\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_status.html#a02ab596f4febca68da503aaf8dde3a80a598e4c5d4c234c1bf09367d64487519c\">MStatus::kNotImplemented</a>;</div>\n\
<div class=\"line\">    }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <span class=\"comment\">// Locate the varying parameters whose source is &#39;uvSetName&#39;</span></div>\n\
<div class=\"line\">    <span class=\"comment\">//</span></div>\n\
<div class=\"line\">    <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string_array.html\">MStringArray</a> uvParams;</div>\n\
<div class=\"line\">    <span class=\"keywordtype\">unsigned</span> <span class=\"keywordtype\">int</span> nVarying = fVertexStructure.numElements();</div>\n\
<div class=\"line\">    <span class=\"keywordflow\">for</span>( <span class=\"keywordtype\">unsigned</span> <span class=\"keywordtype\">int</span> i = 0; i &lt; nVarying; i++ )</div>\n\
<div class=\"line\">    {</div>\n\
<div class=\"line\">        <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_varying_parameter.html\">MVaryingParameter</a> elem = fVertexStructure.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_varying_parameter.html#a40cde1a792fb9a978d3a3a68414fb865\">getElement</a>(i);</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">if</span>( elem.<a name=\"a124\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_varying_parameter.html#ad72ff2b3fb20052e4a2455dad5c10682\">getSourceType</a>() == MVaryingParameter::kTexCoord &amp;&amp;</div>\n\
<div class=\"line\">            elem.<a name=\"a125\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_varying_parameter.html#a45e2132632639698f9c4f668be933a70\">getSourceSetName</a>() == uvSetName )</div>\n\
<div class=\"line\">        {</div>\n\
<div class=\"line\">            uvParams.<a name=\"a126\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string_array.html#a18d06b3d0af1426e654ac2cc1dc86c60\">append</a>( elem.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_varying_parameter.html#a2e8d4c38a60806df8c2ffd6d09e70b96\">name</a>() );</div>\n\
<div class=\"line\">        }</div>\n\
<div class=\"line\">    }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <span class=\"comment\">// Determine the default texture.</span></div>\n\
<div class=\"line\">    <span class=\"comment\">//</span></div>\n\
<div class=\"line\">    <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string.html\">MString</a> defaultTex;</div>\n\
<div class=\"line\">    <span class=\"keywordflow\">if</span>( uvParams.<a name=\"a127\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string_array.html#a580388f31f60c46fac867ca48a48da1e\">length</a>() &gt; 0 )</div>\n\
<div class=\"line\">    {</div>\n\
<div class=\"line\">        <span class=\"comment\">// Only process the first entry of this UV set (if multiple exist).</span></div>\n\
<div class=\"line\">        <span class=\"comment\">// There can only be one default, so we&#39;ll only consider the default</span></div>\n\
<div class=\"line\">        <span class=\"comment\">// of the first varying input of this UV set.</span></div>\n\
<div class=\"line\">        <span class=\"comment\">//</span></div>\n\
<div class=\"line\">        <a name=\"_a128\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_fn_dependency_node.html\">MFnDependencyNode</a> depFn( thisMObject() );</div>\n\
<div class=\"line\">        <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string.html\">MString</a> attrName( uvParams[0] );</div>\n\
<div class=\"line\">        attrName += <span class=\"stringliteral\">&quot;_DefaultTexture&quot;</span>;</div>\n\
<div class=\"line\">        <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_plug.html\">MPlug</a> defaultTexPlug = depFn.findPlug( attrName );</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">if</span>( !defaultTexPlug.<a name=\"a129\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_plug.html#ab7ec149d38b7c29ca55c5aa7b407d8f9\">isNull</a>() )</div>\n\
<div class=\"line\">        {</div>\n\
<div class=\"line\">            defaultTexPlug.<a name=\"a130\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_plug.html#ab017c746e6e0c13bf994b2458d3b5eee\">getValue</a>( defaultTex );</div>\n\
<div class=\"line\">        }</div>\n\
<div class=\"line\">    }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <span class=\"comment\">// Locate any texture UVLinks that point to these uvParams and record</span></div>\n\
<div class=\"line\">    <span class=\"comment\">// those textures.</span></div>\n\
<div class=\"line\">    <span class=\"comment\">//</span></div>\n\
<div class=\"line\">    <span class=\"keywordtype\">unsigned</span> <span class=\"keywordtype\">int</span> nUniform = fUniformParameters.length();</div>\n\
<div class=\"line\">    <span class=\"keywordtype\">unsigned</span> <span class=\"keywordtype\">int</span> nUVParams = uvParams.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string_array.html#a580388f31f60c46fac867ca48a48da1e\">length</a>();</div>\n\
<div class=\"line\">    <span class=\"keywordflow\">for</span>( <span class=\"keywordtype\">unsigned</span> <span class=\"keywordtype\">int</span> i = 0; i &lt; nUVParams; i++ )</div>\n\
<div class=\"line\">    {</div>\n\
<div class=\"line\">        <span class=\"keyword\">const</span> <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string.html\">MString</a>&amp; varName = uvParams[i];</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">for</span>( <span class=\"keywordtype\">unsigned</span> <span class=\"keywordtype\">int</span> j = 0; j &lt; nUniform; j++ )</div>\n\
<div class=\"line\">        {</div>\n\
<div class=\"line\">            <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html\">MUniformParameter</a> elem = fUniformParameters.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_varying_parameter.html#a40cde1a792fb9a978d3a3a68414fb865\">getElement</a>(j);</div>\n\
<div class=\"line\">            <span class=\"keywordflow\">if</span>( elem.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html#ac52395416dfb965501c67061d7198c1c\">type</a>() != MUniformParameter::kType2DTexture )</div>\n\
<div class=\"line\">            {</div>\n\
<div class=\"line\">                <span class=\"keywordflow\">continue</span>;</div>\n\
<div class=\"line\">            }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">            LPCSTR uvLinkAnnot;</div>\n\
<div class=\"line\">            D3DXHANDLE d3dParameter = (D3DXHANDLE) elem.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html#aabc6dea98709831626d182f1bce0c69a\">userData</a>();</div>\n\
<div class=\"line\">            <span class=\"keywordflow\">if</span>( !GetAnnotation(d3dParameter, <span class=\"stringliteral\">&quot;UVLink&quot;</span>, uvLinkAnnot) )</div>\n\
<div class=\"line\">            {</div>\n\
<div class=\"line\">                <span class=\"keywordflow\">continue</span>;</div>\n\
<div class=\"line\">            }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">            <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string.html\">MString</a> uvLink( uvLinkAnnot );</div>\n\
<div class=\"line\">            <span class=\"keywordflow\">if</span>( uvLink == varName )</div>\n\
<div class=\"line\">            {</div>\n\
<div class=\"line\">                <span class=\"keywordflow\">if</span>( elem.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html#aca2cba4630391c78dcf1a828986160da\">name</a>() == defaultTex )</div>\n\
<div class=\"line\">                {</div>\n\
<div class=\"line\">                    imageNames.<a name=\"a131\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string_array.html#a3db31367f989449bb9b121cd734dc0df\">insert</a>( elem.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html#aca2cba4630391c78dcf1a828986160da\">name</a>(), 0 );</div>\n\
<div class=\"line\">                }</div>\n\
<div class=\"line\">                <span class=\"keywordflow\">else</span></div>\n\
<div class=\"line\">                {</div>\n\
<div class=\"line\">                    imageNames.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string_array.html#a18d06b3d0af1426e654ac2cc1dc86c60\">append</a>( elem.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html#aca2cba4630391c78dcf1a828986160da\">name</a>() );</div>\n\
<div class=\"line\">                }</div>\n\
<div class=\"line\">            }</div>\n\
<div class=\"line\">        }</div>\n\
<div class=\"line\">    }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <span class=\"comment\">// If no UVLinks found, display all 2D textures.</span></div>\n\
<div class=\"line\">    <span class=\"comment\">//</span></div>\n\
<div class=\"line\">    <span class=\"keywordflow\">if</span>( imageNames.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string_array.html#a580388f31f60c46fac867ca48a48da1e\">length</a>() == 0 )</div>\n\
<div class=\"line\">    {</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">for</span>( <span class=\"keywordtype\">unsigned</span> <span class=\"keywordtype\">int</span> i = 0; i &lt; nUniform; i++ )</div>\n\
<div class=\"line\">        {</div>\n\
<div class=\"line\">            <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html\">MUniformParameter</a> elem = fUniformParameters.getElement(i);</div>\n\
<div class=\"line\">            <span class=\"keywordflow\">if</span>( elem.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html#ac52395416dfb965501c67061d7198c1c\">type</a>() == MUniformParameter::kType2DTexture )</div>\n\
<div class=\"line\">            {</div>\n\
<div class=\"line\">                <span class=\"keywordflow\">if</span>( elem.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html#aca2cba4630391c78dcf1a828986160da\">name</a>() == defaultTex )</div>\n\
<div class=\"line\">                {</div>\n\
<div class=\"line\">                    imageNames.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string_array.html#a3db31367f989449bb9b121cd734dc0df\">insert</a>( elem.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html#aca2cba4630391c78dcf1a828986160da\">name</a>(), 0 );</div>\n\
<div class=\"line\">                }</div>\n\
<div class=\"line\">                <span class=\"keywordflow\">else</span></div>\n\
<div class=\"line\">                {</div>\n\
<div class=\"line\">                    imageNames.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string_array.html#a18d06b3d0af1426e654ac2cc1dc86c60\">append</a>( elem.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html#aca2cba4630391c78dcf1a828986160da\">name</a>() );</div>\n\
<div class=\"line\">                }</div>\n\
<div class=\"line\">            }</div>\n\
<div class=\"line\">        }</div>\n\
<div class=\"line\">    }</div>\n\
<div class=\"line\">    <span class=\"keywordflow\">return</span> (imageNames.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string_array.html#a580388f31f60c46fac867ca48a48da1e\">length</a>() &gt; 0) ? <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_status.html#a02ab596f4febca68da503aaf8dde3a80af0536797208144380691e2b376ffc1d1\">MStatus::kSuccess</a> : <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_status.html#a02ab596f4febca68da503aaf8dde3a80a598e4c5d4c234c1bf09367d64487519c\">MStatus::kNotImplemented</a>;</div>\n\
<div class=\"line\">}</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"><span class=\"comment\">/* virtual */</span></div>\n\
<div class=\"line\"><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_status.html\">MStatus</a> hlslShader::renderImage( <span class=\"keyword\">const</span> <a class=\"code\" href=\"#!/url=./cpp_ref/struct_m_px_hardware_shader_1_1_shader_context.html\">MPxHardwareShader::ShaderContext</a> &amp;context,</div>\n\
<div class=\"line\">                                <span class=\"keyword\">const</span> <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string.html\">MString</a> &amp;imageName,</div>\n\
<div class=\"line\">                                floatRegion region,</div>\n\
<div class=\"line\">                                <span class=\"keyword\">const</span> <a name=\"_a132\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/struct_m_px_hardware_shader_1_1_render_parameters.html\">MPxHardwareShader::RenderParameters</a>&amp; <span class=\"comment\">/*parameters*/</span>,</div>\n\
<div class=\"line\">                                <span class=\"keywordtype\">int</span> &amp;imageWidth,</div>\n\
<div class=\"line\">                                <span class=\"keywordtype\">int</span> &amp;imageHeight )</div>\n\
<div class=\"line\">{</div>\n\
<div class=\"line\">    <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html\">MUniformParameter</a> imageParam;</div>\n\
<div class=\"line\">    <span class=\"keywordtype\">bool</span> foundParam = <span class=\"keyword\">false</span>;</div>\n\
<div class=\"line\">    <span class=\"keywordtype\">unsigned</span> <span class=\"keywordtype\">int</span> nUniform = fUniformParameters.length();</div>\n\
<div class=\"line\">    <span class=\"keywordflow\">for</span>( <span class=\"keywordtype\">unsigned</span> <span class=\"keywordtype\">int</span> i = 0; i &lt; nUniform; i++ )</div>\n\
<div class=\"line\">    {</div>\n\
<div class=\"line\">        <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html\">MUniformParameter</a> elem = fUniformParameters.getElement(i);</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">if</span>( elem.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html#aca2cba4630391c78dcf1a828986160da\">name</a>() == imageName )</div>\n\
<div class=\"line\">        {</div>\n\
<div class=\"line\">            imageParam = elem;</div>\n\
<div class=\"line\">            foundParam = <span class=\"keyword\">true</span>;</div>\n\
<div class=\"line\">            <span class=\"keywordflow\">break</span>;</div>\n\
<div class=\"line\">        }</div>\n\
<div class=\"line\">    }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <span class=\"keywordflow\">if</span>( !foundParam )</div>\n\
<div class=\"line\">    {</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">return</span> <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_status.html#a02ab596f4febca68da503aaf8dde3a80a598e4c5d4c234c1bf09367d64487519c\">MStatus::kNotImplemented</a>;</div>\n\
<div class=\"line\">    }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <span class=\"comment\">// Only supports 2D textures.</span></div>\n\
<div class=\"line\">    <span class=\"comment\">//</span></div>\n\
<div class=\"line\">    <span class=\"keywordflow\">if</span>( imageParam.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html#ac52395416dfb965501c67061d7198c1c\">type</a>() != MUniformParameter::kType2DTexture )</div>\n\
<div class=\"line\">    {</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">return</span> <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_status.html#a02ab596f4febca68da503aaf8dde3a80a598e4c5d4c234c1bf09367d64487519c\">MStatus::kNotImplemented</a>;</div>\n\
<div class=\"line\">    }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <span class=\"comment\">// Draw the texture (in OpenGL)</span></div>\n\
<div class=\"line\">    <span class=\"comment\">//</span></div>\n\
<div class=\"line\">    glPushAttrib( GL_ALL_ATTRIB_BITS );</div>\n\
<div class=\"line\">    glPushClientAttrib( GL_CLIENT_VERTEX_ARRAY_BIT);</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <span class=\"comment\">// Use MHwTextureManager for our texture cache, since we need to</span></div>\n\
<div class=\"line\">    <span class=\"comment\">// render in OpenGL.</span></div>\n\
<div class=\"line\">    <span class=\"comment\">//</span></div>\n\
<div class=\"line\">    <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_plug.html\">MPlug</a> plug = imageParam.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html#a000c434a3beb6c2cc9681d9e445cf0eb\">getSource</a>();</div>\n\
<div class=\"line\">    <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_image_file_info.html#a9b0c9320a802a00a718bcab75ba40550\">MImageFileInfo::MHwTextureType</a> hwType;</div>\n\
<div class=\"line\">    <span class=\"keywordflow\">if</span>( MS::kSuccess != <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_hw_texture_manager.html#af1077c5a30b589e36b864c09876fbc44\">MHwTextureManager::glBind</a>(plug, hwType) )</div>\n\
<div class=\"line\">    {</div>\n\
<div class=\"line\">        glPopAttrib();</div>\n\
<div class=\"line\">        glPopClientAttrib();</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">        <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_fn_dependency_node.html\">MFnDependencyNode</a> fnNode( thisMObject() );</div>\n\
<div class=\"line\">        <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string.html\">MString</a> sMsg = <span class=\"stringliteral\">&quot;hlslShader &quot;</span>;</div>\n\
<div class=\"line\">        sMsg += fnNode.name();</div>\n\
<div class=\"line\">        sMsg += <span class=\"stringliteral\">&quot; : failed to load texture \\&quot;&quot;</span>;</div>\n\
<div class=\"line\">        sMsg += imageName;</div>\n\
<div class=\"line\">        sMsg += <span class=\"stringliteral\">&quot;\\&quot;.&quot;</span>;</div>\n\
<div class=\"line\">        <a name=\"a133\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_global.html#acb043e7fc4eb7fc0f39833d31364b8a4\">MGlobal::displayWarning</a>( sMsg );</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">        <span class=\"keywordflow\">return</span> <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_status.html#a02ab596f4febca68da503aaf8dde3a80a598e4c5d4c234c1bf09367d64487519c\">MStatus::kNotImplemented</a>;</div>\n\
<div class=\"line\">    }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    GLint width = 0;</div>\n\
<div class=\"line\">    GLint height = 0;</div>\n\
<div class=\"line\">    glGetTexLevelParameteriv(GL_TEXTURE_2D, 0, GL_TEXTURE_WIDTH, &amp;width);</div>\n\
<div class=\"line\">    glGetTexLevelParameteriv(GL_TEXTURE_2D, 0, GL_TEXTURE_HEIGHT, &amp;height);</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_S, GL_REPEAT);</div>\n\
<div class=\"line\">    glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_T, GL_REPEAT);</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    glBegin( GL_QUADS );</div>\n\
<div class=\"line\">    glTexCoord2f(region[0][0], region[0][1]);</div>\n\
<div class=\"line\">    glVertex2f(region[0][0], region[0][1]);</div>\n\
<div class=\"line\">    glTexCoord2f(region[0][0], region[1][1]);</div>\n\
<div class=\"line\">    glVertex2f(region[0][0], region[1][1]);</div>\n\
<div class=\"line\">    glTexCoord2f(region[1][0], region[1][1]);</div>\n\
<div class=\"line\">    glVertex2f(region[1][0], region[1][1]);</div>\n\
<div class=\"line\">    glTexCoord2f(region[1][0], region[0][1]);</div>\n\
<div class=\"line\">    glVertex2f(region[1][0], region[0][1]);</div>\n\
<div class=\"line\">    glEnd();</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    glPopAttrib();</div>\n\
<div class=\"line\">    glPopClientAttrib();</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    imageWidth = (int) width;</div>\n\
<div class=\"line\">    imageHeight = (int) height;</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <span class=\"keywordflow\">return</span> <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_status.html#a02ab596f4febca68da503aaf8dde3a80af0536797208144380691e2b376ffc1d1\">MStatus::kSuccess</a>;</div>\n\
<div class=\"line\">}</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"><span class=\"comment\">// Renders the specified texture (imageName) to the UV editor in viewport 2.0.</span></div>\n\
<div class=\"line\"><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_status.html\">MStatus</a> hlslShader::renderImage( <span class=\"keyword\">const</span> <a class=\"code\" href=\"#!/url=./cpp_ref/struct_m_px_hardware_shader_1_1_shader_context.html\">MPxHardwareShader::ShaderContext</a>&amp; shaderContext,</div>\n\
<div class=\"line\">                                <a name=\"_a134\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_h_w_render_1_1_m_u_i_draw_manager.html\">MHWRender::MUIDrawManager</a>&amp; uiDrawManager,</div>\n\
<div class=\"line\">                                <span class=\"keyword\">const</span> <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string.html\">MString</a>&amp; imageName,</div>\n\
<div class=\"line\">                                floatRegion region,</div>\n\
<div class=\"line\">                                <span class=\"keyword\">const</span> <a class=\"code\" href=\"#!/url=./cpp_ref/struct_m_px_hardware_shader_1_1_render_parameters.html\">MPxHardwareShader::RenderParameters</a>&amp; parameters,</div>\n\
<div class=\"line\">                                <span class=\"keywordtype\">int</span>&amp; imageWidth,</div>\n\
<div class=\"line\">                                <span class=\"keywordtype\">int</span>&amp; imageHeight )</div>\n\
<div class=\"line\">{</div>\n\
<div class=\"line\">    <span class=\"comment\">// Get device</span></div>\n\
<div class=\"line\">    <a name=\"_a135\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_h_w_render_1_1_m_renderer.html\">MHWRender::MRenderer</a>* theRenderer = <a name=\"a136\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_h_w_render_1_1_m_renderer.html#a4678a72ac6959ed21d422d27928d0343\">MHWRender::MRenderer::theRenderer</a>();</div>\n\
<div class=\"line\">    <span class=\"keywordflow\">if</span> (!theRenderer)</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">return</span> <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_status.html#a02ab596f4febca68da503aaf8dde3a80a1ef6c2d725fb4bec3e7e840d28adbc00\">MStatus::kFailure</a>;</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html\">MUniformParameter</a> imageParam;</div>\n\
<div class=\"line\">    <span class=\"keywordflow\">for</span>( <span class=\"keywordtype\">int</span> i = 0; i &lt; fUniformParameters.length(); i++ ) {</div>\n\
<div class=\"line\">        <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html\">MUniformParameter</a> elem = fUniformParameters.getElement(i);</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">if</span>( elem.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html#a37357b066d4c628b1fae2f1ee08b2b12\">isATexture</a>() &amp;&amp; elem.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html#aca2cba4630391c78dcf1a828986160da\">name</a>() == imageName ) { <span class=\"comment\">// Check for isATexture, as multiple parameters can have the same UI name.</span></div>\n\
<div class=\"line\">            imageParam = elem;</div>\n\
<div class=\"line\">            <span class=\"keywordflow\">break</span>;</div>\n\
<div class=\"line\">        }</div>\n\
<div class=\"line\">    }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <span class=\"comment\">// Only supports 2D textures.</span></div>\n\
<div class=\"line\">    <span class=\"keywordflow\">if</span>( imageParam.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html#ac52395416dfb965501c67061d7198c1c\">type</a>() != MUniformParameter::kType2DTexture )</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">return</span> <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_status.html#a02ab596f4febca68da503aaf8dde3a80a1ef6c2d725fb4bec3e7e840d28adbc00\">MStatus::kFailure</a>;</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <a name=\"_a137\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_h_w_render_1_1_m_texture_manager.html\">MHWRender::MTextureManager</a>* txtManager = theRenderer-&gt;<a name=\"a138\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_h_w_render_1_1_m_renderer.html#aa3f2ec2984800e2cd8ea09b4ad9f072e\">getTextureManager</a>();</div>\n\
<div class=\"line\">    <span class=\"keywordflow\">if</span>(txtManager == NULL)</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">return</span> <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_status.html#a02ab596f4febca68da503aaf8dde3a80a1ef6c2d725fb4bec3e7e840d28adbc00\">MStatus::kFailure</a>;</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <a name=\"_a139\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_h_w_render_1_1_m_draw_context.html\">MHWRender::MDrawContext</a> *context = <a name=\"a140\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_utilities.html#ab9589288e0f14cffca1b6da7d262631d\">MHWRender::MRenderUtilities::acquireUVTextureDrawContext</a>();</div>\n\
<div class=\"line\">    <span class=\"keywordflow\">if</span> (!context) <span class=\"keywordflow\">return</span> <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_status.html#a02ab596f4febca68da503aaf8dde3a80a1ef6c2d725fb4bec3e7e840d28adbc00\">MStatus::kFailure</a>;</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <a name=\"_a141\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_h_w_render_1_1_m_texture.html\">MHWRender::MTexture</a>* texture = txtManager-&gt;<a name=\"a142\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_h_w_render_1_1_m_texture_manager.html#a04aa3cfef217948abc8edd0f19565f95\">acquireTexture</a>( imageParam.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html#ae9f61935fee5d55a0df8bd4b2013a679\">getAsString</a>( *context ) );</div>\n\
<div class=\"line\">    <span class=\"keywordflow\">if</span>(texture == NULL)</div>\n\
<div class=\"line\">    {</div>\n\
<div class=\"line\">        <a name=\"a143\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_utilities.html#a5222892109760efc845e37469b0f6cb4\">MHWRender::MRenderUtilities::releaseDrawContext</a>( context );</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">return</span> <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_status.html#a02ab596f4febca68da503aaf8dde3a80a598e4c5d4c234c1bf09367d64487519c\">MStatus::kNotImplemented</a>;</div>\n\
<div class=\"line\">    }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <span class=\"comment\">// get image dimension</span></div>\n\
<div class=\"line\">    {</div>\n\
<div class=\"line\">        <a name=\"_a144\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_h_w_render_1_1_m_texture_description.html\">MHWRender::MTextureDescription</a> desc;</div>\n\
<div class=\"line\">        texture-&gt;<a name=\"a145\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_h_w_render_1_1_m_texture.html#ad1b6f25f4fb913a233b1c2bff46a62a1\">textureDescription</a>(desc);</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">        imageWidth  = (int)desc.<a name=\"a146\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_h_w_render_1_1_m_texture_description.html#a2582291699b63f6ddc938c371b54344e\">fWidth</a>;</div>\n\
<div class=\"line\">        imageHeight = (<span class=\"keywordtype\">int</span>)desc.<a name=\"a147\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_h_w_render_1_1_m_texture_description.html#aa3b84951e55674788c9ae0f404a8ee17\">fHeight</a>;</div>\n\
<div class=\"line\">    }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <span class=\"comment\">// Early return, this is just a call to get the size of the texture (&quot;Use image ratio&quot; is on)</span></div>\n\
<div class=\"line\">    <span class=\"keywordflow\">if</span>(region[0][0] == 0 &amp;&amp; region[0][1] == 0 &amp;&amp; region[1][0] == 0 &amp;&amp; region[1][1] == 0)</div>\n\
<div class=\"line\">    {</div>\n\
<div class=\"line\">        <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_utilities.html#a5222892109760efc845e37469b0f6cb4\">MHWRender::MRenderUtilities::releaseDrawContext</a>( context );</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">return</span> <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_status.html#a02ab596f4febca68da503aaf8dde3a80af0536797208144380691e2b376ffc1d1\">MStatus::kSuccess</a>;</div>\n\
<div class=\"line\">    }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <span class=\"comment\">// Render texture on quad</span></div>\n\
<div class=\"line\">    <a name=\"_a148\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_point_array.html\">MPointArray</a> positions;</div>\n\
<div class=\"line\">    <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_point_array.html\">MPointArray</a>&amp; texcoords = positions;</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <span class=\"comment\">// Tri #0</span></div>\n\
<div class=\"line\">    positions.<a name=\"a149\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_point_array.html#abe5a9fe36b4651af38a4a26c85f46e1a\">append</a>(region[0][0], region[0][1]);</div>\n\
<div class=\"line\">    positions.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_point_array.html#abe5a9fe36b4651af38a4a26c85f46e1a\">append</a>(region[1][0], region[0][1]);</div>\n\
<div class=\"line\">    positions.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_point_array.html#abe5a9fe36b4651af38a4a26c85f46e1a\">append</a>(region[1][0], region[1][1]);</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <span class=\"comment\">// Tri #1</span></div>\n\
<div class=\"line\">    positions.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_point_array.html#abe5a9fe36b4651af38a4a26c85f46e1a\">append</a>(region[0][0], region[0][1]);</div>\n\
<div class=\"line\">    positions.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_point_array.html#abe5a9fe36b4651af38a4a26c85f46e1a\">append</a>(region[1][0], region[1][1]);</div>\n\
<div class=\"line\">    positions.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_point_array.html#abe5a9fe36b4651af38a4a26c85f46e1a\">append</a>(region[0][0], region[1][1]);</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    uiDrawManager.<a name=\"a150\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_h_w_render_1_1_m_u_i_draw_manager.html#a9008ebfa63c02670625076230d77c3f9\">beginDrawable</a>();</div>\n\
<div class=\"line\">    uiDrawManager.<a name=\"a151\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_h_w_render_1_1_m_u_i_draw_manager.html#a9baede3e37abe9551e50a8c6be65ec4d\">setColor</a>( parameters.<a name=\"a152\"></a>baseColor );</div>\n\
<div class=\"line\">    uiDrawManager.<a name=\"a153\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_h_w_render_1_1_m_u_i_draw_manager.html#aa02e49a4dc244a97fdfcb4a5452773fe\">setTexture</a>( texture );</div>\n\
<div class=\"line\">    uiDrawManager.<a name=\"a154\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_h_w_render_1_1_m_u_i_draw_manager.html#af740bfef414d18e34661378f7f4bfb91\">setTextureSampler</a>( parameters.<a name=\"a155\"></a>unfiltered ? MHWRender::MSamplerState::kMinMagMipLinear : MHWRender::MSamplerState::kMinMagMipPoint, MHWRender::MSamplerState::kTexWrap );</div>\n\
<div class=\"line\">    uiDrawManager.<a name=\"a156\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_h_w_render_1_1_m_u_i_draw_manager.html#a0a8ebc59bf8740d56560abf3e8d7e63d\">setTextureMask</a>( parameters.<a name=\"a157\"></a>showAlphaMask ? MHWRender::MBlendState::kAlphaChannel : MHWRender::MBlendState::kRGBAChannels );</div>\n\
<div class=\"line\">    uiDrawManager.<a name=\"a158\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_h_w_render_1_1_m_u_i_draw_manager.html#ab7479336abc018548fe68277932d848a\">mesh</a>( MHWRender::MUIDrawManager::kTriangles, positions, NULL, NULL, NULL, &amp;texcoords );</div>\n\
<div class=\"line\">    uiDrawManager.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_h_w_render_1_1_m_u_i_draw_manager.html#aa02e49a4dc244a97fdfcb4a5452773fe\">setTexture</a>( NULL );</div>\n\
<div class=\"line\">    uiDrawManager.<a name=\"a159\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_h_w_render_1_1_m_u_i_draw_manager.html#a78c343c25a05be7e46dd4b7ebab82ff6\">endDrawable</a>();</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_utilities.html#a5222892109760efc845e37469b0f6cb4\">MHWRender::MRenderUtilities::releaseDrawContext</a>( context );</div>\n\
<div class=\"line\">    <span class=\"keywordflow\">return</span> <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_status.html#a02ab596f4febca68da503aaf8dde3a80af0536797208144380691e2b376ffc1d1\">MStatus::kSuccess</a>;</div>\n\
<div class=\"line\">}</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_status.html\">MStatus</a> hlslShader::uvLinks( <span class=\"keyword\">const</span> <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string.html\">MString</a>&amp; varyingParamName,</div>\n\
<div class=\"line\">                            <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string_array.html\">MStringArray</a>&amp; uniformTextureNames )</div>\n\
<div class=\"line\">{</div>\n\
<div class=\"line\">    <span class=\"keywordflow\">if</span>( !fD3DEffect )</div>\n\
<div class=\"line\">    {</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">return</span> MS::kFailure;</div>\n\
<div class=\"line\">    }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <span class=\"comment\">// Parse through the uniform parameters for UVLink annotations</span></div>\n\
<div class=\"line\">    <span class=\"comment\">// against &#39;varyingParamName&#39;.</span></div>\n\
<div class=\"line\">    <span class=\"comment\">//</span></div>\n\
<div class=\"line\">    <span class=\"keywordtype\">unsigned</span> <span class=\"keywordtype\">int</span> nUniform = fUniformParameters.length();</div>\n\
<div class=\"line\">    <span class=\"keywordflow\">for</span>( <span class=\"keywordtype\">unsigned</span> <span class=\"keywordtype\">int</span> i = 0; i &lt; nUniform; i++ )</div>\n\
<div class=\"line\">    {</div>\n\
<div class=\"line\">        <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html\">MUniformParameter</a> elem = fUniformParameters.getElement(i);</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">if</span>( elem.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html#ac52395416dfb965501c67061d7198c1c\">type</a>() != MUniformParameter::kType2DTexture )</div>\n\
<div class=\"line\">        {</div>\n\
<div class=\"line\">            <span class=\"keywordflow\">continue</span>;</div>\n\
<div class=\"line\">        }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">        LPCSTR uvLinkAnnot;</div>\n\
<div class=\"line\">        D3DXHANDLE d3dParameter = (D3DXHANDLE) elem.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html#aabc6dea98709831626d182f1bce0c69a\">userData</a>();</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">if</span>( !GetAnnotation(d3dParameter, <span class=\"stringliteral\">&quot;UVLink&quot;</span>, uvLinkAnnot) )</div>\n\
<div class=\"line\">        {</div>\n\
<div class=\"line\">            <span class=\"keywordflow\">continue</span>;</div>\n\
<div class=\"line\">        }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">        <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string.html\">MString</a> uvLink( uvLinkAnnot );</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">if</span>( uvLink == varyingParamName )</div>\n\
<div class=\"line\">        {</div>\n\
<div class=\"line\">            uniformTextureNames.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string_array.html#a18d06b3d0af1426e654ac2cc1dc86c60\">append</a>( elem.<a class=\"code\" href=\"#!/url=./cpp_ref/class_m_uniform_parameter.html#aca2cba4630391c78dcf1a828986160da\">name</a>() );</div>\n\
<div class=\"line\">        }</div>\n\
<div class=\"line\">    }</div>\n\
<div class=\"line\">    <span class=\"keywordflow\">return</span> MS::kSuccess;</div>\n\
<div class=\"line\">}</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"><span class=\"comment\">// hlslShaderCmd</span></div>\n\
<div class=\"line\"><span class=\"comment\">//</span></div>\n\
<div class=\"line\"><span class=\"preprocessor\">#define kUVLinkFlag         &quot;-uvl&quot;</span></div>\n\
<div class=\"line\"><span class=\"preprocessor\">#define kUVLinkFlagLong     &quot;-uvLink&quot;</span></div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">hlslShaderCmd::hlslShaderCmd()</div>\n\
<div class=\"line\">{}</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">hlslShaderCmd::~hlslShaderCmd()</div>\n\
<div class=\"line\">{}</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_status.html\">MStatus</a> hlslShaderCmd::doIt( <span class=\"keyword\">const</span> <a name=\"_a160\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_arg_list.html\">MArgList</a>&amp; args )</div>\n\
<div class=\"line\">{</div>\n\
<div class=\"line\">    <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_status.html\">MStatus</a> status;</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <span class=\"comment\">// Parse the shader node</span></div>\n\
<div class=\"line\">    <span class=\"comment\">//</span></div>\n\
<div class=\"line\">    <a name=\"_a161\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_arg_parser.html\">MArgParser</a> parser( syntax(), args );</div>\n\
<div class=\"line\">    <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string.html\">MString</a> nodeName;</div>\n\
<div class=\"line\">    parser.getCommandArgument( 0, nodeName );</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <a name=\"_a162\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_selection_list.html\">MSelectionList</a> list;</div>\n\
<div class=\"line\">    status = list.<a name=\"a163\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_selection_list.html#a23929aeafb29672f2652128eac9c4dec\">add</a>( nodeName );</div>\n\
<div class=\"line\">    <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_object.html\">MObject</a> shaderNode;</div>\n\
<div class=\"line\">    status = list.<a name=\"a164\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_selection_list.html#a72d8cd9c78fd234dcf68cd2fb70bc432\">getDependNode</a>( 0, shaderNode );</div>\n\
<div class=\"line\">    <span class=\"keywordflow\">if</span>( status != MS::kSuccess )</div>\n\
<div class=\"line\">    {</div>\n\
<div class=\"line\">        displayError( <span class=\"stringliteral\">&quot;Invalid hlslShader node: &quot;</span> + nodeName );</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">return</span> MS::kFailure;</div>\n\
<div class=\"line\">    }</div>\n\
<div class=\"line\">    </div>\n\
<div class=\"line\">    <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_fn_dependency_node.html\">MFnDependencyNode</a> depFn( shaderNode );</div>\n\
<div class=\"line\">    <span class=\"keywordflow\">if</span>( depFn.typeId() != hlslShader::sId )</div>\n\
<div class=\"line\">    {</div>\n\
<div class=\"line\">        displayError( <span class=\"stringliteral\">&quot;Invalid hlslShader node: &quot;</span> + nodeName );</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">return</span> MS::kFailure;</div>\n\
<div class=\"line\">    }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    hlslShader* shader = (hlslShader*) depFn.userNode();</div>\n\
<div class=\"line\">    <span class=\"keywordflow\">if</span>( !shader )</div>\n\
<div class=\"line\">    {</div>\n\
<div class=\"line\">        displayError( <span class=\"stringliteral\">&quot;Invalid hlslShader node: &quot;</span> + nodeName );</div>\n\
<div class=\"line\">        <span class=\"keywordflow\">return</span> MS::kFailure;</div>\n\
<div class=\"line\">    }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <span class=\"comment\">// Process flag arguments</span></div>\n\
<div class=\"line\">    <span class=\"comment\">//</span></div>\n\
<div class=\"line\">    <span class=\"keywordflow\">if</span>( parser.isFlagSet(kUVLinkFlag) )</div>\n\
<div class=\"line\">    {</div>\n\
<div class=\"line\">        <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string.html\">MString</a> paramName;</div>\n\
<div class=\"line\">        parser.getFlagArgument( kUVLinkFlag, 0, paramName );</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">        <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_string_array.html\">MStringArray</a> textures;</div>\n\
<div class=\"line\">        shader-&gt;uvLinks( paramName, textures );</div>\n\
<div class=\"line\">        setResult( textures );</div>\n\
<div class=\"line\">    }</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\">    <span class=\"keywordflow\">return</span> MS::kSuccess;</div>\n\
<div class=\"line\">}</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"><a name=\"_a165\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_syntax.html\">MSyntax</a> hlslShaderCmd::newSyntax()</div>\n\
<div class=\"line\">{</div>\n\
<div class=\"line\">    <a class=\"code\" href=\"#!/url=./cpp_ref/class_m_syntax.html\">MSyntax</a> syntax;</div>\n\
<div class=\"line\">    syntax.<a name=\"a166\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_syntax.html#aeaeaac3794bb4de8004afb1ac1829488\">addFlag</a>( kUVLinkFlag, kUVLinkFlagLong, MSyntax::kString );</div>\n\
<div class=\"line\">    syntax.<a name=\"a167\"></a><a class=\"code\" href=\"#!/url=./cpp_ref/class_m_syntax.html#a1d306e0ce61954dd7cbdcd0e74a905a6\">addArg</a>( MSyntax::kString );</div>\n\
<div class=\"line\">    <span class=\"keywordflow\">return</span> syntax;</div>\n\
<div class=\"line\">}</div>\n\
<div class=\"line\"></div>\n\
<div class=\"line\"><span class=\"keywordtype\">void</span>* hlslShaderCmd::creator()</div>\n\
<div class=\"line\">{</div>\n\
<div class=\"line\">    <span class=\"keywordflow\">return</span> <span class=\"keyword\">new</span> hlslShaderCmd;</div>\n\
<div class=\"line\">}</div>\n\
<div class=\"line\"></div>\n\
</div><!-- fragment --> </div><!-- contents -->\n\
</div><!-- doc-content -->\n\
<!-- start footer part -->\n\
\n\
      <div class=\"footer-block\"><a href=\"../html/ac.cmtdialog.htm\" class=\"comments-anchor\" target=\"_blank\"><span class=\"comments-link\">Please send us your comment about this page</span></a></div></div>\n\
   </div></body>\n\
</html>\n\
";