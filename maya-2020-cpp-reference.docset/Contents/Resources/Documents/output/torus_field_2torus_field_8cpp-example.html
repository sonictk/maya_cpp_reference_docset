<!-- saved from url=(0024)http://docs.autodesk.com -->
<html>
<head><script src="../scripts/yepnope.1.5.4-min.js" type="text/javascript"></script><script src="../scripts/lib/jquery-1.11.1.min.js" type="text/javascript"></script>
<title>C++ API Reference: torusField/torusField.cpp</title>
</head>
<body height="100%"><div class="body_content" id="body-content"><link href="cpp_ref/navtree.css" rel="stylesheet" type="text/css"/><link href="cpp_ref/doxygen.css" rel="stylesheet" type="text/css"/><link href="cpp_ref/tabs.css" rel="stylesheet" type="text/css"/><link href="style/adsk.cpm.css" rel="stylesheet" type="text/css"/><script type="text/javascript">
var tocSystemNeedsToBeLoaded = typeof(cpp_ref_adsk_ref_toc) == 'undefined';
var weAreIn21 = $('div#main.view-active').length;
var tocPrefix = '';
if (weAreIn21)
{ tocPrefix = 'cpp_ref/'; }
function cpp_ref_initializeToc(forceTrigger) {
    cpp_ref_adsk_ref_toc.initResizable();
    cpp_ref_adsk_ref_toc.initNavTree('torus_field_2torus_field_8cpp-example.html', tocPrefix);
    dQuery(document).trigger('toc_initialized');
}
if (tocSystemNeedsToBeLoaded)
{
	yepnope([{
	load:[tocPrefix + 'json3.min.js', tocPrefix + 'jquery.js', tocPrefix + 'ref-toc-controller.js', tocPrefix + 'dynsections.js'],
	complete: function() {
	  if (typeof(dQuery) == 'undefined')
	  {
	    dQuery = jQuery.noConflict(true);
	  }
	  else { jQuery.noConflict(true); }
	  $(document).ready(cpp_ref_initializeToc);
	}
 	}])
}
if (!weAreIn21) { // if in AKN...
$(window).load( function() {
    setTimeout( function() {
        var content = $('body > div').not('#body-content');     // take any divs under body that are not id=body-content
        content.each( function() { 
            $(this).css( { 'padding-left': $(this).css('margin-left') } );       // and if they have any padding-left already, move it to margin-left.
        } );
        var width = cpp_ref_adsk_ref_toc.readFromStorage('width');
        content.css({marginLeft:parseInt(width)+6+"px"});
    }, 100);
} ); 
}
</script><script>
 if (!tocSystemNeedsToBeLoaded) { cpp_ref_initializeToc(); }
 </script>
<div>
<div class="head">
<h1>C++ API Reference: torusField/torusField.cpp</h1>
</div>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<div class="tabs" id="navrow1">
<ul class="tablist">
<li><a href="./index.html"><span>Main Page</span></a></li>
<li><a href="./pages.html"><span>Related Pages</span></a></li>
<li><a href="./modules.html"><span>Modules</span></a></li>
<li><a href="./namespaces.html"><span>Namespaces</span></a></li>
<li><a href="./annotated.html"><span>Classes</span></a></li>
<li><a href="./examples.html"><span>Examples</span></a></li>
<li>
<div class="MSearchBoxInactive" id="MSearchBox">
<span class="left">
<img alt="" id="MSearchSelect" onmouseout="return searchBox.OnSearchSelectHide()" onmouseover="return searchBox.OnSearchSelectShow()" src="cpp_ref/search/mag_sel.png"/>
<input accesskey="S" id="MSearchField" onblur="searchBox.OnSearchFieldFocus(false)" onfocus="searchBox.OnSearchFieldFocus(true)" onkeyup="searchBox.OnSearchFieldChange(event)" type="text" value="Search"/>
</span><span class="right">
<a href="javascript:searchBox.CloseResultsWindow()" id="MSearchClose"><img alt="" border="0" id="MSearchCloseImg" src="cpp_ref/search/close.png"/></a>
</span>
</div>
</li>
</ul>
</div>
</div><!-- top -->
<div class="ui-resizable side-nav-resizable" id="side-nav">
<div id="nav-tree">
<div id="nav-tree-contents">
<div class="sync" id="nav-sync"></div>
</div>
</div>
<div class="ui-resizable-handle" id="splitbar" style="-moz-user-select:none;">
</div>
</div>
<div id="doc-content">
<!-- window showing the filter options -->
<!-- iframe showing the search results (closed by default) -->
<div class="header">
<div class="headertitle">
<div class="title">torusField/torusField.cpp</div> </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">//-</span></div>
<div class="line"><span class="comment">// ==========================================================================</span></div>
<div class="line"><span class="comment">// Copyright 2015 Autodesk, Inc.  All rights reserved.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Use of this software is subject to the terms of the Autodesk</span></div>
<div class="line"><span class="comment">// license agreement provided at the time of installation or download,</span></div>
<div class="line"><span class="comment">// or which otherwise accompanies this software in either electronic</span></div>
<div class="line"><span class="comment">// or hard copy form.</span></div>
<div class="line"><span class="comment">// ==========================================================================</span></div>
<div class="line"><span class="comment">//+</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// DESCRIPTION:</span></div>
<div class="line"><span class="comment">// </span></div>
<div class="line"><span class="comment">// Produces the dependency graph node "torusField".</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// This node is an example of a dynamics field that creates a attract-repel field</span></div>
<div class="line"><span class="comment">// between itself and a distance.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// The example MEL script "torusField.mel" shows how to create the node</span></div>
<div class="line"><span class="comment">// and appropriate connections to correctly establish a user defined field. </span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MIOStream.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;math.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include "torusField.h"</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MTime.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MVectorArray.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MDoubleArray.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MMatrix.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MArrayDataBuilder.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MFnDependencyNode.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MFnTypedAttribute.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MFnNumericAttribute.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MFnCompoundAttribute.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MFnUnitAttribute.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MFnVectorArrayData.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MFnDoubleArrayData.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MFnMatrixData.h&gt;</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><a name="_a0"></a><a class="code" href="./class_m_object.html">MObject</a> torusField::aMinDistance;</div>
<div class="line"><a class="code" href="./class_m_object.html">MObject</a> torusField::aAttractDistance;</div>
<div class="line"><a class="code" href="./class_m_object.html">MObject</a> torusField::aRepelDistance;</div>
<div class="line"><a class="code" href="./class_m_object.html">MObject</a> torusField::aDrag;</div>
<div class="line"><a class="code" href="./class_m_object.html">MObject</a> torusField::aSwarmAmplitude;</div>
<div class="line"><a class="code" href="./class_m_object.html">MObject</a> torusField::aSwarmFrequency;</div>
<div class="line"><a class="code" href="./class_m_object.html">MObject</a> torusField::aSwarmPhase;</div>
<div class="line"></div>
<div class="line"><a name="_a1"></a><a class="code" href="./class_m_type_id.html">MTypeId</a> torusField::id( 0x80018 );</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> *torusField::creator()</div>
<div class="line">{</div>
<div class="line"> <span class="keywordflow">return</span> <span class="keyword">new</span> torusField;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a name="_a2"></a><a class="code" href="./class_m_status.html">MStatus</a> torusField::initialize()</div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  Descriptions:</span></div>
<div class="line"><span class="comment">//      Initialize the node, attributes.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line">{</div>
<div class="line"> <a class="code" href="./class_m_status.html">MStatus</a> status;</div>
<div class="line"></div>
<div class="line"> <a name="_a3"></a><a class="code" href="./class_m_fn_numeric_attribute.html">MFnNumericAttribute</a> numAttr;</div>
<div class="line"></div>
<div class="line"> <span class="comment">// create the field basic attributes.</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line">    aMinDistance = numAttr.<a name="a4"></a><a class="code" href="./class_m_fn_numeric_attribute.html#a5c08a5ce5e7123cc444c95a0e4a50f29">create</a>(<span class="stringliteral">"minDistance"</span>,<span class="stringliteral">"mnd"</span>,MFnNumericData::kDouble);</div>
<div class="line">    numAttr.<a name="a5"></a><a class="code" href="./class_m_fn_numeric_attribute.html#aae3f2fbbbce06e006f1838a1fb6fdcdd">setDefault</a>( 0.0 );</div>
<div class="line">    numAttr.<a name="a6"></a><a class="code" href="./class_m_fn_attribute.html#a9e68a8b4af016b37f6567cfa6d68e551">setKeyable</a>( <span class="keyword">true</span> );</div>
<div class="line">    status = addAttribute( aMinDistance );</div>
<div class="line">    McheckErr(status, <span class="stringliteral">"ERROR adding aMinDistance attribute.\n"</span>);</div>
<div class="line"></div>
<div class="line">    aAttractDistance = numAttr.<a class="code" href="./class_m_fn_numeric_attribute.html#a5c08a5ce5e7123cc444c95a0e4a50f29">create</a>(<span class="stringliteral">"attractDistance"</span>,<span class="stringliteral">"ad"</span>,</div>
<div class="line">                                        MFnNumericData::kDouble);</div>
<div class="line">    numAttr.<a class="code" href="./class_m_fn_numeric_attribute.html#aae3f2fbbbce06e006f1838a1fb6fdcdd">setDefault</a>( 20.0 );</div>
<div class="line">    numAttr.<a class="code" href="./class_m_fn_attribute.html#a9e68a8b4af016b37f6567cfa6d68e551">setKeyable</a>( <span class="keyword">true</span> );</div>
<div class="line">    status = addAttribute( aAttractDistance );</div>
<div class="line">    McheckErr(status, <span class="stringliteral">"ERROR adding aAttractDistance attribute.\n"</span>);</div>
<div class="line"></div>
<div class="line">    aRepelDistance = numAttr.<a class="code" href="./class_m_fn_numeric_attribute.html#a5c08a5ce5e7123cc444c95a0e4a50f29">create</a>(<span class="stringliteral">"repelDistance"</span>,<span class="stringliteral">"rd"</span>,</div>
<div class="line">                                        MFnNumericData::kDouble);</div>
<div class="line">    numAttr.<a class="code" href="./class_m_fn_numeric_attribute.html#aae3f2fbbbce06e006f1838a1fb6fdcdd">setDefault</a>( 10.0 );</div>
<div class="line">    numAttr.<a class="code" href="./class_m_fn_attribute.html#a9e68a8b4af016b37f6567cfa6d68e551">setKeyable</a>( <span class="keyword">true</span> );</div>
<div class="line">    status = addAttribute( aRepelDistance );</div>
<div class="line">    McheckErr(status, <span class="stringliteral">"ERROR adding aRepelDistance attribute.\n"</span>);</div>
<div class="line"></div>
<div class="line">    aDrag = numAttr.<a class="code" href="./class_m_fn_numeric_attribute.html#a5c08a5ce5e7123cc444c95a0e4a50f29">create</a>(<span class="stringliteral">"drag"</span>, <span class="stringliteral">"d"</span>, MFnNumericData::kDouble);</div>
<div class="line">    numAttr.<a class="code" href="./class_m_fn_numeric_attribute.html#aae3f2fbbbce06e006f1838a1fb6fdcdd">setDefault</a>( 0.0 );</div>
<div class="line">    numAttr.<a class="code" href="./class_m_fn_attribute.html#a9e68a8b4af016b37f6567cfa6d68e551">setKeyable</a>( <span class="keyword">true</span> );</div>
<div class="line">    status = addAttribute( aDrag );</div>
<div class="line">    McheckErr(status, <span class="stringliteral">"ERROR adding aDrag attribute.\n"</span>);</div>
<div class="line"></div>
<div class="line">    aSwarmAmplitude = numAttr.<a class="code" href="./class_m_fn_numeric_attribute.html#a5c08a5ce5e7123cc444c95a0e4a50f29">create</a>(<span class="stringliteral">"swarmAmplitude"</span>, <span class="stringliteral">"samp"</span>,</div>
<div class="line">                                        MFnNumericData::kDouble);</div>
<div class="line">    numAttr.<a class="code" href="./class_m_fn_numeric_attribute.html#aae3f2fbbbce06e006f1838a1fb6fdcdd">setDefault</a>( 0.0 );</div>
<div class="line">    numAttr.<a class="code" href="./class_m_fn_attribute.html#a9e68a8b4af016b37f6567cfa6d68e551">setKeyable</a>( <span class="keyword">true</span> );</div>
<div class="line">    status = addAttribute( aSwarmAmplitude );</div>
<div class="line">    McheckErr(status, <span class="stringliteral">"ERROR adding aSwarmAmplitude attribute.\n"</span>);</div>
<div class="line"></div>
<div class="line">    aSwarmFrequency = numAttr.<a class="code" href="./class_m_fn_numeric_attribute.html#a5c08a5ce5e7123cc444c95a0e4a50f29">create</a>(<span class="stringliteral">"swarmFrequency"</span>, <span class="stringliteral">"sfrq"</span>,</div>
<div class="line">                                        MFnNumericData::kDouble);</div>
<div class="line">    numAttr.<a class="code" href="./class_m_fn_numeric_attribute.html#aae3f2fbbbce06e006f1838a1fb6fdcdd">setDefault</a>( 1.0 );</div>
<div class="line">    numAttr.<a class="code" href="./class_m_fn_attribute.html#a9e68a8b4af016b37f6567cfa6d68e551">setKeyable</a>( <span class="keyword">true</span> );</div>
<div class="line">    status = addAttribute( aSwarmFrequency );</div>
<div class="line">    McheckErr(status, <span class="stringliteral">"ERROR adding aSwarmFrequency attribute.\n"</span>);</div>
<div class="line"></div>
<div class="line">    aSwarmPhase = numAttr.<a class="code" href="./class_m_fn_numeric_attribute.html#a5c08a5ce5e7123cc444c95a0e4a50f29">create</a>(<span class="stringliteral">"swarmPhase"</span>, <span class="stringliteral">"sa"</span>, MFnNumericData::kDouble);</div>
<div class="line">    numAttr.<a class="code" href="./class_m_fn_numeric_attribute.html#aae3f2fbbbce06e006f1838a1fb6fdcdd">setDefault</a>( 0.0 );</div>
<div class="line">    numAttr.<a class="code" href="./class_m_fn_attribute.html#a9e68a8b4af016b37f6567cfa6d68e551">setKeyable</a>( <span class="keyword">true</span> );</div>
<div class="line">    status = addAttribute( aSwarmPhase );</div>
<div class="line">    McheckErr(status, <span class="stringliteral">"ERROR adding aSwarmPhase attribute.\n"</span>);</div>
<div class="line"></div>
<div class="line"> <span class="comment">// the new attribute will affect output force.</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <span class="comment">//status = attributeAffects( aMinDistance, outputForce );</span></div>
<div class="line"> <span class="comment">//McheckErr(status, "ERROR in attributeAffects(aMinDistance,outputForce).\n");</span></div>
<div class="line"> <span class="comment">//status = attributeAffects( aAttractDistance, outputForce );</span></div>
<div class="line"> <span class="comment">//McheckErr(status, "ERROR in attributeAffects(aAttractDistance,outputForce).\n");</span></div>
<div class="line"> <span class="comment">//status = attributeAffects( aRepelDistance, outputForce );</span></div>
<div class="line"> <span class="comment">//McheckErr(status, "ERROR in attributeAffects(aRepelDistance,outputForce).\n");</span></div>
<div class="line"> <span class="comment">//status = attributeAffects( aDrag, outputForce );</span></div>
<div class="line"> <span class="comment">//McheckErr(status, "ERROR in attributeAffects(aDrag,outputForce).\n");</span></div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">return</span>( MS::kSuccess );</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><a class="code" href="./class_m_status.html">MStatus</a> torusField::compute(<span class="keyword">const</span> <a name="_a7"></a><a class="code" href="./class_m_plug.html">MPlug</a>&amp; plug, <a name="_a8"></a><a class="code" href="./class_m_data_block.html">MDataBlock</a>&amp; block)</div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  Descriptions:</span></div>
<div class="line"><span class="comment">//      compute output force.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line">{</div>
<div class="line"> <a class="code" href="./class_m_status.html">MStatus</a> status;</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span>( !(plug == mOutputForce) )</div>
<div class="line"> <span class="keywordflow">return</span>( MS::kUnknownParameter );</div>
<div class="line"></div>
<div class="line"> <span class="comment">// get the logical index of the element this plug refers to.</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <span class="keywordtype">int</span> multiIndex = plug.<a name="a9"></a><a class="code" href="./class_m_plug.html#aee365de27bc5ea401941e79738cc4afe">logicalIndex</a>( &amp;status );</div>
<div class="line">    McheckErr(status, <span class="stringliteral">"ERROR in plug.logicalIndex.\n"</span>);</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Get input data handle, use outputArrayValue since we do not</span></div>
<div class="line"> <span class="comment">// want to evaluate both inputs, only the one related to the</span></div>
<div class="line"> <span class="comment">// requested multiIndex. Evaluating both inputs at once would cause</span></div>
<div class="line"> <span class="comment">// a dependency graph loop.</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <a name="_a10"></a><a class="code" href="./class_m_array_data_handle.html">MArrayDataHandle</a> hInputArray = block.<a name="a11"></a><a class="code" href="./class_m_data_block.html#a11fd41c7d97d656a2bffdc23015f1496">outputArrayValue</a>( mInputData, &amp;status );</div>
<div class="line">    McheckErr(status,<span class="stringliteral">"ERROR in hInputArray = block.outputArrayValue().\n"</span>);</div>
<div class="line"></div>
<div class="line">    status = hInputArray.<a name="a12"></a><a class="code" href="./class_m_array_data_handle.html#a8d77f0fea87bb6854b60cd199bf26240">jumpToElement</a>( multiIndex );</div>
<div class="line">    McheckErr(status, <span class="stringliteral">"ERROR: hInputArray.jumpToElement failed.\n"</span>);</div>
<div class="line"></div>
<div class="line"> <span class="comment">// get children of aInputData.</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <a name="_a13"></a><a class="code" href="./class_m_data_handle.html">MDataHandle</a> hCompond = hInputArray.<a name="a14"></a><a class="code" href="./class_m_array_data_handle.html#a81d24dca6d647d8d0a8fe0ef2c63b170">inputValue</a>( &amp;status );</div>
<div class="line">    McheckErr(status, <span class="stringliteral">"ERROR in hCompond=hInputArray.inputValue\n"</span>);</div>
<div class="line"></div>
<div class="line"> <a class="code" href="./class_m_data_handle.html">MDataHandle</a> hPosition = hCompond.<a name="a15"></a><a class="code" href="./class_m_data_handle.html#a58951af761a410e17982060cae4fdf49">child</a>( mInputPositions );</div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> dPosition = hPosition.<a name="a16"></a><a class="code" href="./class_m_data_handle.html#a31773b870681e1f6b3ad82ff58de33bc">data</a>();</div>
<div class="line"> <a name="_a17"></a><a class="code" href="./class_m_fn_vector_array_data.html">MFnVectorArrayData</a> fnPosition( dPosition );</div>
<div class="line"> <a name="_a18"></a><a class="code" href="./class_m_vector_array.html">MVectorArray</a> points = fnPosition.array( &amp;status );</div>
<div class="line">    McheckErr(status, <span class="stringliteral">"ERROR in fnPosition.array(), not find points.\n"</span>);</div>
<div class="line"></div>
<div class="line"> <a class="code" href="./class_m_data_handle.html">MDataHandle</a> hVelocity = hCompond.<a class="code" href="./class_m_data_handle.html#a58951af761a410e17982060cae4fdf49">child</a>( mInputVelocities );</div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> dVelocity = hVelocity.<a class="code" href="./class_m_data_handle.html#a31773b870681e1f6b3ad82ff58de33bc">data</a>();</div>
<div class="line"> <a class="code" href="./class_m_fn_vector_array_data.html">MFnVectorArrayData</a> fnVelocity( dVelocity );</div>
<div class="line"> <a class="code" href="./class_m_vector_array.html">MVectorArray</a> velocities = fnVelocity.array( &amp;status );</div>
<div class="line">    McheckErr(status, <span class="stringliteral">"ERROR in fnVelocity.array(), not find velocities.\n"</span>);</div>
<div class="line"></div>
<div class="line"> <a class="code" href="./class_m_data_handle.html">MDataHandle</a> hMass = hCompond.<a class="code" href="./class_m_data_handle.html#a58951af761a410e17982060cae4fdf49">child</a>( mInputMass );</div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> dMass = hMass.<a class="code" href="./class_m_data_handle.html#a31773b870681e1f6b3ad82ff58de33bc">data</a>();</div>
<div class="line"> <a name="_a19"></a><a class="code" href="./class_m_fn_double_array_data.html">MFnDoubleArrayData</a> fnMass( dMass );</div>
<div class="line"> <a name="_a20"></a><a class="code" href="./class_m_double_array.html">MDoubleArray</a> masses = fnMass.array( &amp;status );</div>
<div class="line">    McheckErr(status, <span class="stringliteral">"ERROR in fnMass.array(), not find masses.\n"</span>);</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Compute the output force.</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"></div>
<div class="line"> <a class="code" href="./class_m_vector_array.html">MVectorArray</a> forceArray;</div>
<div class="line"> <span class="keywordtype">bool</span> useMaxDistSet = useMaxDistanceValue( block );</div>
<div class="line"> <span class="keywordflow">if</span>( useMaxDistSet )</div>
<div class="line">    {</div>
<div class="line">        applyMaxDist( block, points, velocities, masses, forceArray );</div>
<div class="line">    }</div>
<div class="line"> <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        applyNoMaxDist( block, points, velocities, masses, forceArray );</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <span class="comment">// get output data handle</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <a class="code" href="./class_m_array_data_handle.html">MArrayDataHandle</a> hOutArray = block.<a class="code" href="./class_m_data_block.html#a11fd41c7d97d656a2bffdc23015f1496">outputArrayValue</a>( mOutputForce, &amp;status);</div>
<div class="line">    McheckErr(status, <span class="stringliteral">"ERROR in hOutArray = block.outputArrayValue.\n"</span>);</div>
<div class="line"> <a name="_a21"></a><a class="code" href="./class_m_array_data_builder.html">MArrayDataBuilder</a> bOutArray = hOutArray.<a name="a22"></a><a class="code" href="./class_m_array_data_handle.html#a48b34beab40fa4ae60cfe40e556f591a">builder</a>( &amp;status );</div>
<div class="line">    McheckErr(status, <span class="stringliteral">"ERROR in bOutArray = hOutArray.builder.\n"</span>);</div>
<div class="line"></div>
<div class="line"> <span class="comment">// get output force array from block.</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <a class="code" href="./class_m_data_handle.html">MDataHandle</a> hOut = bOutArray.<a name="a23"></a><a class="code" href="./class_m_array_data_builder.html#a6d195a24b9624f2e38079e1ce412c9bb">addElement</a>(multiIndex, &amp;status);</div>
<div class="line">    McheckErr(status, <span class="stringliteral">"ERROR in hOut = bOutArray.addElement.\n"</span>);</div>
<div class="line"></div>
<div class="line"> <a class="code" href="./class_m_fn_vector_array_data.html">MFnVectorArrayData</a> fnOutputForce;</div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> dOutputForce = fnOutputForce.<a name="a24"></a><a class="code" href="./class_m_fn_vector_array_data.html#af1adb4abaf5243c6c0749bcca7b5c418">create</a>( forceArray, &amp;status );</div>
<div class="line">    McheckErr(status, <span class="stringliteral">"ERROR in dOutputForce = fnOutputForce.create\n"</span>);</div>
<div class="line"></div>
<div class="line"> <span class="comment">// update data block with new output force data.</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line">    hOut.<a name="a25"></a><a class="code" href="./class_m_data_handle.html#a2a75482f517f405a641c0eee0bd995ac">set</a>( dOutputForce );</div>
<div class="line">    block.<a name="a26"></a><a class="code" href="./class_m_data_block.html#aceb46f1065ef1cd730c4ab15d61466cc">setClean</a>( plug );</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">return</span>( MS::kSuccess );</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> torusField::applyNoMaxDist</div>
<div class="line">    (</div>
<div class="line"> <a class="code" href="./class_m_data_block.html">MDataBlock</a> &amp;block,              <span class="comment">// get field param from this block</span></div>
<div class="line"> <span class="keyword">const</span> <a class="code" href="./class_m_vector_array.html">MVectorArray</a> &amp;points,     <span class="comment">// current position of Object</span></div>
<div class="line"> <span class="keyword">const</span> <a class="code" href="./class_m_vector_array.html">MVectorArray</a> &amp;velocities, <span class="comment">// current velocity of Object</span></div>
<div class="line"> <span class="keyword">const</span> <a class="code" href="./class_m_double_array.html">MDoubleArray</a> &amp;<span class="comment">/*masses*/</span>,     <span class="comment">// mass of Object</span></div>
<div class="line"> <a class="code" href="./class_m_vector_array.html">MVectorArray</a> &amp;outputForce       <span class="comment">// output force</span></div>
<div class="line">    )</div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  Descriptions:</span></div>
<div class="line"><span class="comment">//      Compute output force in the case that the useMaxDistance is not set.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line">{</div>
<div class="line"> <span class="comment">// points and velocities should have the same length. If not return.</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <span class="keywordflow">if</span>( points.<a name="a27"></a><a class="code" href="./class_m_vector_array.html#a580388f31f60c46fac867ca48a48da1e">length</a>() != velocities.<a class="code" href="./class_m_vector_array.html#a580388f31f60c46fac867ca48a48da1e">length</a>() )</div>
<div class="line"> <span class="keywordflow">return</span>;</div>
<div class="line"></div>
<div class="line"> <span class="comment">// clear the output force array.</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line">    outputForce.<a name="a28"></a><a class="code" href="./class_m_vector_array.html#ad5522f028dde0080b753279426415a4a">clear</a>();</div>
<div class="line"></div>
<div class="line"> <span class="comment">// get field parameters.</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <span class="keywordtype">double</span> magValue = magnitudeValue( block );</div>
<div class="line"> <span class="comment">// double attenValue = attenuationValue( block );</span></div>
<div class="line"> <span class="keywordtype">double</span> minDist = minDistanceValue( block );</div>
<div class="line"> <span class="keywordtype">double</span> attractDist = attractDistanceValue( block );</div>
<div class="line"> <span class="keywordtype">double</span> repelDist = repelDistanceValue( block );</div>
<div class="line"> <span class="keywordtype">double</span> dragMag = dragValue( block );</div>
<div class="line"> <span class="keywordtype">double</span> swarmAmp = swarmAmplitudeValue( block );</div>
<div class="line"></div>
<div class="line"> <span class="comment">// get owner's data. posArray may have only one point which is the centroid</span></div>
<div class="line"> <span class="comment">// (if this has owner) or field position(if without owner). Or it may have</span></div>
<div class="line"> <span class="comment">// a list of points if with owner and applyPerVertex.</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <a class="code" href="./class_m_vector_array.html">MVectorArray</a> posArray;</div>
<div class="line">    posArray.<a class="code" href="./class_m_vector_array.html#ad5522f028dde0080b753279426415a4a">clear</a>();</div>
<div class="line">    ownerPosition( block, posArray );</div>
<div class="line"></div>
<div class="line"> <span class="keywordtype">int</span> fieldPosCount = posArray.<a class="code" href="./class_m_vector_array.html#a580388f31f60c46fac867ca48a48da1e">length</a>();</div>
<div class="line"> <span class="keywordtype">int</span> receptorSize = points.<a class="code" href="./class_m_vector_array.html#a580388f31f60c46fac867ca48a48da1e">length</a>();</div>
<div class="line"></div>
<div class="line"> <span class="comment">// With this model,if max distance isn't set then we</span></div>
<div class="line"> <span class="comment">// also don't attenuate, because 1 - dist/maxDist isn't</span></div>
<div class="line"> <span class="comment">// meaningful. No max distance and no attenuation.</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <span class="keywordflow">if</span> (dragMag &lt;= 0)</div>
<div class="line">    {</div>
<div class="line"> <span class="keywordflow">if</span> (swarmAmp &lt;= 0)</div>
<div class="line">        {</div>
<div class="line"> <span class="comment">// No max dist, no attenuation, no drag, no swarm</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ptIndex = 0; ptIndex &lt; receptorSize; ptIndex ++ )</div>
<div class="line">            {</div>
<div class="line"> <a name="_a29"></a><a class="code" href="./class_m_vector.html">MVector</a> forceV(0.0,0.0,0.0);</div>
<div class="line"> <span class="keyword">const</span> <a class="code" href="./class_m_vector.html">MVector</a> &amp;receptorPoint = points[ptIndex];</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Apply from every field position to every receptor position.</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = fieldPosCount; --i&gt;=0; )</div>
<div class="line">                {</div>
<div class="line"> <a class="code" href="./class_m_vector.html">MVector</a> difference = (receptorPoint-posArray[i]);</div>
<div class="line"></div>
<div class="line"> <span class="keywordtype">double</span> distance = difference.<a name="a30"></a><a class="code" href="./class_m_vector.html#ad207cb443e371f73f07e874c504f60c1">length</a>();</div>
<div class="line"> <span class="keywordflow">if</span> (distance &lt; minDist) <span class="keywordflow">continue</span>;</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (distance &lt;= repelDist)</div>
<div class="line">                        forceV += difference * magValue;</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> (distance &gt;= attractDist)</div>
<div class="line">                        forceV += -difference * magValue;</div>
<div class="line">                }</div>
<div class="line">                outputForce.<a name="a31"></a><a class="code" href="./class_m_vector_array.html#a01b5503917181b1b379579cc1d6d802e">append</a>( forceV );</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line"> <span class="comment">// No max dist, no attenuation, no drag, yes swarm</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ptIndex = 0; ptIndex &lt; receptorSize; ptIndex ++ )</div>
<div class="line">            {</div>
<div class="line"> <a class="code" href="./class_m_vector.html">MVector</a> forceV(0.0,0.0,0.0);</div>
<div class="line"> <span class="keyword">const</span> <a class="code" href="./class_m_vector.html">MVector</a> &amp;receptorPoint = points[ptIndex];</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Apply from every field position to every receptor position.</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <span class="keywordtype">double</span> distance = 0.0;</div>
<div class="line"> <span class="keywordtype">int</span> i;</div>
<div class="line"> <span class="keywordflow">for</span>(i = fieldPosCount; --i&gt;=0; )</div>
<div class="line">                {</div>
<div class="line"> <a class="code" href="./class_m_vector.html">MVector</a> difference = (receptorPoint-posArray[i]);</div>
<div class="line">                    distance = difference.<a class="code" href="./class_m_vector.html#ad207cb443e371f73f07e874c504f60c1">length</a>();</div>
<div class="line"> <span class="keywordflow">if</span> (distance &lt; minDist) <span class="keywordflow">continue</span>;</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (distance &lt;= repelDist)</div>
<div class="line">                        forceV += difference * magValue;</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> (distance &gt;= attractDist)</div>
<div class="line">                        forceV += -difference * magValue;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Apply swarm only if the object is inside the zone</span></div>
<div class="line"> <span class="comment">// the repulsion-attraction is pushing the object to.</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <span class="keywordflow">if</span> ( distance &gt;= repelDist &amp;&amp; distance &lt;= attractDist)</div>
<div class="line">                {</div>
<div class="line"> <span class="keywordtype">double</span> frequency = swarmFrequencyValue( block );</div>
<div class="line"> <a class="code" href="./class_m_vector.html">MVector</a> phase( 0.0, 0.0, swarmPhaseValue(block) );</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Add swarm in here</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <span class="keywordflow">for</span>(i = fieldPosCount; --i &gt;= 0;)</div>
<div class="line">                    {</div>
<div class="line"> <a class="code" href="./class_m_vector.html">MVector</a> difference = receptorPoint - posArray[i];</div>
<div class="line">                        difference = (difference + phase) * frequency;</div>
<div class="line"></div>
<div class="line"> <span class="keywordtype">double</span> *noiseEffect = &amp;difference.<a name="a32"></a><a class="code" href="./class_m_vector.html#af88b946fb90d5f08b5fb740c70e98c10">x</a>;</div>
<div class="line"> <span class="keywordflow">if</span>( (noiseEffect[0] &lt; -2147483647.0) ||</div>
<div class="line">                            (noiseEffect[0] &gt;  2147483647.0) ||</div>
<div class="line">                            (noiseEffect[1] &lt; -2147483647.0) ||</div>
<div class="line">                            (noiseEffect[1] &gt;  2147483647.0) ||</div>
<div class="line">                            (noiseEffect[2] &lt; -2147483647.0) ||</div>
<div class="line">                            (noiseEffect[2] &gt;  2147483647.0) )</div>
<div class="line"> <span class="keywordflow">continue</span>;</div>
<div class="line"></div>
<div class="line"> <span class="keywordtype">double</span> noiseOut[4];</div>
<div class="line">                        noiseFunction( noiseEffect, noiseOut );</div>
<div class="line"> <a class="code" href="./class_m_vector.html">MVector</a> swarmForce( noiseOut[0] * swarmAmp,</div>
<div class="line">                                            noiseOut[1] * swarmAmp,</div>
<div class="line">                                            noiseOut[2] * swarmAmp );</div>
<div class="line">                        forceV += swarmForce;</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">                outputForce.<a class="code" href="./class_m_vector_array.html#a01b5503917181b1b379579cc1d6d802e">append</a>( forceV );</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line"> <span class="keywordflow">if</span> (swarmAmp &lt;= 0)</div>
<div class="line">        {</div>
<div class="line"> <span class="comment">// Yes drag, no swarm</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ptIndex = 0; ptIndex &lt; receptorSize; ptIndex ++ )</div>
<div class="line">            {</div>
<div class="line"> <span class="keyword">const</span> <a class="code" href="./class_m_vector.html">MVector</a>&amp; receptorPoint = points[ptIndex];</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Apply from every field position to every receptor position.</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <a class="code" href="./class_m_vector.html">MVector</a> forceV(0,0,0);</div>
<div class="line"> <span class="keywordtype">double</span> distance = 0.0;</div>
<div class="line"> <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = fieldPosCount; --i&gt;=0; )</div>
<div class="line">                {</div>
<div class="line"> <a class="code" href="./class_m_vector.html">MVector</a> difference = (receptorPoint-posArray[i]);</div>
<div class="line">                    distance = difference.<a class="code" href="./class_m_vector.html#ad207cb443e371f73f07e874c504f60c1">length</a>();</div>
<div class="line"> <span class="keywordflow">if</span> (distance &lt; minDist) <span class="keywordflow">continue</span>;</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (distance &lt;= repelDist)</div>
<div class="line">                        forceV += difference * magValue;</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> (distance &gt;= attractDist)</div>
<div class="line">                        forceV += -difference * magValue;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Apply drag only if the object is inside the zone</span></div>
<div class="line"> <span class="comment">// the repulsion-attraction is pushing the object to.</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <span class="keywordflow">if</span> ( distance &gt;= repelDist &amp;&amp; distance &lt;= attractDist)</div>
<div class="line">                {</div>
<div class="line"> <span class="keywordflow">if</span> (fieldPosCount &gt; 0)</div>
<div class="line">                    {</div>
<div class="line"> <a class="code" href="./class_m_vector.html">MVector</a> dragForceV;</div>
<div class="line">                        dragForceV = velocities[ptIndex] *</div>
<div class="line">                                                (-dragMag) * fieldPosCount;</div>
<div class="line">                        forceV += dragForceV;</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">                outputForce.<a class="code" href="./class_m_vector_array.html#a01b5503917181b1b379579cc1d6d802e">append</a>( forceV );</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line"> <span class="comment">// Yes drag, yes swarm</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ptIndex = 0; ptIndex &lt; receptorSize; ptIndex ++ )</div>
<div class="line">            {</div>
<div class="line"> <span class="keyword">const</span> <a class="code" href="./class_m_vector.html">MVector</a> &amp;receptorPoint = points[ptIndex];</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Apply from every field position to every receptor position.</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <a class="code" href="./class_m_vector.html">MVector</a> forceV(0,0,0);</div>
<div class="line"> <span class="keywordtype">double</span> distance = 0.0;</div>
<div class="line"> <span class="keywordtype">int</span> i;</div>
<div class="line"> <span class="keywordflow">for</span>(i = fieldPosCount; --i&gt;=0; )</div>
<div class="line">                {</div>
<div class="line"> <a class="code" href="./class_m_vector.html">MVector</a> difference = (receptorPoint-posArray[i]);</div>
<div class="line">                    distance = difference.<a class="code" href="./class_m_vector.html#ad207cb443e371f73f07e874c504f60c1">length</a>();</div>
<div class="line"> <span class="keywordflow">if</span> (distance &lt; minDist) <span class="keywordflow">continue</span>;</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (distance &lt;= repelDist)</div>
<div class="line">                        forceV += difference * magValue;</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> (distance &gt;= attractDist)</div>
<div class="line">                        forceV += -difference * magValue;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Apply drag and swarm only if the object is inside</span></div>
<div class="line"> <span class="comment">// the zone the repulsion-attraction is pushing the object to.</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <span class="keywordflow">if</span> ( distance &gt;= repelDist &amp;&amp; distance &lt;= attractDist)</div>
<div class="line">                {</div>
<div class="line"> <span class="keywordflow">if</span> (fieldPosCount &gt; 0)</div>
<div class="line">                    {</div>
<div class="line"> <a class="code" href="./class_m_vector.html">MVector</a> dragForceV;</div>
<div class="line">                        dragForceV = velocities[ptIndex] *</div>
<div class="line">                                                (-dragMag) * fieldPosCount;</div>
<div class="line">                        forceV += dragForceV;</div>
<div class="line">                    }</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Add swarm in here</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <span class="keywordtype">double</span> frequency = swarmFrequencyValue( block );</div>
<div class="line"> <a class="code" href="./class_m_vector.html">MVector</a> phase( 0.0, 0.0, swarmPhaseValue(block) );</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">for</span>(i = fieldPosCount; --i&gt;=0; )</div>
<div class="line">                    {</div>
<div class="line"> <a class="code" href="./class_m_vector.html">MVector</a> difference = receptorPoint - posArray[i];</div>
<div class="line">                        difference = (difference + phase) * frequency;</div>
<div class="line"></div>
<div class="line"> <span class="keywordtype">double</span> *noiseEffect = &amp;difference.<a class="code" href="./class_m_vector.html#af88b946fb90d5f08b5fb740c70e98c10">x</a>;</div>
<div class="line"> <span class="keywordflow">if</span>( (noiseEffect[0] &lt; -2147483647.0) ||</div>
<div class="line">                            (noiseEffect[0] &gt;  2147483647.0) ||</div>
<div class="line">                            (noiseEffect[1] &lt; -2147483647.0) ||</div>
<div class="line">                            (noiseEffect[1] &gt;  2147483647.0) ||</div>
<div class="line">                            (noiseEffect[2] &lt; -2147483647.0) ||</div>
<div class="line">                            (noiseEffect[2] &gt;  2147483647.0) )</div>
<div class="line"> <span class="keywordflow">continue</span>;</div>
<div class="line"></div>
<div class="line"> <span class="keywordtype">double</span> noiseOut[4];</div>
<div class="line">                        noiseFunction( noiseEffect, noiseOut );</div>
<div class="line"> <a class="code" href="./class_m_vector.html">MVector</a> swarmForce( noiseOut[0] * swarmAmp,</div>
<div class="line">                                            noiseOut[1] * swarmAmp,</div>
<div class="line">                                            noiseOut[2] * swarmAmp );</div>
<div class="line">                        forceV += swarmForce;</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">                outputForce.<a class="code" href="./class_m_vector_array.html#a01b5503917181b1b379579cc1d6d802e">append</a>( forceV );</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> torusField::applyMaxDist</div>
<div class="line">    (</div>
<div class="line"> <a class="code" href="./class_m_data_block.html">MDataBlock</a>&amp; block,              <span class="comment">// get field param from this block</span></div>
<div class="line"> <span class="keyword">const</span> <a class="code" href="./class_m_vector_array.html">MVectorArray</a> &amp;points,     <span class="comment">// current position of Object</span></div>
<div class="line"> <span class="keyword">const</span> <a class="code" href="./class_m_vector_array.html">MVectorArray</a> &amp;velocities, <span class="comment">// current velocity of Object</span></div>
<div class="line"> <span class="keyword">const</span> <a class="code" href="./class_m_double_array.html">MDoubleArray</a> &amp;<span class="comment">/*masses*/</span>,     <span class="comment">// mass of Object</span></div>
<div class="line"> <a class="code" href="./class_m_vector_array.html">MVectorArray</a> &amp;outputForce       <span class="comment">// output force</span></div>
<div class="line">    )</div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  Descriptions:</span></div>
<div class="line"><span class="comment">//      Compute output force in the case that the useMaxDistance is set.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line">{</div>
<div class="line"> <span class="comment">// points and velocities should have the same length. If not return.</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <span class="keywordflow">if</span>( points.<a class="code" href="./class_m_vector_array.html#a580388f31f60c46fac867ca48a48da1e">length</a>() != velocities.<a class="code" href="./class_m_vector_array.html#a580388f31f60c46fac867ca48a48da1e">length</a>() )</div>
<div class="line"> <span class="keywordflow">return</span>;</div>
<div class="line"></div>
<div class="line"> <span class="comment">// clear the output force array.</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line">    outputForce.<a class="code" href="./class_m_vector_array.html#ad5522f028dde0080b753279426415a4a">clear</a>();</div>
<div class="line"></div>
<div class="line"> <span class="comment">// get field parameters.</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <span class="keywordtype">double</span> magValue = magnitudeValue( block );</div>
<div class="line"> <span class="keywordtype">double</span> attenValue = attenuationValue( block );</div>
<div class="line"> <span class="keywordtype">double</span> maxDist = maxDistanceValue( block );</div>
<div class="line"> <span class="keywordtype">double</span> minDist = minDistanceValue( block );</div>
<div class="line"> <span class="keywordtype">double</span> attractDist = attractDistanceValue( block );</div>
<div class="line"> <span class="keywordtype">double</span> repelDist = repelDistanceValue( block );</div>
<div class="line"> <span class="keywordtype">double</span> dragMag = dragValue( block );</div>
<div class="line"> <span class="keywordtype">double</span> swarmAmp = swarmAmplitudeValue( block );</div>
<div class="line"></div>
<div class="line"> <span class="comment">// get owner's data. posArray may have only one point which is the centroid</span></div>
<div class="line"> <span class="comment">// (if this has owner) or field position(if without owner). Or it may have</span></div>
<div class="line"> <span class="comment">// a list of points if with owner and applyPerVertex.</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <a class="code" href="./class_m_vector_array.html">MVectorArray</a> posArray;</div>
<div class="line">    posArray.<a class="code" href="./class_m_vector_array.html#ad5522f028dde0080b753279426415a4a">clear</a>();</div>
<div class="line">    ownerPosition( block, posArray );</div>
<div class="line"></div>
<div class="line"> <span class="keywordtype">int</span> fieldPosCount = posArray.<a class="code" href="./class_m_vector_array.html#a580388f31f60c46fac867ca48a48da1e">length</a>();</div>
<div class="line"> <span class="keywordtype">int</span> receptorSize = points.<a class="code" href="./class_m_vector_array.html#a580388f31f60c46fac867ca48a48da1e">length</a>();</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (attenValue &gt; 0.0)</div>
<div class="line">    {</div>
<div class="line"> <span class="comment">// Max distance applies and so does attenuation.</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ptIndex = 0; ptIndex &lt; receptorSize; ptIndex ++ )</div>
<div class="line">        {</div>
<div class="line"> <span class="keyword">const</span> <a class="code" href="./class_m_vector.html">MVector</a> &amp;receptorPoint = points[ptIndex];</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Apply from every field position to every receptor position.</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <a class="code" href="./class_m_vector.html">MVector</a> forceV(0,0,0);</div>
<div class="line"> <a class="code" href="./class_m_vector.html">MVector</a> sumForceV(0,0,0);</div>
<div class="line"> <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = fieldPosCount; --i&gt;=0; )</div>
<div class="line">            {</div>
<div class="line"> <a class="code" href="./class_m_vector.html">MVector</a> difference = receptorPoint-posArray[i];</div>
<div class="line"> <span class="keywordtype">double</span> distance  = difference.<a class="code" href="./class_m_vector.html#ad207cb443e371f73f07e874c504f60c1">length</a>();</div>
<div class="line"> <span class="keywordflow">if</span> (distance &lt;= maxDist &amp;&amp; distance &gt;= minDist )</div>
<div class="line">                {</div>
<div class="line"> <span class="keywordtype">double</span> force = magValue *</div>
<div class="line">                                    (pow((1.0-(distance/maxDist)),attenValue));</div>
<div class="line">                    forceV = difference * force;</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Apply drag and swarm if the object is inside</span></div>
<div class="line"> <span class="comment">// the zone the repulsion-attraction is pushing the</span></div>
<div class="line"> <span class="comment">// object to, and if they are set.</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <span class="keywordflow">if</span> ( distance &gt;= repelDist &amp;&amp; distance &lt;= attractDist)</div>
<div class="line">                    {</div>
<div class="line"> <span class="keywordflow">if</span> (fieldPosCount &gt; 0 &amp;&amp; dragMag &gt; 0)</div>
<div class="line">                        {</div>
<div class="line"> <a class="code" href="./class_m_vector.html">MVector</a> dragForceV;</div>
<div class="line">                            dragForceV = velocities[ptIndex] *</div>
<div class="line">                                            (-dragMag) * fieldPosCount;</div>
<div class="line">                            forceV += dragForceV;</div>
<div class="line">                        }</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Add swarm if swarm aplitude is set.</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <span class="keywordflow">if</span> (swarmAmp &gt; 0)</div>
<div class="line">                        {</div>
<div class="line"> <span class="keywordtype">double</span> frequency = swarmFrequencyValue( block );</div>
<div class="line"> <a class="code" href="./class_m_vector.html">MVector</a> phase( 0.0, 0.0, swarmPhaseValue(block) );</div>
<div class="line"></div>
<div class="line">                            difference = receptorPoint - posArray[i];</div>
<div class="line">                            difference = (difference + phase) * frequency;</div>
<div class="line"> <span class="keywordtype">double</span> *noiseEffect = &amp;difference.<a class="code" href="./class_m_vector.html#af88b946fb90d5f08b5fb740c70e98c10">x</a>;</div>
<div class="line"> <span class="keywordflow">if</span>( (noiseEffect[0] &lt; -2147483647.0) ||</div>
<div class="line">                                (noiseEffect[0] &gt;  2147483647.0) ||</div>
<div class="line">                                (noiseEffect[1] &lt; -2147483647.0) ||</div>
<div class="line">                                (noiseEffect[1] &gt;  2147483647.0) ||</div>
<div class="line">                                (noiseEffect[2] &lt; -2147483647.0) ||</div>
<div class="line">                                (noiseEffect[2] &gt;  2147483647.0) )</div>
<div class="line"> <span class="keywordflow">continue</span>;</div>
<div class="line"></div>
<div class="line"> <span class="keywordtype">double</span> noiseOut[4];</div>
<div class="line">                            noiseFunction( noiseEffect, noiseOut );</div>
<div class="line"> <a class="code" href="./class_m_vector.html">MVector</a> swarmForce( noiseOut[0] * swarmAmp,</div>
<div class="line">                                                noiseOut[1] * swarmAmp,</div>
<div class="line">                                                noiseOut[2] * swarmAmp );</div>
<div class="line">                            forceV += swarmForce;</div>
<div class="line">                        }</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line"> <span class="keywordflow">if</span> (maxDist &gt; 0.0) forceV *= falloffCurve(distance/maxDist);</div>
<div class="line">                sumForceV += forceV;                    </div>
<div class="line">            }</div>
<div class="line">            outputForce.<a class="code" href="./class_m_vector_array.html#a01b5503917181b1b379579cc1d6d802e">append</a>( sumForceV );</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line"> <span class="comment">// Max dist applies, but not attenuation.</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ptIndex = 0; ptIndex &lt; receptorSize; ptIndex ++ )</div>
<div class="line">        {</div>
<div class="line"> <span class="keyword">const</span> <a class="code" href="./class_m_vector.html">MVector</a> &amp; receptorPoint = points[ptIndex];</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Apply from every field position to every receptor position.</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <a class="code" href="./class_m_vector.html">MVector</a> forceV(0,0,0);</div>
<div class="line"> <a class="code" href="./class_m_vector.html">MVector</a> sumForceV(0,0,0);</div>
<div class="line"> <span class="keywordtype">int</span> i;</div>
<div class="line"> <span class="keywordflow">for</span>(i = fieldPosCount; --i&gt;=0; )</div>
<div class="line">            {</div>
<div class="line"> <a class="code" href="./class_m_vector.html">MVector</a> difference = (receptorPoint-posArray[i]);</div>
<div class="line"> <span class="keywordtype">double</span> distance = difference.<a class="code" href="./class_m_vector.html#ad207cb443e371f73f07e874c504f60c1">length</a>();</div>
<div class="line"> <span class="keywordflow">if</span> (distance &lt; minDist || distance &gt; maxDist) <span class="keywordflow">continue</span>;</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (distance &lt;= repelDist)</div>
<div class="line">                    forceV = difference * magValue;</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> (distance &gt;= attractDist)</div>
<div class="line">                    forceV = -difference * magValue;</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Apply drag and swarm if the object is inside</span></div>
<div class="line"> <span class="comment">// the zone the repulsion-attraction is pushing the</span></div>
<div class="line"> <span class="comment">// object to, and if they are set.</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <span class="keywordflow">if</span> ( distance &gt;= repelDist &amp;&amp; distance &lt;= attractDist)</div>
<div class="line">                {</div>
<div class="line"> <span class="keywordflow">if</span> (fieldPosCount &gt; 0 &amp;&amp; dragMag &gt; 0)</div>
<div class="line">                    {</div>
<div class="line"> <a class="code" href="./class_m_vector.html">MVector</a> dragForceV;</div>
<div class="line">                        dragForceV = velocities[ptIndex] *</div>
<div class="line">                                            (-dragMag) * fieldPosCount;</div>
<div class="line">                        forceV += dragForceV;</div>
<div class="line">                    }</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Add swarm if swarm aplitude is set.</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <span class="keywordflow">if</span> (swarmAmp &gt; 0)</div>
<div class="line">                    {</div>
<div class="line"> <span class="keywordtype">double</span> frequency = swarmFrequencyValue( block );</div>
<div class="line"> <a class="code" href="./class_m_vector.html">MVector</a> phase( 0.0, 0.0, swarmPhaseValue(block) );</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">for</span>(i = fieldPosCount; --i &gt;= 0;)</div>
<div class="line">                        {</div>
<div class="line">                            difference = receptorPoint - posArray[i];</div>
<div class="line">                            difference = (difference + phase) * frequency;</div>
<div class="line"> <span class="keywordtype">double</span> *noiseEffect = &amp;difference.<a class="code" href="./class_m_vector.html#af88b946fb90d5f08b5fb740c70e98c10">x</a>;</div>
<div class="line"> <span class="keywordflow">if</span>( (noiseEffect[0] &lt; -2147483647.0) ||</div>
<div class="line">                                (noiseEffect[0] &gt;  2147483647.0) ||</div>
<div class="line">                                (noiseEffect[1] &lt; -2147483647.0) ||</div>
<div class="line">                                (noiseEffect[1] &gt;  2147483647.0) ||</div>
<div class="line">                                (noiseEffect[2] &lt; -2147483647.0) ||</div>
<div class="line">                                (noiseEffect[2] &gt;  2147483647.0) )</div>
<div class="line"> <span class="keywordflow">continue</span>;</div>
<div class="line"></div>
<div class="line"> <span class="keywordtype">double</span> noiseOut[4];</div>
<div class="line">                            noiseFunction( noiseEffect, noiseOut );</div>
<div class="line"> <a class="code" href="./class_m_vector.html">MVector</a> swarmForce( noiseOut[0] * swarmAmp,</div>
<div class="line">                                                noiseOut[1] * swarmAmp,</div>
<div class="line">                                                noiseOut[2] * swarmAmp );</div>
<div class="line"></div>
<div class="line">                            forceV += swarmForce;</div>
<div class="line">                        }</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line"> <span class="keywordflow">if</span> (maxDist &gt; 0.0) forceV *= falloffCurve(distance/maxDist);</div>
<div class="line">                sumForceV += forceV;</div>
<div class="line">            }</div>
<div class="line">            outputForce.<a class="code" href="./class_m_vector_array.html#a01b5503917181b1b379579cc1d6d802e">append</a>( sumForceV );</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> torusField::ownerPosition</div>
<div class="line">    (</div>
<div class="line"> <a class="code" href="./class_m_data_block.html">MDataBlock</a>&amp; block,</div>
<div class="line"> <a class="code" href="./class_m_vector_array.html">MVectorArray</a> &amp;ownerPosArray</div>
<div class="line">    )</div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  Descriptions:</span></div>
<div class="line"><span class="comment">//      If this field has an owner, get the owner's position array or</span></div>
<div class="line"><span class="comment">//      centroid, then assign it to the ownerPosArray.</span></div>
<div class="line"><span class="comment">//      If it does not have owner, get the field position in the world</span></div>
<div class="line"><span class="comment">//      space, and assign it to the given array, ownerPosArray.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line">{</div>
<div class="line"> <a class="code" href="./class_m_status.html">MStatus</a> status;</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span>( applyPerVertexValue(block) )</div>
<div class="line">    {</div>
<div class="line"> <a class="code" href="./class_m_data_handle.html">MDataHandle</a> hOwnerPos = block.<a name="a33"></a><a class="code" href="./class_m_data_block.html#af4a356799acd4ed070d372ed7cfb4706">inputValue</a>( mOwnerPosData, &amp;status );</div>
<div class="line"> <span class="keywordflow">if</span>( status == MS::kSuccess )</div>
<div class="line">        {</div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> dOwnerPos = hOwnerPos.<a class="code" href="./class_m_data_handle.html#a31773b870681e1f6b3ad82ff58de33bc">data</a>();</div>
<div class="line"> <a class="code" href="./class_m_fn_vector_array_data.html">MFnVectorArrayData</a> fnOwnerPos( dOwnerPos );</div>
<div class="line"> <a class="code" href="./class_m_vector_array.html">MVectorArray</a> posArray = fnOwnerPos.array( &amp;status );</div>
<div class="line"> <span class="keywordflow">if</span>( status == MS::kSuccess )</div>
<div class="line">            {</div>
<div class="line"> <span class="comment">// assign vectors from block to ownerPosArray.</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <span class="keywordflow">for</span>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; posArray.<a class="code" href="./class_m_vector_array.html#a580388f31f60c46fac867ca48a48da1e">length</a>(); i ++ )</div>
<div class="line">                    ownerPosArray.<a class="code" href="./class_m_vector_array.html#a01b5503917181b1b379579cc1d6d802e">append</a>( posArray[i] );</div>
<div class="line">            }</div>
<div class="line"> <span class="keywordflow">else</span></div>
<div class="line">            {</div>
<div class="line"> <a class="code" href="./class_m_vector.html">MVector</a> worldPos(0.0, 0.0, 0.0);</div>
<div class="line"> <span class="comment">//status = getWorldPosition( block, worldPos );</span></div>
<div class="line">                status = getWorldPosition( worldPos );</div>
<div class="line">                ownerPosArray.<a class="code" href="./class_m_vector_array.html#a01b5503917181b1b379579cc1d6d802e">append</a>( worldPos );</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line"> <span class="comment">// get the field position in the world space</span></div>
<div class="line"> <span class="comment">// and add it into ownerPosArray.</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <a class="code" href="./class_m_vector.html">MVector</a> worldPos(0.0, 0.0, 0.0);</div>
<div class="line"> <span class="comment">//status = getWorldPosition( block, worldPos );</span></div>
<div class="line">            status = getWorldPosition( worldPos );</div>
<div class="line">            ownerPosArray.<a class="code" href="./class_m_vector_array.html#a01b5503917181b1b379579cc1d6d802e">append</a>( worldPos );</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line"> <a class="code" href="./class_m_vector.html">MVector</a> centroidV(0.0, 0.0, 0.0);</div>
<div class="line">        status = ownerCentroidValue( block, centroidV );</div>
<div class="line"> <span class="keywordflow">if</span>( status == MS::kSuccess )</div>
<div class="line">        {</div>
<div class="line"> <span class="comment">// assign centroid vector to ownerPosArray.</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line">            ownerPosArray.<a class="code" href="./class_m_vector_array.html#a01b5503917181b1b379579cc1d6d802e">append</a>( centroidV );</div>
<div class="line">        }</div>
<div class="line"> <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line"> <span class="comment">// get the field position in the world space.</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <a class="code" href="./class_m_vector.html">MVector</a> worldPos(0.0, 0.0, 0.0);</div>
<div class="line"> <span class="comment">//status = getWorldPosition( block, worldPos );</span></div>
<div class="line">            status = getWorldPosition( worldPos );</div>
<div class="line">            ownerPosArray.<a class="code" href="./class_m_vector_array.html#a01b5503917181b1b379579cc1d6d802e">append</a>( worldPos );</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><a class="code" href="./class_m_status.html">MStatus</a> torusField::getWorldPosition( <a class="code" href="./class_m_vector.html">MVector</a> &amp;vector )</div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  Descriptions:</span></div>
<div class="line"><span class="comment">//      get the field position in the world space.</span></div>
<div class="line"><span class="comment">//      The position value is from inherited attribute, aWorldMatrix.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line">{</div>
<div class="line"> <a class="code" href="./class_m_status.html">MStatus</a> status;</div>
<div class="line"></div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> thisNode = thisMObject();</div>
<div class="line"> <a name="_a34"></a><a class="code" href="./class_m_fn_dependency_node.html">MFnDependencyNode</a> fnThisNode( thisNode );</div>
<div class="line"></div>
<div class="line"> <span class="comment">// get worldMatrix attribute.</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> worldMatrixAttr = fnThisNode.attribute( <span class="stringliteral">"worldMatrix"</span> );</div>
<div class="line"></div>
<div class="line"> <span class="comment">// build worldMatrix plug, and specify which element the plug refers to.</span></div>
<div class="line"> <span class="comment">// We use the first element(the first dagPath of this field).</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <a class="code" href="./class_m_plug.html">MPlug</a> matrixPlug( thisNode, worldMatrixAttr );</div>
<div class="line">    matrixPlug = matrixPlug.elementByLogicalIndex( 0 );</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Get the value of the 'worldMatrix' attribute</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> matrixObject;</div>
<div class="line">    status = matrixPlug.getValue( matrixObject );</div>
<div class="line"> <span class="keywordflow">if</span>( !status )</div>
<div class="line">    {</div>
<div class="line">        status.<a name="a35"></a><a class="code" href="./class_m_status.html#a1f01a4748fea4d8bcced082df83f804d">perror</a>(<span class="stringliteral">"torusField::getWorldPosition: get matrixObject"</span>);</div>
<div class="line"> <span class="keywordflow">return</span>( status );</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <a name="_a36"></a><a class="code" href="./class_m_fn_matrix_data.html">MFnMatrixData</a> worldMatrixData( matrixObject, &amp;status );</div>
<div class="line"> <span class="keywordflow">if</span>( !status )</div>
<div class="line">    {</div>
<div class="line">        status.<a class="code" href="./class_m_status.html#a1f01a4748fea4d8bcced082df83f804d">perror</a>(<span class="stringliteral">"torusField::getWorldPosition: get worldMatrixData"</span>);</div>
<div class="line"> <span class="keywordflow">return</span>( status );</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <a name="_a37"></a><a class="code" href="./class_m_matrix.html">MMatrix</a> worldMatrix = worldMatrixData.<a name="a38"></a><a class="code" href="./class_m_matrix.html#a527b102f4eb0951cf4f391f828d3ca34">matrix</a>( &amp;status );</div>
<div class="line"> <span class="keywordflow">if</span>( !status )</div>
<div class="line">    {</div>
<div class="line">        status.<a class="code" href="./class_m_status.html#a1f01a4748fea4d8bcced082df83f804d">perror</a>(<span class="stringliteral">"torusField::getWorldPosition: get worldMatrix"</span>);</div>
<div class="line"> <span class="keywordflow">return</span>( status );</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <span class="comment">// assign the translate to the given vector.</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line">    vector[0] = worldMatrix( 3, 0 );</div>
<div class="line">    vector[1] = worldMatrix( 3, 1 );</div>
<div class="line">    vector[2] = worldMatrix( 3, 2 );</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">return</span>( status );</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><a class="code" href="./class_m_status.html">MStatus</a> torusField::getWorldPosition( <a class="code" href="./class_m_data_block.html">MDataBlock</a>&amp; block, <a class="code" href="./class_m_vector.html">MVector</a> &amp;vector )</div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  Descriptions:</span></div>
<div class="line"><span class="comment">//      Find the field position in the world space.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line">{</div>
<div class="line"> <a class="code" href="./class_m_status.html">MStatus</a> status;</div>
<div class="line"></div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> thisNode = thisMObject();</div>
<div class="line"> <a class="code" href="./class_m_fn_dependency_node.html">MFnDependencyNode</a> fnThisNode( thisNode );</div>
<div class="line"></div>
<div class="line"> <span class="comment">// get worldMatrix attribute.</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> worldMatrixAttr = fnThisNode.attribute( <span class="stringliteral">"worldMatrix"</span> );</div>
<div class="line"></div>
<div class="line"> <span class="comment">// build worldMatrix plug, and specify which element the plug refers to.</span></div>
<div class="line"> <span class="comment">// We use the first element(the first dagPath of this field).</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <a class="code" href="./class_m_plug.html">MPlug</a> matrixPlug( thisNode, worldMatrixAttr );</div>
<div class="line">    matrixPlug = matrixPlug.elementByLogicalIndex( 0 );</div>
<div class="line"></div>
<div class="line"> <span class="comment">//MDataHandle hWMatrix = block.inputValue( worldMatrix, &amp;status );</span></div>
<div class="line"> <a class="code" href="./class_m_data_handle.html">MDataHandle</a> hWMatrix = block.<a class="code" href="./class_m_data_block.html#af4a356799acd4ed070d372ed7cfb4706">inputValue</a>( matrixPlug, &amp;status );</div>
<div class="line"></div>
<div class="line">    McheckErr(status, <span class="stringliteral">"ERROR getting hWMatrix from dataBlock.\n"</span>);</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span>( status == MS::kSuccess )</div>
<div class="line">    {</div>
<div class="line"> <a class="code" href="./class_m_matrix.html">MMatrix</a> wMatrix = hWMatrix.<a name="a39"></a><a class="code" href="./class_m_data_handle.html#aaa25e9866d30fc06edc510817e32a8f2">asMatrix</a>();</div>
<div class="line">        vector[0] = wMatrix(3, 0);</div>
<div class="line">        vector[1] = wMatrix(3, 1);</div>
<div class="line">        vector[2] = wMatrix(3, 2);</div>
<div class="line">    }</div>
<div class="line"> <span class="keywordflow">return</span>( status );</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="./class_m_status.html">MStatus</a> torusField::getForceAtPoint(<span class="keyword">const</span> <a class="code" href="./class_m_vector_array.html">MVectorArray</a>&amp; points,</div>
<div class="line"> <span class="keyword">const</span> <a class="code" href="./class_m_vector_array.html">MVectorArray</a>&amp;   velocities,</div>
<div class="line"> <span class="keyword">const</span> <a class="code" href="./class_m_double_array.html">MDoubleArray</a>&amp;   masses,</div>
<div class="line"> <a class="code" href="./class_m_vector_array.html">MVectorArray</a>&amp; forceArray,</div>
<div class="line"> <span class="keywordtype">double</span> <span class="comment">/*deltaTime*/</span>)</div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//    This method is not required to be overridden, it is only necessary</span></div>
<div class="line"><span class="comment">//    for compatibility with the MFnField function set.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line">{</div>
<div class="line"> <a class="code" href="./class_m_data_block.html">MDataBlock</a> block = forceCache();</div>
<div class="line"></div>
<div class="line"> <span class="keywordtype">bool</span> useMaxDistSet = useMaxDistanceValue( block );</div>
<div class="line"> <span class="keywordflow">if</span>( useMaxDistSet )</div>
<div class="line">    {</div>
<div class="line">        applyMaxDist( block, points, velocities, masses, forceArray );</div>
<div class="line">    }</div>
<div class="line"> <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        applyNoMaxDist( block, points, velocities, masses, forceArray );</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">return</span> MS::kSuccess;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="./class_m_status.html">MStatus</a> torusField::iconSizeAndOrigin(  GLuint&amp; width,</div>
<div class="line">                    GLuint&amp; height,</div>
<div class="line">                    GLuint&amp; xbo,</div>
<div class="line">                    GLuint&amp; ybo   )</div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  This method is not required to be overridden.  It should be overridden</span></div>
<div class="line"><span class="comment">//  if the plug-in has custom icon.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  The width and height have to be a multiple of 32 on Windows and 16 on </span></div>
<div class="line"><span class="comment">//  other platform.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  Define an 8x8 icon at the lower left corner of the 32x32 grid. </span></div>
<div class="line"><span class="comment">//  (xbo, ybo) of (4,4) makes sure the icon is center at origin.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line">{</div>
<div class="line">    width = 32;</div>
<div class="line">    height = 32;</div>
<div class="line">    xbo = 4;</div>
<div class="line">    ybo = 4;</div>
<div class="line"> <span class="keywordflow">return</span> MS::kSuccess;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="./class_m_status.html">MStatus</a> torusField::iconBitmap(GLubyte* bitmap)</div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  This method is not required to be overridden.  It should be overridden</span></div>
<div class="line"><span class="comment">//  if the plug-in has custom icon.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  Define an 8x8 icon at the lower left corner of the 32x32 grid. </span></div>
<div class="line"><span class="comment">//  (xbo, ybo) of (4,4) makes sure the icon is center at origin.</span></div>
<div class="line">{</div>
<div class="line">    bitmap[0] = 0x18;</div>
<div class="line">    bitmap[4] = 0x66;</div>
<div class="line">    bitmap[8] = 0xC3;</div>
<div class="line">    bitmap[12] = 0x81;</div>
<div class="line">    bitmap[16] = 0x81;</div>
<div class="line">    bitmap[20] = 0xC3;</div>
<div class="line">    bitmap[24] = 0x66;</div>
<div class="line">    bitmap[28] = 0x18;</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">return</span> MS::kSuccess;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#define rand3a(x,y,z)   frand(67*(x)+59*(y)+71*(z))</span></div>
<div class="line"><span class="preprocessor">#define rand3b(x,y,z)   frand(73*(x)+79*(y)+83*(z))</span></div>
<div class="line"><span class="preprocessor">#define rand3c(x,y,z)   frand(89*(x)+97*(y)+101*(z))</span></div>
<div class="line"><span class="preprocessor">#define rand3d(x,y,z)   frand(103*(x)+107*(y)+109*(z))</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span>     xlim[3][2];     <span class="comment">// integer bound for point</span></div>
<div class="line"><span class="keywordtype">double</span>  xarg[3];        <span class="comment">// fractional part</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">double</span> frand( <span class="keywordtype">int</span> s )   <span class="comment">// get random number from seed</span></div>
<div class="line">{</div>
<div class="line">    s = s &lt;&lt; 13^s;</div>
<div class="line"> <span class="keywordflow">return</span>(1. - ((s*(s*s*15731+789221)+1376312589)&amp;0x7fffffff)/1073741824.);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">double</span> hermite( <span class="keywordtype">double</span> p0, <span class="keywordtype">double</span> p1, <span class="keywordtype">double</span> r0, <span class="keywordtype">double</span> r1, <span class="keywordtype">double</span> t )</div>
<div class="line">{</div>
<div class="line"> <span class="keywordtype">double</span> t2, t3, _3t2, _2t3 ;</div>
<div class="line">    t2 = t * t;</div>
<div class="line">    t3 = t2 * t;</div>
<div class="line">    _3t2 = 3. * t2;</div>
<div class="line">    _2t3 = 2. * t3 ;</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">return</span>(p0*(_2t3-_3t2+1) + p1*(-_2t3+_3t2) + r0*(t3-2.*t2+t) + r1*(t3-t2));</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> interpolate( <span class="keywordtype">double</span> f[4], <span class="keywordtype">int</span> i, <span class="keywordtype">int</span> n )</div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  f[] returned tangent and value *</span></div>
<div class="line"><span class="comment">//  i   location ?</span></div>
<div class="line"><span class="comment">//  n   order</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line">{</div>
<div class="line"> <span class="keywordtype">double</span> f0[4], f1[4] ;  <span class="comment">//results for first and second halves</span></div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span>( n == 0 )    <span class="comment">// at 0, return lattice value</span></div>
<div class="line">    {</div>
<div class="line">        f[0] = rand3a( xlim[0][i&amp;1], xlim[1][i&gt;&gt;1&amp;1], xlim[2][i&gt;&gt;2] );</div>
<div class="line">        f[1] = rand3b( xlim[0][i&amp;1], xlim[1][i&gt;&gt;1&amp;1], xlim[2][i&gt;&gt;2] );</div>
<div class="line">        f[2] = rand3c( xlim[0][i&amp;1], xlim[1][i&gt;&gt;1&amp;1], xlim[2][i&gt;&gt;2] );</div>
<div class="line">        f[3] = rand3d( xlim[0][i&amp;1], xlim[1][i&gt;&gt;1&amp;1], xlim[2][i&gt;&gt;2] );</div>
<div class="line"> <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    n--;</div>
<div class="line">    interpolate( f0, i, n );        <span class="comment">// compute first half</span></div>
<div class="line">    interpolate( f1, i| 1&lt;&lt;n, n );  <span class="comment">// compute second half</span></div>
<div class="line"></div>
<div class="line"> <span class="comment">// use linear interpolation for slopes</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line">    f[0] = (1. - xarg[n]) * f0[0] + xarg[n] * f1[0];</div>
<div class="line">    f[1] = (1. - xarg[n]) * f0[1] + xarg[n] * f1[1];</div>
<div class="line">    f[2] = (1. - xarg[n]) * f0[2] + xarg[n] * f1[2];</div>
<div class="line"></div>
<div class="line"> <span class="comment">// use hermite interpolation for values</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line">    f[3] = hermite( f0[3], f1[3], f0[n], f1[n], xarg[n] );</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> torusField::noiseFunction( <span class="keywordtype">double</span> *inNoise, <span class="keywordtype">double</span> *out )</div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  Descriptions:</span></div>
<div class="line"><span class="comment">//      A noise function.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line">{</div>
<div class="line">    xlim[0][0] = (int)floor( inNoise[0] );</div>
<div class="line">    xlim[0][1] = xlim[0][0] + 1;</div>
<div class="line">    xlim[1][0] = (int)floor( inNoise[1] );</div>
<div class="line">    xlim[1][1] = xlim[1][0] + 1;</div>
<div class="line">    xlim[2][0] = (int)floor( inNoise[2] );</div>
<div class="line">    xlim[2][1] = xlim[2][0] + 1;</div>
<div class="line"></div>
<div class="line">    xarg[0] = inNoise[0] - xlim[0][0];</div>
<div class="line">    xarg[1] = inNoise[1] - xlim[1][0];</div>
<div class="line">    xarg[2] = inNoise[2] - xlim[2][0];</div>
<div class="line"></div>
<div class="line">    interpolate( out, 0, 3 ) ;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#define TORUS_PI 3.14159265</span></div>
<div class="line"><span class="preprocessor">#define TORUS_2PI 2*TORUS_PI</span></div>
<div class="line"><span class="preprocessor">#define EDGES 30</span></div>
<div class="line"><span class="preprocessor">#define SEGMENTS 20</span></div>
<div class="line"></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  Descriptions:</span></div>
<div class="line"><span class="comment">//      Draw a set of rings to symbolie the field. This does not override default icon, you can do that by implementing the iconBitmap() function</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="keywordtype">void</span> torusField::draw( <a name="_a40"></a><a class="code" href="./class_m3d_view.html">M3dView</a>&amp; view, <span class="keyword">const</span> <a name="_a41"></a><a class="code" href="./class_m_dag_path.html">MDagPath</a>&amp; path, M3dView::DisplayStyle style, M3dView:: DisplayStatus )</div>
<div class="line">{</div>
<div class="line">    _OPENMAYA_DEPRECATION_PUSH_AND_DISABLE_WARNING</div>
<div class="line">     view.<a name="a42"></a><a class="code" href="./class_m3d_view.html#a0e318e5634c7aaf31c4eb7232d2013d4">beginGL</a>();</div>
<div class="line">     _OPENMAYA_POP_WARNING</div>
<div class="line"> <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; SEGMENTS; j++ )</div>
<div class="line">     {</div>
<div class="line">        glPushMatrix();</div>
<div class="line">        glRotatef( GLfloat(360 * j / SEGMENTS), 0.0, 1.0, 0.0 );</div>
<div class="line">        glTranslatef( 1.5, 0.0, 0.0 );</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; EDGES; i++ )</div>
<div class="line">         {</div>
<div class="line">            glBegin(GL_LINE_STRIP);</div>
<div class="line"> <span class="keywordtype">float</span> p0 = float( TORUS_2PI * i / EDGES );</div>
<div class="line"> <span class="keywordtype">float</span> p1 = float( TORUS_2PI * (i+1) / EDGES );</div>
<div class="line">            glVertex2f( cos(p0), sin(p0) );</div>
<div class="line">            glVertex2f( cos(p1), sin(p1) );</div>
<div class="line">            glEnd();</div>
<div class="line">         }</div>
<div class="line">        glPopMatrix();</div>
<div class="line">     }</div>
<div class="line">     _OPENMAYA_DEPRECATION_PUSH_AND_DISABLE_WARNING</div>
<div class="line">     view.<a name="a43"></a><a class="code" href="./class_m3d_view.html#ab810c5a46d728df70ff5f44b604559f4">endGL</a> ();</div>
<div class="line">     _OPENMAYA_POP_WARNING</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><a class="code" href="./class_m_status.html">MStatus</a> initializePlugin(<a class="code" href="./class_m_object.html">MObject</a> obj)</div>
<div class="line">{</div>
<div class="line"> <a class="code" href="./class_m_status.html">MStatus</a> status;</div>
<div class="line"> <a name="_a44"></a><a class="code" href="./class_m_fn_plugin.html">MFnPlugin</a> plugin(obj, PLUGIN_COMPANY, <span class="stringliteral">"3.0"</span>, <span class="stringliteral">"Any"</span>);</div>
<div class="line"></div>
<div class="line">    status = plugin.registerNode( <span class="stringliteral">"torusField"</span>, torusField::id,</div>
<div class="line">                            &amp;torusField::creator, &amp;torusField::initialize,</div>
<div class="line">                            MPxNode::kFieldNode );</div>
<div class="line"> <span class="keywordflow">if</span> (!status) {</div>
<div class="line">        status.<a class="code" href="./class_m_status.html#a1f01a4748fea4d8bcced082df83f804d">perror</a>(<span class="stringliteral">"registerNode"</span>);</div>
<div class="line"> <span class="keywordflow">return</span> status;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">return</span> status;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="./class_m_status.html">MStatus</a> uninitializePlugin(<a class="code" href="./class_m_object.html">MObject</a> obj)</div>
<div class="line">{</div>
<div class="line"> <a class="code" href="./class_m_status.html">MStatus</a> status;</div>
<div class="line"> <a class="code" href="./class_m_fn_plugin.html">MFnPlugin</a> plugin(obj);</div>
<div class="line"></div>
<div class="line">    status = plugin.deregisterNode( torusField::id );</div>
<div class="line"> <span class="keywordflow">if</span> (!status) {</div>
<div class="line">        status.<a class="code" href="./class_m_status.html#a1f01a4748fea4d8bcced082df83f804d">perror</a>(<span class="stringliteral">"deregisterNode"</span>);</div>
<div class="line"> <span class="keywordflow">return</span> status;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">return</span> status;</div>
<div class="line">}</div>
<div class="line"></div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div class="footer-block"><a class="comments-anchor" href="../html/ac.cmtdialog.htm" target="_blank"><span class="comments-link">Please send us your comment about this page</span></a></div></div>
</div></body>
</html>
