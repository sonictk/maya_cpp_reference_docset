<!-- saved from url=(0024)http://docs.autodesk.com -->
<html>
   <head><script src="../scripts/yepnope.1.5.4-min.js" type="text/javascript"></script><script src="../scripts/lib/jquery-1.11.1.min.js" type="text/javascript"></script>
      <title>C++ API Reference: apiMeshShape/apiMeshSubSceneOverride.cpp</title>
      
	  
      
      
      
      
      
      
      
    

</head>
   <body height="100%"><div class="body_content" id="body-content"><link rel="stylesheet" type="text/css" href="cpp_ref/navtree.css"><link rel="stylesheet" type="text/css" href="cpp_ref/doxygen.css"><link rel="stylesheet" type="text/css" href="cpp_ref/tabs.css"><link rel="stylesheet" type="text/css" href="style/adsk.cpm.css"><script type="text/javascript">
var tocSystemNeedsToBeLoaded = typeof(cpp_ref_adsk_ref_toc) == 'undefined';
var weAreIn21 = $('div#main.view-active').length;
var tocPrefix = '';
if (weAreIn21)
{ tocPrefix = 'cpp_ref/'; }
function cpp_ref_initializeToc(forceTrigger) {
    cpp_ref_adsk_ref_toc.initResizable();
    cpp_ref_adsk_ref_toc.initNavTree('api_mesh_shape_2api_mesh_sub_scene_override_8cpp-example.html', tocPrefix);
    dQuery(document).trigger('toc_initialized');
}
if (tocSystemNeedsToBeLoaded)
{
	yepnope([{
	load:[tocPrefix + 'json3.min.js', tocPrefix + 'jquery.js', tocPrefix + 'ref-toc-controller.js', tocPrefix + 'dynsections.js'],
	complete: function() {
	  if (typeof(dQuery) == 'undefined')
	  {
	    dQuery = jQuery.noConflict(true);
	  }
	  else { jQuery.noConflict(true); }
	  $(document).ready(cpp_ref_initializeToc);
	}
 	}])
}
if (!weAreIn21) { // if in AKN...
$(window).load( function() {
    setTimeout( function() {
        var content = $('body > div').not('#body-content');     // take any divs under body that are not id=body-content
        content.each( function() { 
            $(this).css( { 'padding-left': $(this).css('margin-left') } );       // and if they have any padding-left already, move it to margin-left.
        } );
        var width = cpp_ref_adsk_ref_toc.readFromStorage('width');
        content.css({marginLeft:parseInt(width)+6+"px"});
    }, 100);
} ); 
}
</script><script>
 if (!tocSystemNeedsToBeLoaded) { cpp_ref_initializeToc(); }
 </script>
      <div>
         <div class="head">
            <h1>C++ API Reference: apiMeshShape/apiMeshSubSceneOverride.cpp</h1>
         </div>

<div id="top"><!-- do not remove this div, it is closed by doxygen! -->

<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->

  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="#!/url=./cpp_ref/index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="#!/url=./cpp_ref/pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="#!/url=./cpp_ref/modules.html"><span>Modules</span></a></li>
      <li><a href="#!/url=./cpp_ref/namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="#!/url=./cpp_ref/annotated.html"><span>Classes</span></a></li>
      <li><a href="#!/url=./cpp_ref/examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="cpp_ref/search/mag_sel.png" onmouseover="return searchBox.OnSearchSelectShow()" onmouseout="return searchBox.OnSearchSelectHide()" alt="">
          <input type="text" id="MSearchField" value="Search" accesskey="S" onfocus="searchBox.OnSearchFieldFocus(true)" onblur="searchBox.OnSearchFieldFocus(false)" onkeyup="searchBox.OnSearchFieldChange(event)">
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="cpp_ref/search/close.png" alt=""></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" class="ui-resizable-handle">
  </div>
</div>

<div id="doc-content">
<!-- window showing the filter options -->


<!-- iframe showing the search results (closed by default) -->


<div class="header">
  <div class="headertitle">
<div class="title">apiMeshShape/apiMeshSubSceneOverride.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">//-</span></div>
<div class="line"><span class="comment">// ==========================================================================</span></div>
<div class="line"><span class="comment">// Copyright 2019 Autodesk, Inc.  All rights reserved.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Use of this software is subject to the terms of the Autodesk</span></div>
<div class="line"><span class="comment">// license agreement provided at the time of installation or download,</span></div>
<div class="line"><span class="comment">// or which otherwise accompanies this software in either electronic</span></div>
<div class="line"><span class="comment">// or hard copy form.</span></div>
<div class="line"><span class="comment">// ==========================================================================</span></div>
<div class="line"><span class="comment">//+</span></div>
<div class="line"></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// apiMeshSubSceneOverride.cpp</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="preprocessor">#include &quot;apiMeshSubSceneOverride.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;apiMeshShape.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;apiMeshGeom.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;maya/M3dView.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MDagPathArray.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MDrawRegistry.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MFnDagNode.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MFnDependencyNode.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MFnSingleIndexedComponent.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MGLFunctionTable.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MGlobal.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MHWGeometry.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MHWGeometryUtilities.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MHardwareRenderer.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MItSelectionList.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MObject.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MObjectArray.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MPlugArray.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MPxComponentConverter.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MSelectionContext.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MSelectionList.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MShaderManager.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MUserData.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MViewport2Renderer.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iterator&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;memory&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifdef _WINDOWS</span></div>
<div class="line"><span class="preprocessor">#include &lt;d3d11.h&gt;</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">namespace </span>apiMeshSubSceneOverrideHelpers</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Helper class for link lost callback</span></div>
<div class="line">    <span class="keyword">class </span>ShadedItemUserData : <span class="keyword">public</span> <a name="_a0"></a><a class="code" href="#!/url=./cpp_ref/class_m_user_data.html">MUserData</a></div>
<div class="line">    {</div>
<div class="line">    <span class="keyword">public</span>:</div>
<div class="line">        ShadedItemUserData(apiMeshSubSceneOverride* ov)</div>
<div class="line">        : <a class="code" href="#!/url=./cpp_ref/class_m_user_data.html">MUserData</a>(<span class="keyword">false</span>), fOverride(ov) {}</div>
<div class="line">        ~ShadedItemUserData()<span class="keyword"> override </span>{ fOverride = NULL; }</div>
<div class="line"></div>
<div class="line">        apiMeshSubSceneOverride* fOverride;</div>
<div class="line">    };</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Custom user data class to attach to render items</span></div>
<div class="line">    <span class="comment">// to help with viewport 2.0 selection</span></div>
<div class="line">    <span class="keyword">class </span>apiMeshHWSelectionUserData : <span class="keyword">public</span> <a class="code" href="#!/url=./cpp_ref/class_m_user_data.html">MUserData</a></div>
<div class="line">    {</div>
<div class="line">    <span class="keyword">public</span>:</div>
<div class="line">        apiMeshHWSelectionUserData()</div>
<div class="line">        : <a class="code" href="#!/url=./cpp_ref/class_m_user_data.html">MUserData</a>(<span class="keyword">true</span>) <span class="comment">// let Maya clean up</span></div>
<div class="line">        , fMeshGeom(NULL)</div>
<div class="line">        , fInstanceIndex(0)</div>
<div class="line">        , fFaceViewSelectedStates()</div>
<div class="line">        {</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        ~apiMeshHWSelectionUserData()<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">        </span>{</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        apiMeshGeom* fMeshGeom;</div>
<div class="line">        <span class="keywordtype">int</span> fInstanceIndex;</div>
<div class="line">        std::unique_ptr&lt;bool[]&gt; fFaceViewSelectedStates;</div>
<div class="line">    };</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Custom component converter to select components</span></div>
<div class="line">    <span class="comment">// Attached to the vertex, edge and face selection render items</span></div>
<div class="line">    <span class="comment">// respectively apiMeshSubSceneOverride::sVertexSelectionName, apiMeshSubSceneOverride::sEdgeSelectionName</span></div>
<div class="line">    <span class="comment">// and apiMeshSubSceneOverride::sFaceSelectionName</span></div>
<div class="line">    <span class="keyword">class </span>simpleComponentConverter : <span class="keyword">public</span> <a name="_a1"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_px_component_converter.html">MHWRender::MPxComponentConverter</a></div>
<div class="line">    {</div>
<div class="line">    <span class="keyword">public</span>:</div>
<div class="line">        simpleComponentConverter(<a class="code" href="#!/url=./cpp_ref/class_m_fn.html#a1d1cfd8ffb84e947f82999c682b666a7">MFn::Type</a> componentType, <a name="_a2"></a><a class="code" href="#!/url=./cpp_ref/class_m_selection_mask.html">MSelectionMask</a> selectionType)</div>
<div class="line">        : <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_px_component_converter.html">MHWRender::MPxComponentConverter</a>()</div>
<div class="line">        , fComponentType(componentType)</div>
<div class="line">        , fSelectionType(selectionType) {}</div>
<div class="line">        ~simpleComponentConverter()<span class="keyword"> override </span>{}</div>
<div class="line"></div>
<div class="line">        <span class="keywordtype">void</span> initialize(<span class="keyword">const</span> <a name="_a3"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html">MHWRender::MRenderItem</a>&amp; renderItem)<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">        </span>{</div>
<div class="line">            <span class="comment">// Create the component selection object</span></div>
<div class="line">            fComponentObject = fComponent.create( fComponentType );</div>
<div class="line"></div>
<div class="line">            <span class="comment">// For face selection, </span></div>
<div class="line">            <span class="comment">// create a lookup table to match triangle intersection with face id :</span></div>
<div class="line">            <span class="comment">// One face may contains more than one triangle</span></div>
<div class="line">            <span class="keywordflow">if</span> (fComponentType == <a name="a4"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn.html#a1d1cfd8ffb84e947f82999c682b666a7a5ddabf9726f89e07cff62014221fe6fb">MFn::kMeshPolygonComponent</a>) {</div>
<div class="line">                apiMeshHWSelectionUserData* selectionData = <span class="keyword">dynamic_cast&lt;</span>apiMeshHWSelectionUserData*<span class="keyword">&gt;</span>(renderItem.<a name="a5"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#afd8b782f19e9508747c851a990d8f5db">customData</a>());</div>
<div class="line">                <span class="keywordflow">if</span>(selectionData) {</div>
<div class="line">                    apiMeshGeom* meshGeom = selectionData-&gt;fMeshGeom;</div>
<div class="line">                    <span class="keywordtype">bool</span>* faceStates = selectionData-&gt;fFaceViewSelectedStates.get();</div>
<div class="line"></div>
<div class="line">                    <span class="comment">// Allocate faces lookup table</span></div>
<div class="line">                    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> numTriangles = 0;</div>
<div class="line">                    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;meshGeom-&gt;faceCount; ++i) {</div>
<div class="line">                        <span class="keywordtype">int</span> numVerts = meshGeom-&gt;face_counts[i];</div>
<div class="line">                        <span class="keywordflow">if</span> (numVerts &gt; 2) {</div>
<div class="line">                            <span class="keywordflow">if</span> (!faceStates || faceStates[i]) {</div>
<div class="line">                                numTriangles += numVerts - 2;</div>
<div class="line">                            }</div>
<div class="line">                        }</div>
<div class="line">                    }</div>
<div class="line">                    fLookupTable.resize(numTriangles);</div>
<div class="line"></div>
<div class="line">                    <span class="comment">// Fill faces lookup table</span></div>
<div class="line">                    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> idx = 0;</div>
<div class="line">                    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> faceIdx=0; faceIdx&lt;meshGeom-&gt;faceCount; ++faceIdx) {</div>
<div class="line">                        <span class="comment">// ignore degenerate faces</span></div>
<div class="line">                        <span class="keywordtype">int</span> numVerts = meshGeom-&gt;face_counts[faceIdx];</div>
<div class="line">                        <span class="keywordflow">if</span> (numVerts &gt; 2) {</div>
<div class="line">                            <span class="keywordflow">if</span> (!faceStates || faceStates[faceIdx]) {</div>
<div class="line">                                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> v=1; v&lt;numVerts-1; ++v) {</div>
<div class="line">                                    fLookupTable[idx++] = faceIdx;</div>
<div class="line">                                }</div>
<div class="line">                            }</div>
<div class="line">                        }</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordtype">void</span> addIntersection(<a name="_a6"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_intersection.html">MHWRender::MIntersection</a>&amp; intersection)<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">        </span>{</div>
<div class="line">            <span class="comment">// Convert the intersection index, which represent the primitive position in the</span></div>
<div class="line">            <span class="comment">// index buffer, to the correct component id</span></div>
<div class="line"></div>
<div class="line">            <span class="comment">// For vertex and edge: the primitive index value is the same as the component id</span></div>
<div class="line">            <span class="comment">// For face: get the face id that matches the triangle index from the lookup table</span></div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> (fComponentType == <a name="a7"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn.html#a1d1cfd8ffb84e947f82999c682b666a7a18f788d50a75ca81a0dc5a2538f364ae">MFn::kMeshEdgeComponent</a>) {</div>
<div class="line">                <span class="comment">// Only accept edge selection intersection on draw instance #2 -- scaled by 2</span></div>
<div class="line">                <span class="comment">// and instance #-1 (when useDrawInstancingOnEdgeSelectionItem is false)</span></div>
<div class="line">                <span class="keywordflow">if</span> (intersection.<a name="a8"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_intersection.html#a35ab9f5cd2b7e3c46d5c661d9cd73571">instanceID</a>() == 1 || intersection.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_intersection.html#a35ab9f5cd2b7e3c46d5c661d9cd73571">instanceID</a>() == 3)</div>
<div class="line">                    <span class="keywordflow">return</span>;</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="keywordtype">int</span> idx = intersection.<a name="a9"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_intersection.html#ae85767d1d26fc7491279d1f2c277b499">index</a>();</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> (fComponentType == <a class="code" href="#!/url=./cpp_ref/class_m_fn.html#a1d1cfd8ffb84e947f82999c682b666a7a5ddabf9726f89e07cff62014221fe6fb">MFn::kMeshPolygonComponent</a>) {</div>
<div class="line">                <span class="keywordflow">if</span> (idx &gt;= 0 &amp;&amp; idx &lt; (<span class="keywordtype">int</span>)fLookupTable.size()) {</div>
<div class="line">                    idx = fLookupTable[idx];</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            fComponent.addElement(idx);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <a name="_a10"></a><a class="code" href="#!/url=./cpp_ref/class_m_object.html">MObject</a> component()<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">        </span>{</div>
<div class="line">            <span class="comment">// Return the component object that contains the ids of the selected components</span></div>
<div class="line">            <span class="keywordflow">return</span> fComponentObject;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <a class="code" href="#!/url=./cpp_ref/class_m_selection_mask.html">MSelectionMask</a> selectionMask()<span class="keyword"> const override</span></div>
<div class="line"><span class="keyword">        </span>{</div>
<div class="line">            <span class="comment">// This converter is only valid for specified selection type</span></div>
<div class="line">            <span class="keywordflow">return</span> fSelectionType;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keyword">static</span> MPxComponentConverter* creatorVertexSelection()</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// creator function to instanciate a component converter for vertex selection</span></div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m_selection_mask.html">MSelectionMask</a> mask;</div>
<div class="line">            mask.<a name="a11"></a>setMask(MSelectionMask::kSelectMeshVerts);</div>
<div class="line">            mask.<a name="a12"></a><a class="code" href="#!/url=./cpp_ref/class_m_selection_mask.html#ab2205ed8ba273131fea652a106524bda">addMask</a>(MSelectionMask::kSelectPointsForGravity);</div>
<div class="line">            <span class="keywordflow">return</span> <span class="keyword">new</span> simpleComponentConverter(<a name="a13"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn.html#a1d1cfd8ffb84e947f82999c682b666a7a040adaedfb9ad2fcc82cdeca1e214522">MFn::kMeshVertComponent</a>, mask);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keyword">static</span> MPxComponentConverter* creatorEdgeSelection()</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// creator function to instanciate a component converter for edge selection</span></div>
<div class="line">            <span class="keywordflow">return</span> <span class="keyword">new</span> simpleComponentConverter(<a class="code" href="#!/url=./cpp_ref/class_m_fn.html#a1d1cfd8ffb84e947f82999c682b666a7a18f788d50a75ca81a0dc5a2538f364ae">MFn::kMeshEdgeComponent</a>, MSelectionMask::kSelectMeshEdges);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keyword">static</span> MPxComponentConverter* creatorFaceSelection()</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// creator function to instanciate a component converter for face selection</span></div>
<div class="line">            <span class="keywordflow">return</span> <span class="keyword">new</span> simpleComponentConverter(<a class="code" href="#!/url=./cpp_ref/class_m_fn.html#a1d1cfd8ffb84e947f82999c682b666a7a5ddabf9726f89e07cff62014221fe6fb">MFn::kMeshPolygonComponent</a>, MSelectionMask::kSelectMeshFaces);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">    <span class="keyword">private</span>:</div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_fn.html#a1d1cfd8ffb84e947f82999c682b666a7">MFn::Type</a> fComponentType;</div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_selection_mask.html">MSelectionMask</a> fSelectionType;</div>
<div class="line"></div>
<div class="line">        <a name="_a14"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_single_indexed_component.html">MFnSingleIndexedComponent</a> fComponent;</div>
<div class="line">        <a class="code" href="#!/url=./cpp_ref/class_m_object.html">MObject</a> fComponentObject;</div>
<div class="line">        std::vector&lt;int&gt; fLookupTable;</div>
<div class="line">    };</div>
<div class="line"></div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> sViewSelectedInstanceMark = -1;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Gather the view-selected face indices of each instance. Use -1 to mark a</span></div>
<div class="line">    <span class="comment">// view-selected instance (but not any of its faces) for easier processing</span></div>
<div class="line">    <span class="comment">// later in shouldDrawInstance().</span></div>
<div class="line">    <span class="keywordtype">bool</span> gatherViewSelectedFaceInfo(ViewSelectedFaceInfo&amp; vsfInfo,</div>
<div class="line">        <span class="keyword">const</span> <a name="_a15"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_frame_context.html">MHWRender::MFrameContext</a>&amp; frameContext,</div>
<div class="line">        <span class="keyword">const</span> <a name="_a16"></a><a class="code" href="#!/url=./cpp_ref/class_m_dag_path_array.html">MDagPathArray</a>&amp; instances,</div>
<div class="line">        <span class="keyword">const</span> apiMeshGeom* meshGeom)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (!meshGeom || meshGeom-&gt;faceCount &lt;= 0)</div>
<div class="line">            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"></div>
<div class="line">        <a name="_a17"></a><a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> panelName;</div>
<div class="line">        <span class="keywordflow">if</span> (frameContext.<a name="a18"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_frame_context.html#a0df712533d76bdc96f2b49f4767ed85e">renderingDestination</a>(panelName) != MFrameContext::k3dViewport)</div>
<div class="line">            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"></div>
<div class="line">        <a name="_a19"></a><a class="code" href="#!/url=./cpp_ref/class_m3d_view.html">M3dView</a> view;</div>
<div class="line">        <span class="keywordflow">if</span> (!<a name="a20"></a><a class="code" href="#!/url=./cpp_ref/class_m3d_view.html#a6f8dcac6993b14738fc6259cfd50a3b8">M3dView::getM3dViewFromModelPanel</a>(panelName, view) || !view.<a name="a21"></a><a class="code" href="#!/url=./cpp_ref/class_m3d_view.html#af6dcf7f299baab571323208e5634308c">viewIsFiltered</a>())</div>
<div class="line">            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"></div>
<div class="line">        <a name="_a22"></a><a class="code" href="#!/url=./cpp_ref/class_m_selection_list.html">MSelectionList</a> viewSelectedList;</div>
<div class="line">        <span class="keywordflow">if</span> (view.<a name="a23"></a><a class="code" href="#!/url=./cpp_ref/class_m3d_view.html#a325652f994f1ba4f2b110048a1f19a86">filteredObjectList</a>(viewSelectedList))</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> instanceArrayLength = instances.<a name="a24"></a><a class="code" href="#!/url=./cpp_ref/class_m_dag_path_array.html#a580388f31f60c46fac867ca48a48da1e">length</a>();</div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> instIdx = 0; instIdx &lt; instanceArrayLength; instIdx++)</div>
<div class="line">            {</div>
<div class="line">                <a class="code" href="#!/url=./cpp_ref/class_m_selection_list.html">MSelectionList</a> intersectionList;</div>
<div class="line">                intersectionList.<a name="a25"></a><a class="code" href="#!/url=./cpp_ref/class_m_selection_list.html#a23929aeafb29672f2652128eac9c4dec">add</a>(instances[instIdx]);</div>
<div class="line">                intersectionList.<a name="a26"></a><a class="code" href="#!/url=./cpp_ref/class_m_selection_list.html#ad44d2a948e6027c27702304431b14052">intersect</a>(viewSelectedList, <span class="keyword">true</span><span class="comment">/*expandToLeaves*/</span>);</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">for</span> (<a name="_a27"></a><a class="code" href="#!/url=./cpp_ref/class_m_it_selection_list.html">MItSelectionList</a> it(intersectionList); !it.<a name="a28"></a><a class="code" href="#!/url=./cpp_ref/class_m_it_selection_list.html#ac0f0d6fc806b11d246e05cb94e886b38">isDone</a>(); it.next())</div>
<div class="line">                {</div>
<div class="line">                    <a name="_a29"></a><a class="code" href="#!/url=./cpp_ref/class_m_dag_path.html">MDagPath</a> dummyPath;</div>
<div class="line">                    <a class="code" href="#!/url=./cpp_ref/class_m_object.html">MObject</a> comp;</div>
<div class="line">                    it.getDagPath(dummyPath, comp);</div>
<div class="line">                    <span class="keywordflow">if</span> (comp.<a name="a30"></a><a class="code" href="#!/url=./cpp_ref/class_m_object.html#ac02f2a4d7312eb91f40980adfd4e31b2">isNull</a>())</div>
<div class="line">                    {</div>
<div class="line">                        vsfInfo.emplace(instIdx, sViewSelectedInstanceMark);</div>
<div class="line">                    }</div>
<div class="line">                    <span class="keywordflow">else</span></div>
<div class="line">                    {</div>
<div class="line">                        <a class="code" href="#!/url=./cpp_ref/class_m_fn_single_indexed_component.html">MFnSingleIndexedComponent</a> fnComp(comp);</div>
<div class="line">                        <span class="keywordflow">if</span> (fnComp.<a name="a31"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_component.html#ad0759188ad557dad7d5b12ae65a9669d">componentType</a>() == <a class="code" href="#!/url=./cpp_ref/class_m_fn.html#a1d1cfd8ffb84e947f82999c682b666a7a5ddabf9726f89e07cff62014221fe6fb">MFn::kMeshPolygonComponent</a>)</div>
<div class="line">                        {</div>
<div class="line">                            <a name="_a32"></a><a class="code" href="#!/url=./cpp_ref/class_m_int_array.html">MIntArray</a> faceIds;</div>
<div class="line">                            fnComp.<a name="a33"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_single_indexed_component.html#af46c6b65dba2489debae349dab66e127">getElements</a>(faceIds);</div>
<div class="line">                            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; faceIds.<a name="a34"></a><a class="code" href="#!/url=./cpp_ref/class_m_int_array.html#a580388f31f60c46fac867ca48a48da1e">length</a>(); i++)</div>
<div class="line">                            {</div>
<div class="line">                                <span class="keywordtype">int</span> faceId = faceIds[i];</div>
<div class="line">                                <span class="keywordflow">if</span> (faceId &gt;= 0 &amp;&amp; faceId &lt; meshGeom-&gt;faceCount)</div>
<div class="line">                                {</div>
<div class="line">                                    vsfInfo.emplace(instIdx, faceId);</div>
<div class="line">                                }</div>
<div class="line">                            }</div>
<div class="line">                        }</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// If an instance has only -1 stored in its ViewSelectedFaceInfo map, it is</span></div>
<div class="line">    <span class="comment">// view-selected but none of its faces is, so the instance should be drawn.</span></div>
<div class="line">    <span class="keywordtype">bool</span> shouldDrawInstance(<span class="keyword">const</span> ViewSelectedFaceInfo&amp; info, <span class="keywordtype">int</span> instIdx)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordtype">bool</span> found = <span class="keyword">false</span>;</div>
<div class="line"></div>
<div class="line">        <span class="keyword">auto</span> range = info.equal_range(instIdx);</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keyword">auto</span> i = range.first; i != range.second; ++i)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">if</span> (i-&gt;second != sViewSelectedInstanceMark)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            found = <span class="keyword">true</span>;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">return</span> found;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"><span class="keyword">using namespace </span>apiMeshSubSceneOverrideHelpers;</div>
<div class="line"></div>
<div class="line"><span class="comment">// Compile time switching for regular MVertexBuffer management vs. custom</span></div>
<div class="line"><span class="comment">// user buffer management. Just an example to show</span></div>
<div class="line"><span class="comment">// how custom buffers can be used. See the bounding box code below.     </span></div>
<div class="line"><span class="comment">// Note this now works for both OpenGL and DirectX11 Viewport 2.0</span></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">bool</span> sUseCustomUserBuffersForBoundingBox = <span class="keyword">true</span>;</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> MHWRender::DrawAPI sDrawAPI = MHWRender::kNone;</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">bool</span> useSelectHighlight(<span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_selection_list.html">MSelectionList</a>&amp; selectedList, <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_dag_path.html">MDagPath</a>&amp; path);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">bool</span> floatApproxEqual(<span class="keywordtype">float</span> left, <span class="keywordtype">float</span> right);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> sNameSeparator(<span class="stringliteral">&quot;_&quot;</span>);</div>
<div class="line"></div>
<div class="line">std::set&lt;std::string&gt; apiMeshSubSceneOverride::sViewSelectedFaceSelectionNames;</div>
<div class="line"></div>
<div class="line"><span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> apiMeshSubSceneOverride::sWireName(<span class="stringliteral">&quot;apiMeshWire&quot;</span>);</div>
<div class="line"><span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> apiMeshSubSceneOverride::sSelectName(<span class="stringliteral">&quot;apiMeshSelection&quot;</span>);</div>
<div class="line"><span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> apiMeshSubSceneOverride::sBoxName(<span class="stringliteral">&quot;apiMeshBox&quot;</span>);</div>
<div class="line"><span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> apiMeshSubSceneOverride::sSelectedBoxName(<span class="stringliteral">&quot;apiMeshBoxSelection&quot;</span>);</div>
<div class="line"><span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> apiMeshSubSceneOverride::sShadedName(<span class="stringliteral">&quot;apiMeshShaded&quot;</span>);</div>
<div class="line"><span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> apiMeshSubSceneOverride::sTexturedName(<span class="stringliteral">&quot;apiMeshTextured&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> apiMeshSubSceneOverride::sVertexSelectionName(<span class="stringliteral">&quot;apiMeshVertexSelection&quot;</span>);</div>
<div class="line"><span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> apiMeshSubSceneOverride::sEdgeSelectionName(<span class="stringliteral">&quot;apiMeshEdgeSelection&quot;</span>);</div>
<div class="line"><span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> apiMeshSubSceneOverride::sFaceSelectionName(<span class="stringliteral">&quot;apiMeshFaceSelection&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> apiMeshSubSceneOverride::sActiveVertexName(<span class="stringliteral">&quot;apiMeshActiveVertex&quot;</span>);</div>
<div class="line"><span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> apiMeshSubSceneOverride::sActiveEdgeName(<span class="stringliteral">&quot;apiMeshActiveEdge&quot;</span>);</div>
<div class="line"><span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> apiMeshSubSceneOverride::sActiveFaceName(<span class="stringliteral">&quot;apiMeshActiveFace&quot;</span>);</div>
<div class="line"></div>
<div class="line">apiMeshSubSceneOverride::apiMeshSubSceneOverride(<span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_object.html">MObject</a>&amp; obj)</div>
<div class="line">: MPxSubSceneOverride(obj)</div>
<div class="line">, fObject(obj)</div>
<div class="line">, fMesh(NULL)</div>
<div class="line">, fWireShader(NULL)</div>
<div class="line">, fThickWireShader(NULL)</div>
<div class="line">, fSelectShader(NULL)</div>
<div class="line">, fThickSelectShader(NULL)</div>
<div class="line">, fShadedShader(NULL)</div>
<div class="line">, fVertexComponentShader(NULL)</div>
<div class="line">, fEdgeComponentShader(NULL)</div>
<div class="line">, fFaceComponentShader(NULL)</div>
<div class="line">, fPositionBuffer(NULL)</div>
<div class="line">, fNormalBuffer(NULL)</div>
<div class="line">, fBoxPositionBuffer(NULL)</div>
<div class="line">, fBoxPositionBufferId(0)</div>
<div class="line">, fBoxPositionBufferDX(NULL)</div>
<div class="line">, fBoxIndexBufferId(0)</div>
<div class="line">, fBoxIndexBufferDX(NULL)</div>
<div class="line">, fWireIndexBuffer(NULL)</div>
<div class="line">, fBoxIndexBuffer(NULL)</div>
<div class="line">, fShadedIndexBuffer(NULL)</div>
<div class="line">, fActiveVerticesIndexBuffer(NULL)</div>
<div class="line">, fActiveEdgesIndexBuffer(NULL)</div>
<div class="line">, fActiveFacesIndexBuffer(NULL)</div>
<div class="line">, fThickLineWidth(-1.0)</div>
<div class="line">, fQueuedLineWidth(-1.0)</div>
<div class="line">, fNumInstances(0)</div>
<div class="line">, fIsInstanceMode(false)</div>
<div class="line">, fAreUIDrawablesDirty(true)</div>
<div class="line">, fQueueUpdate(false)</div>
<div class="line">, fUseQueuedLineUpdate(false) <span class="comment">// Set to true to run sample line width update code</span></div>
<div class="line">{</div>
<div class="line">    <span class="comment">// get the real apiMesh object from the MObject</span></div>
<div class="line">    <a name="_a35"></a><a class="code" href="#!/url=./cpp_ref/class_m_status.html">MStatus</a> status;</div>
<div class="line">    <a name="_a36"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_dependency_node.html">MFnDependencyNode</a> node(obj, &amp;status);</div>
<div class="line">    <span class="keywordflow">if</span> (status)</div>
<div class="line">    {</div>
<div class="line">        fMesh = <span class="keyword">dynamic_cast&lt;</span>apiMesh*<span class="keyword">&gt;</span>(node.userNode());</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">apiMeshSubSceneOverride::~apiMeshSubSceneOverride()</div>
<div class="line">{</div>
<div class="line">    fMesh = NULL;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Clear out LinkLost callbacks still in flight:</span></div>
<div class="line">    <span class="comment">// They might get triggered if the shader are destroyed before</span></div>
<div class="line">    <span class="comment">// the render items, and at this point the fOverride member is clearly invalid.</span></div>
<div class="line">    std::vector&lt;ShadedItemUserData*&gt;::iterator it;</div>
<div class="line">    <span class="keywordflow">for</span> (it = fLinkLostCallbackData.begin(); it != fLinkLostCallbackData.end(); ++it)</div>
<div class="line">    {</div>
<div class="line">        ShadedItemUserData* cbData = *it;</div>
<div class="line">        cbData-&gt;fOverride = 0;</div>
<div class="line">    }</div>
<div class="line">    fLinkLostCallbackData.clear();</div>
<div class="line"></div>
<div class="line">    _OPENMAYA_DEPRECATION_PUSH_AND_DISABLE_WARNING</div>
<div class="line">    <a name="_a37"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_renderer.html">MHWRender::MRenderer</a>* renderer = <a name="a38"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_renderer.html#a4678a72ac6959ed21d422d27928d0343">MHWRender::MRenderer::theRenderer</a>();</div>
<div class="line">    _OPENMAYA_POP_WARNING</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (renderer)</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">const</span> <a name="_a39"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_shader_manager.html">MHWRender::MShaderManager</a>* shaderMgr =</div>
<div class="line">            renderer-&gt;getShaderManager();</div>
<div class="line">        <span class="keywordflow">if</span> (shaderMgr)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">if</span> (fWireShader) {</div>
<div class="line">                shaderMgr-&gt;<a name="a40"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_shader_manager.html#a0c7deb55edc231cbb2365b271ecd55f8">releaseShader</a>(fWireShader);</div>
<div class="line">                fWireShader = NULL;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">if</span> (fThickWireShader) {</div>
<div class="line">                shaderMgr-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_shader_manager.html#a0c7deb55edc231cbb2365b271ecd55f8">releaseShader</a>(fThickWireShader);</div>
<div class="line">                fThickWireShader = NULL;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">if</span> (fSelectShader) {</div>
<div class="line">                shaderMgr-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_shader_manager.html#a0c7deb55edc231cbb2365b271ecd55f8">releaseShader</a>(fSelectShader);</div>
<div class="line">                fSelectShader = NULL;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">if</span> (fThickSelectShader) {</div>
<div class="line">                shaderMgr-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_shader_manager.html#a0c7deb55edc231cbb2365b271ecd55f8">releaseShader</a>(fThickSelectShader);</div>
<div class="line">                fThickSelectShader = NULL;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">if</span> (fShadedShader) {</div>
<div class="line">                shaderMgr-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_shader_manager.html#a0c7deb55edc231cbb2365b271ecd55f8">releaseShader</a>(fShadedShader);</div>
<div class="line">                fShadedShader = NULL;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">if</span> (fVertexComponentShader) {</div>
<div class="line">                shaderMgr-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_shader_manager.html#a0c7deb55edc231cbb2365b271ecd55f8">releaseShader</a>(fVertexComponentShader);</div>
<div class="line">                fVertexComponentShader = NULL;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">if</span> (fEdgeComponentShader) {</div>
<div class="line">                shaderMgr-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_shader_manager.html#a0c7deb55edc231cbb2365b271ecd55f8">releaseShader</a>(fEdgeComponentShader);</div>
<div class="line">                fEdgeComponentShader = NULL;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">if</span> (fFaceComponentShader) {</div>
<div class="line">                shaderMgr-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_shader_manager.html#a0c7deb55edc231cbb2365b271ecd55f8">releaseShader</a>(fFaceComponentShader);</div>
<div class="line">                fFaceComponentShader = NULL;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    deleteBuffers();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> apiMeshSubSceneOverride::untrackLinkLostData(ShadedItemUserData* data)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; fLinkLostCallbackData.size(); ++i)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (fLinkLostCallbackData[i] == data)</div>
<div class="line">        {</div>
<div class="line">            fLinkLostCallbackData[i] = fLinkLostCallbackData.back();</div>
<div class="line">            fLinkLostCallbackData.pop_back();</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">MHWRender::DrawAPI apiMeshSubSceneOverride::supportedDrawAPIs()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">    <span class="comment">// this plugin supports both GL and DX</span></div>
<div class="line">    <span class="keywordflow">return</span> (MHWRender::kOpenGL | MHWRender::kDirectX11 | MHWRender::kOpenGLCoreProfile);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">bool</span> apiMeshSubSceneOverride::requiresUpdate(</div>
<div class="line">    <span class="keyword">const</span> <a name="_a41"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_sub_scene_container.html">MHWRender::MSubSceneContainer</a>&amp; container,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_frame_context.html">MHWRender::MFrameContext</a>&amp; frameContext)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">    <span class="comment">// Nothing in the container, definitely need to update</span></div>
<div class="line">    <span class="keywordflow">if</span> (container.<a name="a42"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_sub_scene_container.html#ab1eb6de2bf3aa228929ab4b40c73507c">count</a>() == 0)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Update always. This could be optimized to only update when the</span></div>
<div class="line">    <span class="comment">// actual shape node detects a change.</span></div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> apiMeshSubSceneOverride::update(</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_sub_scene_container.html">MHWRender::MSubSceneContainer</a>&amp; container,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_frame_context.html">MHWRender::MFrameContext</a>&amp; frameContext)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Update render items based on current set of instances</span></div>
<div class="line">    manageRenderItems(container, frameContext,</div>
<div class="line">        fMesh-&gt;shapeDirty() || container.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_sub_scene_container.html#ab1eb6de2bf3aa228929ab4b40c73507c">count</a>() == 0);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Always reset shape dirty flag</span></div>
<div class="line">    fMesh-&gt;resetShapeDirty();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">bool</span> apiMeshSubSceneOverride::furtherUpdateRequired(</div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_frame_context.html">MHWRender::MFrameContext</a>&amp; frameContext)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (fUseQueuedLineUpdate)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (!frameContext.<a name="a43"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_frame_context.html#ae814ee8697336ed8a1f43182c3a43fd6">inUserInteraction</a>()</div>
<div class="line">            &amp;&amp; !frameContext.<a name="a44"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_frame_context.html#acae6b9f8aa6589912296983df9f1aca8">userChangingViewContext</a>())</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">return</span> fQueueUpdate;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> apiMeshSubSceneOverride::manageRenderItems(</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_sub_scene_container.html">MHWRender::MSubSceneContainer</a>&amp; container,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_frame_context.html">MHWRender::MFrameContext</a>&amp; frameContext,</div>
<div class="line">    <span class="keywordtype">bool</span> updateGeometry)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Preamble</span></div>
<div class="line">    <span class="keyword">using namespace </span><a class="code" href="#!/url=./cpp_ref/namespace_m_h_w_render.html">MHWRender</a>;</div>
<div class="line">    <span class="keywordflow">if</span> (!fMesh || fObject.isNull()) <span class="keywordflow">return</span>;</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_renderer.html">MRenderer</a>* renderer = <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_renderer.html#a4678a72ac6959ed21d422d27928d0343">MRenderer::theRenderer</a>();</div>
<div class="line">    <span class="keywordflow">if</span> (!renderer) <span class="keywordflow">return</span>;</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_shader_manager.html">MShaderManager</a>* shaderMgr = renderer-&gt;<a name="a45"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_renderer.html#a4603e18a1b89b798a2e4a4f36d9b5125">getShaderManager</a>();</div>
<div class="line">    <span class="keywordflow">if</span> (!shaderMgr) <span class="keywordflow">return</span>;</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_status.html">MStatus</a> status;</div>
<div class="line">    <a name="_a46"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_dag_node.html">MFnDagNode</a> node(fObject, &amp;status);</div>
<div class="line">    <span class="keywordflow">if</span> (!status) <span class="keywordflow">return</span>;</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_dag_path_array.html">MDagPathArray</a> instances;</div>
<div class="line">    <span class="keywordflow">if</span> (!node.getAllPaths(instances) || instances.<a class="code" href="#!/url=./cpp_ref/class_m_dag_path_array.html#a580388f31f60c46fac867ca48a48da1e">length</a>() == 0) <span class="keywordflow">return</span>;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Constants</span></div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">float</span> sRed[]   = {1.0f, 0.0f, 0.0f, 1.0f};</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">float</span> sGreen[] = {0.0f, 1.0f, 0.0f, 1.0f};</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">float</span> sWhite[] = {1.0f, 1.0f, 1.0f, 1.0f};</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Set up shared shaders if needed</span></div>
<div class="line">    <span class="keywordflow">if</span> (!fWireShader)</div>
<div class="line">    {</div>
<div class="line">        fWireShader = shaderMgr-&gt;<a name="a47"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_shader_manager.html#a8e4ad27d691969622af2b05d8c6213d9">getStockShader</a>(</div>
<div class="line">            MShaderManager::k3dSolidShader);</div>
<div class="line">        fWireShader-&gt;<a name="a48"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_shader_instance.html#aa17e2c9a17b86064950103066fa307ef">setParameter</a>(<span class="stringliteral">&quot;solidColor&quot;</span>, sRed);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (!fThickWireShader)</div>
<div class="line">    {</div>
<div class="line">        fThickWireShader = shaderMgr-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_shader_manager.html#a8e4ad27d691969622af2b05d8c6213d9">getStockShader</a>(</div>
<div class="line">            MShaderManager::k3dThickLineShader);</div>
<div class="line">        fThickWireShader-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_shader_instance.html#aa17e2c9a17b86064950103066fa307ef">setParameter</a>(<span class="stringliteral">&quot;solidColor&quot;</span>, sRed);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (!fSelectShader)</div>
<div class="line">    {</div>
<div class="line">        fSelectShader = shaderMgr-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_shader_manager.html#a8e4ad27d691969622af2b05d8c6213d9">getStockShader</a>(</div>
<div class="line">            MShaderManager::k3dSolidShader);</div>
<div class="line">        fSelectShader-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_shader_instance.html#aa17e2c9a17b86064950103066fa307ef">setParameter</a>(<span class="stringliteral">&quot;solidColor&quot;</span>, sGreen);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (!fThickSelectShader)</div>
<div class="line">    {</div>
<div class="line">        fThickSelectShader = shaderMgr-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_shader_manager.html#a8e4ad27d691969622af2b05d8c6213d9">getStockShader</a>(</div>
<div class="line">            MShaderManager::k3dThickLineShader);</div>
<div class="line">        fThickSelectShader-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_shader_instance.html#aa17e2c9a17b86064950103066fa307ef">setParameter</a>(<span class="stringliteral">&quot;solidColor&quot;</span>, sGreen);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (!fVertexComponentShader)</div>
<div class="line">    {</div>
<div class="line">        fVertexComponentShader = shaderMgr-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_shader_manager.html#a8e4ad27d691969622af2b05d8c6213d9">getStockShader</a>(</div>
<div class="line">            MShaderManager::k3dFatPointShader);</div>
<div class="line">        fVertexComponentShader-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_shader_instance.html#aa17e2c9a17b86064950103066fa307ef">setParameter</a>(<span class="stringliteral">&quot;solidColor&quot;</span>, sWhite);</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">float</span> pointSize[2] = {5.0, 5.0};</div>
<div class="line">        fVertexComponentShader-&gt;setParameter(<span class="stringliteral">&quot;pointSize&quot;</span>, pointSize);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (!fEdgeComponentShader)</div>
<div class="line">    {</div>
<div class="line">        fEdgeComponentShader = shaderMgr-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_shader_manager.html#a8e4ad27d691969622af2b05d8c6213d9">getStockShader</a>(</div>
<div class="line">            MShaderManager::k3dThickLineShader);</div>
<div class="line">        fEdgeComponentShader-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_shader_instance.html#aa17e2c9a17b86064950103066fa307ef">setParameter</a>(<span class="stringliteral">&quot;solidColor&quot;</span>, sWhite);</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">float</span> lineWidth[2] = {2.0, 2.0};</div>
<div class="line">        fEdgeComponentShader-&gt;setParameter(<span class="stringliteral">&quot;lineWidth&quot;</span>, lineWidth);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (!fFaceComponentShader)</div>
<div class="line">    {</div>
<div class="line">        fFaceComponentShader = shaderMgr-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_shader_manager.html#a8e4ad27d691969622af2b05d8c6213d9">getStockShader</a>(</div>
<div class="line">            MShaderManager::k3dSolidShader);</div>
<div class="line">        fFaceComponentShader-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_shader_instance.html#aa17e2c9a17b86064950103066fa307ef">setParameter</a>(<span class="stringliteral">&quot;solidColor&quot;</span>, sWhite);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (!fShadedShader)</div>
<div class="line">    {</div>
<div class="line">        fShadedShader = shaderMgr-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_shader_manager.html#a8e4ad27d691969622af2b05d8c6213d9">getStockShader</a>(MShaderManager::k3dBlinnShader);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Set up shared geometry if necessary</span></div>
<div class="line">    <span class="keywordflow">if</span> (updateGeometry) rebuildGeometryBuffers();</div>
<div class="line">    <span class="keywordflow">if</span> (!fPositionBuffer || !fNormalBuffer || !fBoxPositionBuffer ||</div>
<div class="line">        !fWireIndexBuffer || !fBoxIndexBuffer || !fShadedIndexBuffer)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    ViewSelectedFaceInfo vsfInfo;</div>
<div class="line">    <span class="keywordtype">bool</span> isActiveViewFiltered = gatherViewSelectedFaceInfo(vsfInfo,</div>
<div class="line">        frameContext, instances, fMesh-&gt;meshGeomToUse());</div>
<div class="line"></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_selection_list.html">MSelectionList</a> selectedList;</div>
<div class="line">    <a name="a49"></a><a class="code" href="#!/url=./cpp_ref/class_m_global.html#a6d81d38246555884897fb153c93aaf42">MGlobal::getActiveSelectionList</a>(selectedList);</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">bool</span> anyMatrixChanged = <span class="keyword">false</span>;</div>
<div class="line">    <span class="keywordtype">bool</span> itemsChanged = <span class="keyword">false</span>;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> instanceArrayLength = instances.<a class="code" href="#!/url=./cpp_ref/class_m_dag_path_array.html#a580388f31f60c46fac867ca48a48da1e">length</a>();</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> numInstanceSelected = 0;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> numInstanceUnselected = 0;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> numInstances = 0;</div>
<div class="line">    <a name="_a50"></a><a class="code" href="#!/url=./cpp_ref/class_m_matrix_array.html">MMatrixArray</a> instanceMatrixArray(instanceArrayLength);</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_matrix_array.html">MMatrixArray</a> selectedInstanceMatrixArray(instanceArrayLength);</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_matrix_array.html">MMatrixArray</a> unselectedInstanceMatrixArray(instanceArrayLength);</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> instIdx=0; instIdx&lt;instanceArrayLength; instIdx++)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// If expecting large numbers of instances, then walking through the whole</span></div>
<div class="line">        <span class="comment">// list of instances every time to look for changes is not efficient</span></div>
<div class="line">        <span class="comment">// enough.  Watching for change events and changing only the required</span></div>
<div class="line">        <span class="comment">// instances should be done instead.  This method of checking for selection</span></div>
<div class="line">        <span class="comment">// status is also not fast.</span></div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_dag_path.html">MDagPath</a>&amp; instance = instances[instIdx];</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> instanceNum = instance.<a name="a51"></a><a class="code" href="#!/url=./cpp_ref/class_m_dag_path.html#ac908055bb978bce38fcb5f1af6620760">instanceNumber</a>();</div>
<div class="line">        <span class="keywordflow">if</span> (instance.<a name="a52"></a><a class="code" href="#!/url=./cpp_ref/class_m_dag_path.html#a095ae34296e81703965265a42ee783ca">isValid</a>() &amp;&amp; instance.<a name="a53"></a><a class="code" href="#!/url=./cpp_ref/class_m_dag_path.html#a27f324b7f2643119a7542e39101601d1">isVisible</a>() &amp;&amp;</div>
<div class="line">            (!isActiveViewFiltered || shouldDrawInstance(vsfInfo, instIdx)))</div>
<div class="line">        {</div>
<div class="line">            InstanceInfo instanceInfo(instance.<a name="a54"></a><a class="code" href="#!/url=./cpp_ref/class_m_dag_path.html#afb30f64680f5aa038da428a79579d08c">inclusiveMatrix</a>(),</div>
<div class="line">                useSelectHighlight(selectedList, instance));</div>
<div class="line"></div>
<div class="line">            InstanceInfoMap::iterator iter = fInstanceInfoCache.find(instanceNum);</div>
<div class="line">            <span class="keywordflow">if</span> (iter == fInstanceInfoCache.end() ||</div>
<div class="line">                iter-&gt;second.fIsSelected != instanceInfo.fIsSelected ||</div>
<div class="line">                !iter-&gt;second.fTransform.isEquivalent(instanceInfo.fTransform))</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">if</span> (!fAreUIDrawablesDirty &amp;&amp;</div>
<div class="line">                    (iter == fInstanceInfoCache.end() ||</div>
<div class="line">                     !iter-&gt;second.fTransform.isEquivalent(instanceInfo.fTransform)))</div>
<div class="line">                {</div>
<div class="line">                    fAreUIDrawablesDirty = <span class="keyword">true</span>;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">                fInstanceInfoCache[instanceNum] = instanceInfo;</div>
<div class="line">                anyMatrixChanged = <span class="keyword">true</span>;</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            instanceMatrixArray[numInstances++] = instanceInfo.fTransform;</div>
<div class="line">            <span class="keywordflow">if</span> (instanceInfo.fIsSelected)</div>
<div class="line">            {</div>
<div class="line">                selectedInstanceMatrixArray[numInstanceSelected++] = instanceInfo.fTransform;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">            {</div>
<div class="line">                unselectedInstanceMatrixArray[numInstanceUnselected++] = instanceInfo.fTransform;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            InstanceInfoMap::iterator iter = fInstanceInfoCache.find(instanceNum);</div>
<div class="line">            <span class="keywordflow">if</span> (iter != fInstanceInfoCache.end())</div>
<div class="line">            {</div>
<div class="line">                fInstanceInfoCache.erase(instanceNum);</div>
<div class="line"></div>
<div class="line">                fNumInstances--;</div>
<div class="line"></div>
<div class="line">                anyMatrixChanged = <span class="keyword">true</span>;</div>
<div class="line">                fAreUIDrawablesDirty = <span class="keyword">true</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    instanceMatrixArray.setLength(numInstances);  <span class="comment">//collapse to correct length</span></div>
<div class="line">    selectedInstanceMatrixArray.setLength(numInstanceSelected);</div>
<div class="line">    unselectedInstanceMatrixArray.setLength(numInstanceUnselected);</div>
<div class="line">    <span class="keywordflow">if</span> (fNumInstances != numInstances)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=numInstances; i&lt;fNumInstances; i++)</div>
<div class="line">        {</div>
<div class="line">            fInstanceInfoCache.erase(i);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        anyMatrixChanged = <span class="keyword">true</span>;</div>
<div class="line">        fAreUIDrawablesDirty = <span class="keyword">true</span>;</div>
<div class="line">        fNumInstances = numInstances;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (fAreUIDrawablesDirty)</div>
<div class="line">    {</div>
<div class="line">        fInstance0Transform = instances[0].inclusiveMatrix();</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">bool</span> anyInstanceSelected = numInstanceSelected &gt; 0;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">bool</span> anyInstanceUnselected = numInstanceUnselected &gt; 0;</div>
<div class="line"></div>
<div class="line">    std::set&lt;int&gt; activeVerticesSet;</div>
<div class="line">    std::set&lt;int&gt; activeEdgesSet;</div>
<div class="line">    std::set&lt;int&gt; activeFacesSet;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (fMesh-&gt;hasActiveComponents())</div>
<div class="line">    {</div>
<div class="line">        <a name="_a55"></a><a class="code" href="#!/url=./cpp_ref/class_m_object_array.html">MObjectArray</a> activeComponents = fMesh-&gt;activeComponents();</div>
<div class="line">        <span class="keywordflow">if</span> (activeComponents.<a name="a56"></a><a class="code" href="#!/url=./cpp_ref/class_m_object_array.html#a580388f31f60c46fac867ca48a48da1e">length</a>() &gt; 0)</div>
<div class="line">        {</div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m_fn_single_indexed_component.html">MFnSingleIndexedComponent</a> fnComponent( activeComponents[0] );</div>
<div class="line">            <span class="keywordflow">if</span> (fnComponent.elementCount())</div>
<div class="line">            {</div>
<div class="line">                <a class="code" href="#!/url=./cpp_ref/class_m_int_array.html">MIntArray</a> activeIds;</div>
<div class="line">                fnComponent.getElements( activeIds );</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">if</span>(fnComponent.componentType() == <a class="code" href="#!/url=./cpp_ref/class_m_fn.html#a1d1cfd8ffb84e947f82999c682b666a7a040adaedfb9ad2fcc82cdeca1e214522">MFn::kMeshVertComponent</a>)</div>
<div class="line">                {</div>
<div class="line">                    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;activeIds.<a class="code" href="#!/url=./cpp_ref/class_m_int_array.html#a580388f31f60c46fac867ca48a48da1e">length</a>(); ++i)</div>
<div class="line">                        activeVerticesSet.<a name="a57"></a><a class="code" href="#!/url=./cpp_ref/class_m_int_array.html#a95aaff2c93e48e4da000d79e8324c714">insert</a>( activeIds[i] );</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(fnComponent.componentType() == <a class="code" href="#!/url=./cpp_ref/class_m_fn.html#a1d1cfd8ffb84e947f82999c682b666a7a18f788d50a75ca81a0dc5a2538f364ae">MFn::kMeshEdgeComponent</a>)</div>
<div class="line">                {</div>
<div class="line">                    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;activeIds.<a class="code" href="#!/url=./cpp_ref/class_m_int_array.html#a580388f31f60c46fac867ca48a48da1e">length</a>(); ++i)</div>
<div class="line">                        activeEdgesSet.insert( activeIds[i] );</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(fnComponent.componentType() == <a class="code" href="#!/url=./cpp_ref/class_m_fn.html#a1d1cfd8ffb84e947f82999c682b666a7a5ddabf9726f89e07cff62014221fe6fb">MFn::kMeshPolygonComponent</a>)</div>
<div class="line">                {</div>
<div class="line">                    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;activeIds.<a class="code" href="#!/url=./cpp_ref/class_m_int_array.html#a580388f31f60c46fac867ca48a48da1e">length</a>(); ++i)</div>
<div class="line">                        activeFacesSet.insert( activeIds[i] );</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Update index buffer of active items if necessary</span></div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">bool</span> updateActiveItems =</div>
<div class="line">        updateGeometry ||</div>
<div class="line">        fActiveVerticesSet != activeVerticesSet ||</div>
<div class="line">        fActiveEdgesSet != activeEdgesSet ||</div>
<div class="line">        fActiveFacesSet != activeFacesSet;</div>
<div class="line"></div>
<div class="line">    fActiveVerticesSet = activeVerticesSet;</div>
<div class="line">    fActiveEdgesSet = activeEdgesSet;</div>
<div class="line">    fActiveFacesSet = activeFacesSet;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (updateActiveItems)</div>
<div class="line">        rebuildActiveComponentIndexBuffers();</div>
<div class="line"></div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">bool</span> anyVertexSelected = !fActiveVerticesSet.empty();</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">bool</span> anyEdgeSelected = !fActiveEdgesSet.empty();</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">bool</span> anyFaceSelected = !fActiveFacesSet.empty();</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( (anyVertexSelected &amp;&amp; fActiveVerticesIndexBuffer == NULL) ||</div>
<div class="line">        (anyEdgeSelected &amp;&amp; fActiveEdgesIndexBuffer == NULL) ||</div>
<div class="line">        (anyFaceSelected &amp;&amp; fActiveFacesIndexBuffer == NULL) )</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Add render items if necessary.  Remove any pre-existing render items</span></div>
<div class="line">    <span class="comment">// that are no longer needed. Assign selection mask to each render item in</span></div>
<div class="line">    <span class="comment">// order to prevent getInstancedSelectionPath() from being called for</span></div>
<div class="line">    <span class="comment">// unqualified selection hits.</span></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html">MRenderItem</a>* wireItem = container.<a name="a58"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_sub_scene_container.html#aa96c3d709fe8ea2325d20c2423bb8f23">find</a>(sWireName);</div>
<div class="line">    <span class="keywordflow">if</span> (!wireItem &amp;&amp; anyInstanceUnselected)</div>
<div class="line">    {</div>
<div class="line">        wireItem = <a name="a59"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#ac74a014f3346d8ddac693b7f034fa228">MRenderItem::Create</a>(</div>
<div class="line">            sWireName,</div>
<div class="line">            MRenderItem::DecorationItem,</div>
<div class="line">            MGeometry::kLines);</div>
<div class="line">        wireItem-&gt;<a name="a60"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a8e28487092f00765128c2ffdd43d0fe4">setDrawMode</a>(MGeometry::kWireframe);</div>
<div class="line">        wireItem-&gt;<a name="a61"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a6e865e2cf5c9d818b1cbb99af2360c47">depthPriority</a>(<a name="a62"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#adb484c507442ebce56eac38bd07cac07">MRenderItem::sActiveWireDepthPriority</a>);</div>
<div class="line">        wireItem-&gt;<a name="a63"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#ad283b157fa4f6c40bceb9d398c53a72a">setShader</a>(fWireShader);</div>
<div class="line">        wireItem-&gt;<a name="a64"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a793ce3d41d7f13aea020b811379a3ef3">setSelectionMask</a>(MSelectionMask::kSelectMeshes);</div>
<div class="line">        container.<a name="a65"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_sub_scene_container.html#a3868473990e1902a2929a48acd2746d8">add</a>(wireItem);</div>
<div class="line">        itemsChanged = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (wireItem &amp;&amp; !anyInstanceUnselected)</div>
<div class="line">    {</div>
<div class="line">        container.<a name="a66"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_sub_scene_container.html#ab8634382a216e26abb0b47c55d5eb4b6">remove</a>(sWireName);</div>
<div class="line">        wireItem = NULL;</div>
<div class="line">        itemsChanged = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html">MRenderItem</a>* selectItem = container.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_sub_scene_container.html#aa96c3d709fe8ea2325d20c2423bb8f23">find</a>(sSelectName);</div>
<div class="line">    <span class="keywordflow">if</span> (!selectItem &amp;&amp; anyInstanceSelected)</div>
<div class="line">    {</div>
<div class="line">        selectItem = <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#ac74a014f3346d8ddac693b7f034fa228">MRenderItem::Create</a>(</div>
<div class="line">            sSelectName,</div>
<div class="line">            MRenderItem::DecorationItem,</div>
<div class="line">            MGeometry::kLines);</div>
<div class="line">        selectItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a8e28487092f00765128c2ffdd43d0fe4">setDrawMode</a>((MGeometry::DrawMode)(MGeometry::kWireframe | MGeometry::kShaded | MGeometry::kTextured));</div>
<div class="line">        selectItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a6e865e2cf5c9d818b1cbb99af2360c47">depthPriority</a>(<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#adb484c507442ebce56eac38bd07cac07">MRenderItem::sActiveWireDepthPriority</a>);</div>
<div class="line">        selectItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#ad283b157fa4f6c40bceb9d398c53a72a">setShader</a>(fSelectShader);</div>
<div class="line">        selectItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a793ce3d41d7f13aea020b811379a3ef3">setSelectionMask</a>(MSelectionMask::kSelectMeshes);</div>
<div class="line">        container.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_sub_scene_container.html#a3868473990e1902a2929a48acd2746d8">add</a>(selectItem);</div>
<div class="line">        itemsChanged = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (selectItem &amp;&amp; !anyInstanceSelected)</div>
<div class="line">    {</div>
<div class="line">        container.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_sub_scene_container.html#ab8634382a216e26abb0b47c55d5eb4b6">remove</a>(sSelectName);</div>
<div class="line">        selectItem = NULL;</div>
<div class="line">        itemsChanged = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html">MRenderItem</a>* boxItem = container.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_sub_scene_container.html#aa96c3d709fe8ea2325d20c2423bb8f23">find</a>(sBoxName);</div>
<div class="line">    <span class="keywordflow">if</span> (!boxItem &amp;&amp; anyInstanceUnselected)</div>
<div class="line">    {</div>
<div class="line">        boxItem = <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#ac74a014f3346d8ddac693b7f034fa228">MRenderItem::Create</a>(</div>
<div class="line">            sBoxName,</div>
<div class="line">            MRenderItem::NonMaterialSceneItem,</div>
<div class="line">            MGeometry::kLines);</div>
<div class="line">        boxItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a8e28487092f00765128c2ffdd43d0fe4">setDrawMode</a>(MGeometry::kBoundingBox);</div>
<div class="line">        boxItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#ad283b157fa4f6c40bceb9d398c53a72a">setShader</a>(fWireShader);</div>
<div class="line">        boxItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a793ce3d41d7f13aea020b811379a3ef3">setSelectionMask</a>(MSelectionMask::kSelectMeshes);</div>
<div class="line">        container.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_sub_scene_container.html#a3868473990e1902a2929a48acd2746d8">add</a>(boxItem);</div>
<div class="line">        itemsChanged = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (boxItem &amp;&amp; !anyInstanceUnselected)</div>
<div class="line">    {</div>
<div class="line">        container.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_sub_scene_container.html#ab8634382a216e26abb0b47c55d5eb4b6">remove</a>(sBoxName);</div>
<div class="line">        boxItem = NULL;</div>
<div class="line">        itemsChanged = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html">MRenderItem</a>* selectedBoxItem = container.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_sub_scene_container.html#aa96c3d709fe8ea2325d20c2423bb8f23">find</a>(sSelectedBoxName);</div>
<div class="line">    <span class="keywordflow">if</span> (!selectedBoxItem &amp;&amp; anyInstanceSelected)</div>
<div class="line">    {</div>
<div class="line">        selectedBoxItem = <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#ac74a014f3346d8ddac693b7f034fa228">MRenderItem::Create</a>(</div>
<div class="line">            sSelectedBoxName,</div>
<div class="line">            MRenderItem::NonMaterialSceneItem,</div>
<div class="line">            MGeometry::kLines);</div>
<div class="line">        selectedBoxItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a8e28487092f00765128c2ffdd43d0fe4">setDrawMode</a>(MGeometry::kBoundingBox);</div>
<div class="line">        selectedBoxItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#ad283b157fa4f6c40bceb9d398c53a72a">setShader</a>(fSelectShader);</div>
<div class="line">        selectedBoxItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a793ce3d41d7f13aea020b811379a3ef3">setSelectionMask</a>(MSelectionMask::kSelectMeshes);</div>
<div class="line">        container.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_sub_scene_container.html#a3868473990e1902a2929a48acd2746d8">add</a>(selectedBoxItem);</div>
<div class="line">        itemsChanged = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (selectedBoxItem &amp;&amp; !anyInstanceSelected)</div>
<div class="line">    {</div>
<div class="line">        container.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_sub_scene_container.html#ab8634382a216e26abb0b47c55d5eb4b6">remove</a>(sSelectedBoxName);</div>
<div class="line">        selectedBoxItem = NULL;</div>
<div class="line">        itemsChanged = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html">MRenderItem</a>* shadedItem = container.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_sub_scene_container.html#aa96c3d709fe8ea2325d20c2423bb8f23">find</a>(sShadedName);</div>
<div class="line">    <span class="keywordflow">if</span> (!shadedItem)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// We always want a shaded item</span></div>
<div class="line">        shadedItem = <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#ac74a014f3346d8ddac693b7f034fa228">MRenderItem::Create</a>(</div>
<div class="line">            sShadedName,</div>
<div class="line">            MRenderItem::MaterialSceneItem,</div>
<div class="line">            MGeometry::kTriangles);</div>
<div class="line">        shadedItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a8e28487092f00765128c2ffdd43d0fe4">setDrawMode</a>(MGeometry::kShaded);</div>
<div class="line">        shadedItem-&gt;<a name="a67"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a634faadbe865d745bc8ed447efe671da">setExcludedFromPostEffects</a>(<span class="keyword">false</span>);</div>
<div class="line">        shadedItem-&gt;<a name="a68"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a4679f5dfcf97d7470561e4adc1cbe21c">castsShadows</a>(<span class="keyword">true</span>);</div>
<div class="line">        shadedItem-&gt;<a name="a69"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a84fc76ef02716b725765f6de1ff3a8c6">receivesShadows</a>(<span class="keyword">true</span>);</div>
<div class="line">        shadedItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a793ce3d41d7f13aea020b811379a3ef3">setSelectionMask</a>(MSelectionMask::kSelectMeshes);</div>
<div class="line">        container.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_sub_scene_container.html#a3868473990e1902a2929a48acd2746d8">add</a>(shadedItem);</div>
<div class="line">        itemsChanged = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html">MRenderItem</a>* texturedItem = container.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_sub_scene_container.html#aa96c3d709fe8ea2325d20c2423bb8f23">find</a>(sTexturedName);</div>
<div class="line">    <span class="keywordflow">if</span> (!texturedItem)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// We always want a textured item</span></div>
<div class="line">        texturedItem = <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#ac74a014f3346d8ddac693b7f034fa228">MRenderItem::Create</a>(</div>
<div class="line">            sTexturedName,</div>
<div class="line">            MRenderItem::MaterialSceneItem,</div>
<div class="line">            MGeometry::kTriangles);</div>
<div class="line">        texturedItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a8e28487092f00765128c2ffdd43d0fe4">setDrawMode</a>(MGeometry::kTextured);</div>
<div class="line">        texturedItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a634faadbe865d745bc8ed447efe671da">setExcludedFromPostEffects</a>(<span class="keyword">false</span>);</div>
<div class="line">        texturedItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a4679f5dfcf97d7470561e4adc1cbe21c">castsShadows</a>(<span class="keyword">true</span>);</div>
<div class="line">        texturedItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a84fc76ef02716b725765f6de1ff3a8c6">receivesShadows</a>(<span class="keyword">true</span>);</div>
<div class="line">        texturedItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a793ce3d41d7f13aea020b811379a3ef3">setSelectionMask</a>(MSelectionMask::kSelectMeshes);</div>
<div class="line">        container.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_sub_scene_container.html#a3868473990e1902a2929a48acd2746d8">add</a>(texturedItem);</div>
<div class="line">        itemsChanged = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Grab shading node from first component of first instance of the</span></div>
<div class="line">    <span class="comment">// object and use it to get an MShaderInstance. This could be expanded</span></div>
<div class="line">    <span class="comment">// to support full instancing and components if necessary.</span></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_object.html">MObject</a> shader;</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_object_array.html">MObjectArray</a> sets, comps;</div>
<div class="line">    <span class="keywordflow">if</span> (node.getConnectedSetsAndMembers(0, sets, comps, <span class="keyword">true</span>))</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;sets.<a class="code" href="#!/url=./cpp_ref/class_m_object_array.html#a580388f31f60c46fac867ca48a48da1e">length</a>(); i++)</div>
<div class="line">        {</div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m_fn_dependency_node.html">MFnDependencyNode</a> fnSet(sets[i], &amp;status);</div>
<div class="line">            <span class="keywordflow">if</span> (status)</div>
<div class="line">            {</div>
<div class="line">                <a name="_a70"></a><a class="code" href="#!/url=./cpp_ref/class_m_plug.html">MPlug</a> shaderPlug = fnSet.findPlug(<span class="stringliteral">&quot;surfaceShader&quot;</span>, <span class="keyword">true</span>);</div>
<div class="line">                <span class="keywordflow">if</span> (!shaderPlug.<a name="a71"></a><a class="code" href="#!/url=./cpp_ref/class_m_plug.html#ab7ec149d38b7c29ca55c5aa7b407d8f9">isNull</a>())</div>
<div class="line">                {</div>
<div class="line">                    <a name="_a72"></a><a class="code" href="#!/url=./cpp_ref/class_m_plug_array.html">MPlugArray</a> connectedPlugs;</div>
<div class="line">                    shaderPlug.<a name="a73"></a><a class="code" href="#!/url=./cpp_ref/class_m_plug.html#acf1340576a4a0a78a0045e67ee4155bf">connectedTo</a>(connectedPlugs, <span class="keyword">true</span>, <span class="keyword">false</span>);</div>
<div class="line">                    <span class="keywordflow">if</span> (connectedPlugs.<a name="a74"></a><a class="code" href="#!/url=./cpp_ref/class_m_plug_array.html#a580388f31f60c46fac867ca48a48da1e">length</a>() &gt; 0)</div>
<div class="line">                    {</div>
<div class="line">                        shader = connectedPlugs[0].node(&amp;status);</div>
<div class="line">                        <span class="keywordflow">if</span> (status &amp;&amp; !shader.<a class="code" href="#!/url=./cpp_ref/class_m_object.html#ac02f2a4d7312eb91f40980adfd4e31b2">isNull</a>()) <span class="keywordflow">break</span>;</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Check the dirty flag and make necessary update for shader assignment.</span></div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">bool</span> updateMaterial = fMesh-&gt;materialDirty();</div>
<div class="line">    fMesh-&gt;setMaterialDirty(<span class="keyword">false</span>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Update shader for shaded item</span></div>
<div class="line">    <span class="keywordflow">if</span> (updateMaterial || !shadedItem-&gt;<a name="a75"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a2d1a4a42bc868748d574acbe644677a1">isShaderFromNode</a>())</div>
<div class="line">    {</div>
<div class="line">        ShadedItemUserData *userData = <span class="keyword">new</span> ShadedItemUserData(<span class="keyword">this</span>);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (!shader.<a class="code" href="#!/url=./cpp_ref/class_m_object.html#ac02f2a4d7312eb91f40980adfd4e31b2">isNull</a>() &amp;&amp;</div>
<div class="line">            shadedItem-&gt;<a name="a76"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a1f821e0772346c0567396a67bb5fee7b">setShaderFromNode</a>(shader,</div>
<div class="line">                                          instances[0],</div>
<div class="line">                                          shadedItemLinkLost,</div>
<div class="line">                                          userData,</div>
<div class="line">                                          <span class="keyword">true</span>))</div>
<div class="line">        {</div>
<div class="line">            fLinkLostCallbackData.push_back(userData);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            shadedItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#ad283b157fa4f6c40bceb9d398c53a72a">setShader</a>(fShadedShader);</div>
<div class="line">            <span class="keyword">delete</span> userData;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Update shader for textured item</span></div>
<div class="line">    <span class="keywordflow">if</span> (updateMaterial || !texturedItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a2d1a4a42bc868748d574acbe644677a1">isShaderFromNode</a>())</div>
<div class="line">    {</div>
<div class="line">        ShadedItemUserData *userData = <span class="keyword">new</span> ShadedItemUserData(<span class="keyword">this</span>);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (!shader.<a class="code" href="#!/url=./cpp_ref/class_m_object.html#ac02f2a4d7312eb91f40980adfd4e31b2">isNull</a>() &amp;&amp;</div>
<div class="line">            texturedItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a1f821e0772346c0567396a67bb5fee7b">setShaderFromNode</a>(shader,</div>
<div class="line">                                            instances[0],</div>
<div class="line">                                            shadedItemLinkLost,</div>
<div class="line">                                            userData,</div>
<div class="line">                                            <span class="keyword">false</span>))</div>
<div class="line">        {</div>
<div class="line">            fLinkLostCallbackData.push_back(userData);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            texturedItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#ad283b157fa4f6c40bceb9d398c53a72a">setShader</a>(fShadedShader);</div>
<div class="line">            <span class="keyword">delete</span> userData;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// We&#39;ve enabled update for selection by overriding enableUpdateForSelection().</span></div>
<div class="line">    <span class="comment">// If the subscene update method is called in the selection pass, we can query</span></div>
<div class="line">    <span class="comment">// the selection state information to create render items as needed, instead</span></div>
<div class="line">    <span class="comment">// of pre-creating everything inefficiently.</span></div>
<div class="line">    <span class="keyword">const</span> <a name="_a77"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_selection_info.html">MSelectionInfo</a>* selInfo = frameContext.<a name="a78"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_frame_context.html#a47de565a64c70284706f3510b6827b73">getSelectionInfo</a>();</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">bool</span> isVertexSelectable =</div>
<div class="line">        selInfo &amp;&amp; selInfo-&gt;<a name="a79"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_selection_info.html#abac05251449b5b93d7026ad4bf702491">selectableComponent</a>(<span class="keyword">true</span>, MSelectionMask::kSelectMeshVerts);</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">bool</span> isEdgeSelectable =</div>
<div class="line">        selInfo &amp;&amp; selInfo-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_selection_info.html#abac05251449b5b93d7026ad4bf702491">selectableComponent</a>(<span class="keyword">true</span>, MSelectionMask::kSelectMeshEdges);</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">bool</span> isFaceSelectable =</div>
<div class="line">        selInfo &amp;&amp; selInfo-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_selection_info.html#abac05251449b5b93d7026ad4bf702491">selectableComponent</a>(<span class="keyword">true</span>, MSelectionMask::kSelectMeshFaces);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// render item for vertex selection</span></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html">MRenderItem</a>* vertexSelectionItem = container.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_sub_scene_container.html#aa96c3d709fe8ea2325d20c2423bb8f23">find</a>(sVertexSelectionName);</div>
<div class="line">    <span class="keywordflow">if</span> (!vertexSelectionItem &amp;&amp; isVertexSelectable)</div>
<div class="line">    {</div>
<div class="line">        vertexSelectionItem = <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#ac74a014f3346d8ddac693b7f034fa228">MRenderItem::Create</a>(</div>
<div class="line">            sVertexSelectionName,</div>
<div class="line">            MRenderItem::DecorationItem,</div>
<div class="line">            MGeometry::kPoints);</div>
<div class="line">        <span class="comment">// use for selection only : not visible in viewport</span></div>
<div class="line">        vertexSelectionItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a8e28487092f00765128c2ffdd43d0fe4">setDrawMode</a>(MHWRender::MGeometry::kSelectionOnly);</div>
<div class="line">        <span class="comment">// set the selection mask to kSelectMeshVerts : we want the render item to be used for Vertex Components selection</span></div>
<div class="line">        <a class="code" href="#!/url=./cpp_ref/class_m_selection_mask.html">MSelectionMask</a> mask(MSelectionMask::kSelectMeshVerts);</div>
<div class="line">        mask.addMask(MSelectionMask::kSelectPointsForGravity);</div>
<div class="line">        vertexSelectionItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a793ce3d41d7f13aea020b811379a3ef3">setSelectionMask</a>( mask );</div>
<div class="line">        <span class="comment">// set selection priority : on top</span></div>
<div class="line">        vertexSelectionItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a6e865e2cf5c9d818b1cbb99af2360c47">depthPriority</a>(<a name="a80"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#abf0686a71845159b7a473312fe05044a">MRenderItem::sSelectionDepthPriority</a>);</div>
<div class="line">        vertexSelectionItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#ad283b157fa4f6c40bceb9d398c53a72a">setShader</a>(fVertexComponentShader);</div>
<div class="line">        container.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_sub_scene_container.html#a3868473990e1902a2929a48acd2746d8">add</a>(vertexSelectionItem);</div>
<div class="line">        itemsChanged = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// change this value to enable item instancing : same item will be rendered multiple times</span></div>
<div class="line">    <span class="comment">// the edge selection item will be visible in the viewport and rendered 3 times (with different scaling)</span></div>
<div class="line">    <span class="comment">// only the second instance (scale 1.5) will be selectable (see simpleComponentConverter)</span></div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">bool</span> useDrawInstancingOnEdgeSelectionItem = <span class="keyword">false</span>;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// render item for edge selection</span></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html">MRenderItem</a>* edgeSelectionItem = container.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_sub_scene_container.html#aa96c3d709fe8ea2325d20c2423bb8f23">find</a>(sEdgeSelectionName);</div>
<div class="line">    <span class="keywordflow">if</span> (!edgeSelectionItem &amp;&amp; (isEdgeSelectable || useDrawInstancingOnEdgeSelectionItem))</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// use for selection only : not visible in viewport</span></div>
<div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> drawMode = MHWRender::MGeometry::kSelectionOnly;</div>
<div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> depthPriority = <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#abf0686a71845159b7a473312fe05044a">MRenderItem::sSelectionDepthPriority</a>;</div>
<div class="line">        <span class="keywordflow">if</span> (useDrawInstancingOnEdgeSelectionItem) {</div>
<div class="line">            <span class="comment">// display in viewport and in selection</span></div>
<div class="line">            drawMode = MHWRender::MGeometry::kAll;</div>
<div class="line">            <span class="comment">// reduce priority so we can see the active item</span></div>
<div class="line">            depthPriority = <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#adb484c507442ebce56eac38bd07cac07">MRenderItem::sActiveWireDepthPriority</a>-1;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        edgeSelectionItem = <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#ac74a014f3346d8ddac693b7f034fa228">MRenderItem::Create</a>(</div>
<div class="line">            sEdgeSelectionName,</div>
<div class="line">            MRenderItem::DecorationItem,</div>
<div class="line">            MGeometry::kLines);</div>
<div class="line">        edgeSelectionItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a8e28487092f00765128c2ffdd43d0fe4">setDrawMode</a>( (MGeometry::DrawMode)drawMode);</div>
<div class="line">        <span class="comment">// set the selection mask to kSelectMeshEdges : we want the render item to be used for Edge Components selection</span></div>
<div class="line">        edgeSelectionItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a793ce3d41d7f13aea020b811379a3ef3">setSelectionMask</a>( MSelectionMask::kSelectMeshEdges );</div>
<div class="line">        edgeSelectionItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a6e865e2cf5c9d818b1cbb99af2360c47">depthPriority</a>(depthPriority);</div>
<div class="line">        edgeSelectionItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#ad283b157fa4f6c40bceb9d398c53a72a">setShader</a>(fWireShader);</div>
<div class="line">        container.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_sub_scene_container.html#a3868473990e1902a2929a48acd2746d8">add</a>(edgeSelectionItem);</div>
<div class="line">        itemsChanged = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">bool</span> updateSelectionUserData = updateGeometry;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// render item for face selection</span></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html">MRenderItem</a>* faceSelectionItem = container.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_sub_scene_container.html#aa96c3d709fe8ea2325d20c2423bb8f23">find</a>(sFaceSelectionName);</div>
<div class="line">    <span class="keywordflow">if</span> (!faceSelectionItem &amp;&amp; isFaceSelectable)</div>
<div class="line">    {</div>
<div class="line">        faceSelectionItem = <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#ac74a014f3346d8ddac693b7f034fa228">MRenderItem::Create</a>(</div>
<div class="line">            sFaceSelectionName,</div>
<div class="line">            MRenderItem::DecorationItem,</div>
<div class="line">            MGeometry::kTriangles);</div>
<div class="line">        <span class="comment">// use for selection only : not visible in viewport</span></div>
<div class="line">        faceSelectionItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a8e28487092f00765128c2ffdd43d0fe4">setDrawMode</a>(MHWRender::MGeometry::kSelectionOnly);</div>
<div class="line">        <span class="comment">// set the selection mask to kSelectMeshFaces : we want the render item to be used for Face Components selection</span></div>
<div class="line">        faceSelectionItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a793ce3d41d7f13aea020b811379a3ef3">setSelectionMask</a>( MSelectionMask::kSelectMeshFaces );</div>
<div class="line">        <span class="comment">// set selection priority : on top</span></div>
<div class="line">        faceSelectionItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a6e865e2cf5c9d818b1cbb99af2360c47">depthPriority</a>(<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#abf0686a71845159b7a473312fe05044a">MRenderItem::sSelectionDepthPriority</a>);</div>
<div class="line">        faceSelectionItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#ad283b157fa4f6c40bceb9d398c53a72a">setShader</a>(fFaceComponentShader);</div>
<div class="line">        container.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_sub_scene_container.html#a3868473990e1902a2929a48acd2746d8">add</a>(faceSelectionItem);</div>
<div class="line">        itemsChanged = <span class="keyword">true</span>;</div>
<div class="line"></div>
<div class="line">        updateSelectionUserData = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// create and add a custom data to help the face component converter</span></div>
<div class="line">    <span class="keywordflow">if</span> (faceSelectionItem &amp;&amp; updateSelectionUserData)</div>
<div class="line">    {</div>
<div class="line">        apiMeshHWSelectionUserData* mySelectionData = <span class="keyword">new</span> apiMeshHWSelectionUserData();</div>
<div class="line">        mySelectionData-&gt;fMeshGeom = fMesh-&gt;meshGeomToUse();</div>
<div class="line">        faceSelectionItem-&gt;<a name="a81"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a1c029ea3297c266381dce0c7b042b793">setCustomData</a>(mySelectionData);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// render item to display active (selected) vertices</span></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html">MRenderItem</a>* activeVertexItem = container.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_sub_scene_container.html#aa96c3d709fe8ea2325d20c2423bb8f23">find</a>(sActiveVertexName);</div>
<div class="line">    <span class="keywordflow">if</span> (!activeVertexItem &amp;&amp; anyVertexSelected)</div>
<div class="line">    {</div>
<div class="line">        activeVertexItem = <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#ac74a014f3346d8ddac693b7f034fa228">MRenderItem::Create</a>(</div>
<div class="line">            sActiveVertexName,</div>
<div class="line">            MRenderItem::DecorationItem,</div>
<div class="line">            MGeometry::kPoints);</div>
<div class="line">        activeVertexItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a8e28487092f00765128c2ffdd43d0fe4">setDrawMode</a>(MGeometry::kAll);</div>
<div class="line">        activeVertexItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a6e865e2cf5c9d818b1cbb99af2360c47">depthPriority</a>(<a name="a82"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#ac0ade2503ccc47f3bd487b9ae7bf53e4">MRenderItem::sActivePointDepthPriority</a>);</div>
<div class="line">        activeVertexItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#ad283b157fa4f6c40bceb9d398c53a72a">setShader</a>(fVertexComponentShader);</div>
<div class="line">        activeVertexItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a793ce3d41d7f13aea020b811379a3ef3">setSelectionMask</a>(MSelectionMask::kSelectMeshVerts);</div>
<div class="line">        container.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_sub_scene_container.html#a3868473990e1902a2929a48acd2746d8">add</a>(activeVertexItem);</div>
<div class="line">        itemsChanged = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (activeVertexItem &amp;&amp; !anyVertexSelected)</div>
<div class="line">    {</div>
<div class="line">        container.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_sub_scene_container.html#ab8634382a216e26abb0b47c55d5eb4b6">remove</a>(sActiveVertexName);</div>
<div class="line">        activeVertexItem = NULL;</div>
<div class="line">        itemsChanged = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// render item to display active (selected) edges</span></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html">MRenderItem</a>* activeEdgeItem = container.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_sub_scene_container.html#aa96c3d709fe8ea2325d20c2423bb8f23">find</a>(sActiveEdgeName);</div>
<div class="line">    <span class="keywordflow">if</span> (!activeEdgeItem &amp;&amp; anyEdgeSelected)</div>
<div class="line">    {</div>
<div class="line">        activeEdgeItem = <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#ac74a014f3346d8ddac693b7f034fa228">MRenderItem::Create</a>(</div>
<div class="line">            sActiveEdgeName,</div>
<div class="line">            MRenderItem::DecorationItem,</div>
<div class="line">            MGeometry::kLines);</div>
<div class="line">        activeEdgeItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a8e28487092f00765128c2ffdd43d0fe4">setDrawMode</a>(MGeometry::kAll);</div>
<div class="line">        activeEdgeItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a6e865e2cf5c9d818b1cbb99af2360c47">depthPriority</a>(<a name="a83"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a2ef0afa87b031ef0f0091e79eb81313a">MRenderItem::sActiveLineDepthPriority</a>);</div>
<div class="line">        activeEdgeItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#ad283b157fa4f6c40bceb9d398c53a72a">setShader</a>(fEdgeComponentShader);</div>
<div class="line">        activeEdgeItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a793ce3d41d7f13aea020b811379a3ef3">setSelectionMask</a>(MSelectionMask::kSelectMeshEdges);</div>
<div class="line">        container.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_sub_scene_container.html#a3868473990e1902a2929a48acd2746d8">add</a>(activeEdgeItem);</div>
<div class="line">        itemsChanged = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (activeEdgeItem &amp;&amp; !anyEdgeSelected)</div>
<div class="line">    {</div>
<div class="line">        container.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_sub_scene_container.html#ab8634382a216e26abb0b47c55d5eb4b6">remove</a>(sActiveEdgeName);</div>
<div class="line">        activeEdgeItem = NULL;</div>
<div class="line">        itemsChanged = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// render item to display active (selected) faces</span></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html">MRenderItem</a>* activeFaceItem = container.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_sub_scene_container.html#aa96c3d709fe8ea2325d20c2423bb8f23">find</a>(sActiveFaceName);</div>
<div class="line">    <span class="keywordflow">if</span> (!activeFaceItem &amp;&amp; anyFaceSelected)</div>
<div class="line">    {</div>
<div class="line">        activeFaceItem = <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#ac74a014f3346d8ddac693b7f034fa228">MRenderItem::Create</a>(</div>
<div class="line">            sActiveFaceName,</div>
<div class="line">            MRenderItem::DecorationItem,</div>
<div class="line">            MGeometry::kTriangles);</div>
<div class="line">        activeFaceItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a8e28487092f00765128c2ffdd43d0fe4">setDrawMode</a>(MGeometry::kAll);</div>
<div class="line">        activeFaceItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a6e865e2cf5c9d818b1cbb99af2360c47">depthPriority</a>(<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a2ef0afa87b031ef0f0091e79eb81313a">MRenderItem::sActiveLineDepthPriority</a>);</div>
<div class="line">        activeFaceItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#ad283b157fa4f6c40bceb9d398c53a72a">setShader</a>(fFaceComponentShader);</div>
<div class="line">        activeFaceItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a793ce3d41d7f13aea020b811379a3ef3">setSelectionMask</a>(MSelectionMask::kSelectMeshFaces);</div>
<div class="line">        container.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_sub_scene_container.html#a3868473990e1902a2929a48acd2746d8">add</a>(activeFaceItem);</div>
<div class="line">        itemsChanged = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (activeFaceItem &amp;&amp; !anyFaceSelected)</div>
<div class="line">    {</div>
<div class="line">        container.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_sub_scene_container.html#ab8634382a216e26abb0b47c55d5eb4b6">remove</a>(sActiveFaceName);</div>
<div class="line">        activeFaceItem = NULL;</div>
<div class="line">        itemsChanged = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// update the line width on the shader for our wire items if it changed</span></div>
<div class="line">    <span class="keywordtype">float</span> lineWidth = frameContext.<a name="a84"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_frame_context.html#a273487acee9e1ffaa4e56d5c25940c2c">getGlobalLineWidth</a>();</div>
<div class="line">    <span class="keywordtype">bool</span> userWidthChange = !floatApproxEqual(lineWidth, fThickLineWidth);</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">bool</span> doUpdate = <span class="keyword">false</span>;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">float</span> targetRefinedLineWidth = 50.0f;</div>
<div class="line">    <span class="keywordflow">if</span> (userWidthChange)</div>
<div class="line">    {</div>
<div class="line">        fThickLineWidth = lineWidth;</div>
<div class="line">        doUpdate = <span class="keyword">true</span>;</div>
<div class="line"></div>
<div class="line">        <span class="comment">// First user change will trigger an update requirement</span></div>
<div class="line">        <span class="keywordflow">if</span> (fUseQueuedLineUpdate)</div>
<div class="line">        {</div>
<div class="line">            fQueuedLineWidth = lineWidth;</div>
<div class="line">            <span class="keywordflow">if</span> (fQueuedLineWidth &lt; targetRefinedLineWidth)</div>
<div class="line">            {</div>
<div class="line">                fQueueUpdate = <span class="keyword">true</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Increment by 1 until we reach the target width.</span></div>
<div class="line">        <span class="comment">// If we haven&#39;t reached it yet then queue another update</span></div>
<div class="line">        <span class="comment">// so we can increment and retest against the target width.</span></div>
<div class="line">        <span class="keywordflow">if</span> (fUseQueuedLineUpdate &amp;&amp; fQueueUpdate)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">if</span> (fQueuedLineWidth &lt; targetRefinedLineWidth)</div>
<div class="line">            {</div>
<div class="line">                lineWidth = fQueuedLineWidth;</div>
<div class="line">                fQueuedLineWidth++;</div>
<div class="line">                fQueueUpdate = <span class="keyword">true</span>;</div>
<div class="line">                doUpdate = <span class="keyword">true</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">            {</div>
<div class="line">                <span class="comment">// Reached target. Stop asking for more refinement</span></div>
<div class="line">                fQueueUpdate = <span class="keyword">false</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (doUpdate)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (!floatApproxEqual(lineWidth, 1.0f))</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// Only set the shader if the line width changes (or the first time)</span></div>
<div class="line">            <span class="keywordtype">float</span> lineWidthArray[2] = {0};</div>
<div class="line">            lineWidthArray[0] = lineWidth;</div>
<div class="line">            lineWidthArray[1] = lineWidth;</div>
<div class="line">            fThickWireShader-&gt;setParameter(<span class="stringliteral">&quot;lineWidth&quot;</span>, lineWidthArray);</div>
<div class="line">            fThickSelectShader-&gt;setParameter(<span class="stringliteral">&quot;lineWidth&quot;</span>, lineWidthArray);</div>
<div class="line">            <span class="keywordflow">if</span> (wireItem)</div>
<div class="line">                wireItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#ad283b157fa4f6c40bceb9d398c53a72a">setShader</a>(fThickWireShader);</div>
<div class="line">            <span class="keywordflow">if</span> (selectItem)</div>
<div class="line">                selectItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#ad283b157fa4f6c40bceb9d398c53a72a">setShader</a>(fThickSelectShader);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">if</span> (wireItem)</div>
<div class="line">                wireItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#ad283b157fa4f6c40bceb9d398c53a72a">setShader</a>(fWireShader);</div>
<div class="line">            <span class="keywordflow">if</span> (selectItem)</div>
<div class="line">                selectItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#ad283b157fa4f6c40bceb9d398c53a72a">setShader</a>(fSelectShader);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Update geometry if required</span></div>
<div class="line">    <span class="keywordflow">if</span> (itemsChanged || updateGeometry)</div>
<div class="line">    {</div>
<div class="line">        <a name="_a85"></a><a class="code" href="#!/url=./cpp_ref/class_m_bounding_box.html">MBoundingBox</a> bounds = fMesh-&gt;boundingBox();</div>
<div class="line"></div>
<div class="line">        <a name="_a86"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_vertex_buffer_array.html">MVertexBufferArray</a> wireBuffers;</div>
<div class="line">        wireBuffers.<a name="a87"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_vertex_buffer_array.html#acd36fdd49c7d45faff08163ae776c5b2">addBuffer</a>(<span class="stringliteral">&quot;positions&quot;</span>, fPositionBuffer);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (wireItem)</div>
<div class="line">            setGeometryForRenderItem(*wireItem, wireBuffers, *fWireIndexBuffer, &amp;bounds);</div>
<div class="line">        <span class="keywordflow">if</span> (selectItem)</div>
<div class="line">            setGeometryForRenderItem(*selectItem, wireBuffers, *fWireIndexBuffer, &amp;bounds);</div>
<div class="line"></div>
<div class="line">        <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_vertex_buffer_array.html">MVertexBufferArray</a> boxBuffers;</div>
<div class="line">        boxBuffers.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_vertex_buffer_array.html#acd36fdd49c7d45faff08163ae776c5b2">addBuffer</a>(<span class="stringliteral">&quot;positions&quot;</span>, fBoxPositionBuffer);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (boxItem)</div>
<div class="line">            setGeometryForRenderItem(*boxItem, boxBuffers, *fBoxIndexBuffer, &amp;bounds);</div>
<div class="line">        <span class="keywordflow">if</span> (selectedBoxItem)</div>
<div class="line">            setGeometryForRenderItem(*selectedBoxItem, boxBuffers, *fBoxIndexBuffer, &amp;bounds);</div>
<div class="line"></div>
<div class="line">        <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_vertex_buffer_array.html">MVertexBufferArray</a> shadedBuffers;</div>
<div class="line">        shadedBuffers.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_vertex_buffer_array.html#acd36fdd49c7d45faff08163ae776c5b2">addBuffer</a>(<span class="stringliteral">&quot;positions&quot;</span>, fPositionBuffer);</div>
<div class="line">        shadedBuffers.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_vertex_buffer_array.html#acd36fdd49c7d45faff08163ae776c5b2">addBuffer</a>(<span class="stringliteral">&quot;normals&quot;</span>, fNormalBuffer);</div>
<div class="line"></div>
<div class="line">        setGeometryForRenderItem(*shadedItem, shadedBuffers, *fShadedIndexBuffer, &amp;bounds);</div>
<div class="line">        setGeometryForRenderItem(*texturedItem, shadedBuffers, *fShadedIndexBuffer, &amp;bounds);</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Point vertex buffer is fully sequential, use an empty index buffer to draw non-indexed.</span></div>
<div class="line">        <span class="keywordflow">if</span> (vertexSelectionItem)</div>
<div class="line">            setGeometryForRenderItem(*vertexSelectionItem, wireBuffers, <a name="_a88"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_index_buffer.html">MIndexBuffer</a>(MGeometry::kUnsignedInt32), &amp;bounds);</div>
<div class="line">        <span class="keywordflow">if</span> (edgeSelectionItem)</div>
<div class="line">            setGeometryForRenderItem(*edgeSelectionItem, wireBuffers, *fWireIndexBuffer, &amp;bounds);</div>
<div class="line">        <span class="keywordflow">if</span> (faceSelectionItem)</div>
<div class="line">            setGeometryForRenderItem(*faceSelectionItem, wireBuffers, *fShadedIndexBuffer, &amp;bounds);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Update active component items if required</span></div>
<div class="line">    <span class="keywordflow">if</span> (itemsChanged || updateActiveItems)</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="#!/url=./cpp_ref/class_m_bounding_box.html">MBoundingBox</a> bounds = fMesh-&gt;boundingBox();</div>
<div class="line"></div>
<div class="line">        <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_vertex_buffer_array.html">MVertexBufferArray</a> vertexBuffer;</div>
<div class="line">        vertexBuffer.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_vertex_buffer_array.html#acd36fdd49c7d45faff08163ae776c5b2">addBuffer</a>(<span class="stringliteral">&quot;positions&quot;</span>, fPositionBuffer);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (activeVertexItem)</div>
<div class="line">            setGeometryForRenderItem(*activeVertexItem, vertexBuffer, *fActiveVerticesIndexBuffer, &amp;bounds);</div>
<div class="line">        <span class="keywordflow">if</span> (activeEdgeItem)</div>
<div class="line">            setGeometryForRenderItem(*activeEdgeItem, vertexBuffer, *fActiveEdgesIndexBuffer, &amp;bounds);</div>
<div class="line">        <span class="keywordflow">if</span> (activeFaceItem)</div>
<div class="line">            setGeometryForRenderItem(*activeFaceItem, vertexBuffer, *fActiveFacesIndexBuffer, &amp;bounds);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Update render item matrices if necessary</span></div>
<div class="line">    <span class="keywordflow">if</span> (itemsChanged || anyMatrixChanged)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (!fIsInstanceMode &amp;&amp; numInstances == 1)</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// When not dealing with multiple instances, don&#39;t convert the render items into instanced</span></div>
<div class="line">            <span class="comment">// mode.  Set the matrices on them directly.</span></div>
<div class="line">            <a name="_a89"></a><a class="code" href="#!/url=./cpp_ref/class_m_matrix.html">MMatrix</a>&amp; objToWorld = instanceMatrixArray[0];</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> (wireItem)</div>
<div class="line">                wireItem-&gt;<a name="a90"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a32cf944375530a37382f8ff49045ddf6">setMatrix</a>(&amp;objToWorld);</div>
<div class="line">            <span class="keywordflow">if</span> (selectItem)</div>
<div class="line">                selectItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a32cf944375530a37382f8ff49045ddf6">setMatrix</a>(&amp;objToWorld);</div>
<div class="line">            <span class="keywordflow">if</span> (boxItem)</div>
<div class="line">                boxItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a32cf944375530a37382f8ff49045ddf6">setMatrix</a>(&amp;objToWorld);</div>
<div class="line">            <span class="keywordflow">if</span> (selectedBoxItem)</div>
<div class="line">                selectedBoxItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a32cf944375530a37382f8ff49045ddf6">setMatrix</a>(&amp;objToWorld);</div>
<div class="line"></div>
<div class="line">            shadedItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a32cf944375530a37382f8ff49045ddf6">setMatrix</a>(&amp;objToWorld);</div>
<div class="line">            texturedItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a32cf944375530a37382f8ff49045ddf6">setMatrix</a>(&amp;objToWorld);</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> (vertexSelectionItem)</div>
<div class="line">                vertexSelectionItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a32cf944375530a37382f8ff49045ddf6">setMatrix</a>(&amp;objToWorld);</div>
<div class="line">            <span class="keywordflow">if</span> (edgeSelectionItem)</div>
<div class="line">                edgeSelectionItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a32cf944375530a37382f8ff49045ddf6">setMatrix</a>(&amp;objToWorld);</div>
<div class="line">            <span class="keywordflow">if</span> (faceSelectionItem)</div>
<div class="line">                faceSelectionItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a32cf944375530a37382f8ff49045ddf6">setMatrix</a>(&amp;objToWorld);</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> (useDrawInstancingOnEdgeSelectionItem) {</div>
<div class="line">                <span class="comment">// create/update draw instances</span></div>
<div class="line">                <span class="comment">// first instance : no scaling - won&#39;t be selectable see simpleComponentConverter::addIntersection</span></div>
<div class="line">                <a class="code" href="#!/url=./cpp_ref/class_m_matrix.html">MMatrix</a> transform1 = objToWorld;</div>
<div class="line">                transform1[3][3] = 1;  <span class="comment">// make sure we don&#39;t scale the w</span></div>
<div class="line">                <span class="comment">// second instance : scaled by 2</span></div>
<div class="line">                <a class="code" href="#!/url=./cpp_ref/class_m_matrix.html">MMatrix</a> transform2 = objToWorld * 2;</div>
<div class="line">                transform2[3][3] = 1;  <span class="comment">// make sure we don&#39;t scale the w</span></div>
<div class="line">                <span class="comment">// third instance : scaled by 3 - won&#39;t be selectable see simpleComponentConverter::addIntersection</span></div>
<div class="line">                <a class="code" href="#!/url=./cpp_ref/class_m_matrix.html">MMatrix</a> transform3 = objToWorld * 3;</div>
<div class="line">                transform3[3][3] = 1;  <span class="comment">// make sure we don&#39;t scale the w</span></div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">if</span> (<span class="keyword">true</span>) {</div>
<div class="line">                    <a class="code" href="#!/url=./cpp_ref/class_m_matrix_array.html">MMatrixArray</a> transforms;</div>
<div class="line">                    transforms.<a name="a91"></a><a class="code" href="#!/url=./cpp_ref/class_m_matrix_array.html#a9336f30aa141a15a691d8ab9e60108f2">append</a>(transform1);</div>
<div class="line">                    transforms.<a class="code" href="#!/url=./cpp_ref/class_m_matrix_array.html#a9336f30aa141a15a691d8ab9e60108f2">append</a>(transform2);</div>
<div class="line">                    transforms.<a class="code" href="#!/url=./cpp_ref/class_m_matrix_array.html#a9336f30aa141a15a691d8ab9e60108f2">append</a>(transform3);</div>
<div class="line">                    setInstanceTransformArray(*edgeSelectionItem, transforms);</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">else</span> {</div>
<div class="line">                    <span class="comment">// another way to set up the instances</span></div>
<div class="line">                    <span class="comment">// useful to get the instance ID</span></div>
<div class="line">                    removeAllInstances(*edgeSelectionItem);</div>
<div class="line">                    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> newInstanceId = addInstanceTransform(*edgeSelectionItem, transform1);</div>
<div class="line">                    printf(<span class="stringliteral">&quot;newInstanceId %u\n&quot;</span>, newInstanceId);</div>
<div class="line">                    newInstanceId = addInstanceTransform(*edgeSelectionItem, transform2);</div>
<div class="line">                    printf(<span class="stringliteral">&quot;newInstanceId %u\n&quot;</span>, newInstanceId);</div>
<div class="line">                    newInstanceId = addInstanceTransform(*edgeSelectionItem, transform3);</div>
<div class="line">                    printf(<span class="stringliteral">&quot;newInstanceId %u\n&quot;</span>, newInstanceId);</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> (activeVertexItem)</div>
<div class="line">                activeVertexItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a32cf944375530a37382f8ff49045ddf6">setMatrix</a>(&amp;objToWorld);</div>
<div class="line">            <span class="keywordflow">if</span> (activeEdgeItem)</div>
<div class="line">                activeEdgeItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a32cf944375530a37382f8ff49045ddf6">setMatrix</a>(&amp;objToWorld);</div>
<div class="line">            <span class="keywordflow">if</span> (activeFaceItem)</div>
<div class="line">                activeFaceItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a32cf944375530a37382f8ff49045ddf6">setMatrix</a>(&amp;objToWorld);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// If we have DAG instances of this shape then use the MPxSubSceneOverride instance</span></div>
<div class="line">            <span class="comment">// transform API to set up instance copies of the render items.  This will be faster</span></div>
<div class="line">            <span class="comment">// to render than creating render items for each instance, especially for large numbers</span></div>
<div class="line">            <span class="comment">// of instances.</span></div>
<div class="line">            <span class="comment">// Note: for simplicity, this code is not tracking the actual shaded material binding</span></div>
<div class="line">            <span class="comment">// of the shape.  MPxSubSceneOverride render item instances require that the shader</span></div>
<div class="line">            <span class="comment">// and other properties of the instances all match.  So if we were to bind a shader based</span></div>
<div class="line">            <span class="comment">// on the DAG shape material binding, then we would need one render item per material. We</span></div>
<div class="line">            <span class="comment">// could then group up the instance transforms based matching materials.</span></div>
<div class="line"></div>
<div class="line">            <span class="comment">// Note this has to happen after the geometry and shaders are set, otherwise it will fail.</span></div>
<div class="line">            <span class="keywordflow">if</span> (wireItem)</div>
<div class="line">                setInstanceTransformArray(*wireItem, unselectedInstanceMatrixArray);</div>
<div class="line">            <span class="keywordflow">if</span> (selectItem)</div>
<div class="line">                setInstanceTransformArray(*selectItem, selectedInstanceMatrixArray);</div>
<div class="line">            <span class="keywordflow">if</span> (boxItem)</div>
<div class="line">                setInstanceTransformArray(*boxItem, unselectedInstanceMatrixArray);</div>
<div class="line">            <span class="keywordflow">if</span> (selectedBoxItem)</div>
<div class="line">                setInstanceTransformArray(*selectedBoxItem, selectedInstanceMatrixArray);</div>
<div class="line"></div>
<div class="line">            setInstanceTransformArray(*shadedItem, instanceMatrixArray);</div>
<div class="line">            setInstanceTransformArray(*texturedItem, instanceMatrixArray);</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> (vertexSelectionItem)</div>
<div class="line">                setInstanceTransformArray(*vertexSelectionItem, instanceMatrixArray);</div>
<div class="line">            <span class="keywordflow">if</span> (edgeSelectionItem)</div>
<div class="line">                setInstanceTransformArray(*edgeSelectionItem, instanceMatrixArray);</div>
<div class="line">            <span class="keywordflow">if</span> (faceSelectionItem)</div>
<div class="line">                setInstanceTransformArray(*faceSelectionItem, instanceMatrixArray);</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> (activeVertexItem)</div>
<div class="line">                setInstanceTransformArray(*activeVertexItem, instanceMatrixArray);</div>
<div class="line">            <span class="keywordflow">if</span> (activeEdgeItem)</div>
<div class="line">                setInstanceTransformArray(*activeEdgeItem, instanceMatrixArray);</div>
<div class="line">            <span class="keywordflow">if</span> (activeFaceItem)</div>
<div class="line">                setInstanceTransformArray(*activeFaceItem, instanceMatrixArray);</div>
<div class="line"></div>
<div class="line">            <span class="comment">// Once we change the render items into instance rendering they can&#39;t be changed back without</span></div>
<div class="line">            <span class="comment">// being deleted and re-created.  So if instances are deleted to leave only one remaining,</span></div>
<div class="line">            <span class="comment">// just keep treating them the instance way.</span></div>
<div class="line">            fIsInstanceMode = <span class="keyword">true</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    manageIsolateSelectRenderItems(container, frameContext, instances, vsfInfo,</div>
<div class="line">        shader, updateMaterial, updateGeometry);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (itemsChanged || anyMatrixChanged || updateGeometry)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// On transform or geometry change, force recalculation of shadow maps</span></div>
<div class="line">        <a name="a92"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_renderer.html#a06b742a8850af64d01e3fcbd9450916f">MRenderer::setLightsAndShadowsDirty</a>();</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> apiMeshSubSceneOverride::manageIsolateSelectRenderItems(</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_sub_scene_container.html">MHWRender::MSubSceneContainer</a>&amp; container,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_frame_context.html">MHWRender::MFrameContext</a>&amp; frameContext,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_dag_path_array.html">MDagPathArray</a>&amp; instances,</div>
<div class="line">    <span class="keyword">const</span> ViewSelectedFaceInfo&amp; currInfo,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_object.html">MObject</a>&amp; shader,</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">bool</span> updateMaterial,</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">bool</span> updateGeometry)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">using namespace </span><a class="code" href="#!/url=./cpp_ref/namespace_m_h_w_render.html">MHWRender</a>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (!fMesh) <span class="keywordflow">return</span>;</div>
<div class="line"></div>
<div class="line">    apiMeshGeom* meshGeom = fMesh-&gt;meshGeomToUse();</div>
<div class="line">    <span class="keywordflow">if</span> (!meshGeom) <span class="keywordflow">return</span>;</div>
<div class="line"></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> destinationName;</div>
<div class="line">    <span class="keywordflow">if</span> (frameContext.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_frame_context.html#a0df712533d76bdc96f2b49f4767ed85e">renderingDestination</a>(destinationName) != MFrameContext::k3dViewport)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Check whether the view-selected faces of the DAG instances changed for the current view</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="keywordtype">bool</span> updateViewSelectedFaces = <span class="keyword">false</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keyword">const</span> std::string activeViewName = destinationName.<a name="a93"></a><a class="code" href="#!/url=./cpp_ref/class_m_string.html#aa9ab612f356c53479afc4c648c9ef94d">asChar</a>();</div>
<div class="line">    <span class="keywordflow">if</span> (fViewSelectedFaceInfoCache.find(activeViewName) == fViewSelectedFaceInfoCache.end())</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (!currInfo.empty())</div>
<div class="line">        {</div>
<div class="line">            updateViewSelectedFaces = <span class="keyword">true</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fViewSelectedFaceInfoCache[activeViewName] != currInfo)</div>
<div class="line">    {</div>
<div class="line">        updateViewSelectedFaces = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Create/remove render items for the current view</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="keywordflow">if</span> (updateViewSelectedFaces)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Gather previous instances which own view-selected faces</span></div>
<div class="line">        std::set&lt;int&gt; prevInstIdxArray;</div>
<div class="line">        <span class="keywordflow">if</span> (fViewSelectedFaceInfoCache.find(activeViewName) != fViewSelectedFaceInfoCache.end())</div>
<div class="line">        {</div>
<div class="line">            <span class="keyword">const</span> ViewSelectedFaceInfo&amp; prevInfo = fViewSelectedFaceInfoCache[activeViewName];</div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;p : prevInfo)</div>
<div class="line">            {</div>
<div class="line">                <span class="keyword">const</span> <span class="keywordtype">int</span> instIdx = p.first;</div>
<div class="line">                <span class="keyword">const</span> <span class="keywordtype">int</span> faceIdx = p.second;</div>
<div class="line">                <span class="keywordflow">if</span> (faceIdx != sViewSelectedInstanceMark)</div>
<div class="line">                {</div>
<div class="line">                    prevInstIdxArray.insert(instIdx);</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Gather current instances which own view-selected faces</span></div>
<div class="line">        std::set&lt;int&gt; currInstIdxArray;</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;p : currInfo)</div>
<div class="line">        {</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">int</span> instIdx = p.first;</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">int</span> faceIdx = p.second;</div>
<div class="line">            <span class="keywordflow">if</span> (faceIdx != sViewSelectedInstanceMark)</div>
<div class="line">            {</div>
<div class="line">                currInstIdxArray.insert(instIdx);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Update the cache now that we&#39;ve gathered the previous data</span></div>
<div class="line">        fViewSelectedFaceInfoCache[activeViewName] = currInfo;</div>
<div class="line"></div>
<div class="line">        <span class="comment">// For the DAG instances which don&#39;t own view-selected faces any more,</span></div>
<div class="line">        <span class="comment">// their isolate select render items are removed to reduce the number of</span></div>
<div class="line">        <span class="comment">// render items. Plug-ins can also choose to disable the render items if</span></div>
<div class="line">        <span class="comment">// frequent reuse of the render items is expected.</span></div>
<div class="line">        std::set&lt;int&gt; diffInstIdxArray;</div>
<div class="line">        std::set_difference(</div>
<div class="line">            prevInstIdxArray.begin(), prevInstIdxArray.end(),</div>
<div class="line">            currInstIdxArray.begin(), currInstIdxArray.end(),</div>
<div class="line">            std::inserter(diffInstIdxArray, diffInstIdxArray.begin()));</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> instIdx : diffInstIdxArray)</div>
<div class="line">        {</div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> namePostfix = sNameSeparator + instIdx + sNameSeparator + destinationName;</div>
<div class="line"></div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> shadedName = sShadedName + namePostfix;</div>
<div class="line">            container.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_sub_scene_container.html#ab8634382a216e26abb0b47c55d5eb4b6">remove</a>(shadedName);</div>
<div class="line"></div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> texturedName = sTexturedName + namePostfix;</div>
<div class="line">            container.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_sub_scene_container.html#ab8634382a216e26abb0b47c55d5eb4b6">remove</a>(texturedName);</div>
<div class="line"></div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> faceSelectionName = sFaceSelectionName + namePostfix;</div>
<div class="line">            container.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_sub_scene_container.html#ab8634382a216e26abb0b47c55d5eb4b6">remove</a>(faceSelectionName);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Create render items for new DAG instances which own view-selected</span></div>
<div class="line">        <span class="comment">// faces since the last update</span></div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> instIdx : currInstIdxArray)</div>
<div class="line">        {</div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> namePostfix = sNameSeparator + instIdx + sNameSeparator + destinationName;</div>
<div class="line"></div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> shadedName = sShadedName + namePostfix;</div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html">MRenderItem</a>* viewSelectedShadedItem = container.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_sub_scene_container.html#aa96c3d709fe8ea2325d20c2423bb8f23">find</a>(shadedName);</div>
<div class="line">            <span class="keywordflow">if</span> (!viewSelectedShadedItem)</div>
<div class="line">            {</div>
<div class="line">                viewSelectedShadedItem = <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#ac74a014f3346d8ddac693b7f034fa228">MRenderItem::Create</a>(</div>
<div class="line">                    shadedName,</div>
<div class="line">                    MRenderItem::MaterialSceneItem,</div>
<div class="line">                    MGeometry::kTriangles);</div>
<div class="line"></div>
<div class="line">                viewSelectedShadedItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a8e28487092f00765128c2ffdd43d0fe4">setDrawMode</a>(MGeometry::kShaded);</div>
<div class="line">                viewSelectedShadedItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a634faadbe865d745bc8ed447efe671da">setExcludedFromPostEffects</a>(<span class="keyword">false</span>);</div>
<div class="line">                viewSelectedShadedItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a4679f5dfcf97d7470561e4adc1cbe21c">castsShadows</a>(<span class="keyword">true</span>);</div>
<div class="line">                viewSelectedShadedItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a84fc76ef02716b725765f6de1ff3a8c6">receivesShadows</a>(<span class="keyword">true</span>);</div>
<div class="line">                viewSelectedShadedItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a793ce3d41d7f13aea020b811379a3ef3">setSelectionMask</a>(MSelectionMask::kSelectMeshes);</div>
<div class="line">                container.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_sub_scene_container.html#a3868473990e1902a2929a48acd2746d8">add</a>(viewSelectedShadedItem);</div>
<div class="line"></div>
<div class="line">                apiMeshHWSelectionUserData* userData = <span class="keyword">new</span> apiMeshHWSelectionUserData();</div>
<div class="line">                userData-&gt;fMeshGeom = meshGeom;</div>
<div class="line">                userData-&gt;fInstanceIndex = instIdx;</div>
<div class="line">                viewSelectedShadedItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a1c029ea3297c266381dce0c7b042b793">setCustomData</a>(userData);</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> texturedName = sTexturedName + namePostfix;</div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html">MRenderItem</a>* viewSelectedTexturedItem = container.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_sub_scene_container.html#aa96c3d709fe8ea2325d20c2423bb8f23">find</a>(texturedName);</div>
<div class="line">            <span class="keywordflow">if</span> (!viewSelectedTexturedItem)</div>
<div class="line">            {</div>
<div class="line">                viewSelectedTexturedItem = <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#ac74a014f3346d8ddac693b7f034fa228">MRenderItem::Create</a>(</div>
<div class="line">                    texturedName,</div>
<div class="line">                    MRenderItem::MaterialSceneItem,</div>
<div class="line">                    MGeometry::kTriangles);</div>
<div class="line"></div>
<div class="line">                viewSelectedTexturedItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a8e28487092f00765128c2ffdd43d0fe4">setDrawMode</a>(MGeometry::kTextured);</div>
<div class="line">                viewSelectedTexturedItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a634faadbe865d745bc8ed447efe671da">setExcludedFromPostEffects</a>(<span class="keyword">false</span>);</div>
<div class="line">                viewSelectedTexturedItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a4679f5dfcf97d7470561e4adc1cbe21c">castsShadows</a>(<span class="keyword">true</span>);</div>
<div class="line">                viewSelectedTexturedItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a84fc76ef02716b725765f6de1ff3a8c6">receivesShadows</a>(<span class="keyword">true</span>);</div>
<div class="line">                viewSelectedTexturedItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a793ce3d41d7f13aea020b811379a3ef3">setSelectionMask</a>(MSelectionMask::kSelectMeshes);</div>
<div class="line">                container.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_sub_scene_container.html#a3868473990e1902a2929a48acd2746d8">add</a>(viewSelectedTexturedItem);</div>
<div class="line"></div>
<div class="line">                apiMeshHWSelectionUserData* userData = <span class="keyword">new</span> apiMeshHWSelectionUserData();</div>
<div class="line">                userData-&gt;fMeshGeom = meshGeom;</div>
<div class="line">                userData-&gt;fInstanceIndex = instIdx;</div>
<div class="line">                viewSelectedTexturedItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a1c029ea3297c266381dce0c7b042b793">setCustomData</a>(userData);</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> faceSelectionName = sFaceSelectionName + namePostfix;</div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html">MRenderItem</a>* viewSelectedFaceSelectionItem = container.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_sub_scene_container.html#aa96c3d709fe8ea2325d20c2423bb8f23">find</a>(faceSelectionName);</div>
<div class="line">            <span class="keywordflow">if</span> (!viewSelectedFaceSelectionItem)</div>
<div class="line">            {</div>
<div class="line">                viewSelectedFaceSelectionItem = <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#ac74a014f3346d8ddac693b7f034fa228">MRenderItem::Create</a>(</div>
<div class="line">                    faceSelectionName,</div>
<div class="line">                    MRenderItem::DecorationItem,</div>
<div class="line">                    MGeometry::kTriangles);</div>
<div class="line"></div>
<div class="line">                <span class="comment">// use for selection only : not visible in viewport</span></div>
<div class="line">                viewSelectedFaceSelectionItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a8e28487092f00765128c2ffdd43d0fe4">setDrawMode</a>(MGeometry::kSelectionOnly);</div>
<div class="line">                <span class="comment">// set the selection mask to kSelectMeshFaces : we want the render item to be used for Face Components selection</span></div>
<div class="line">                viewSelectedFaceSelectionItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a793ce3d41d7f13aea020b811379a3ef3">setSelectionMask</a>(MSelectionMask::kSelectMeshFaces);</div>
<div class="line">                <span class="comment">// set selection priority : on top</span></div>
<div class="line">                viewSelectedFaceSelectionItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a6e865e2cf5c9d818b1cbb99af2360c47">depthPriority</a>(<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#abf0686a71845159b7a473312fe05044a">MRenderItem::sSelectionDepthPriority</a>);</div>
<div class="line">                viewSelectedFaceSelectionItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#ad283b157fa4f6c40bceb9d398c53a72a">setShader</a>(fFaceComponentShader);</div>
<div class="line">                container.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_sub_scene_container.html#a3868473990e1902a2929a48acd2746d8">add</a>(viewSelectedFaceSelectionItem);</div>
<div class="line"></div>
<div class="line">                apiMeshHWSelectionUserData* userData = <span class="keyword">new</span> apiMeshHWSelectionUserData();</div>
<div class="line">                userData-&gt;fMeshGeom = meshGeom;</div>
<div class="line">                userData-&gt;fInstanceIndex = instIdx;</div>
<div class="line">                viewSelectedFaceSelectionItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a1c029ea3297c266381dce0c7b042b793">setCustomData</a>(userData);</div>
<div class="line"></div>
<div class="line">                <span class="comment">// Register component converter for isolate select render items</span></div>
<div class="line">                <span class="keyword">const</span> std::string key = faceSelectionName.<a class="code" href="#!/url=./cpp_ref/class_m_string.html#aa9ab612f356c53479afc4c648c9ef94d">asChar</a>();</div>
<div class="line">                <span class="keywordflow">if</span> (sViewSelectedFaceSelectionNames.find(key) == sViewSelectedFaceSelectionNames.end())</div>
<div class="line">                {</div>
<div class="line">                    <a name="a94"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_draw_registry.html#ac76651be69e4645ee8e741049dd183ed">MDrawRegistry::registerComponentConverter</a>(faceSelectionName,</div>
<div class="line">                        simpleComponentConverter::creatorFaceSelection);</div>
<div class="line"></div>
<div class="line">                    sViewSelectedFaceSelectionNames.emplace(key);</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Update render items for all views as required</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; p : fViewSelectedFaceInfoCache)</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">const</span> std::string&amp; viewName = p.first;</div>
<div class="line">        <span class="keyword">const</span> ViewSelectedFaceInfo&amp; faceInfo = p.second;</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">bool</span> isActiveView = (viewName == activeViewName);</div>
<div class="line"></div>
<div class="line">        std::set&lt;int&gt; instIdxArray;</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; q : faceInfo)</div>
<div class="line">        {</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">int</span> instIdx = q.first;</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">int</span> faceIdx = q.second;</div>
<div class="line">            <span class="keywordflow">if</span> (faceIdx != sViewSelectedInstanceMark)</div>
<div class="line">            {</div>
<div class="line">                instIdxArray.insert(instIdx);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> instIdx : instIdxArray)</div>
<div class="line">        {</div>
<div class="line">            <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> namePostfix = sNameSeparator + instIdx + sNameSeparator + viewName.c_str();</div>
<div class="line"></div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html">MRenderItem</a>* viewSelectedShadedItem = container.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_sub_scene_container.html#aa96c3d709fe8ea2325d20c2423bb8f23">find</a>(sShadedName + namePostfix);</div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html">MRenderItem</a>* viewSelectedTexturedItem = container.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_sub_scene_container.html#aa96c3d709fe8ea2325d20c2423bb8f23">find</a>(sTexturedName + namePostfix);</div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html">MRenderItem</a>* viewSelectedFaceSelectionItem = container.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_sub_scene_container.html#aa96c3d709fe8ea2325d20c2423bb8f23">find</a>(sFaceSelectionName + namePostfix);</div>
<div class="line">            <span class="keywordflow">if</span> (!viewSelectedShadedItem || !viewSelectedTexturedItem || !viewSelectedFaceSelectionItem)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">continue</span>;</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="comment">// Enable isolate select render items for the active view and disable those for other views</span></div>
<div class="line">            viewSelectedShadedItem-&gt;<a name="a95"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a1e9d2a5708b2231a8e72d22dc3be53fe">enable</a>(isActiveView);</div>
<div class="line">            viewSelectedTexturedItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a1e9d2a5708b2231a8e72d22dc3be53fe">enable</a>(isActiveView);</div>
<div class="line">            viewSelectedFaceSelectionItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a1e9d2a5708b2231a8e72d22dc3be53fe">enable</a>(isActiveView);</div>
<div class="line"></div>
<div class="line">            <span class="comment">// Update matrix</span></div>
<div class="line">            <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_dag_path.html">MDagPath</a>&amp; instance = instances[instIdx];</div>
<div class="line">            <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_matrix.html">MMatrix</a> objToWorld = instance.<a class="code" href="#!/url=./cpp_ref/class_m_dag_path.html#afb30f64680f5aa038da428a79579d08c">inclusiveMatrix</a>();</div>
<div class="line">            viewSelectedShadedItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a32cf944375530a37382f8ff49045ddf6">setMatrix</a>(&amp;objToWorld);</div>
<div class="line">            viewSelectedTexturedItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a32cf944375530a37382f8ff49045ddf6">setMatrix</a>(&amp;objToWorld);</div>
<div class="line">            viewSelectedFaceSelectionItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a32cf944375530a37382f8ff49045ddf6">setMatrix</a>(&amp;objToWorld);</div>
<div class="line"></div>
<div class="line">            <span class="comment">// Perform necessary update for shader, geometry, bounding box</span></div>
<div class="line">            <span class="keywordflow">if</span> (updateViewSelectedFaces || updateMaterial || updateGeometry)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">if</span> (updateMaterial || !viewSelectedShadedItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a2d1a4a42bc868748d574acbe644677a1">isShaderFromNode</a>())</div>
<div class="line">                {</div>
<div class="line">                    ShadedItemUserData *userData = <span class="keyword">new</span> ShadedItemUserData(<span class="keyword">this</span>);</div>
<div class="line"></div>
<div class="line">                    <span class="keywordflow">if</span> (!shader.<a class="code" href="#!/url=./cpp_ref/class_m_object.html#ac02f2a4d7312eb91f40980adfd4e31b2">isNull</a>() &amp;&amp;</div>
<div class="line">                        viewSelectedShadedItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a1f821e0772346c0567396a67bb5fee7b">setShaderFromNode</a>(shader,</div>
<div class="line">                            instance,</div>
<div class="line">                            shadedItemLinkLost,</div>
<div class="line">                            userData,</div>
<div class="line">                            <span class="keyword">true</span>))</div>
<div class="line">                    {</div>
<div class="line">                        fLinkLostCallbackData.push_back(userData);</div>
<div class="line">                    }</div>
<div class="line">                    <span class="keywordflow">else</span></div>
<div class="line">                    {</div>
<div class="line">                        viewSelectedShadedItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#ad283b157fa4f6c40bceb9d398c53a72a">setShader</a>(fShadedShader);</div>
<div class="line">                        <span class="keyword">delete</span> userData;</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">if</span> (updateMaterial || !viewSelectedTexturedItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a2d1a4a42bc868748d574acbe644677a1">isShaderFromNode</a>())</div>
<div class="line">                {</div>
<div class="line">                    ShadedItemUserData *userData = <span class="keyword">new</span> ShadedItemUserData(<span class="keyword">this</span>);</div>
<div class="line"></div>
<div class="line">                    <span class="keywordflow">if</span> (!shader.<a class="code" href="#!/url=./cpp_ref/class_m_object.html#ac02f2a4d7312eb91f40980adfd4e31b2">isNull</a>() &amp;&amp;</div>
<div class="line">                        viewSelectedTexturedItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a1f821e0772346c0567396a67bb5fee7b">setShaderFromNode</a>(shader,</div>
<div class="line">                            instance,</div>
<div class="line">                            shadedItemLinkLost,</div>
<div class="line">                            userData,</div>
<div class="line">                            <span class="keyword">false</span>))</div>
<div class="line">                    {</div>
<div class="line">                        fLinkLostCallbackData.push_back(userData);</div>
<div class="line">                    }</div>
<div class="line">                    <span class="keywordflow">else</span></div>
<div class="line">                    {</div>
<div class="line">                        viewSelectedTexturedItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#ad283b157fa4f6c40bceb9d398c53a72a">setShader</a>(fShadedShader);</div>
<div class="line">                        <span class="keyword">delete</span> userData;</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">                <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_vertex_buffer_array.html">MVertexBufferArray</a> shadedBuffers;</div>
<div class="line">                shadedBuffers.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_vertex_buffer_array.html#acd36fdd49c7d45faff08163ae776c5b2">addBuffer</a>(<span class="stringliteral">&quot;positions&quot;</span>, fPositionBuffer);</div>
<div class="line">                shadedBuffers.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_vertex_buffer_array.html#acd36fdd49c7d45faff08163ae776c5b2">addBuffer</a>(<span class="stringliteral">&quot;normals&quot;</span>, fNormalBuffer);</div>
<div class="line"></div>
<div class="line">                <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_vertex_buffer_array.html">MVertexBufferArray</a> selectionBuffers;</div>
<div class="line">                selectionBuffers.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_vertex_buffer_array.html#acd36fdd49c7d45faff08163ae776c5b2">addBuffer</a>(<span class="stringliteral">&quot;positions&quot;</span>, fPositionBuffer);</div>
<div class="line"></div>
<div class="line">                std::unique_ptr&lt;bool[]&gt; faceStates(<span class="keyword">new</span> <span class="keywordtype">bool</span>[meshGeom-&gt;faceCount]);</div>
<div class="line">                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> faceIdx = 0; faceIdx &lt; meshGeom-&gt;faceCount; faceIdx++)</div>
<div class="line">                {</div>
<div class="line">                    faceStates[faceIdx] = <span class="keyword">false</span>;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">                <span class="keyword">auto</span> range = faceInfo.equal_range(instIdx);</div>
<div class="line">                <span class="keywordflow">for</span> (<span class="keyword">auto</span> it = range.first; it != range.second; it++)</div>
<div class="line">                {</div>
<div class="line">                    <span class="keyword">const</span> <span class="keywordtype">int</span> faceIdx = it-&gt;second;</div>
<div class="line">                    <span class="keywordflow">if</span> (faceIdx != sViewSelectedInstanceMark)</div>
<div class="line">                    {</div>
<div class="line">                        faceStates[faceIdx] = <span class="keyword">true</span>;</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">                <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> numTriangles = 0;</div>
<div class="line">                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> faceIdx = 0; faceIdx &lt; meshGeom-&gt;faceCount; ++faceIdx)</div>
<div class="line">                {</div>
<div class="line">                    <span class="keywordtype">int</span> numVerts = meshGeom-&gt;face_counts[faceIdx];</div>
<div class="line">                    <span class="keywordflow">if</span> (numVerts &gt; 2)</div>
<div class="line">                    {</div>
<div class="line">                        <span class="keywordflow">if</span> (faceStates[faceIdx])</div>
<div class="line">                        {</div>
<div class="line">                            numTriangles += numVerts - 2;</div>
<div class="line">                        }</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">                <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_index_buffer.html">MIndexBuffer</a>* indexBuffer = <span class="keyword">new</span> <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_index_buffer.html">MIndexBuffer</a>(MGeometry::kUnsignedInt32);</div>
<div class="line">                <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>* data = (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>*)indexBuffer-&gt;<a name="a96"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_index_buffer.html#aff9e3c2ed40ad0c0f0fe55668670d071">acquire</a>(numTriangles * 3, <span class="keyword">true</span>);</div>
<div class="line">                <span class="keywordflow">if</span> (data)</div>
<div class="line">                {</div>
<div class="line">                    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> base = 0;</div>
<div class="line">                    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> idx = 0;</div>
<div class="line">                    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> faceIdx = 0; faceIdx &lt; meshGeom-&gt;faceCount; faceIdx++)</div>
<div class="line">                    {</div>
<div class="line">                        <span class="comment">// Ignore degenerate faces</span></div>
<div class="line">                        <span class="keywordtype">int</span> numVerts = meshGeom-&gt;face_counts[faceIdx];</div>
<div class="line">                        <span class="keywordflow">if</span> (numVerts &gt; 2)</div>
<div class="line">                        {</div>
<div class="line">                            <span class="keywordflow">if</span> (faceStates[faceIdx])</div>
<div class="line">                            {</div>
<div class="line">                                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> v = 1; v &lt; numVerts - 1; v++)</div>
<div class="line">                                {</div>
<div class="line">                                    data[idx++] = meshGeom-&gt;face_connects[base];</div>
<div class="line">                                    data[idx++] = meshGeom-&gt;face_connects[base + v];</div>
<div class="line">                                    data[idx++] = meshGeom-&gt;face_connects[base + v + 1];</div>
<div class="line">                                }</div>
<div class="line">                            }</div>
<div class="line">                            base += numVerts;</div>
<div class="line">                        }</div>
<div class="line">                    }</div>
<div class="line"></div>
<div class="line">                    indexBuffer-&gt;<a name="a97"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_index_buffer.html#aafb3736206f8a73c0fc74757919cfb83">commit</a>(data);</div>
<div class="line">                    data = <span class="keyword">nullptr</span>;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">                <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_bounding_box.html">MBoundingBox</a> bounds = fMesh-&gt;boundingBox();</div>
<div class="line">                setGeometryForRenderItem(*viewSelectedShadedItem, shadedBuffers, *indexBuffer, &amp;bounds);</div>
<div class="line">                setGeometryForRenderItem(*viewSelectedTexturedItem, shadedBuffers, *indexBuffer, &amp;bounds);</div>
<div class="line">                setGeometryForRenderItem(*viewSelectedFaceSelectionItem, selectionBuffers, *indexBuffer, &amp;bounds);</div>
<div class="line"></div>
<div class="line">                <span class="comment">// The apiMeshGeom object can be re-created during DG evaluation, thus update the pointer.</span></div>
<div class="line">                apiMeshHWSelectionUserData* userData;</div>
<div class="line">                userData = <span class="keyword">dynamic_cast&lt;</span>apiMeshHWSelectionUserData*<span class="keyword">&gt;</span>(viewSelectedShadedItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#afd8b782f19e9508747c851a990d8f5db">customData</a>());</div>
<div class="line">                <span class="keywordflow">if</span> (userData)</div>
<div class="line">                {</div>
<div class="line">                    userData-&gt;fMeshGeom = meshGeom;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">                userData = <span class="keyword">dynamic_cast&lt;</span>apiMeshHWSelectionUserData*<span class="keyword">&gt;</span>(viewSelectedTexturedItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#afd8b782f19e9508747c851a990d8f5db">customData</a>());</div>
<div class="line">                <span class="keywordflow">if</span> (userData)</div>
<div class="line">                {</div>
<div class="line">                    userData-&gt;fMeshGeom = meshGeom;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">                userData = <span class="keyword">dynamic_cast&lt;</span>apiMeshHWSelectionUserData*<span class="keyword">&gt;</span>(viewSelectedFaceSelectionItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#afd8b782f19e9508747c851a990d8f5db">customData</a>());</div>
<div class="line">                <span class="keywordflow">if</span> (userData)</div>
<div class="line">                {</div>
<div class="line">                    userData-&gt;fMeshGeom = meshGeom;</div>
<div class="line">                    userData-&gt;fFaceViewSelectedStates = std::move(faceStates);</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> apiMeshSubSceneOverride::rebuildGeometryBuffers()</div>
<div class="line">{</div>
<div class="line">    _OPENMAYA_DEPRECATION_PUSH_AND_DISABLE_WARNING</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_renderer.html">MHWRender::MRenderer</a>* renderer = <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_renderer.html#a4678a72ac6959ed21d422d27928d0343">MHWRender::MRenderer::theRenderer</a>();</div>
<div class="line">    _OPENMAYA_POP_WARNING</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (sDrawAPI == MHWRender::kNone)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (renderer)</div>
<div class="line">        {</div>
<div class="line">            sDrawAPI = renderer-&gt;drawAPI();</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Preamble</span></div>
<div class="line">    <span class="keyword">using namespace </span><a class="code" href="#!/url=./cpp_ref/namespace_m_h_w_render.html">MHWRender</a>;</div>
<div class="line">    apiMeshGeom* meshGeom = fMesh-&gt;meshGeomToUse();</div>
<div class="line">    <span class="keywordflow">if</span> (!meshGeom) <span class="keywordflow">return</span>;</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_bounding_box.html">MBoundingBox</a> bounds = fMesh-&gt;boundingBox();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Clear old</span></div>
<div class="line">    deleteGeometryBuffers();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Compute mesh data size</span></div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> numTriangles = 0;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> totalVerts = 0;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;meshGeom-&gt;faceCount; i++)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordtype">int</span> numVerts = meshGeom-&gt;face_counts[i];</div>
<div class="line">        <span class="keywordflow">if</span> (numVerts &gt; 2)</div>
<div class="line">        {</div>
<div class="line">            numTriangles += numVerts - 2;</div>
<div class="line">            totalVerts += numVerts;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (numTriangles == 0 || totalVerts == 0)</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Acquire vertex buffer resources</span></div>
<div class="line">    <span class="keyword">const</span> <a name="_a98"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_vertex_buffer_descriptor.html">MVertexBufferDescriptor</a> posDesc(<span class="stringliteral">&quot;&quot;</span>, MGeometry::kPosition, MGeometry::kFloat, 3);</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_vertex_buffer_descriptor.html">MVertexBufferDescriptor</a> normalDesc(<span class="stringliteral">&quot;&quot;</span>, MGeometry::kNormal, MGeometry::kFloat, 3);</div>
<div class="line">    fPositionBuffer = <span class="keyword">new</span> <a name="_a99"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_vertex_buffer.html">MVertexBuffer</a>(posDesc);</div>
<div class="line">    fNormalBuffer = <span class="keyword">new</span> <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_vertex_buffer.html">MVertexBuffer</a>(normalDesc);</div>
<div class="line">    fBoxPositionBuffer = <span class="keyword">new</span> <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_vertex_buffer.html">MVertexBuffer</a>(posDesc);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Generating a compact position buffer will reduce the data size transferred to the</span></div>
<div class="line">    <span class="comment">// video card by leveraging the index buffer capabilities. It will also help with</span></div>
<div class="line">    <span class="comment">// component selection since the vertex ID from the hit record will match one to one with</span></div>
<div class="line">    <span class="comment">// the position in the vertices array.</span></div>
<div class="line">    <span class="keywordtype">float</span>* positions = (<span class="keywordtype">float</span>*)fPositionBuffer-&gt;acquire(meshGeom-&gt;vertices.length(), <span class="keyword">true</span>);</div>
<div class="line">    <span class="keywordtype">float</span>* normals = (<span class="keywordtype">float</span>*)fNormalBuffer-&gt;acquire(meshGeom-&gt;vertices.length(), <span class="keyword">true</span>);</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">float</span>* boxPositions = NULL;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>* boxIndices = NULL;</div>
<div class="line">    <span class="keywordflow">if</span> (sUseCustomUserBuffersForBoundingBox)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Just for demo of custom user buffers make box custom</span></div>
<div class="line">        <span class="keyword">static</span> <span class="keywordtype">float</span> sBoxPositions[8*3];</div>
<div class="line">        <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> sBoxIndices[24];</div>
<div class="line">        boxPositions = sBoxPositions;</div>
<div class="line">        boxIndices = sBoxIndices;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        boxPositions = (<span class="keywordtype">float</span>*)fBoxPositionBuffer-&gt;acquire(8, <span class="keyword">true</span>);</div>
<div class="line">        boxIndices = (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>*)fBoxIndexBuffer-&gt;acquire(24, <span class="keyword">true</span>);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Acquire index buffer resources</span></div>
<div class="line">    fWireIndexBuffer = <span class="keyword">new</span> <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_index_buffer.html">MIndexBuffer</a>(MGeometry::kUnsignedInt32);</div>
<div class="line">    fBoxIndexBuffer = <span class="keyword">new</span> <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_index_buffer.html">MIndexBuffer</a>(MGeometry::kUnsignedInt16);</div>
<div class="line">    fShadedIndexBuffer = <span class="keyword">new</span> <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_index_buffer.html">MIndexBuffer</a>(MGeometry::kUnsignedInt32);</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>* wireBuffer = (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>*)fWireIndexBuffer-&gt;acquire(2*totalVerts, <span class="keyword">true</span>);</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>* shadedBuffer = (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>*)fShadedIndexBuffer-&gt;acquire(3*numTriangles, <span class="keyword">true</span>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Sanity check</span></div>
<div class="line">    <span class="keywordflow">if</span> (!positions || !boxPositions || !normals || !wireBuffer || !boxIndices || !shadedBuffer)</div>
<div class="line">    {</div>
<div class="line">        deleteGeometryBuffers();</div>
<div class="line">        <span class="keywordflow">return</span>; <span class="comment">// FAIL</span></div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Fill vertex data for shaded/wireframe</span></div>
<div class="line">    <span class="keywordtype">int</span> vid = 0;</div>
<div class="line">    <span class="keywordtype">int</span> pid = 0;</div>
<div class="line">    <span class="keywordtype">int</span> nid = 0;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;meshGeom-&gt;vertices.length(); i++)</div>
<div class="line">    {</div>
<div class="line">        <a name="_a100"></a><a class="code" href="#!/url=./cpp_ref/class_m_point.html">MPoint</a> position = meshGeom-&gt;vertices[i];</div>
<div class="line">        positions[pid++] = (float)position[0];</div>
<div class="line">        positions[pid++] = (float)position[1];</div>
<div class="line">        positions[pid++] = (float)position[2];</div>
<div class="line"></div>
<div class="line">        <a name="_a101"></a><a class="code" href="#!/url=./cpp_ref/class_m_vector.html">MVector</a> normal = meshGeom-&gt;normals[i];</div>
<div class="line">        normals[nid++] = (float)normal[0];</div>
<div class="line">        normals[nid++] = (float)normal[1];</div>
<div class="line">        normals[nid++] = (float)normal[2];</div>
<div class="line">    }</div>
<div class="line">    fPositionBuffer-&gt;commit(positions); positions = NULL;</div>
<div class="line">    fNormalBuffer-&gt;commit(normals); normals = NULL;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Fill vertex and index data for bounding box</span></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_point.html">MPoint</a> bbmin = bounds.<a name="a102"></a><a class="code" href="#!/url=./cpp_ref/class_m_bounding_box.html#afb3213b98f3a6b4bda9759511e9b79a1">min</a>();</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_point.html">MPoint</a> bbmax = bounds.<a name="a103"></a><a class="code" href="#!/url=./cpp_ref/class_m_bounding_box.html#a1dfdbea9d5560e4aa09d34bdbd82480c">max</a>();</div>
<div class="line">    boxPositions[0]  = (float)bbmin.<a name="a104"></a><a class="code" href="#!/url=./cpp_ref/class_m_point.html#af88b946fb90d5f08b5fb740c70e98c10">x</a>; boxPositions[1]  = (<span class="keywordtype">float</span>)bbmin.<a name="a105"></a><a class="code" href="#!/url=./cpp_ref/class_m_point.html#ab927965981178aa1fba979a37168db2a">y</a>; boxPositions[2]  = (float)bbmin.<a name="a106"></a><a class="code" href="#!/url=./cpp_ref/class_m_point.html#ab3e6ed577a7c669c19de1f9c1b46c872">z</a>;</div>
<div class="line">    boxPositions[3]  = (<span class="keywordtype">float</span>)bbmin.<a class="code" href="#!/url=./cpp_ref/class_m_point.html#af88b946fb90d5f08b5fb740c70e98c10">x</a>; boxPositions[4]  = (float)bbmin.<a class="code" href="#!/url=./cpp_ref/class_m_point.html#ab927965981178aa1fba979a37168db2a">y</a>; boxPositions[5]  = (<span class="keywordtype">float</span>)bbmax.<a class="code" href="#!/url=./cpp_ref/class_m_point.html#ab3e6ed577a7c669c19de1f9c1b46c872">z</a>;</div>
<div class="line">    boxPositions[6]  = (float)bbmax.<a class="code" href="#!/url=./cpp_ref/class_m_point.html#af88b946fb90d5f08b5fb740c70e98c10">x</a>; boxPositions[7]  = (<span class="keywordtype">float</span>)bbmin.<a class="code" href="#!/url=./cpp_ref/class_m_point.html#ab927965981178aa1fba979a37168db2a">y</a>; boxPositions[8]  = (float)bbmax.<a class="code" href="#!/url=./cpp_ref/class_m_point.html#ab3e6ed577a7c669c19de1f9c1b46c872">z</a>;</div>
<div class="line">    boxPositions[9]  = (<span class="keywordtype">float</span>)bbmax.<a class="code" href="#!/url=./cpp_ref/class_m_point.html#af88b946fb90d5f08b5fb740c70e98c10">x</a>; boxPositions[10] = (float)bbmin.<a class="code" href="#!/url=./cpp_ref/class_m_point.html#ab927965981178aa1fba979a37168db2a">y</a>; boxPositions[11] = (<span class="keywordtype">float</span>)bbmin.<a class="code" href="#!/url=./cpp_ref/class_m_point.html#ab3e6ed577a7c669c19de1f9c1b46c872">z</a>;</div>
<div class="line">    boxPositions[12] = (float)bbmin.<a class="code" href="#!/url=./cpp_ref/class_m_point.html#af88b946fb90d5f08b5fb740c70e98c10">x</a>; boxPositions[13] = (<span class="keywordtype">float</span>)bbmax.<a class="code" href="#!/url=./cpp_ref/class_m_point.html#ab927965981178aa1fba979a37168db2a">y</a>; boxPositions[14] = (float)bbmin.<a class="code" href="#!/url=./cpp_ref/class_m_point.html#ab3e6ed577a7c669c19de1f9c1b46c872">z</a>;</div>
<div class="line">    boxPositions[15] = (<span class="keywordtype">float</span>)bbmin.<a class="code" href="#!/url=./cpp_ref/class_m_point.html#af88b946fb90d5f08b5fb740c70e98c10">x</a>; boxPositions[16] = (float)bbmax.<a class="code" href="#!/url=./cpp_ref/class_m_point.html#ab927965981178aa1fba979a37168db2a">y</a>; boxPositions[17] = (<span class="keywordtype">float</span>)bbmax.<a class="code" href="#!/url=./cpp_ref/class_m_point.html#ab3e6ed577a7c669c19de1f9c1b46c872">z</a>;</div>
<div class="line">    boxPositions[18] = (float)bbmax.<a class="code" href="#!/url=./cpp_ref/class_m_point.html#af88b946fb90d5f08b5fb740c70e98c10">x</a>; boxPositions[19] = (<span class="keywordtype">float</span>)bbmax.<a class="code" href="#!/url=./cpp_ref/class_m_point.html#ab927965981178aa1fba979a37168db2a">y</a>; boxPositions[20] = (float)bbmax.<a class="code" href="#!/url=./cpp_ref/class_m_point.html#ab3e6ed577a7c669c19de1f9c1b46c872">z</a>;</div>
<div class="line">    boxPositions[21] = (<span class="keywordtype">float</span>)bbmax.<a class="code" href="#!/url=./cpp_ref/class_m_point.html#af88b946fb90d5f08b5fb740c70e98c10">x</a>; boxPositions[22] = (float)bbmax.<a class="code" href="#!/url=./cpp_ref/class_m_point.html#ab927965981178aa1fba979a37168db2a">y</a>; boxPositions[23] = (<span class="keywordtype">float</span>)bbmin.<a class="code" href="#!/url=./cpp_ref/class_m_point.html#ab3e6ed577a7c669c19de1f9c1b46c872">z</a>;</div>
<div class="line">    boxIndices[0]  = 0; boxIndices[1]  = 1;</div>
<div class="line">    boxIndices[2]  = 1; boxIndices[3]  = 2;</div>
<div class="line">    boxIndices[4]  = 2; boxIndices[5]  = 3;</div>
<div class="line">    boxIndices[6]  = 3; boxIndices[7]  = 0;</div>
<div class="line">    boxIndices[8]  = 4; boxIndices[9]  = 5;</div>
<div class="line">    boxIndices[10] = 5; boxIndices[11] = 6;</div>
<div class="line">    boxIndices[12] = 6; boxIndices[13] = 7;</div>
<div class="line">    boxIndices[14] = 7; boxIndices[15] = 4;</div>
<div class="line">    boxIndices[16] = 0; boxIndices[17] = 4;</div>
<div class="line">    boxIndices[18] = 1; boxIndices[19] = 5;</div>
<div class="line">    boxIndices[20] = 2; boxIndices[21] = 6;</div>
<div class="line">    boxIndices[22] = 3; boxIndices[23] = 7;</div>
<div class="line">    <span class="keywordflow">if</span> (sUseCustomUserBuffersForBoundingBox)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (sDrawAPI == MHWRender::kOpenGL ||</div>
<div class="line">            sDrawAPI == MHWRender::kOpenGLCoreProfile)</div>
<div class="line">        {       </div>
<div class="line">            <span class="keyword">static</span> <a name="_a107"></a><a class="code" href="#!/url=./cpp_ref/class_m_g_l_function_table.html">MGLFunctionTable</a>* gGLFT = NULL;</div>
<div class="line"></div>
<div class="line">            _OPENMAYA_DEPRECATION_PUSH_AND_DISABLE_WARNING</div>
<div class="line">            <a name="_a108"></a><a class="code" href="#!/url=./cpp_ref/class_m_hardware_renderer.html">MHardwareRenderer</a>* pRenderer = <a name="a109"></a><a class="code" href="#!/url=./cpp_ref/class_m_hardware_renderer.html#a93fef222f7278c123e8df750f7f0ea5b">MHardwareRenderer::theRenderer</a>();</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> (!gGLFT &amp;&amp; pRenderer)</div>
<div class="line">            {</div>
<div class="line">                gGLFT = pRenderer-&gt;glFunctionTable();</div>
<div class="line">            }</div>
<div class="line">            _OPENMAYA_POP_WARNING</div>
<div class="line">            <span class="keywordflow">if</span> (gGLFT)</div>
<div class="line">            {</div>
<div class="line">                gGLFT-&gt;<a name="a110"></a>glGenBuffersARB(1, &amp;fBoxPositionBufferId);</div>
<div class="line">                <span class="keywordflow">if</span> (fBoxPositionBufferId != 0)</div>
<div class="line">                {</div>
<div class="line">                    gGLFT-&gt;<a name="a111"></a>glBindBufferARB(MGL_ARRAY_BUFFER_ARB, fBoxPositionBufferId);</div>
<div class="line">                    gGLFT-&gt;<a name="a112"></a>glBufferDataARB(MGL_ARRAY_BUFFER_ARB, 8*3*<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>), boxPositions, MGL_STATIC_DRAW_ARB);</div>
<div class="line">                    gGLFT-&gt;glBindBufferARB(MGL_ARRAY_BUFFER_ARB, 0);</div>
<div class="line">                    fBoxPositionBuffer-&gt;resourceHandle(&amp;fBoxPositionBufferId, 8*3);</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">                gGLFT-&gt;glGenBuffersARB(1, &amp;fBoxIndexBufferId);</div>
<div class="line">                <span class="keywordflow">if</span> (fBoxIndexBufferId != 0)</div>
<div class="line">                {</div>
<div class="line">                    gGLFT-&gt;glBindBufferARB(MGL_ELEMENT_ARRAY_BUFFER_ARB, fBoxIndexBufferId);</div>
<div class="line">                    gGLFT-&gt;glBufferDataARB(MGL_ELEMENT_ARRAY_BUFFER_ARB, 24*<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>), boxIndices, MGL_STATIC_DRAW_ARB);</div>
<div class="line">                    gGLFT-&gt;glBindBufferARB(MGL_ELEMENT_ARRAY_BUFFER_ARB, 0);</div>
<div class="line">                    fBoxIndexBuffer-&gt;resourceHandle(&amp;fBoxIndexBufferId, 24);</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"><span class="preprocessor">#ifdef _WINDOWS</span></div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sDrawAPI == MHWRender::kDirectX11)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">if</span> (renderer)</div>
<div class="line">            {</div>
<div class="line">                ID3D11Device* pDevice = (ID3D11Device*)renderer-&gt;GPUDeviceHandle();</div>
<div class="line"></div>
<div class="line">                <span class="comment">// Fill in a buffer description.</span></div>
<div class="line">                D3D11_BUFFER_DESC bufferDesc;</div>
<div class="line">                bufferDesc.Usage            = D3D11_USAGE_DEFAULT;</div>
<div class="line">                bufferDesc.ByteWidth        = <span class="keyword">sizeof</span>(float) * 3 * 8;</div>
<div class="line">                bufferDesc.BindFlags        = D3D11_BIND_VERTEX_BUFFER;</div>
<div class="line">                bufferDesc.CPUAccessFlags   = 0;</div>
<div class="line">                bufferDesc.MiscFlags        = 0;</div>
<div class="line"></div>
<div class="line">                <span class="comment">// Fill in the sub-resource data.</span></div>
<div class="line">                D3D11_SUBRESOURCE_DATA InitData;</div>
<div class="line">                InitData.pSysMem = boxPositions;</div>
<div class="line">                InitData.SysMemPitch = 0;</div>
<div class="line">                InitData.SysMemSlicePitch = 0;</div>
<div class="line">                </div>
<div class="line">                <span class="keywordflow">if</span> (pDevice)</div>
<div class="line">                {</div>
<div class="line">                    pDevice-&gt;CreateBuffer( &amp;bufferDesc, &amp;InitData, &amp;fBoxPositionBufferDX );</div>
<div class="line">                    <span class="keywordflow">if</span> (fBoxPositionBufferDX)</div>
<div class="line">                        fBoxPositionBuffer-&gt;resourceHandle((<span class="keywordtype">void</span>*)fBoxPositionBufferDX, 8*3);</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">                <span class="comment">// Index buffer</span></div>
<div class="line">                bufferDesc.ByteWidth = <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> short) * 24;</div>
<div class="line">                bufferDesc.BindFlags = D3D11_BIND_INDEX_BUFFER;</div>
<div class="line">                InitData.pSysMem = boxIndices;</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">if</span> (pDevice)</div>
<div class="line">                {</div>
<div class="line">                    pDevice-&gt;CreateBuffer( &amp;bufferDesc, &amp;InitData, &amp;fBoxIndexBufferDX);</div>
<div class="line">                    <span class="keywordflow">if</span> (fBoxIndexBufferDX)</div>
<div class="line">                        fBoxIndexBuffer-&gt;resourceHandle((<span class="keywordtype">void</span>*)fBoxIndexBufferDX, 24);</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        fBoxPositionBuffer-&gt;commit(boxPositions);</div>
<div class="line">        fBoxIndexBuffer-&gt;commit(boxIndices);</div>
<div class="line">    }</div>
<div class="line">    boxPositions = NULL;</div>
<div class="line">    boxIndices = NULL;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Fill index data for wireframe</span></div>
<div class="line">    vid = 0;</div>
<div class="line">    <span class="keywordtype">int</span> first = 0;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> idx = 0;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> faceIdx=0; faceIdx&lt;meshGeom-&gt;faceCount; faceIdx++)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// ignore degenerate faces</span></div>
<div class="line">        <span class="keywordtype">int</span> numVerts = meshGeom-&gt;face_counts[faceIdx];</div>
<div class="line">        <span class="keywordflow">if</span> (numVerts &gt; 2)</div>
<div class="line">        {</div>
<div class="line">            first = vid;</div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> v=0; v&lt;numVerts-1; v++)</div>
<div class="line">            {</div>
<div class="line">                wireBuffer[idx++] = meshGeom-&gt;face_connects[vid++];</div>
<div class="line">                wireBuffer[idx++] = meshGeom-&gt;face_connects[vid];</div>
<div class="line">            }</div>
<div class="line">            wireBuffer[idx++] = meshGeom-&gt;face_connects[vid++];</div>
<div class="line">            wireBuffer[idx++] = meshGeom-&gt;face_connects[first];</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            vid += numVerts;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    fWireIndexBuffer-&gt;commit(wireBuffer); wireBuffer = NULL;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Fill index data for shaded</span></div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> base = 0;</div>
<div class="line">    idx = 0;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> faceIdx=0; faceIdx&lt;meshGeom-&gt;faceCount; faceIdx++)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Ignore degenerate faces</span></div>
<div class="line">        <span class="keywordtype">int</span> numVerts = meshGeom-&gt;face_counts[faceIdx];</div>
<div class="line">        <span class="keywordflow">if</span> (numVerts &gt; 2)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> v=1; v&lt;numVerts-1; v++)</div>
<div class="line">            {</div>
<div class="line">                shadedBuffer[idx++] = meshGeom-&gt;face_connects[base];</div>
<div class="line">                shadedBuffer[idx++] = meshGeom-&gt;face_connects[base+v];</div>
<div class="line">                shadedBuffer[idx++] = meshGeom-&gt;face_connects[base+v+1];</div>
<div class="line">            }</div>
<div class="line">            base += numVerts;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    fShadedIndexBuffer-&gt;commit(shadedBuffer); shadedBuffer = NULL;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> apiMeshSubSceneOverride::rebuildActiveComponentIndexBuffers()</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Preamble</span></div>
<div class="line">    <span class="keyword">using namespace </span><a class="code" href="#!/url=./cpp_ref/namespace_m_h_w_render.html">MHWRender</a>;</div>
<div class="line">    apiMeshGeom* meshGeom = fMesh-&gt;meshGeomToUse();</div>
<div class="line">    <span class="keywordflow">if</span> (!meshGeom) <span class="keywordflow">return</span>;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Clear old</span></div>
<div class="line">    deleteActiveComponentIndexBuffers();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Acquire and fill index buffer for active vertices</span></div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> numActiveVertices = fActiveVerticesSet.size();</div>
<div class="line">    <span class="keywordflow">if</span> (numActiveVertices &gt; 0)</div>
<div class="line">    {</div>
<div class="line">        fActiveVerticesIndexBuffer = <span class="keyword">new</span> <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_index_buffer.html">MIndexBuffer</a>(MGeometry::kUnsignedInt32);</div>
<div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>* activeVerticesBuffer = (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>*)fActiveVerticesIndexBuffer-&gt;acquire(numActiveVertices, <span class="keyword">true</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (activeVerticesBuffer) {</div>
<div class="line">            <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> idx = 0;</div>
<div class="line">            std::set&lt;int&gt;::const_iterator it = fActiveVerticesSet.begin();</div>
<div class="line">            std::set&lt;int&gt;::const_iterator itEnd = fActiveVerticesSet.end();</div>
<div class="line">            <span class="keywordflow">for</span>(; it != itEnd; ++it)</div>
<div class="line">                activeVerticesBuffer[idx++] = *it;</div>
<div class="line"></div>
<div class="line">            fActiveVerticesIndexBuffer-&gt;commit(activeVerticesBuffer);</div>
<div class="line">            activeVerticesBuffer = NULL;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Acquire and fill index buffer for active edges</span></div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> numActiveEdges = fActiveEdgesSet.size();</div>
<div class="line">    <span class="keywordflow">if</span> (numActiveEdges &gt; 0)</div>
<div class="line">    {</div>
<div class="line">        fActiveEdgesIndexBuffer = <span class="keyword">new</span> <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_index_buffer.html">MIndexBuffer</a>(MGeometry::kUnsignedInt32);</div>
<div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>* activeEdgesBuffer = (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>*)fActiveEdgesIndexBuffer-&gt;acquire(2*numActiveEdges, <span class="keyword">true</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (activeEdgesBuffer) {</div>
<div class="line">            <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> eid = 0;</div>
<div class="line">            <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> first = 0;</div>
<div class="line">            <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vid = 0;</div>
<div class="line">            <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> idx = 0;</div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;meshGeom-&gt;faceCount; ++i)</div>
<div class="line">            {</div>
<div class="line">                <span class="comment">// Ignore degenerate faces</span></div>
<div class="line">                <span class="keywordtype">int</span> numVerts = meshGeom-&gt;face_counts[i];</div>
<div class="line">                <span class="keywordflow">if</span> (numVerts &gt; 2)</div>
<div class="line">                {</div>
<div class="line">                    first = vid;</div>
<div class="line">                    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> v=0; v&lt;numVerts-1; ++v)</div>
<div class="line">                    {</div>
<div class="line">                        <span class="keywordflow">if</span> (fActiveEdgesSet.count(eid) &gt; 0)</div>
<div class="line">                        {</div>
<div class="line">                            activeEdgesBuffer[idx++] = meshGeom-&gt;face_connects[vid];</div>
<div class="line">                            activeEdgesBuffer[idx++] = meshGeom-&gt;face_connects[vid + 1];</div>
<div class="line">                        }</div>
<div class="line">                        ++vid;</div>
<div class="line">                        ++eid;</div>
<div class="line">                    }</div>
<div class="line"></div>
<div class="line">                    <span class="keywordflow">if</span> (fActiveEdgesSet.count(eid) &gt; 0)</div>
<div class="line">                    {</div>
<div class="line">                        activeEdgesBuffer[idx++] = meshGeom-&gt;face_connects[vid];</div>
<div class="line">                        activeEdgesBuffer[idx++] = meshGeom-&gt;face_connects[first];</div>
<div class="line">                    }</div>
<div class="line">                    ++vid;</div>
<div class="line">                    ++eid;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">else</span> {</div>
<div class="line">                    vid += numVerts;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            fActiveEdgesIndexBuffer-&gt;commit(activeEdgesBuffer);</div>
<div class="line">            activeEdgesBuffer = NULL;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Acquire and fill index buffer for active faces</span></div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> numActiveFaces = fActiveFacesSet.size();</div>
<div class="line">    <span class="keywordflow">if</span> (numActiveFaces &gt; 0)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> numActiveFacesTriangles = 0;</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;meshGeom-&gt;faceCount; ++i)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">if</span> (fActiveFacesSet.count(i) &gt; 0)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordtype">int</span> numVerts = meshGeom-&gt;face_counts[i];</div>
<div class="line">                <span class="keywordflow">if</span> (numVerts &gt; 2)</div>
<div class="line">                    numActiveFacesTriangles += numVerts - 2;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        fActiveFacesIndexBuffer = <span class="keyword">new</span> <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_index_buffer.html">MIndexBuffer</a>(MGeometry::kUnsignedInt32);</div>
<div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>* activeFacesBuffer = (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>*)fActiveFacesIndexBuffer-&gt;acquire(3*numActiveFacesTriangles, <span class="keyword">true</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (activeFacesBuffer)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> idx = 0;</div>
<div class="line">            <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vid = 0;</div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;meshGeom-&gt;faceCount; ++i)</div>
<div class="line">            {</div>
<div class="line">                <span class="comment">// Ignore degenerate faces</span></div>
<div class="line">                <span class="keywordtype">int</span> numVerts = meshGeom-&gt;face_counts[i];</div>
<div class="line">                <span class="keywordflow">if</span> (numVerts &gt; 2)</div>
<div class="line">                {</div>
<div class="line">                    <span class="keywordflow">if</span> (fActiveFacesSet.count(i) &gt; 0)</div>
<div class="line">                    {</div>
<div class="line">                        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> v=1; v&lt;numVerts-1; ++v)</div>
<div class="line">                        {</div>
<div class="line">                            activeFacesBuffer[idx++] = meshGeom-&gt;face_connects[vid];</div>
<div class="line">                            activeFacesBuffer[idx++] = meshGeom-&gt;face_connects[vid+v];</div>
<div class="line">                            activeFacesBuffer[idx++] = meshGeom-&gt;face_connects[vid+v+1];</div>
<div class="line">                        }</div>
<div class="line">                    }</div>
<div class="line">                    vid += numVerts;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            fActiveFacesIndexBuffer-&gt;commit(activeFacesBuffer);</div>
<div class="line">            activeFacesBuffer = NULL;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> apiMeshSubSceneOverride::deleteBuffers()</div>
<div class="line">{</div>
<div class="line">    deleteGeometryBuffers();</div>
<div class="line">    deleteActiveComponentIndexBuffers();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> apiMeshSubSceneOverride::deleteGeometryBuffers()</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">delete</span> fPositionBuffer; fPositionBuffer = NULL;</div>
<div class="line">    <span class="keyword">delete</span> fNormalBuffer; fNormalBuffer = NULL;</div>
<div class="line">    <span class="keyword">delete</span> fBoxPositionBuffer; fBoxPositionBuffer = NULL;</div>
<div class="line">    <span class="keyword">delete</span> fWireIndexBuffer; fWireIndexBuffer = NULL;</div>
<div class="line">    <span class="keyword">delete</span> fBoxIndexBuffer; fBoxIndexBuffer = NULL;</div>
<div class="line">    <span class="keyword">delete</span> fShadedIndexBuffer; fShadedIndexBuffer = NULL;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Delete client buffers</span></div>
<div class="line">    <span class="keywordflow">if</span> (sUseCustomUserBuffersForBoundingBox)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (sDrawAPI == MHWRender::kOpenGL ||</div>
<div class="line">            sDrawAPI == MHWRender::kOpenGLCoreProfile)</div>
<div class="line">        {</div>
<div class="line">            <span class="keyword">static</span> <a class="code" href="#!/url=./cpp_ref/class_m_g_l_function_table.html">MGLFunctionTable</a>* gGLFT = NULL;</div>
<div class="line"></div>
<div class="line">            _OPENMAYA_DEPRECATION_PUSH_AND_DISABLE_WARNING</div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m_hardware_renderer.html">MHardwareRenderer</a>* pRenderer = <a class="code" href="#!/url=./cpp_ref/class_m_hardware_renderer.html#a93fef222f7278c123e8df750f7f0ea5b">MHardwareRenderer::theRenderer</a>();</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> (pRenderer &amp;&amp; !gGLFT)</div>
<div class="line">            {</div>
<div class="line">                gGLFT = pRenderer-&gt;glFunctionTable();</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            _OPENMAYA_POP_WARNING</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> (gGLFT)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">if</span> (fBoxPositionBufferId != 0)</div>
<div class="line">                {</div>
<div class="line">                    gGLFT-&gt;<a name="a113"></a>glDeleteBuffersARB(1, &amp;fBoxPositionBufferId);</div>
<div class="line">                    fBoxPositionBufferId = 0;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">if</span> (fBoxIndexBufferId != 0)</div>
<div class="line">                {</div>
<div class="line">                    gGLFT-&gt;glDeleteBuffersARB(1, &amp;fBoxIndexBufferId);</div>
<div class="line">                    fBoxIndexBufferId = 0;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"><span class="preprocessor">#ifdef _WINDOWS</span></div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sDrawAPI == MHWRender::kDirectX11)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">if</span> (NULL != fBoxPositionBufferDX)</div>
<div class="line">            {</div>
<div class="line">                fBoxPositionBufferDX-&gt;Release();</div>
<div class="line">                fBoxPositionBufferDX = NULL;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">if</span> (NULL != fBoxIndexBufferDX)</div>
<div class="line">            {</div>
<div class="line">                fBoxIndexBufferDX-&gt;Release();</div>
<div class="line">                fBoxIndexBufferDX = NULL;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> apiMeshSubSceneOverride::deleteActiveComponentIndexBuffers()</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">delete</span> fActiveVerticesIndexBuffer; fActiveVerticesIndexBuffer = NULL;</div>
<div class="line">    <span class="keyword">delete</span> fActiveEdgesIndexBuffer; fActiveEdgesIndexBuffer = NULL;</div>
<div class="line">    <span class="keyword">delete</span> fActiveFacesIndexBuffer; fActiveFacesIndexBuffer = NULL;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment">    This is method is called during the pre-filtering phase of the viewport 2.0 selection</span></div>
<div class="line"><span class="comment">    and is used to setup the selection context of the given DAG object.</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">    We want the whole shape to be selectable, so we set the selection level to kObject so that the shape</span></div>
<div class="line"><span class="comment">    will be processed by the selection.</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">    In case we are currently in component selection mode (vertex, edge or face),</span></div>
<div class="line"><span class="comment">    since we have created render items that can be use in the selection phase (kSelectionOnly draw mode)</span></div>
<div class="line"><span class="comment">    and we also registered component converters to handle this render items,</span></div>
<div class="line"><span class="comment">    we can set the selection level to kComponent so that the shape will also be processed by the selection.</span></div>
<div class="line"><span class="comment">*/</span></div>
<div class="line"><span class="keywordtype">void</span> apiMeshSubSceneOverride::updateSelectionGranularity(</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_dag_path.html">MDagPath</a>&amp; path,</div>
<div class="line">    <a name="_a114"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_selection_context.html">MHWRender::MSelectionContext</a>&amp; selectionContext)</div>
<div class="line">{</div>
<div class="line">    MHWRender::DisplayStatus displayStatus = <a name="a115"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_geometry_utilities.html#aa2838b92c9f7db4a810690a986199134">MHWRender::MGeometryUtilities::displayStatus</a>(path);</div>
<div class="line">    <span class="keywordflow">if</span>(displayStatus == MHWRender::kHilite)</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="#!/url=./cpp_ref/class_m_selection_mask.html">MSelectionMask</a> globalComponentMask = <a name="a116"></a><a class="code" href="#!/url=./cpp_ref/class_m_global.html#a2166afd9d082dd5952bcd361f0a3abb5">MGlobal::selectionMode</a>() == MGlobal::kSelectComponentMode ? <a name="a117"></a><a class="code" href="#!/url=./cpp_ref/class_m_global.html#a1da385dcfc2718a595d4d008c56e7dc6">MGlobal::componentSelectionMask</a>() : <a name="_a118"></a><a class="code" href="#!/url=./cpp_ref/class_m_global.html">MGlobal</a>::objectSelectionMask();</div>
<div class="line">        <a class="code" href="#!/url=./cpp_ref/class_m_selection_mask.html">MSelectionMask</a> supportedComponents(MSelectionMask::kSelectMeshVerts);</div>
<div class="line">        supportedComponents.addMask(MSelectionMask::kSelectMeshEdges);</div>
<div class="line">        supportedComponents.addMask(MSelectionMask::kSelectMeshFaces);</div>
<div class="line">        supportedComponents.addMask(MSelectionMask::kSelectPointsForGravity);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span>(globalComponentMask.<a name="a119"></a>intersects(supportedComponents))</div>
<div class="line">        {</div>
<div class="line">            selectionContext.<a name="a120"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_selection_context.html#ab1ead3c2bb71ebaaaa7b94b8a1dcaa3b">setSelectionLevel</a>(MHWRender::MSelectionContext::kComponent);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pointSnappingActive())</div>
<div class="line">    {</div>
<div class="line">        selectionContext.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_selection_context.html#ab1ead3c2bb71ebaaaa7b94b8a1dcaa3b">setSelectionLevel</a>(MHWRender::MSelectionContext::kComponent);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">bool</span> apiMeshSubSceneOverride::hasUIDrawables()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">bool</span> apiMeshSubSceneOverride::areUIDrawablesDirty()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">    <span class="comment">// For performance, the UI drawables should be updated only when required.</span></div>
<div class="line">    <span class="keywordflow">return</span> fAreUIDrawablesDirty;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> apiMeshSubSceneOverride::addUIDrawables(</div>
<div class="line">    <a name="_a121"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_u_i_draw_manager.html">MHWRender::MUIDrawManager</a>&amp; drawManager,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_frame_context.html">MHWRender::MFrameContext</a>&amp; frameContext)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Draw a text &quot;subSceneUIDraw&quot;</span></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_point.html">MPoint</a> pos( 0.0, 0.0, 0.0 ); <span class="comment">// Position of the text</span></div>
<div class="line">    <a name="_a122"></a><a class="code" href="#!/url=./cpp_ref/class_m_color.html">MColor</a> textColor( 0.1f, 0.8f, 0.8f, 1.0f ); <span class="comment">// Text color</span></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> text(<span class="stringliteral">&quot;subSceneUIDraw&quot;</span>);</div>
<div class="line"></div>
<div class="line">    drawManager.<a name="a123"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_u_i_draw_manager.html#a9008ebfa63c02670625076230d77c3f9">beginDrawable</a>();</div>
<div class="line"></div>
<div class="line">    drawManager.<a name="a124"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_u_i_draw_manager.html#a9baede3e37abe9551e50a8c6be65ec4d">setColor</a>( textColor );</div>
<div class="line">    drawManager.<a name="a125"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_u_i_draw_manager.html#adfd0cfdd2cc781dba3987f64cb638a67">setFontSize</a>( MHWRender::MUIDrawManager::kSmallFontSize );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// MUIDrawManager assumes the object space of the original instance. If there</span></div>
<div class="line">    <span class="comment">// are multiple instances, each text needs to be drawn in the origin of each</span></div>
<div class="line">    <span class="comment">// instance, so we need to transform the coordinates from each instance&#39;s</span></div>
<div class="line">    <span class="comment">// object space to the original instance&#39;s object space.</span></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_matrix.html">MMatrix</a> worldInverse0 = fInstance0Transform.<a name="a126"></a><a class="code" href="#!/url=./cpp_ref/class_m_matrix.html#a8ca5ebc404566e2c4a16d4754772e082">inverse</a>();</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span> it = fInstanceInfoCache.begin(); it != fInstanceInfoCache.end(); it++)</div>
<div class="line">    {</div>
<div class="line">        drawManager.<a name="a127"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_u_i_draw_manager.html#a334e4280e5ddd4653c69f9703b5dd3b4">text</a>((pos * it-&gt;second.fTransform) * worldInverse0,</div>
<div class="line">            text, MHWRender::MUIDrawManager::kCenter);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    drawManager.<a name="a128"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_u_i_draw_manager.html#a78c343c25a05be7e46dd4b7ebab82ff6">endDrawable</a>();</div>
<div class="line"></div>
<div class="line">    fAreUIDrawablesDirty = <span class="keyword">false</span>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">bool</span> apiMeshSubSceneOverride::enableUpdateForSelection()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment">   Register our component converters to the draw registry</span></div>
<div class="line"><span class="comment">   This should be done only once, when the plugin is initialized</span></div>
<div class="line"><span class="comment">*/</span></div>
<div class="line"><a class="code" href="#!/url=./cpp_ref/class_m_status.html">MStatus</a> apiMeshSubSceneOverride::registerComponentConverters()</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_status.html">MStatus</a> status = <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_draw_registry.html#ac76651be69e4645ee8e741049dd183ed">MHWRender::MDrawRegistry::registerComponentConverter</a>(apiMeshSubSceneOverride::sVertexSelectionName, simpleComponentConverter::creatorVertexSelection);</div>
<div class="line">    <span class="keywordflow">if</span>(status) {</div>
<div class="line">        status = <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_draw_registry.html#ac76651be69e4645ee8e741049dd183ed">MHWRender::MDrawRegistry::registerComponentConverter</a>(apiMeshSubSceneOverride::sEdgeSelectionName, simpleComponentConverter::creatorEdgeSelection);</div>
<div class="line">        <span class="keywordflow">if</span>(status) {</div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_draw_registry.html#ac76651be69e4645ee8e741049dd183ed">MHWRender::MDrawRegistry::registerComponentConverter</a>(apiMeshSubSceneOverride::sFaceSelectionName, simpleComponentConverter::creatorFaceSelection);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> status;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment">   Deregister our component converters from the draw registry</span></div>
<div class="line"><span class="comment">   This should be done only once, when the plugin is uninitialized</span></div>
<div class="line"><span class="comment">*/</span></div>
<div class="line"><a class="code" href="#!/url=./cpp_ref/class_m_status.html">MStatus</a> apiMeshSubSceneOverride::deregisterComponentConverters()</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Deregister component converter for isolate select render items</span></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> std::string&amp; key : sViewSelectedFaceSelectionNames)</div>
<div class="line">    {</div>
<div class="line">        <a name="a129"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_draw_registry.html#a56780f99f287625aef1d60eb5c6a0e03">MHWRender::MDrawRegistry::deregisterComponentConverter</a>(key.c_str());</div>
<div class="line">    }</div>
<div class="line">    sViewSelectedFaceSelectionNames.<a name="a130"></a><a class="code" href="#!/url=./cpp_ref/class_m_status.html#ac8bb3912a3ce86b15842e79d0b421204">clear</a>();</div>
<div class="line"></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_status.html">MStatus</a> status = <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_draw_registry.html#a56780f99f287625aef1d60eb5c6a0e03">MHWRender::MDrawRegistry::deregisterComponentConverter</a>(apiMeshSubSceneOverride::sVertexSelectionName);</div>
<div class="line">    <span class="keywordflow">if</span>(status) {</div>
<div class="line">        status = <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_draw_registry.html#a56780f99f287625aef1d60eb5c6a0e03">MHWRender::MDrawRegistry::deregisterComponentConverter</a>(apiMeshSubSceneOverride::sEdgeSelectionName);</div>
<div class="line">        <span class="keywordflow">if</span>(status) {</div>
<div class="line">            status = <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_draw_registry.html#a56780f99f287625aef1d60eb5c6a0e03">MHWRender::MDrawRegistry::deregisterComponentConverter</a>(apiMeshSubSceneOverride::sFaceSelectionName);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> status;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">bool</span> apiMeshSubSceneOverride::getInstancedSelectionPath(</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html">MHWRender::MRenderItem</a>&amp; renderItem,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_intersection.html">MHWRender::MIntersection</a>&amp; intersection,</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_dag_path.html">MDagPath</a>&amp; dagPath)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_status.html">MStatus</a> status;</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_fn_dag_node.html">MFnDagNode</a> node(fObject, &amp;status);</div>
<div class="line">    <span class="keywordflow">if</span> (!status) </div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_dag_path_array.html">MDagPathArray</a> instances;</div>
<div class="line">    <span class="keywordflow">if</span> (!node.getAllPaths(instances))</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> instanceCount = instances.<a class="code" href="#!/url=./cpp_ref/class_m_dag_path_array.html#a580388f31f60c46fac867ca48a48da1e">length</a>();</div>
<div class="line">    <span class="keywordflow">if</span> (instanceCount == 0)</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">int</span> instanceId = intersection.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_intersection.html#a35ab9f5cd2b7e3c46d5c661d9cd73571">instanceID</a>();</div>
<div class="line">    <span class="comment">// In case there is only one instance or GPU instancing is not used</span></div>
<div class="line">    <span class="keywordflow">if</span> (instanceCount == 1 || instanceId == -1)</div>
<div class="line">    {</div>
<div class="line">        instanceId = 0;</div>
<div class="line"></div>
<div class="line">        apiMeshHWSelectionUserData* userData =</div>
<div class="line">            <span class="keyword">dynamic_cast&lt;</span>apiMeshHWSelectionUserData*<span class="keyword">&gt;</span>(renderItem.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#afd8b782f19e9508747c851a990d8f5db">customData</a>());</div>
<div class="line">        <span class="keywordflow">if</span> (userData &amp;&amp;</div>
<div class="line">            userData-&gt;fInstanceIndex &gt;= 0 &amp;&amp;</div>
<div class="line">            userData-&gt;fInstanceIndex &lt; (<span class="keywordtype">int</span>)instanceCount)</div>
<div class="line">        {</div>
<div class="line">            instanceId = userData-&gt;fInstanceIndex;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        dagPath = instances[instanceId];</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">// The instance ID starts from 1 for the first DAG node. We can use instanceID - 1</span></div>
<div class="line">    <span class="comment">// as the index to DagPath array returned by MFnDagNode::getAllPaths().</span></div>
<div class="line">    <span class="comment">// HOWEVER there is an exception when there are instances within a Shape object,</span></div>
<div class="line">    <span class="comment">// which introduces nested instancing scenarios. For simplicity reason the selection</span></div>
<div class="line">    <span class="comment">// edge instancing is disabled when there are multiple apiMesh instances.</span></div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (instanceId &gt;=1 &amp;&amp; instanceId &lt;= (<span class="keywordtype">int</span>)instanceCount)</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="#!/url=./cpp_ref/class_m3d_view.html">M3dView</a> view = <a name="a131"></a><a class="code" href="#!/url=./cpp_ref/class_m3d_view.html#a3cda809eff914b04ff47de958c365f09">M3dView::active3dView</a>();</div>
<div class="line">        <span class="keywordflow">if</span> (view.<a class="code" href="#!/url=./cpp_ref/class_m3d_view.html#af6dcf7f299baab571323208e5634308c">viewIsFiltered</a>())</div>
<div class="line">        {</div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m_selection_list.html">MSelectionList</a> viewSelectedList;</div>
<div class="line">            <span class="keywordflow">if</span> (view.<a class="code" href="#!/url=./cpp_ref/class_m3d_view.html#a325652f994f1ba4f2b110048a1f19a86">filteredObjectList</a>(viewSelectedList))</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> instIdx = 0; instIdx &lt; instanceCount; instIdx++)</div>
<div class="line">                {</div>
<div class="line">                    <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_dag_path.html">MDagPath</a>&amp; instance = instances[instIdx];</div>
<div class="line">                    <span class="keywordflow">if</span> (instance.<a class="code" href="#!/url=./cpp_ref/class_m_dag_path.html#a095ae34296e81703965265a42ee783ca">isValid</a>() &amp;&amp; instance.<a class="code" href="#!/url=./cpp_ref/class_m_dag_path.html#a27f324b7f2643119a7542e39101601d1">isVisible</a>())</div>
<div class="line">                    {</div>
<div class="line">                        <a class="code" href="#!/url=./cpp_ref/class_m_selection_list.html">MSelectionList</a> intersectionList;</div>
<div class="line">                        intersectionList.<a class="code" href="#!/url=./cpp_ref/class_m_selection_list.html#a23929aeafb29672f2652128eac9c4dec">add</a>(instance);</div>
<div class="line">                        intersectionList.<a class="code" href="#!/url=./cpp_ref/class_m_selection_list.html#ad44d2a948e6027c27702304431b14052">intersect</a>(viewSelectedList, <span class="keyword">true</span><span class="comment">/*expandToLeaves*/</span>);</div>
<div class="line"></div>
<div class="line">                        <span class="keywordflow">for</span> (<a class="code" href="#!/url=./cpp_ref/class_m_it_selection_list.html">MItSelectionList</a> it(intersectionList); !it.<a class="code" href="#!/url=./cpp_ref/class_m_it_selection_list.html#ac0f0d6fc806b11d246e05cb94e886b38">isDone</a>(); it.next())</div>
<div class="line">                        {</div>
<div class="line">                            <a class="code" href="#!/url=./cpp_ref/class_m_dag_path.html">MDagPath</a> dummyPath;</div>
<div class="line">                            <a class="code" href="#!/url=./cpp_ref/class_m_object.html">MObject</a> comp;</div>
<div class="line">                            <span class="keywordflow">if</span> (it.getDagPath(dummyPath, comp) &amp;&amp; comp.<a class="code" href="#!/url=./cpp_ref/class_m_object.html#ac02f2a4d7312eb91f40980adfd4e31b2">isNull</a>())</div>
<div class="line">                            {</div>
<div class="line">                                instanceId--;</div>
<div class="line">                                <span class="keywordflow">if</span> (instanceId == 0)</div>
<div class="line">                                {</div>
<div class="line">                                    dagPath = instance;</div>
<div class="line">                                    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">                                }</div>
<div class="line">                            }</div>
<div class="line">                        }</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> instIdx = 0; instIdx &lt; instanceCount; instIdx++)</div>
<div class="line">            {</div>
<div class="line">                <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_dag_path.html">MDagPath</a>&amp; instance = instances[instIdx];</div>
<div class="line">                <span class="keywordflow">if</span> (instance.<a class="code" href="#!/url=./cpp_ref/class_m_dag_path.html#a095ae34296e81703965265a42ee783ca">isValid</a>() &amp;&amp; instance.<a class="code" href="#!/url=./cpp_ref/class_m_dag_path.html#a27f324b7f2643119a7542e39101601d1">isVisible</a>())</div>
<div class="line">                {</div>
<div class="line">                    instanceId--;</div>
<div class="line">                    <span class="keywordflow">if</span> (instanceId == 0)</div>
<div class="line">                    {</div>
<div class="line">                        dagPath = instance;</div>
<div class="line">                        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/*static*/</span></div>
<div class="line"><span class="keywordtype">void</span> apiMeshSubSceneOverride::shadedItemLinkLost(<a class="code" href="#!/url=./cpp_ref/class_m_user_data.html">MUserData</a>* userData)</div>
<div class="line">{</div>
<div class="line">    ShadedItemUserData* data = <span class="keyword">dynamic_cast&lt;</span>ShadedItemUserData*<span class="keyword">&gt;</span>(userData);</div>
<div class="line">    <span class="keywordflow">if</span> (data &amp;&amp; data-&gt;fOverride)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (data-&gt;fOverride-&gt;fMesh)</div>
<div class="line">            data-&gt;fOverride-&gt;fMesh-&gt;setMaterialDirty(<span class="keyword">true</span>);</div>
<div class="line">        data-&gt;fOverride-&gt;untrackLinkLostData(data);</div>
<div class="line">    }</div>
<div class="line">    <span class="keyword">delete</span> userData;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// helper function</span></div>
<div class="line"><span class="keywordtype">bool</span> useSelectHighlight(<span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_selection_list.html">MSelectionList</a>&amp; selectedList, <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_dag_path.html">MDagPath</a>&amp; path)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_status.html">MStatus</a> status = <a name="a132"></a><a class="code" href="#!/url=./cpp_ref/class_m_status.html#a02ab596f4febca68da503aaf8dde3a80af0536797208144380691e2b376ffc1d1">MStatus::kSuccess</a>;</div>
<div class="line"></div>
<div class="line">    MHWRender::DisplayStatus displayStatus = <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_geometry_utilities.html#aa2838b92c9f7db4a810690a986199134">MHWRender::MGeometryUtilities::displayStatus</a>(path);</div>
<div class="line">    <span class="keywordflow">if</span> ((displayStatus == MHWRender::kHilite)</div>
<div class="line">        || (displayStatus == MHWRender::kActiveComponent))</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_dag_path.html">MDagPath</a> pathCopy = path;</div>
<div class="line">    <span class="keywordflow">do</span></div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (selectedList.<a name="a133"></a><a class="code" href="#!/url=./cpp_ref/class_m_selection_list.html#a8ccfcfbdcebf501f9667ee617419892c">hasItem</a>(pathCopy))</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">        }</div>
<div class="line">        status = pathCopy.<a name="a134"></a><a class="code" href="#!/url=./cpp_ref/class_m_dag_path.html#ac71eca2b78b8cfc088adc9af6f851dfd">pop</a>();</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">while</span> (status);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">bool</span> floatApproxEqual(<span class="keywordtype">float</span> left, <span class="keywordtype">float</span> right)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> fabs(left - right) &lt; 0.0001f;</div>
<div class="line">}</div>
<div class="line"></div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->

      <div class="footer-block"><a href="../html/ac.cmtdialog.htm" class="comments-anchor" target="_blank"><span class="comments-link">Please send us your comment about this page</span></a></div></div>
   </div></body>
</html>
