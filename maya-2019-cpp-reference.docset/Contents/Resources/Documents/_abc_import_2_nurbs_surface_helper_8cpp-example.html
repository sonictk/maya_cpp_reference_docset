<!-- saved from url=(0024)http://docs.autodesk.com -->
<html>
   <head><script src="../scripts/yepnope.1.5.4-min.js" type="text/javascript"></script><script src="../scripts/lib/jquery-1.11.1.min.js" type="text/javascript"></script><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script type="text/javascript" src="../scripts/utils/adsk.redirect.js"></script>
      <title>AbcImport/NurbsSurfaceHelper.cpp</title>
   

<meta name="topic-subtype" content="C++"></head>
   <body height="100%"><div class="body_content" id="body-content"><link rel="stylesheet" type="text/css" href="cpp_ref/navtree.css"><link rel="stylesheet" type="text/css" href="cpp_ref/doxygen.css"><link rel="stylesheet" type="text/css" href="cpp_ref/tabs.css"><link rel="stylesheet" type="text/css" href="style/adsk.cpm.css"><script type="text/javascript">
var tocSystemNeedsToBeLoaded = typeof(cpp_ref_adsk_ref_toc) == 'undefined';
var weAreIn21 = $('div#main.view-active').length;
var tocPrefix = '';
if (weAreIn21)
{ tocPrefix = 'cpp_ref/'; }
function cpp_ref_initializeToc(forceTrigger) {
    cpp_ref_adsk_ref_toc.initResizable();
    cpp_ref_adsk_ref_toc.initNavTree('_abc_import_2_nurbs_surface_helper_8cpp-example.html', tocPrefix);
    dQuery(document).trigger('toc_initialized');
}
if (tocSystemNeedsToBeLoaded)
{
	yepnope([{
	load:[tocPrefix + 'json3.min.js', tocPrefix + 'jquery.js', tocPrefix + 'ref-toc-controller.js', tocPrefix + 'dynsections.js'],
	complete: function() {
	  if (typeof(dQuery) == 'undefined')
	  {
	    dQuery = jQuery.noConflict(true);
	  }
	  else { jQuery.noConflict(true); }
	  $(document).ready(cpp_ref_initializeToc);
	}
 	}])
}
if (!weAreIn21) { // if in AKN...
$(window).load( function() {
    setTimeout( function() {
        var content = $('body > div').not('#body-content');     // take any divs under body that are not id=body-content
        content.each( function() { 
            $(this).css( { 'padding-left': $(this).css('margin-left') } );       // and if they have any padding-left already, move it to margin-left.
        } );
        var width = cpp_ref_adsk_ref_toc.readFromStorage('width');
        content.css({marginLeft:parseInt(width)+6+"px"});
    }, 100);
} ); 
}
</script><script>$("div#WidgetFloaterPanels,link[href*='microsofttranslator.com'],script[src*='microsofttranslator.com'],script[src*='bing.com']").remove();</script><script type='text/javascript'>$("div#navigation,div#breadcrumbs,div#banner").attr("translate","no"); var mtLocation = ((location && location.href && location.href.indexOf('https') == 0)?'https://ssl.microsofttranslator.com':'http://www.microsofttranslator.com')+'/ajax/v3/WidgetV3.ashx?ctf=True&ui=true&settings=Manual&from=en&hidelanguages='; yepnope.injectJs(mtLocation, function() {}, { charset:'utf-8', type:'text/javascript' } );</script><script>
 if (!tocSystemNeedsToBeLoaded) { cpp_ref_initializeToc(); }
 </script><!-- begin MT -->
            
            <div id='MicrosoftTranslatorWidget' class='Dark' style='float:right;z-index:100;color:white;background-color:#bbbbbb;height:58px;overflow:hidden'></div>
      <div>
         <div class="head">
            <h1>AbcImport/NurbsSurfaceHelper.cpp</h1>
         </div>

    <div id="top"><!-- Generated by Doxygen 1.8.10 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="#!/url=./cpp_ref/index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="#!/url=./cpp_ref/pages.html"><span>Topics</span></a></li>
      <li><a href="#!/url=./cpp_ref/modules.html"><span>Modules</span></a></li>
      <li><a href="#!/url=./cpp_ref/namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="#!/url=./cpp_ref/annotated.html"><span>Classes</span></a></li>
      <li><a href="#!/url=./cpp_ref/files.html"><span>Files</span></a></li>
      <li><a href="#!/url=./cpp_ref/examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" class="ui-resizable-handle">
  </div>
</div>

<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">AbcImport/NurbsSurfaceHelper.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">//-*****************************************************************************</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Copyright (c) 2009-2012,</span></div>
<div class="line"><span class="comment">//  Sony Pictures Imageworks, Inc. and</span></div>
<div class="line"><span class="comment">//  Industrial Light &amp; Magic, a division of Lucasfilm Entertainment Company Ltd.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// All rights reserved.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Redistribution and use in source and binary forms, with or without</span></div>
<div class="line"><span class="comment">// modification, are permitted provided that the following conditions are</span></div>
<div class="line"><span class="comment">// met:</span></div>
<div class="line"><span class="comment">// *       Redistributions of source code must retain the above copyright</span></div>
<div class="line"><span class="comment">// notice, this list of conditions and the following disclaimer.</span></div>
<div class="line"><span class="comment">// *       Redistributions in binary form must reproduce the above</span></div>
<div class="line"><span class="comment">// copyright notice, this list of conditions and the following disclaimer</span></div>
<div class="line"><span class="comment">// in the documentation and/or other materials provided with the</span></div>
<div class="line"><span class="comment">// distribution.</span></div>
<div class="line"><span class="comment">// *       Neither the name of Sony Pictures Imageworks, nor</span></div>
<div class="line"><span class="comment">// Industrial Light &amp; Magic nor the names of their contributors may be used</span></div>
<div class="line"><span class="comment">// to endorse or promote products derived from this software without specific</span></div>
<div class="line"><span class="comment">// prior written permission.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span></div>
<div class="line"><span class="comment">// &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span></div>
<div class="line"><span class="comment">// LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span></div>
<div class="line"><span class="comment">// A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT</span></div>
<div class="line"><span class="comment">// OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span></div>
<div class="line"><span class="comment">// SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span></div>
<div class="line"><span class="comment">// LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span></div>
<div class="line"><span class="comment">// DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span></div>
<div class="line"><span class="comment">// THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span></div>
<div class="line"><span class="comment">// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span></div>
<div class="line"><span class="comment">// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//-*****************************************************************************</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &quot;util.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;NurbsSurfaceHelper.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;NodeIteratorVisitorHelper.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MString.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MDagPath.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MDoubleArray.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MPointArray.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MFnNurbsSurface.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MFnNurbsCurve.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MFnNurbsCurveData.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MGlobal.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MObjectArray.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MTrimBoundaryArray.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MFnTransform.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MCommandResult.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MDagModifier.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">namespace</span></div>
<div class="line">{</div>
<div class="line"></div>
<div class="line">    <span class="comment">// This function repacks trim curves information back into Maya format</span></div>
<div class="line">    <span class="keywordtype">void</span> trimSurface( Alembic::AbcGeom::INuPatchSchema::Sample &amp; iSamp,</div>
<div class="line">        <a name="_a0"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_nurbs_surface.html">MFnNurbsSurface</a> &amp; iFnSurface)</div>
<div class="line">    {</div>
<div class="line"></div>
<div class="line">        Alembic::Util::int32_t numLoops = iSamp.getTrimNumLoops();</div>
<div class="line">        <span class="keywordflow">if</span> (numLoops == 0)</div>
<div class="line">            <span class="keywordflow">return</span>;</div>
<div class="line"></div>
<div class="line">        <a name="_a1"></a><a class="code" href="#!/url=./cpp_ref/class_m_trim_boundary_array.html">MTrimBoundaryArray</a> trimBoundaryArray;</div>
<div class="line"></div>
<div class="line">        <span class="comment">// this is for getting V back into Maya&#39;s coordinate system</span></div>
<div class="line">        <span class="keywordtype">double</span> startU, endU, startV, endV;</div>
<div class="line">        iFnSurface.<a name="a2"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_nurbs_surface.html#a98ab3e5051ac89bf753456b0ab8e5784">getKnotDomain</a>(startU, endU, startV, endV);</div>
<div class="line">        <span class="keywordtype">double</span> offsetV = startV + endV;</div>
<div class="line"></div>
<div class="line">        <a name="_a3"></a><a class="code" href="#!/url=./cpp_ref/class_m_status.html">MStatus</a> status = MS::kSuccess;</div>
<div class="line"></div>
<div class="line">        Alembic::Abc::Int32ArraySamplePtr numCurvesPerLoop =</div>
<div class="line">            iSamp.getTrimNumCurves();</div>
<div class="line">        Alembic::Abc::Int32ArraySamplePtr numCurveVerts =</div>
<div class="line">            iSamp.getTrimNumVertices();</div>
<div class="line">        Alembic::Abc::Int32ArraySamplePtr orders = iSamp.getTrimOrders();</div>
<div class="line">        Alembic::Abc::FloatArraySamplePtr knots = iSamp.getTrimKnots();</div>
<div class="line">        Alembic::Abc::FloatArraySamplePtr uVert = iSamp.getTrimU();</div>
<div class="line">        Alembic::Abc::FloatArraySamplePtr vVert = iSamp.getTrimV();</div>
<div class="line">        Alembic::Abc::FloatArraySamplePtr wVert = iSamp.getTrimW();</div>
<div class="line"></div>
<div class="line">        Alembic::Util::int32_t curCurve = 0;</div>
<div class="line">        Alembic::Util::int32_t curPos = 0;</div>
<div class="line">        Alembic::Util::int32_t curKnot = 0;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">for</span> (Alembic::Util::int32_t i = 0; i &lt; numLoops; ++i)</div>
<div class="line">        {</div>
<div class="line">            <a name="_a4"></a><a class="code" href="#!/url=./cpp_ref/class_m_object_array.html">MObjectArray</a> trimLoop;</div>
<div class="line"></div>
<div class="line">            Alembic::Util::int32_t numCurves = (*numCurvesPerLoop)[i];</div>
<div class="line">            <span class="keywordflow">for</span> (Alembic::Util::int32_t j = 0; j &lt; numCurves; ++j, ++curCurve)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> degree = (*orders)[curCurve] - 1;</div>
<div class="line">                Alembic::Util::int32_t numVerts = (*numCurveVerts)[curCurve];</div>
<div class="line">                Alembic::Util::int32_t numKnots = numVerts + degree + 1;</div>
<div class="line"></div>
<div class="line">                <a name="_a5"></a><a class="code" href="#!/url=./cpp_ref/class_m_point_array.html">MPointArray</a> cvs;</div>
<div class="line">                cvs.<a name="a6"></a><a class="code" href="#!/url=./cpp_ref/class_m_point_array.html#a8c66dfa06f3736b2a214c5aed58bd216">setLength</a>(numVerts);</div>
<div class="line">                <span class="keywordflow">for</span> (Alembic::Util::int32_t k=0 ; k&lt;numVerts; ++k, ++curPos)</div>
<div class="line">                {</div>
<div class="line">                    <span class="keywordtype">double</span> x = (*uVert)[curPos];</div>
<div class="line">                    <span class="keywordtype">double</span> y = (*vVert)[curPos];</div>
<div class="line">                    <span class="keywordtype">double</span> w = (*wVert)[curPos];</div>
<div class="line">                    cvs.<a name="a7"></a><a class="code" href="#!/url=./cpp_ref/class_m_point_array.html#a44867c987d14cbe9223c87bb598d31c1">set</a>(k, x, offsetV-y, 0.0, w);</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">                <a name="_a8"></a><a class="code" href="#!/url=./cpp_ref/class_m_double_array.html">MDoubleArray</a> dknots;</div>
<div class="line">                dknots.<a name="a9"></a><a class="code" href="#!/url=./cpp_ref/class_m_double_array.html#a8c66dfa06f3736b2a214c5aed58bd216">setLength</a>(numKnots - 2);</div>
<div class="line">                ++curKnot;</div>
<div class="line">                <span class="keywordflow">for</span> (Alembic::Util::int32_t k = 1; k &lt; numKnots - 1;</div>
<div class="line">                    ++k, ++curKnot)</div>
<div class="line">                {</div>
<div class="line">                    dknots.<a name="a10"></a><a class="code" href="#!/url=./cpp_ref/class_m_double_array.html#a8f0a19dc13ef5224620b5653a82371d3">set</a>((*knots)[curKnot], k - 1);</div>
<div class="line">                }</div>
<div class="line">                ++curKnot;</div>
<div class="line"></div>
<div class="line">                <a name="_a11"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_nurbs_curve.html">MFnNurbsCurve</a> fnCurve;</div>
<div class="line"></div>
<div class="line">                <span class="comment">// when a 2D curve is created without a parent, the function</span></div>
<div class="line">                <span class="comment">// returns the transform node of the curve created.</span></div>
<div class="line">                <span class="comment">// The transform node as well as the curve node need to be</span></div>
<div class="line">                <span class="comment">// deleted once the trim is done, because after all this is not</span></div>
<div class="line">                <span class="comment">// the equivalent of &quot;curveOnSurface&quot; command</span></div>
<div class="line">                <a name="_a12"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_nurbs_curve_data.html">MFnNurbsCurveData</a> data;</div>
<div class="line">                <a name="_a13"></a><a class="code" href="#!/url=./cpp_ref/class_m_object.html">MObject</a> curveData = data.<a name="a14"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_nurbs_curve_data.html#af1adb4abaf5243c6c0749bcca7b5c418">create</a>();</div>
<div class="line">                <a class="code" href="#!/url=./cpp_ref/class_m_object.html">MObject</a> curve2D = fnCurve.<a name="a15"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_nurbs_curve.html#a4b11e346021c91845e781e9d7d06859f">create</a>(cvs, dknots, degree,</div>
<div class="line">                    <a name="a16"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_nurbs_curve.html#a99f5203c7742378941e34926280c8e66a7fb3bf49ba349ca1a266be41df447b5b">MFnNurbsCurve::kOpen</a>, <span class="keyword">true</span>, <span class="keyword">true</span>, curveData, &amp;status);</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">if</span> (status == MS::kSuccess)</div>
<div class="line">                {</div>
<div class="line">                    trimLoop.<a name="a17"></a><a class="code" href="#!/url=./cpp_ref/class_m_object_array.html#a3694392863ba632bca5d76cbbf190ef5">append</a>(curveData);</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">            trimBoundaryArray.<a name="a18"></a><a class="code" href="#!/url=./cpp_ref/class_m_trim_boundary_array.html#a58aa0ffd87a8ca32834b827e1452f23e">append</a>(trimLoop);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <a class="code" href="#!/url=./cpp_ref/class_m_trim_boundary_array.html">MTrimBoundaryArray</a> oneRegion;</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; trimBoundaryArray.<a name="a19"></a><a class="code" href="#!/url=./cpp_ref/class_m_trim_boundary_array.html#a580388f31f60c46fac867ca48a48da1e">length</a>(); i++)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">if</span> (i &gt; 0)</div>
<div class="line">            {</div>
<div class="line">                <a class="code" href="#!/url=./cpp_ref/class_m_object.html">MObject</a> loopData = trimBoundaryArray.<a name="a20"></a><a class="code" href="#!/url=./cpp_ref/class_m_trim_boundary_array.html#a8c5c9d056371db0b771e14526c08b520">getMergedBoundary</a>(i, &amp;status);</div>
<div class="line">                <span class="keywordflow">if</span> (status != MS::kSuccess) <span class="keywordflow">continue</span>;</div>
<div class="line"></div>
<div class="line">                <a class="code" href="#!/url=./cpp_ref/class_m_fn_nurbs_curve.html">MFnNurbsCurve</a> loop(loopData, &amp;status);</div>
<div class="line">                <span class="keywordflow">if</span> (status != MS::kSuccess) <span class="keywordflow">continue</span>;</div>
<div class="line"></div>
<div class="line">                <span class="comment">// Check whether this loop is an outer boundary.</span></div>
<div class="line">                <span class="keywordtype">bool</span> isOuterBoundary = <span class="keyword">false</span>;</div>
<div class="line"></div>
<div class="line">                <span class="keywordtype">double</span>       length  = loop.<a name="a21"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_nurbs_curve.html#acdf47b43a3196b3eb5f7b78a64003ba9">length</a>();</div>
<div class="line">                <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> segment = std::max(loop.<a name="a22"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_nurbs_curve.html#addc4a2b6312ad1c7265478f2680b7566">numCVs</a>(), 10);</div>
<div class="line"></div>
<div class="line">                <a class="code" href="#!/url=./cpp_ref/class_m_point_array.html">MPointArray</a> curvePoints;</div>
<div class="line">                curvePoints.<a class="code" href="#!/url=./cpp_ref/class_m_point_array.html#a8c66dfa06f3736b2a214c5aed58bd216">setLength</a>(segment);</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; segment; j++)</div>
<div class="line">                {</div>
<div class="line">                    <span class="keywordtype">double</span> param = loop.<a name="a23"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_nurbs_curve.html#a6fc77e351e95b453079bbad771940d9f">findParamFromLength</a>(length * j / segment);</div>
<div class="line">                    loop.<a name="a24"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_nurbs_curve.html#ab2f1acb5a0653b12d7430d5786ef2e3e">getPointAtParam</a>(param, curvePoints[j]);</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">                <span class="comment">// Find the right most curve point</span></div>
<div class="line">                <a name="_a25"></a><a class="code" href="#!/url=./cpp_ref/class_m_point.html">MPoint</a>       rightMostPoint = curvePoints[0];</div>
<div class="line">                <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> rightMostIndex = 0;</div>
<div class="line">                <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; curvePoints.length(); j++)</div>
<div class="line">                {</div>
<div class="line">                    <span class="keywordflow">if</span> (rightMostPoint.<a name="a26"></a><a class="code" href="#!/url=./cpp_ref/class_m_point.html#af88b946fb90d5f08b5fb740c70e98c10">x</a> &lt; curvePoints[j].x)</div>
<div class="line">                    {</div>
<div class="line">                        rightMostPoint = curvePoints[j];</div>
<div class="line">                        rightMostIndex = j;</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">                <span class="comment">// Find the vertex just before and after the right most vertex</span></div>
<div class="line">                <span class="keywordtype">int</span> beforeIndex = (rightMostIndex == 0) ? curvePoints.length() - 1 : rightMostIndex - 1;</div>
<div class="line">                <span class="keywordtype">int</span> afterIndex  = (rightMostIndex == curvePoints.length() - 1) ? 0 : rightMostIndex + 1;</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; curvePoints.length(); j++)</div>
<div class="line">                {</div>
<div class="line">                    <span class="keywordflow">if</span> (fabs(curvePoints[beforeIndex].x - curvePoints[rightMostIndex].x) &lt; 1e-5)</div>
<div class="line">                    {</div>
<div class="line">                        beforeIndex = (beforeIndex == 0) ? curvePoints.length() - 1 : beforeIndex - 1;</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; curvePoints.length(); j++)</div>
<div class="line">                {</div>
<div class="line">                    <span class="keywordflow">if</span> (fabs(curvePoints[afterIndex].x - curvePoints[rightMostIndex].x) &lt; 1e-5)</div>
<div class="line">                    {</div>
<div class="line">                        afterIndex = (afterIndex == (int)(curvePoints.length()) - 1) ? 0 : afterIndex + 1;</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">                <span class="comment">// failed. not a closed curve.</span></div>
<div class="line">                <span class="keywordflow">if</span> (fabs(curvePoints[afterIndex].x - curvePoints[rightMostIndex].x) &lt; 1e-5 &amp;&amp;</div>
<div class="line">                    fabs(curvePoints[beforeIndex].x - curvePoints[rightMostIndex].x) &lt; 1e-5)</div>
<div class="line">                {</div>
<div class="line">                    <span class="keywordflow">continue</span>;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">if</span> (beforeIndex &lt; 0)</div>
<div class="line">                    beforeIndex += curvePoints.length();</div>
<div class="line">                <span class="keywordflow">if</span> (beforeIndex &gt;= (<span class="keywordtype">int</span>)(curvePoints.length()))</div>
<div class="line">                    beforeIndex = beforeIndex &amp; curvePoints.length();</div>
<div class="line">                <span class="keywordflow">if</span> (afterIndex &lt; 0)</div>
<div class="line">                    afterIndex += curvePoints.length();</div>
<div class="line">                <span class="keywordflow">if</span> (afterIndex &gt;= (<span class="keywordtype">int</span>)(curvePoints.length()))</div>
<div class="line">                    afterIndex = afterIndex &amp; curvePoints.length();</div>
<div class="line"></div>
<div class="line">                <span class="comment">// Compute the cross product</span></div>
<div class="line">                <a name="_a27"></a><a class="code" href="#!/url=./cpp_ref/class_m_vector.html">MVector</a> vector1 = curvePoints[beforeIndex] - curvePoints[rightMostIndex];</div>
<div class="line">                <a class="code" href="#!/url=./cpp_ref/class_m_vector.html">MVector</a> vector2 = curvePoints[afterIndex]  - curvePoints[rightMostIndex];</div>
<div class="line">                <span class="keywordflow">if</span> ((vector1 ^ vector2).z &lt; 0)</div>
<div class="line">                {</div>
<div class="line">                    isOuterBoundary = <span class="keyword">true</span>;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">                <span class="comment">// Trim the NURBS surface. An outer boundary starts a new region.</span></div>
<div class="line">                <span class="keywordflow">if</span> (isOuterBoundary)</div>
<div class="line">                {</div>
<div class="line"><span class="preprocessor">#if MAYA_API_VERSION &lt; 201300</span></div>
<div class="line">                    status = iFnSurface.<a name="a28"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_nurbs_surface.html#a7034e46990f9fb46a2c9a03dba876f8e">trimWithBoundaries</a>(oneRegion);</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">                    status = iFnSurface.<a class="code" href="#!/url=./cpp_ref/class_m_fn_nurbs_surface.html#a7034e46990f9fb46a2c9a03dba876f8e">trimWithBoundaries</a>(oneRegion, <span class="keyword">false</span>, 1e-3, 1e-5, <span class="keyword">true</span>);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">                    <span class="keywordflow">if</span> (status != MS::kSuccess)</div>
<div class="line">                    {</div>
<div class="line">                        <a name="a29"></a><a class="code" href="#!/url=./cpp_ref/class_m_global.html#a4ddbe97e58a90e1ab05d45a62c006cf0">MGlobal::displayError</a>(</div>
<div class="line">                            <span class="stringliteral">&quot;Trimming Nurbs Surface outer failed.&quot;</span>);</div>
<div class="line">                    }</div>
<div class="line">                    oneRegion.<a name="a30"></a><a class="code" href="#!/url=./cpp_ref/class_m_trim_boundary_array.html#ad5522f028dde0080b753279426415a4a">clear</a>();</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            oneRegion.<a class="code" href="#!/url=./cpp_ref/class_m_trim_boundary_array.html#a58aa0ffd87a8ca32834b827e1452f23e">append</a>(trimBoundaryArray[i]);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if MAYA_API_VERSION &lt; 201300</span></div>
<div class="line">        status = iFnSurface.<a class="code" href="#!/url=./cpp_ref/class_m_fn_nurbs_surface.html#a7034e46990f9fb46a2c9a03dba876f8e">trimWithBoundaries</a>(oneRegion);</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">        status = iFnSurface.<a class="code" href="#!/url=./cpp_ref/class_m_fn_nurbs_surface.html#a7034e46990f9fb46a2c9a03dba876f8e">trimWithBoundaries</a>(oneRegion, <span class="keyword">false</span>, 1e-3, 1e-5, <span class="keyword">true</span>);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">        <span class="keywordflow">if</span> (status != MS::kSuccess)</div>
<div class="line">        {</div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m_global.html#a4ddbe97e58a90e1ab05d45a62c006cf0">MGlobal::displayError</a>(<span class="stringliteral">&quot;Trimming Nurbs Surface failed.&quot;</span>);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="#!/url=./cpp_ref/class_m_object.html">MObject</a> readNurbs(<span class="keywordtype">double</span> iFrame, Alembic::AbcGeom::INuPatch &amp; iNode,</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_object.html">MObject</a> &amp; iObject)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_status.html">MStatus</a> status;</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_object.html">MObject</a> obj;</div>
<div class="line"></div>
<div class="line">    Alembic::AbcGeom::INuPatchSchema schema = iNode.getSchema();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// no interpolation for now</span></div>
<div class="line">    Alembic::AbcCoreAbstract::index_t index, ceilIndex;</div>
<div class="line">    getWeightAndIndex(iFrame, schema.getTimeSampling(),</div>
<div class="line">        schema.getNumSamples(), index, ceilIndex);</div>
<div class="line"></div>
<div class="line">    Alembic::AbcGeom::INuPatchSchema::Sample samp;</div>
<div class="line">    schema.get(samp, Alembic::Abc::ISampleSelector(index));</div>
<div class="line"></div>
<div class="line">    Alembic::Abc::P3fArraySamplePtr pos = samp.getPositions();</div>
<div class="line">    Alembic::Abc::FloatArraySamplePtr weights = samp.getPositionWeights();</div>
<div class="line"></div>
<div class="line">    <a name="_a31"></a><a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> surfaceName(iNode.getName().c_str());</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> degreeU  = samp.getUOrder() &gt; 0 ? samp.getUOrder() - 1 : 0;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> degreeV  = samp.getVOrder() &gt; 0 ? samp.getVOrder() - 1 : 0;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> numCVInU = samp.getNumU();</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> numCVInV = samp.getNumV();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// cv points</span></div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> numCV = numCVInU*numCVInV;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> curPos = 0;</div>
<div class="line"></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_point_array.html">MPointArray</a> controlVertices;</div>
<div class="line">    controlVertices.<a class="code" href="#!/url=./cpp_ref/class_m_point_array.html#a8c66dfa06f3736b2a214c5aed58bd216">setLength</a>(numCV);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> v = 0; v &lt; numCVInV; ++v)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> u = 0; u &lt; numCVInU; ++u, ++curPos)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> mayaIndex = u * numCVInV + (numCVInV - v - 1);</div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m_point.html">MPoint</a> pt((*pos)[curPos].x, (*pos)[curPos].y, (*pos)[curPos].z);</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> (weights)</div>
<div class="line">            {</div>
<div class="line">                pt.w = (*weights)[curPos];</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="comment">// go from u,v order to reversed v, u order</span></div>
<div class="line">            controlVertices.<a class="code" href="#!/url=./cpp_ref/class_m_point_array.html#a44867c987d14cbe9223c87bb598d31c1">set</a>(pt, mayaIndex);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Nurbs form</span></div>
<div class="line">    <span class="comment">// Alemblic file does not record the form of nurb surface, we get the form</span></div>
<div class="line">    <span class="comment">// by checking the CV data. If the first degree number CV overlap the last</span></div>
<div class="line">    <span class="comment">// degree number CV, then the form is kPeriodic. If only the first CV overlaps</span></div>
<div class="line">    <span class="comment">// the last CV, then the form is kClosed.</span></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_fn_nurbs_surface.html#a99f5203c7742378941e34926280c8e66">MFnNurbsSurface::Form</a> formU = <a name="a32"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_nurbs_surface.html#a99f5203c7742378941e34926280c8e66a0ed9d38a35a60087a093558dad96d882">MFnNurbsSurface::kPeriodic</a>;</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_fn_nurbs_surface.html#a99f5203c7742378941e34926280c8e66">MFnNurbsSurface::Form</a> formV = <a class="code" href="#!/url=./cpp_ref/class_m_fn_nurbs_surface.html#a99f5203c7742378941e34926280c8e66a0ed9d38a35a60087a093558dad96d882">MFnNurbsSurface::kPeriodic</a>;</div>
<div class="line">    <span class="comment">// Check all curves</span></div>
<div class="line">    <span class="keywordtype">bool</span> notOpen = <span class="keyword">true</span>;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> v = 0; notOpen &amp;&amp; v &lt; numCVInV; v++) {</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> u = 0; u &lt; degreeU; u++) {</div>
<div class="line">            <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> firstIndex = u * numCVInV + (numCVInV - v - 1);</div>
<div class="line">            <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> lastPeriodicIndex = (numCVInU - degreeU + u) * numCVInV + (numCVInV - v - 1);</div>
<div class="line">            <span class="keywordflow">if</span> (!controlVertices[firstIndex].isEquivalent(controlVertices[lastPeriodicIndex])) {</div>
<div class="line">                formU = <a name="a33"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_nurbs_surface.html#a99f5203c7742378941e34926280c8e66a7fb3bf49ba349ca1a266be41df447b5b">MFnNurbsSurface::kOpen</a>;</div>
<div class="line">                notOpen = <span class="keyword">false</span>;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (formU == <a class="code" href="#!/url=./cpp_ref/class_m_fn_nurbs_surface.html#a99f5203c7742378941e34926280c8e66a7fb3bf49ba349ca1a266be41df447b5b">MFnNurbsSurface::kOpen</a>) {</div>
<div class="line">        formU = <a name="a34"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_nurbs_surface.html#a99f5203c7742378941e34926280c8e66a44be8f61450ed22be5adcc881a95570f">MFnNurbsSurface::kClosed</a>;</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> v = 0; v &lt; numCVInV; v++) {</div>
<div class="line">            <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> lastUIndex = (numCVInU - 1) * numCVInV + (numCVInV - v - 1);</div>
<div class="line">            <span class="keywordflow">if</span> (! controlVertices[numCVInV-v-1].isEquivalent(controlVertices[lastUIndex])) {</div>
<div class="line">                formU = <a class="code" href="#!/url=./cpp_ref/class_m_fn_nurbs_surface.html#a99f5203c7742378941e34926280c8e66a7fb3bf49ba349ca1a266be41df447b5b">MFnNurbsSurface::kOpen</a>;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    notOpen = <span class="keyword">true</span>;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> u = 0; notOpen &amp;&amp; u &lt; numCVInU; u++) {</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> v = 0; v &lt; degreeV; v++) {</div>
<div class="line">            <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> firstIndex = u * numCVInV + (numCVInV - v - 1);</div>
<div class="line">            <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> lastPeriodicIndex = u * numCVInV + (degreeV - v - 1); <span class="comment">//numV - (numV - vDegree + v) - 1;</span></div>
<div class="line">            <span class="keywordflow">if</span> (!controlVertices[firstIndex].isEquivalent(controlVertices[lastPeriodicIndex])) {</div>
<div class="line">                formV = <a class="code" href="#!/url=./cpp_ref/class_m_fn_nurbs_surface.html#a99f5203c7742378941e34926280c8e66a7fb3bf49ba349ca1a266be41df447b5b">MFnNurbsSurface::kOpen</a>;</div>
<div class="line">                notOpen = <span class="keyword">false</span>;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (formV == <a class="code" href="#!/url=./cpp_ref/class_m_fn_nurbs_surface.html#a99f5203c7742378941e34926280c8e66a7fb3bf49ba349ca1a266be41df447b5b">MFnNurbsSurface::kOpen</a>) {</div>
<div class="line">        formV = <a class="code" href="#!/url=./cpp_ref/class_m_fn_nurbs_surface.html#a99f5203c7742378941e34926280c8e66a44be8f61450ed22be5adcc881a95570f">MFnNurbsSurface::kClosed</a>;</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> u = 0; u &lt; numCVInU; u++) {</div>
<div class="line">            <span class="keywordflow">if</span> (! controlVertices[u * numCVInV + (numCVInV-1)].isEquivalent(controlVertices[u * numCVInV])) {</div>
<div class="line">                formV = <a class="code" href="#!/url=./cpp_ref/class_m_fn_nurbs_surface.html#a99f5203c7742378941e34926280c8e66a7fb3bf49ba349ca1a266be41df447b5b">MFnNurbsSurface::kOpen</a>;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    Alembic::Abc::FloatArraySamplePtr uKnot = samp.getUKnot();</div>
<div class="line">    Alembic::Abc::FloatArraySamplePtr vKnot = samp.getVKnot();</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> numKnotsInU = 0;</div>
<div class="line">    <span class="keywordflow">if</span> (uKnot-&gt;size() &gt; 2)</div>
<div class="line">    {</div>
<div class="line">        numKnotsInU = <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span><span class="keyword">&gt;</span>(uKnot-&gt;size() - 2);</div>
<div class="line">    }</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_double_array.html">MDoubleArray</a> uKnotSequences;</div>
<div class="line">    uKnotSequences.<a class="code" href="#!/url=./cpp_ref/class_m_double_array.html#a8c66dfa06f3736b2a214c5aed58bd216">setLength</a>(numKnotsInU);</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; numKnotsInU; ++i)</div>
<div class="line">    {</div>
<div class="line">        uKnotSequences.<a class="code" href="#!/url=./cpp_ref/class_m_double_array.html#a8f0a19dc13ef5224620b5653a82371d3">set</a>((*uKnot)[i+1], i);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> numKnotsInV =  0;</div>
<div class="line">    <span class="keywordflow">if</span> (vKnot-&gt;size() &gt; 2)</div>
<div class="line">    {</div>
<div class="line">        numKnotsInV = <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span><span class="keyword">&gt;</span>(vKnot-&gt;size() - 2);</div>
<div class="line">    }</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_double_array.html">MDoubleArray</a> vKnotSequences;</div>
<div class="line">    vKnotSequences.<a class="code" href="#!/url=./cpp_ref/class_m_double_array.html#a8c66dfa06f3736b2a214c5aed58bd216">setLength</a>(numKnotsInV);</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; numKnotsInV; i++)</div>
<div class="line">    {</div>
<div class="line">        vKnotSequences.<a class="code" href="#!/url=./cpp_ref/class_m_double_array.html#a8f0a19dc13ef5224620b5653a82371d3">set</a>((*vKnot)[i+1], i);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Node creation try the API first</span></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_fn_nurbs_surface.html">MFnNurbsSurface</a> mFn;</div>
<div class="line">    obj = mFn.<a name="a35"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_nurbs_surface.html#a6a3e914fe9c070228f4df8f4a593b4c8">create</a>(controlVertices, uKnotSequences, vKnotSequences,</div>
<div class="line">        degreeU, degreeV, formU, formV,</div>
<div class="line">        <span class="keyword">true</span>, iObject, &amp;status);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// something went wrong, try open/open create</span></div>
<div class="line">    <span class="keywordflow">if</span> (status != MS::kSuccess &amp;&amp; (formU != <a class="code" href="#!/url=./cpp_ref/class_m_fn_nurbs_surface.html#a99f5203c7742378941e34926280c8e66a7fb3bf49ba349ca1a266be41df447b5b">MFnNurbsSurface::kOpen</a> ||</div>
<div class="line">        formV != <a class="code" href="#!/url=./cpp_ref/class_m_fn_nurbs_surface.html#a99f5203c7742378941e34926280c8e66a7fb3bf49ba349ca1a266be41df447b5b">MFnNurbsSurface::kOpen</a>))</div>
<div class="line">    {</div>
<div class="line">        obj = mFn.<a class="code" href="#!/url=./cpp_ref/class_m_fn_nurbs_surface.html#a6a3e914fe9c070228f4df8f4a593b4c8">create</a>(controlVertices, uKnotSequences, vKnotSequences,</div>
<div class="line">            degreeU, degreeV,  <a class="code" href="#!/url=./cpp_ref/class_m_fn_nurbs_surface.html#a99f5203c7742378941e34926280c8e66a7fb3bf49ba349ca1a266be41df447b5b">MFnNurbsSurface::kOpen</a>,  <a class="code" href="#!/url=./cpp_ref/class_m_fn_nurbs_surface.html#a99f5203c7742378941e34926280c8e66a7fb3bf49ba349ca1a266be41df447b5b">MFnNurbsSurface::kOpen</a>,</div>
<div class="line">            <span class="keyword">true</span>, iObject, &amp;status);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (status == MS::kSuccess)</div>
<div class="line">    {</div>
<div class="line">        mFn.<a name="a36"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_dependency_node.html#a386bb83443e16a98e6fa10c683e76b6c">setName</a>(surfaceName);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="#!/url=./cpp_ref/class_m_global.html#a4ddbe97e58a90e1ab05d45a62c006cf0">MGlobal::displayError</a>(status.<a name="a37"></a><a class="code" href="#!/url=./cpp_ref/class_m_status.html#ad57d0c926a6ff0c782bfa67278925863">errorString</a>());</div>
<div class="line">        <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> errorMsg = <span class="stringliteral">&quot;Could not create Nurbs Surface: &quot;</span>;</div>
<div class="line">        errorMsg += surfaceName;</div>
<div class="line">        <a class="code" href="#!/url=./cpp_ref/class_m_global.html#a4ddbe97e58a90e1ab05d45a62c006cf0">MGlobal::displayError</a>(errorMsg);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    trimSurface(samp, mFn);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> obj;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="#!/url=./cpp_ref/class_m_object.html">MObject</a> createNurbs(<span class="keywordtype">double</span> iFrame, Alembic::AbcGeom::INuPatch &amp; iNode,</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_object.html">MObject</a> &amp; iParent)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// normally we&#39;d only want to do the read if we had only 1 sample, but</span></div>
<div class="line">    <span class="comment">// since we can&#39;t seem to create an empty Nurbs surface like we can a mesh</span></div>
<div class="line">    <span class="comment">// we will read the data (eventually multiple times on creation)</span></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_object.html">MObject</a> obj = readNurbs(iFrame, iNode, iParent);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (!obj.<a name="a38"></a><a class="code" href="#!/url=./cpp_ref/class_m_object.html#ac02f2a4d7312eb91f40980adfd4e31b2">isNull</a>())</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="#!/url=./cpp_ref/class_m_fn_nurbs_surface.html">MFnNurbsSurface</a> fn(obj);</div>
<div class="line">        setInitialShadingGroup(fn.partialPathName());</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> obj;</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
          <div class="footer-block"><a href="../html/ac.cmtdialog.htm" class="comments-anchor" target="_blank"><span class="comments-link">Please send us your comment about this page</span></a></div></div>
   </div></body>
</html>
