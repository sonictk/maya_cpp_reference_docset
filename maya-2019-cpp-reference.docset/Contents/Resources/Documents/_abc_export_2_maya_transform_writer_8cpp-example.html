<!-- saved from url=(0024)http://docs.autodesk.com -->
<html>
<head><script src="../scripts/yepnope.1.5.4-min.js" type="text/javascript"></script><script src="../scripts/lib/jquery-1.11.1.min.js" type="text/javascript"></script><meta content="text/html; charset=utf-8" http-equiv="Content-Type"/><script src="../scripts/utils/adsk.redirect.js" type="text/javascript"></script>
<title>AbcExport/MayaTransformWriter.cpp</title>
<meta content="C++" name="topic-subtype"/></head>
<body height="100%"><div class="body_content" id="body-content"><link href="cpp_ref/navtree.css" rel="stylesheet" type="text/css"/><link href="cpp_ref/doxygen.css" rel="stylesheet" type="text/css"/><link href="cpp_ref/tabs.css" rel="stylesheet" type="text/css"/><link href="style/adsk.cpm.css" rel="stylesheet" type="text/css"/><script type="text/javascript">
var tocSystemNeedsToBeLoaded = typeof(cpp_ref_adsk_ref_toc) == 'undefined';
var weAreIn21 = $('div#main.view-active').length;
var tocPrefix = '';
if (weAreIn21)
{ tocPrefix = 'cpp_ref/'; }
function cpp_ref_initializeToc(forceTrigger) {
    cpp_ref_adsk_ref_toc.initResizable();
    cpp_ref_adsk_ref_toc.initNavTree('_abc_export_2_maya_transform_writer_8cpp-example.html', tocPrefix);
    dQuery(document).trigger('toc_initialized');
}
if (tocSystemNeedsToBeLoaded)
{
	yepnope([{
	load:[tocPrefix + 'json3.min.js', tocPrefix + 'jquery.js', tocPrefix + 'ref-toc-controller.js', tocPrefix + 'dynsections.js'],
	complete: function() {
	  if (typeof(dQuery) == 'undefined')
	  {
	    dQuery = jQuery.noConflict(true);
	  }
	  else { jQuery.noConflict(true); }
	  $(document).ready(cpp_ref_initializeToc);
	}
 	}])
}
if (!weAreIn21) { // if in AKN...
$(window).load( function() {
    setTimeout( function() {
        var content = $('body > div').not('#body-content');     // take any divs under body that are not id=body-content
        content.each( function() { 
            $(this).css( { 'padding-left': $(this).css('margin-left') } );       // and if they have any padding-left already, move it to margin-left.
        } );
        var width = cpp_ref_adsk_ref_toc.readFromStorage('width');
        content.css({marginLeft:parseInt(width)+6+"px"});
    }, 100);
} ); 
}
</script><script>$("div#WidgetFloaterPanels,link[href*='microsofttranslator.com'],script[src*='microsofttranslator.com'],script[src*='bing.com']").remove();</script><script type="text/javascript">$("div#navigation,div#breadcrumbs,div#banner").attr("translate","no"); var mtLocation = ((location && location.href && location.href.indexOf('https') == 0)?'https://ssl.microsofttranslator.com':'http://www.microsofttranslator.com')+'/ajax/v3/WidgetV3.ashx?ctf=True&ui=true&settings=Manual&from=en&hidelanguages='; yepnope.injectJs(mtLocation, function() {}, { charset:'utf-8', type:'text/javascript' } );</script><script>
 if (!tocSystemNeedsToBeLoaded) { cpp_ref_initializeToc(); }
 </script><!-- begin MT -->
<div class="Dark" id="MicrosoftTranslatorWidget" style="float:right;z-index:100;color:white;background-color:#bbbbbb;height:58px;overflow:hidden"></div>
<div>
<div class="head">
<h1>AbcExport/MayaTransformWriter.cpp</h1>
</div>
<div id="top"><!-- Generated by Doxygen 1.8.10 -->
<div class="tabs" id="navrow1">
<ul class="tablist">
<li><a href="./index.html"><span>MainÂ Page</span></a></li>
<li><a href="./pages.html"><span>Topics</span></a></li>
<li><a href="./modules.html"><span>Modules</span></a></li>
<li><a href="./namespaces.html"><span>Namespaces</span></a></li>
<li><a href="./annotated.html"><span>Classes</span></a></li>
<li><a href="./files.html"><span>Files</span></a></li>
<li><a href="./examples.html"><span>Examples</span></a></li>
</ul>
</div>
</div><!-- top -->
<div class="ui-resizable side-nav-resizable" id="side-nav">
<div id="nav-tree">
<div id="nav-tree-contents">
<div class="sync" id="nav-sync"></div>
</div>
</div>
<div class="ui-resizable-handle" id="splitbar" style="-moz-user-select:none;">
</div>
</div>
<div id="doc-content">
<div class="header">
<div class="headertitle">
<div class="title">AbcExport/MayaTransformWriter.cpp</div> </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">//-*****************************************************************************</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Copyright (c) 2009-2012,</span></div>
<div class="line"><span class="comment">//  Sony Pictures Imageworks Inc. and</span></div>
<div class="line"><span class="comment">//  Industrial Light &amp; Magic, a division of Lucasfilm Entertainment Company Ltd.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// All rights reserved.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Redistribution and use in source and binary forms, with or without</span></div>
<div class="line"><span class="comment">// modification, are permitted provided that the following conditions are</span></div>
<div class="line"><span class="comment">// met:</span></div>
<div class="line"><span class="comment">// *       Redistributions of source code must retain the above copyright</span></div>
<div class="line"><span class="comment">// notice, this list of conditions and the following disclaimer.</span></div>
<div class="line"><span class="comment">// *       Redistributions in binary form must reproduce the above</span></div>
<div class="line"><span class="comment">// copyright notice, this list of conditions and the following disclaimer</span></div>
<div class="line"><span class="comment">// in the documentation and/or other materials provided with the</span></div>
<div class="line"><span class="comment">// distribution.</span></div>
<div class="line"><span class="comment">// *       Neither the name of Sony Pictures Imageworks, nor</span></div>
<div class="line"><span class="comment">// Industrial Light &amp; Magic, nor the names of their contributors may be used</span></div>
<div class="line"><span class="comment">// to endorse or promote products derived from this software without specific</span></div>
<div class="line"><span class="comment">// prior written permission.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span></div>
<div class="line"><span class="comment">// "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span></div>
<div class="line"><span class="comment">// LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span></div>
<div class="line"><span class="comment">// A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT</span></div>
<div class="line"><span class="comment">// OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span></div>
<div class="line"><span class="comment">// SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span></div>
<div class="line"><span class="comment">// LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span></div>
<div class="line"><span class="comment">// DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span></div>
<div class="line"><span class="comment">// THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span></div>
<div class="line"><span class="comment">// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span></div>
<div class="line"><span class="comment">// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//-*****************************************************************************</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include "MayaTransformWriter.h"</span></div>
<div class="line"><span class="preprocessor">#include "MayaUtility.h"</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> addTranslate(<span class="keyword">const</span> <a name="_a0"></a><a class="code" href="./class_m_fn_dependency_node.html">MFnDependencyNode</a> &amp; iTrans,</div>
<div class="line"> <a name="_a1"></a><a class="code" href="./class_m_string.html">MString</a> parentName, <a class="code" href="./class_m_string.html">MString</a> xName, <a class="code" href="./class_m_string.html">MString</a> yName, <a class="code" href="./class_m_string.html">MString</a> zName,</div>
<div class="line">    Alembic::Util::uint8_t iHint, <span class="keywordtype">bool</span> inverse, <span class="keywordtype">bool</span> forceStatic,</div>
<div class="line"> <span class="keywordtype">bool</span> forceAnimated, Alembic::AbcGeom::XformSample &amp; oSample,</div>
<div class="line">    std::vector &lt; AnimChan &gt; &amp; oAnimChanList)</div>
<div class="line">{</div>
<div class="line">    Alembic::AbcGeom::XformOp op(Alembic::AbcGeom::kTranslateOperation, iHint);</div>
<div class="line"></div>
<div class="line"> <a name="_a2"></a><a class="code" href="./class_m_plug.html">MPlug</a> xPlug = iTrans.<a name="a3"></a><a class="code" href="./class_m_fn_dependency_node.html#aac29b4a3b51c9d236175e955638f7153">findPlug</a>(xName, <span class="keyword">true</span>);</div>
<div class="line"> <span class="keywordtype">int</span> xSamp = 0;</div>
<div class="line"> <span class="keywordflow">if</span> (!forceStatic)</div>
<div class="line">    {</div>
<div class="line"> <span class="keywordflow">if</span> (!forceAnimated)</div>
<div class="line">            xSamp = util::getSampledType(xPlug);</div>
<div class="line"> <span class="keywordflow">else</span></div>
<div class="line">            xSamp = 1;</div>
<div class="line">    }</div>
<div class="line"> <span class="keywordtype">double</span> xVal = xPlug.<a name="a4"></a><a class="code" href="./class_m_plug.html#a62411b4c90ef50797f86b049bb1f934b">asDouble</a>();</div>
<div class="line"></div>
<div class="line"> <a class="code" href="./class_m_plug.html">MPlug</a> yPlug = iTrans.<a class="code" href="./class_m_fn_dependency_node.html#aac29b4a3b51c9d236175e955638f7153">findPlug</a>(yName, <span class="keyword">true</span>);</div>
<div class="line"> <span class="keywordtype">int</span> ySamp = 0;</div>
<div class="line"> <span class="keywordflow">if</span> (!forceStatic)</div>
<div class="line">    {</div>
<div class="line"> <span class="keywordflow">if</span> (!forceAnimated)</div>
<div class="line">            ySamp = util::getSampledType(yPlug);</div>
<div class="line"> <span class="keywordflow">else</span></div>
<div class="line">            ySamp = 1;</div>
<div class="line">    }</div>
<div class="line"> <span class="keywordtype">double</span> yVal = yPlug.<a class="code" href="./class_m_plug.html#a62411b4c90ef50797f86b049bb1f934b">asDouble</a>();</div>
<div class="line"></div>
<div class="line"> <a class="code" href="./class_m_plug.html">MPlug</a> zPlug = iTrans.<a class="code" href="./class_m_fn_dependency_node.html#aac29b4a3b51c9d236175e955638f7153">findPlug</a>(zName, <span class="keyword">true</span>);</div>
<div class="line"> <span class="keywordtype">int</span> zSamp = 0;</div>
<div class="line"> <span class="keywordflow">if</span> (!forceStatic)</div>
<div class="line">    {</div>
<div class="line"> <span class="keywordflow">if</span> (!forceAnimated)</div>
<div class="line">            zSamp = util::getSampledType(zPlug);</div>
<div class="line"> <span class="keywordflow">else</span></div>
<div class="line">            zSamp = 1;</div>
<div class="line">    }</div>
<div class="line"> <span class="keywordtype">double</span> zVal = zPlug.<a class="code" href="./class_m_plug.html#a62411b4c90ef50797f86b049bb1f934b">asDouble</a>();</div>
<div class="line"></div>
<div class="line"> <span class="comment">// this is to handle the case where there is a connection to the parent</span></div>
<div class="line"> <span class="comment">// plug but not to the child plugs, if the connection is there then all</span></div>
<div class="line"> <span class="comment">// of the children are considered animated</span></div>
<div class="line"> <a class="code" href="./class_m_plug.html">MPlug</a> parentPlug = iTrans.<a class="code" href="./class_m_fn_dependency_node.html#aac29b4a3b51c9d236175e955638f7153">findPlug</a>(parentName, <span class="keyword">true</span>);</div>
<div class="line"> <span class="keywordtype">int</span> parentSamp = 0;</div>
<div class="line"> <span class="keywordflow">if</span> (!forceStatic)</div>
<div class="line">    {</div>
<div class="line"> <span class="keywordflow">if</span> (!forceAnimated)</div>
<div class="line">            parentSamp = util::getSampledType(parentPlug);</div>
<div class="line"> <span class="keywordflow">else</span></div>
<div class="line">            parentSamp = 1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (parentSamp != 0)</div>
<div class="line">    {</div>
<div class="line">        xSamp = 1;</div>
<div class="line">        ySamp = 1;</div>
<div class="line">        zSamp = 1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <span class="comment">// something is sampled or not identity, add it to the stack</span></div>
<div class="line"> <span class="keywordflow">if</span> (xSamp != 0 || ySamp != 0 || zSamp != 0 || xVal != 0.0 || yVal != 0.0 ||</div>
<div class="line">        zVal != 0.0)</div>
<div class="line">    {</div>
<div class="line"> <span class="keywordflow">if</span> (inverse)</div>
<div class="line">        {</div>
<div class="line">            xVal = -xVal;</div>
<div class="line">            yVal = -yVal;</div>
<div class="line">            zVal = -zVal;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        op.setChannelValue(0, xVal);</div>
<div class="line">        op.setChannelValue(1, yVal);</div>
<div class="line">        op.setChannelValue(2, zVal);</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (xSamp != 0)</div>
<div class="line">        {</div>
<div class="line">            AnimChan chan;</div>
<div class="line">            chan.plug = xPlug;</div>
<div class="line">            chan.scale = 1.0;</div>
<div class="line"> <span class="keywordflow">if</span> (inverse)</div>
<div class="line">                chan.scale = -1.0;</div>
<div class="line">            chan.opNum = oSample.getNumOps();</div>
<div class="line">            chan.channelNum = 0;</div>
<div class="line">            oAnimChanList.push_back(chan);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (ySamp != 0)</div>
<div class="line">        {</div>
<div class="line">            AnimChan chan;</div>
<div class="line">            chan.plug = yPlug;</div>
<div class="line">            chan.scale = 1.0;</div>
<div class="line"> <span class="keywordflow">if</span> (inverse)</div>
<div class="line">                chan.scale = -1.0;</div>
<div class="line">            chan.opNum = oSample.getNumOps();</div>
<div class="line">            chan.channelNum = 1;</div>
<div class="line">            oAnimChanList.push_back(chan);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (zSamp != 0)</div>
<div class="line">        {</div>
<div class="line">            AnimChan chan;</div>
<div class="line">            chan.plug = zPlug;</div>
<div class="line">            chan.scale = 1.0;</div>
<div class="line"> <span class="keywordflow">if</span> (inverse)</div>
<div class="line">                chan.scale = -1.0;</div>
<div class="line">            chan.opNum = oSample.getNumOps();</div>
<div class="line">            chan.channelNum = 2;</div>
<div class="line">            oAnimChanList.push_back(chan);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        oSample.addOp(op);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// names need to be passed in x,y,z order, iOrder is the order to</span></div>
<div class="line"><span class="comment">// use these indices</span></div>
<div class="line"><span class="keywordtype">void</span> addRotate(<span class="keyword">const</span> <a class="code" href="./class_m_fn_dependency_node.html">MFnDependencyNode</a> &amp; iTrans,</div>
<div class="line"> <a class="code" href="./class_m_string.html">MString</a> parentName, <span class="keyword">const</span> <a class="code" href="./class_m_string.html">MString</a>* iNames, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>* iOrder,</div>
<div class="line">    Alembic::Util::uint8_t iHint, <span class="keywordtype">bool</span> forceStatic, <span class="keywordtype">bool</span> forceAnimated,</div>
<div class="line">    Alembic::AbcGeom::XformSample &amp; oSample,</div>
<div class="line">    std::vector &lt; AnimChan &gt; &amp; oAnimChanList,</div>
<div class="line"> <span class="keywordtype">size_t</span> oOpIndex[3])</div>
<div class="line">{</div>
<div class="line"> <span class="comment">// for each possible rotation axis</span></div>
<div class="line"> <span class="keyword">static</span> <span class="keyword">const</span> Alembic::AbcGeom::XformOperationType rots[3] = {</div>
<div class="line">         Alembic::AbcGeom::kRotateXOperation,</div>
<div class="line">         Alembic::AbcGeom::kRotateYOperation,</div>
<div class="line">         Alembic::AbcGeom::kRotateZOperation</div>
<div class="line">    };</div>
<div class="line"></div>
<div class="line"> <span class="comment">// this is to handle the case where there is a connection to the parent</span></div>
<div class="line"> <span class="comment">// plug but not to the child plugs, if the connection is there then all</span></div>
<div class="line"> <span class="comment">// of the children are considered animated</span></div>
<div class="line"> <a class="code" href="./class_m_plug.html">MPlug</a> parentPlug = iTrans.<a class="code" href="./class_m_fn_dependency_node.html#aac29b4a3b51c9d236175e955638f7153">findPlug</a>(parentName, <span class="keyword">true</span>);</div>
<div class="line"> <span class="keywordtype">int</span> parentSamp = 0;</div>
<div class="line"> <span class="keywordflow">if</span> (!forceStatic)</div>
<div class="line">    {</div>
<div class="line"> <span class="keywordflow">if</span> (!forceAnimated)</div>
<div class="line">            parentSamp = util::getSampledType(parentPlug);</div>
<div class="line"> <span class="keywordflow">else</span></div>
<div class="line">            parentSamp = 1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <span class="comment">// whether we are using the XYZ rotation order</span></div>
<div class="line"> <span class="keywordtype">bool</span> isXYZ = ((iOrder[0] == 0) &amp;&amp; (iOrder[1] == 1) &amp;&amp; (iOrder[2] == 2));</div>
<div class="line"></div>
<div class="line"> <span class="comment">// add them in backwards since we are dealing with a stack</span></div>
<div class="line"> <span class="keywordtype">int</span> i = 2;</div>
<div class="line"> <span class="keywordflow">for</span> (; i &gt; -1; i--)</div>
<div class="line">    {</div>
<div class="line"> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> index = iOrder[i];</div>
<div class="line"> <a class="code" href="./class_m_plug.html">MPlug</a> plug = iTrans.<a class="code" href="./class_m_fn_dependency_node.html#aac29b4a3b51c9d236175e955638f7153">findPlug</a>(iNames[index], <span class="keyword">true</span>);</div>
<div class="line"> <span class="keywordtype">int</span> samp = 0;</div>
<div class="line"> <span class="keywordflow">if</span> (!forceStatic)</div>
<div class="line">        {</div>
<div class="line"> <span class="keywordflow">if</span> (!forceAnimated)</div>
<div class="line">                samp = util::getSampledType(plug);</div>
<div class="line"> <span class="keywordflow">else</span></div>
<div class="line">                samp = 1;</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (samp == 0)</div>
<div class="line">                samp = parentSamp;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line"> <span class="keywordtype">double</span> plugVal = plug.<a class="code" href="./class_m_plug.html#a62411b4c90ef50797f86b049bb1f934b">asDouble</a>();</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">        Alembic::AbcGeom::XformOp op(rots[index], iHint);</div>
<div class="line">        op.setChannelValue(0, Alembic::AbcGeom::RadiansToDegrees(plugVal));</div>
<div class="line"></div>
<div class="line"> <span class="comment">// the sampled case</span></div>
<div class="line"> <span class="keywordflow">if</span> (samp != 0)</div>
<div class="line">        {</div>
<div class="line">            AnimChan chan;</div>
<div class="line">            chan.plug = plug;</div>
<div class="line">            chan.scale = Alembic::AbcGeom::RadiansToDegrees(1.0);</div>
<div class="line">            chan.opNum = oSample.getNumOps();</div>
<div class="line">            chan.channelNum = 0;</div>
<div class="line">            oAnimChanList.push_back(chan);</div>
<div class="line">        }</div>
<div class="line"> <span class="comment">// non sampled, XYZ axis and the angle is 0, do not add to the stack</span></div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isXYZ &amp;&amp; plugVal == 0.0)</div>
<div class="line"> <span class="keywordflow">continue</span>;</div>
<div class="line"></div>
<div class="line">        oOpIndex[index] = oSample.addOp(op);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// the test on whether or not to add it is very similiar to addTranslate</span></div>
<div class="line"><span class="comment">// but the operation it creates is very different</span></div>
<div class="line"><span class="keywordtype">void</span> addShear(<span class="keyword">const</span> <a class="code" href="./class_m_fn_dependency_node.html">MFnDependencyNode</a> &amp; iTrans, <span class="keywordtype">bool</span> forceStatic,</div>
<div class="line">    Alembic::AbcGeom::XformSample &amp; oSample,</div>
<div class="line">    std::vector &lt; AnimChan &gt; &amp; oAnimChanList)</div>
<div class="line">{</div>
<div class="line">    Alembic::AbcGeom::XformOp op(Alembic::AbcGeom::kMatrixOperation,</div>
<div class="line">        Alembic::AbcGeom::kMayaShearHint);</div>
<div class="line"></div>
<div class="line"> <a class="code" href="./class_m_string.html">MString</a> str = <span class="stringliteral">"shearXY"</span>;</div>
<div class="line"> <a class="code" href="./class_m_plug.html">MPlug</a> xyPlug = iTrans.<a class="code" href="./class_m_fn_dependency_node.html#aac29b4a3b51c9d236175e955638f7153">findPlug</a>(str, <span class="keyword">true</span>);</div>
<div class="line"> <span class="keywordtype">int</span> xySamp = 0;</div>
<div class="line"> <span class="keywordflow">if</span> (!forceStatic)</div>
<div class="line">    {</div>
<div class="line">        xySamp = util::getSampledType(xyPlug);</div>
<div class="line">    }</div>
<div class="line"> <span class="keywordtype">double</span> xyVal = xyPlug.<a class="code" href="./class_m_plug.html#a62411b4c90ef50797f86b049bb1f934b">asDouble</a>();</div>
<div class="line"></div>
<div class="line">    str = <span class="stringliteral">"shearXZ"</span>;</div>
<div class="line"> <a class="code" href="./class_m_plug.html">MPlug</a> xzPlug = iTrans.<a class="code" href="./class_m_fn_dependency_node.html#aac29b4a3b51c9d236175e955638f7153">findPlug</a>(str, <span class="keyword">true</span>);</div>
<div class="line"> <span class="keywordtype">int</span> xzSamp = 0;</div>
<div class="line"> <span class="keywordflow">if</span> (!forceStatic)</div>
<div class="line">    {</div>
<div class="line">        xzSamp = util::getSampledType(xzPlug);</div>
<div class="line">    }</div>
<div class="line"> <span class="keywordtype">double</span> xzVal = xzPlug.<a class="code" href="./class_m_plug.html#a62411b4c90ef50797f86b049bb1f934b">asDouble</a>();</div>
<div class="line"></div>
<div class="line">    str = <span class="stringliteral">"shearYZ"</span>;</div>
<div class="line"> <a class="code" href="./class_m_plug.html">MPlug</a> yzPlug = iTrans.<a class="code" href="./class_m_fn_dependency_node.html#aac29b4a3b51c9d236175e955638f7153">findPlug</a>(str, <span class="keyword">true</span>);</div>
<div class="line"> <span class="keywordtype">int</span> yzSamp = 0;</div>
<div class="line"> <span class="keywordflow">if</span> (!forceStatic)</div>
<div class="line">    {</div>
<div class="line">        yzSamp = util::getSampledType(yzPlug);</div>
<div class="line">    }</div>
<div class="line"> <span class="keywordtype">double</span> yzVal = yzPlug.<a class="code" href="./class_m_plug.html#a62411b4c90ef50797f86b049bb1f934b">asDouble</a>();</div>
<div class="line"></div>
<div class="line"> <span class="comment">// this is to handle the case where there is a connection to the parent</span></div>
<div class="line"> <span class="comment">// plug but not to the child plugs, if the connection is there then all</span></div>
<div class="line"> <span class="comment">// of the children are considered animated</span></div>
<div class="line">    str = <span class="stringliteral">"shear"</span>;</div>
<div class="line"> <a class="code" href="./class_m_plug.html">MPlug</a> parentPlug = iTrans.<a class="code" href="./class_m_fn_dependency_node.html#aac29b4a3b51c9d236175e955638f7153">findPlug</a>(str, <span class="keyword">true</span>);</div>
<div class="line"> <span class="keywordflow">if</span> (!forceStatic &amp;&amp; util::getSampledType(parentPlug) != 0)</div>
<div class="line">    {</div>
<div class="line">        xySamp = 1;</div>
<div class="line">        xzSamp = 1;</div>
<div class="line">        yzSamp = 1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <span class="comment">// something is sampled or not identity, add it to the stack</span></div>
<div class="line"> <span class="keywordflow">if</span> (xySamp != 0 || xzSamp != 0 || yzSamp != 0 ||</div>
<div class="line">        xyVal != 0.0 || xzVal != 0.0 || yzVal != 0.0)</div>
<div class="line">    {</div>
<div class="line">        Alembic::Abc::M44d m;</div>
<div class="line">        m.makeIdentity();</div>
<div class="line">        op.setMatrix(m);</div>
<div class="line">        op.setChannelValue(4, xyVal);</div>
<div class="line">        op.setChannelValue(8, xzVal);</div>
<div class="line">        op.setChannelValue(9, yzVal);</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (xySamp != 0)</div>
<div class="line">        {</div>
<div class="line">            AnimChan chan;</div>
<div class="line">            chan.plug = xyPlug;</div>
<div class="line">            chan.scale = 1.0;</div>
<div class="line">            chan.opNum = oSample.getNumOps();</div>
<div class="line">            chan.channelNum = 4;</div>
<div class="line">            oAnimChanList.push_back(chan);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (xzSamp != 0)</div>
<div class="line">        {</div>
<div class="line">            AnimChan chan;</div>
<div class="line">            chan.plug = xzPlug;</div>
<div class="line">            chan.scale = 1.0;</div>
<div class="line">            chan.opNum = oSample.getNumOps();</div>
<div class="line">            chan.channelNum = 8;</div>
<div class="line">            oAnimChanList.push_back(chan);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (yzSamp != 0)</div>
<div class="line">        {</div>
<div class="line">            AnimChan chan;</div>
<div class="line">            chan.plug = yzPlug;</div>
<div class="line">            chan.scale = 1.0;</div>
<div class="line">            chan.opNum = oSample.getNumOps();</div>
<div class="line">            chan.channelNum = 9;</div>
<div class="line">            oAnimChanList.push_back(chan);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        oSample.addOp(op);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// this test is very similiar to addTranslate, except that it doesn't add it</span></div>
<div class="line"><span class="comment">// to the stack if x,y, and z are 1.0</span></div>
<div class="line"><span class="keywordtype">void</span> addScale(<span class="keyword">const</span> <a class="code" href="./class_m_fn_dependency_node.html">MFnDependencyNode</a> &amp; iTrans,</div>
<div class="line"> <a class="code" href="./class_m_string.html">MString</a> parentName, <a class="code" href="./class_m_string.html">MString</a> xName, <a class="code" href="./class_m_string.html">MString</a> yName, <a class="code" href="./class_m_string.html">MString</a> zName, <span class="keywordtype">bool</span> inverse,</div>
<div class="line"> <span class="keywordtype">bool</span> forceStatic, <span class="keywordtype">bool</span> forceAnimated, Alembic::AbcGeom::XformSample &amp; oSample,</div>
<div class="line">    std::vector &lt; AnimChan &gt; &amp; oAnimChanList)</div>
<div class="line">{</div>
<div class="line"></div>
<div class="line">    Alembic::AbcGeom::XformOp op(Alembic::AbcGeom::kScaleOperation,</div>
<div class="line">        Alembic::AbcGeom::kScaleHint);</div>
<div class="line"></div>
<div class="line"> <a class="code" href="./class_m_plug.html">MPlug</a> xPlug = iTrans.<a class="code" href="./class_m_fn_dependency_node.html#aac29b4a3b51c9d236175e955638f7153">findPlug</a>(xName, <span class="keyword">true</span>);</div>
<div class="line"> <span class="keywordtype">int</span> xSamp = 0;</div>
<div class="line"> <span class="keywordflow">if</span> (!forceStatic)</div>
<div class="line">    {</div>
<div class="line"> <span class="keywordflow">if</span> (!forceAnimated)</div>
<div class="line">            xSamp = util::getSampledType(xPlug);</div>
<div class="line"> <span class="keywordflow">else</span></div>
<div class="line">            xSamp = 1;</div>
<div class="line">    }</div>
<div class="line"> <span class="keywordtype">double</span> xVal = xPlug.<a class="code" href="./class_m_plug.html#a62411b4c90ef50797f86b049bb1f934b">asDouble</a>();</div>
<div class="line"></div>
<div class="line"> <a class="code" href="./class_m_plug.html">MPlug</a> yPlug = iTrans.<a class="code" href="./class_m_fn_dependency_node.html#aac29b4a3b51c9d236175e955638f7153">findPlug</a>(yName, <span class="keyword">true</span>);</div>
<div class="line"> <span class="keywordtype">int</span> ySamp = 0;</div>
<div class="line"> <span class="keywordflow">if</span> (!forceStatic)</div>
<div class="line">    {</div>
<div class="line"> <span class="keywordflow">if</span> (!forceAnimated)</div>
<div class="line">            ySamp = util::getSampledType(yPlug);</div>
<div class="line"> <span class="keywordflow">else</span></div>
<div class="line">            ySamp = 1;</div>
<div class="line">    }</div>
<div class="line"> <span class="keywordtype">double</span> yVal = yPlug.<a class="code" href="./class_m_plug.html#a62411b4c90ef50797f86b049bb1f934b">asDouble</a>();</div>
<div class="line"></div>
<div class="line"> <a class="code" href="./class_m_plug.html">MPlug</a> zPlug = iTrans.<a class="code" href="./class_m_fn_dependency_node.html#aac29b4a3b51c9d236175e955638f7153">findPlug</a>(zName, <span class="keyword">true</span>);</div>
<div class="line"> <span class="keywordtype">int</span> zSamp = 0;</div>
<div class="line"> <span class="keywordflow">if</span> (!forceStatic)</div>
<div class="line">    {</div>
<div class="line"> <span class="keywordflow">if</span> (!forceAnimated)</div>
<div class="line">            zSamp = util::getSampledType(zPlug);</div>
<div class="line"> <span class="keywordflow">else</span></div>
<div class="line">            zSamp = 1;</div>
<div class="line">    }</div>
<div class="line"> <span class="keywordtype">double</span> zVal = zPlug.<a class="code" href="./class_m_plug.html#a62411b4c90ef50797f86b049bb1f934b">asDouble</a>();</div>
<div class="line"></div>
<div class="line"> <span class="comment">// this is to handle the case where there is a connection to the parent</span></div>
<div class="line"> <span class="comment">// plug but not to the child plugs, if the connection is there then all</span></div>
<div class="line"> <span class="comment">// of the children are considered animated</span></div>
<div class="line"> <a class="code" href="./class_m_plug.html">MPlug</a> parentPlug = iTrans.<a class="code" href="./class_m_fn_dependency_node.html#aac29b4a3b51c9d236175e955638f7153">findPlug</a>(parentName, <span class="keyword">true</span>);</div>
<div class="line"> <span class="keywordtype">int</span> parentSamp = 0;</div>
<div class="line"> <span class="keywordflow">if</span> (!forceStatic)</div>
<div class="line">    {</div>
<div class="line"> <span class="keywordflow">if</span> (!forceAnimated)</div>
<div class="line">            parentSamp = util::getSampledType(parentPlug);</div>
<div class="line"> <span class="keywordflow">else</span></div>
<div class="line">            parentSamp = 1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (parentSamp != 0)</div>
<div class="line">    {</div>
<div class="line">        xSamp = 1;</div>
<div class="line">        ySamp = 1;</div>
<div class="line">        zSamp = 1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <span class="comment">// something is sampled or not identity, add it to the stack</span></div>
<div class="line"> <span class="keywordflow">if</span> (xSamp != 0 || ySamp != 0 || zSamp != 0 || xVal != 1.0 || yVal != 1.0 ||</div>
<div class="line">        zVal != 1.0)</div>
<div class="line">    {</div>
<div class="line"> <span class="keywordflow">if</span> (inverse)</div>
<div class="line">        {</div>
<div class="line">            xVal = util::inverseScale(xVal);</div>
<div class="line">            yVal = util::inverseScale(yVal);</div>
<div class="line">            zVal = util::inverseScale(zVal);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        op.setChannelValue(0, xVal);</div>
<div class="line">        op.setChannelValue(1, yVal);</div>
<div class="line">        op.setChannelValue(2, zVal);</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (xSamp != 0)</div>
<div class="line">        {</div>
<div class="line">            AnimChan chan;</div>
<div class="line">            chan.plug = xPlug;</div>
<div class="line">            chan.scale = 1.0;</div>
<div class="line"> <span class="keywordflow">if</span> (inverse)</div>
<div class="line">                chan.scale = -std::numeric_limits&lt;double&gt;::infinity();</div>
<div class="line">            chan.opNum = oSample.getNumOps();</div>
<div class="line">            chan.channelNum = 0;</div>
<div class="line">            oAnimChanList.push_back(chan);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (ySamp != 0)</div>
<div class="line">        {</div>
<div class="line">            AnimChan chan;</div>
<div class="line">            chan.plug = yPlug;</div>
<div class="line">            chan.scale = 1.0;</div>
<div class="line"> <span class="keywordflow">if</span> (inverse)</div>
<div class="line">                chan.scale = -std::numeric_limits&lt;double&gt;::infinity();</div>
<div class="line">            chan.opNum = oSample.getNumOps();</div>
<div class="line">            chan.channelNum = 1;</div>
<div class="line">            oAnimChanList.push_back(chan);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (zSamp != 0)</div>
<div class="line">        {</div>
<div class="line">            AnimChan chan;</div>
<div class="line">            chan.plug = zPlug;</div>
<div class="line">            chan.scale = 1.0;</div>
<div class="line"> <span class="keywordflow">if</span> (inverse)</div>
<div class="line">                chan.scale = -std::numeric_limits&lt;double&gt;::infinity();</div>
<div class="line">            chan.opNum = oSample.getNumOps();</div>
<div class="line">            chan.channelNum = 2;</div>
<div class="line">            oAnimChanList.push_back(chan);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        oSample.addOp(op);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">bool</span> getSampledRotation(<span class="keyword">const</span> Alembic::AbcGeom::XformSample&amp; sample,</div>
<div class="line"> <span class="keyword">const</span> <span class="keywordtype">size_t</span> opIndex[3], <span class="keywordtype">double</span>&amp; xx, <span class="keywordtype">double</span>&amp; yy, <span class="keywordtype">double</span>&amp; zz)</div>
<div class="line">{</div>
<div class="line"> <span class="keywordtype">bool</span> success = <span class="keyword">false</span>;</div>
<div class="line"></div>
<div class="line">    xx = 0.0;</div>
<div class="line"> <span class="keywordflow">if</span> (opIndex[0] &lt; sample.getNumOps())</div>
<div class="line">    {</div>
<div class="line"> <span class="keywordtype">double</span> angleX = sample[opIndex[0]].getChannelValue(0);</div>
<div class="line">        xx = Alembic::AbcGeom::DegreesToRadians(angleX);</div>
<div class="line">        success = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    yy = 0.0;</div>
<div class="line"> <span class="keywordflow">if</span> (opIndex[1] &lt; sample.getNumOps())</div>
<div class="line">    {</div>
<div class="line"> <span class="keywordtype">double</span> angleY = sample[opIndex[1]].getChannelValue(0);</div>
<div class="line">        yy = Alembic::AbcGeom::DegreesToRadians(angleY);</div>
<div class="line">        success = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    zz = 0.0;</div>
<div class="line"> <span class="keywordflow">if</span> (opIndex[2] &lt; sample.getNumOps())</div>
<div class="line">    {</div>
<div class="line"> <span class="keywordtype">double</span> angleZ = sample[opIndex[2]].getChannelValue(0);</div>
<div class="line">        zz = Alembic::AbcGeom::DegreesToRadians(angleZ);</div>
<div class="line">        success = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">return</span> success;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">bool</span> setSampledRotation(Alembic::AbcGeom::XformSample&amp; sample,</div>
<div class="line"> <span class="keyword">const</span> <span class="keywordtype">size_t</span> opIndex[3], <span class="keywordtype">double</span> xx, <span class="keywordtype">double</span> yy, <span class="keywordtype">double</span> zz)</div>
<div class="line">{</div>
<div class="line"> <span class="keywordtype">bool</span> success = <span class="keyword">false</span>;</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (opIndex[0] &lt; sample.getNumOps())</div>
<div class="line">    {</div>
<div class="line">        sample[opIndex[0]].setChannelValue(0, Alembic::AbcGeom::RadiansToDegrees(xx));</div>
<div class="line">        success = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (opIndex[1] &lt; sample.getNumOps())</div>
<div class="line">    {</div>
<div class="line">        sample[opIndex[1]].setChannelValue(0, Alembic::AbcGeom::RadiansToDegrees(yy));</div>
<div class="line">        success = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (opIndex[2] &lt; sample.getNumOps())</div>
<div class="line">    {</div>
<div class="line">        sample[opIndex[2]].setChannelValue(0, Alembic::AbcGeom::RadiansToDegrees(zz));</div>
<div class="line">        success = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">return</span> success;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">MayaTransformWriter::MayaTransformWriter(Alembic::AbcGeom::OObject &amp; iParent,</div>
<div class="line"> <a name="_a5"></a><a class="code" href="./class_m_dag_path.html">MDagPath</a> &amp; iDag, Alembic::Util::uint32_t iTimeIndex, <span class="keyword">const</span> JobArgs &amp; iArgs)</div>
<div class="line">{</div>
<div class="line">    mFilterEulerRotations = iArgs.filterEulerRotations;</div>
<div class="line">    mJointOrientOpIndex[0] = mJointOrientOpIndex[1] = mJointOrientOpIndex[2] =</div>
<div class="line">    mRotateOpIndex[0]      = mRotateOpIndex[1]      = mRotateOpIndex[2]      =</div>
<div class="line">    mRotateAxisOpIndex[0]  = mRotateAxisOpIndex[1]  = mRotateAxisOpIndex[2]  = ~size_t(0);</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (iDag.<a name="a6"></a><a class="code" href="./class_m_dag_path.html#a5901f0fa543d32fb13756c2d004f37ae">hasFn</a>(<a name="a7"></a><a class="code" href="./class_m_fn.html#a1d1cfd8ffb84e947f82999c682b666a7ab8b14d1ed753088b316e8ee8c5d38ca9">MFn::kJoint</a>))</div>
<div class="line">    {</div>
<div class="line"> <a name="_a8"></a><a class="code" href="./class_m_fn_ik_joint.html">MFnIkJoint</a> joint(iDag);</div>
<div class="line"> <a class="code" href="./class_m_string.html">MString</a> jointName = joint.name();</div>
<div class="line"></div>
<div class="line">        jointName = util::stripNamespaces(jointName, iArgs.stripNamespace);</div>
<div class="line"></div>
<div class="line">        Alembic::AbcGeom::OXform obj(iParent, jointName.<a name="a9"></a><a class="code" href="./class_m_string.html#aa9ab612f356c53479afc4c648c9ef94d">asChar</a>(),</div>
<div class="line">            iTimeIndex);</div>
<div class="line">        mSchema = obj.getSchema();</div>
<div class="line"></div>
<div class="line">        Alembic::Abc::OCompoundProperty cp;</div>
<div class="line">        Alembic::Abc::OCompoundProperty up;</div>
<div class="line"> <span class="keywordflow">if</span> (AttributesWriter::hasAnyAttr(joint, iArgs))</div>
<div class="line">        {</div>
<div class="line">            cp = mSchema.getArbGeomParams();</div>
<div class="line">            up = mSchema.getUserProperties();</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        mAttrs = AttributesWriterPtr(<span class="keyword">new</span> AttributesWriter(cp, up, obj, joint,</div>
<div class="line">            iTimeIndex, iArgs, <span class="keyword">false</span>));</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (!iArgs.writeTransforms)</div>
<div class="line">        {</div>
<div class="line"> <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (!iArgs.worldSpace)</div>
<div class="line">        {</div>
<div class="line">            pushTransformStack(joint, iTimeIndex == 0);</div>
<div class="line"></div>
<div class="line"> <span class="comment">// need to look at inheritsTransform</span></div>
<div class="line"> <a name="_a10"></a><a class="code" href="./class_m_fn_dag_node.html">MFnDagNode</a> dagNode(iDag);</div>
<div class="line"> <a class="code" href="./class_m_plug.html">MPlug</a> inheritPlug = dagNode.findPlug(<span class="stringliteral">"inheritsTransform"</span>, <span class="keyword">true</span>);</div>
<div class="line"> <span class="keywordflow">if</span> (!inheritPlug.<a name="a11"></a><a class="code" href="./class_m_plug.html#ab7ec149d38b7c29ca55c5aa7b407d8f9">isNull</a>())</div>
<div class="line">            {</div>
<div class="line"> <span class="keywordflow">if</span> (util::getSampledType(inheritPlug) != 0)</div>
<div class="line">                {</div>
<div class="line">                    mInheritsPlug = inheritPlug;</div>
<div class="line">                }</div>
<div class="line">                mSample.setInheritsXforms(inheritPlug.<a name="a12"></a><a class="code" href="./class_m_plug.html#a69b4092a85b4edf58b7d50f331cc38cf">asBool</a>());</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line"> <span class="comment">// no animated inherits plug and no animated samples?</span></div>
<div class="line"> <span class="comment">// then use the default time sampling</span></div>
<div class="line"> <span class="keywordflow">if</span> (mAnimChanList.empty() &amp;&amp; mInheritsPlug.isNull())</div>
<div class="line">            {</div>
<div class="line">                mSchema.setTimeSampling(0);</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line"> <span class="comment">// everything is default, don't write anything</span></div>
<div class="line"> <span class="keywordflow">if</span> (mSample.getNumOps() == 0 &amp;&amp; mSample.getInheritsXforms())</div>
<div class="line">            {</div>
<div class="line"> <span class="keywordflow">return</span>;</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            mSchema.set(mSample);</div>
<div class="line"> <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line"> <a name="_a13"></a><a class="code" href="./class_m_fn_transform.html">MFnTransform</a> trans(iDag);</div>
<div class="line"> <a class="code" href="./class_m_string.html">MString</a> transName = trans.name();</div>
<div class="line"></div>
<div class="line">        transName = util::stripNamespaces(transName, iArgs.stripNamespace);</div>
<div class="line"></div>
<div class="line">        Alembic::AbcGeom::OXform obj(iParent, transName.<a class="code" href="./class_m_string.html#aa9ab612f356c53479afc4c648c9ef94d">asChar</a>(),</div>
<div class="line">            iTimeIndex);</div>
<div class="line">        mSchema = obj.getSchema();</div>
<div class="line"></div>
<div class="line">        Alembic::Abc::OCompoundProperty cp;</div>
<div class="line">        Alembic::Abc::OCompoundProperty up;</div>
<div class="line"> <span class="keywordflow">if</span> (AttributesWriter::hasAnyAttr(trans, iArgs))</div>
<div class="line">        {</div>
<div class="line">            cp = mSchema.getArbGeomParams();</div>
<div class="line">            up = mSchema.getUserProperties();</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        mAttrs = AttributesWriterPtr(<span class="keyword">new</span> AttributesWriter(cp, up, obj, trans,</div>
<div class="line">            iTimeIndex, iArgs, <span class="keyword">false</span>));</div>
<div class="line"> <span class="keywordflow">if</span> (!iArgs.writeTransforms)</div>
<div class="line">        {</div>
<div class="line"> <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (!iArgs.worldSpace)</div>
<div class="line">        {</div>
<div class="line">            pushTransformStack(trans, iTimeIndex == 0);</div>
<div class="line"></div>
<div class="line"> <span class="comment">// need to look at inheritsTransform</span></div>
<div class="line"> <a class="code" href="./class_m_fn_dag_node.html">MFnDagNode</a> dagNode(iDag);</div>
<div class="line"> <a class="code" href="./class_m_plug.html">MPlug</a> inheritPlug = dagNode.findPlug(<span class="stringliteral">"inheritsTransform"</span>, <span class="keyword">true</span>);</div>
<div class="line"> <span class="keywordflow">if</span> (!inheritPlug.<a class="code" href="./class_m_plug.html#ab7ec149d38b7c29ca55c5aa7b407d8f9">isNull</a>())</div>
<div class="line">            {</div>
<div class="line"> <span class="keywordflow">if</span> (util::getSampledType(inheritPlug) != 0)</div>
<div class="line">                {</div>
<div class="line">                    mInheritsPlug = inheritPlug;</div>
<div class="line">                }</div>
<div class="line">                mSample.setInheritsXforms(inheritPlug.<a class="code" href="./class_m_plug.html#a69b4092a85b4edf58b7d50f331cc38cf">asBool</a>());</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line"> <span class="comment">// no animated inherits plug and no animated samples?</span></div>
<div class="line"> <span class="comment">// then use the default time sampling</span></div>
<div class="line"> <span class="keywordflow">if</span> (mAnimChanList.empty() &amp;&amp; mInheritsPlug.isNull())</div>
<div class="line">            {</div>
<div class="line">                mSchema.setTimeSampling(0);</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line"> <span class="comment">// everything is default, don't write anything</span></div>
<div class="line"> <span class="keywordflow">if</span> (mSample.getNumOps() == 0 &amp;&amp; mSample.getInheritsXforms())</div>
<div class="line">            {</div>
<div class="line"> <span class="keywordflow">return</span>;</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            mSchema.set(mSample);</div>
<div class="line"> <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <span class="comment">// if we didn't bail early then we need to add all the transform</span></div>
<div class="line"> <span class="comment">// information at the current node and above</span></div>
<div class="line"></div>
<div class="line"> <span class="comment">// copy the dag path because we'll be popping from it</span></div>
<div class="line"> <a class="code" href="./class_m_dag_path.html">MDagPath</a> dag(iDag);</div>
<div class="line"></div>
<div class="line"> <span class="keywordtype">int</span> i;</div>
<div class="line"> <span class="keywordtype">int</span> numPaths = dag.length();</div>
<div class="line">    std::vector&lt; MDagPath &gt; dagList;</div>
<div class="line"> <span class="keywordflow">for</span> (i = numPaths - 1; i &gt; -1; i--, dag.pop())</div>
<div class="line">    {</div>
<div class="line">        dagList.push_back(dag);</div>
<div class="line"></div>
<div class="line"> <span class="comment">// inheritsTransform exists on both joints and transforms</span></div>
<div class="line"> <a class="code" href="./class_m_fn_dag_node.html">MFnDagNode</a> dagNode(dag);</div>
<div class="line"> <a class="code" href="./class_m_plug.html">MPlug</a> inheritPlug = dagNode.findPlug(<span class="stringliteral">"inheritsTransform"</span>, <span class="keyword">true</span>);</div>
<div class="line"></div>
<div class="line"> <span class="comment">// if inheritsTransform exists and is set to false, then we</span></div>
<div class="line"> <span class="comment">// don't need to worry about ancestor nodes above this one</span></div>
<div class="line"> <span class="keywordflow">if</span> (!inheritPlug.<a class="code" href="./class_m_plug.html#ab7ec149d38b7c29ca55c5aa7b407d8f9">isNull</a>() &amp;&amp; !inheritPlug.<a class="code" href="./class_m_plug.html#a69b4092a85b4edf58b7d50f331cc38cf">asBool</a>())</div>
<div class="line"> <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    std::vector&lt; MDagPath &gt;::iterator iStart = dagList.begin();</div>
<div class="line"></div>
<div class="line">    std::vector&lt; MDagPath &gt;::iterator iCur = dagList.end();</div>
<div class="line">    iCur--;</div>
<div class="line"></div>
<div class="line"> <span class="comment">// now loop backwards over our dagpath list so we push ancestor nodes</span></div>
<div class="line"> <span class="comment">// first, all the way down to the current node</span></div>
<div class="line"> <span class="keywordflow">for</span> (; iCur != iStart; iCur--)</div>
<div class="line">    {</div>
<div class="line"> <span class="comment">// only add it to the stack don't write it yet!</span></div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (iCur-&gt;hasFn(<a class="code" href="./class_m_fn.html#a1d1cfd8ffb84e947f82999c682b666a7ab8b14d1ed753088b316e8ee8c5d38ca9">MFn::kJoint</a>))</div>
<div class="line">        {</div>
<div class="line"> <a class="code" href="./class_m_fn_ik_joint.html">MFnIkJoint</a> joint(*iCur);</div>
<div class="line">            pushTransformStack(joint, iTimeIndex == 0);</div>
<div class="line">        }</div>
<div class="line"> <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line"> <a class="code" href="./class_m_fn_transform.html">MFnTransform</a> trans(*iCur);</div>
<div class="line">            pushTransformStack(trans, iTimeIndex == 0);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <span class="comment">// finally add any transform info on the final node and write it</span></div>
<div class="line"> <span class="keywordflow">if</span> (iCur-&gt;hasFn(<a class="code" href="./class_m_fn.html#a1d1cfd8ffb84e947f82999c682b666a7ab8b14d1ed753088b316e8ee8c5d38ca9">MFn::kJoint</a>))</div>
<div class="line">    {</div>
<div class="line"> <a class="code" href="./class_m_fn_ik_joint.html">MFnIkJoint</a> joint(*iCur);</div>
<div class="line">        pushTransformStack(joint, iTimeIndex == 0);</div>
<div class="line">    }</div>
<div class="line"> <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line"> <a class="code" href="./class_m_fn_transform.html">MFnTransform</a> trans(*iCur);</div>
<div class="line">        pushTransformStack(trans, iTimeIndex == 0);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <span class="comment">// need to look at inheritsTransform</span></div>
<div class="line"> <a class="code" href="./class_m_fn_dag_node.html">MFnDagNode</a> dagNode(iDag);</div>
<div class="line"> <a class="code" href="./class_m_plug.html">MPlug</a> inheritPlug = dagNode.findPlug(<span class="stringliteral">"inheritsTransform"</span>, <span class="keyword">true</span>);</div>
<div class="line"> <span class="keywordflow">if</span> (!inheritPlug.<a class="code" href="./class_m_plug.html#ab7ec149d38b7c29ca55c5aa7b407d8f9">isNull</a>())</div>
<div class="line">    {</div>
<div class="line"> <span class="keywordflow">if</span> (util::getSampledType(inheritPlug) != 0)</div>
<div class="line">        {</div>
<div class="line">            mInheritsPlug = inheritPlug;</div>
<div class="line">        }</div>
<div class="line">        mSample.setInheritsXforms(inheritPlug.<a class="code" href="./class_m_plug.html#a69b4092a85b4edf58b7d50f331cc38cf">asBool</a>());</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <span class="comment">// no animated inherits plug and no animated samples?</span></div>
<div class="line"> <span class="comment">// then use the default time sampling</span></div>
<div class="line"> <span class="keywordflow">if</span> (mAnimChanList.empty() &amp;&amp; mInheritsPlug.isNull())</div>
<div class="line">    {</div>
<div class="line">        mSchema.setTimeSampling(0);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <span class="comment">// everything is default, don't write anything and use the default</span></div>
<div class="line"> <span class="comment">// time sampling</span></div>
<div class="line"> <span class="keywordflow">if</span> (mSample.getNumOps() == 0 &amp;&amp; mSample.getInheritsXforms())</div>
<div class="line">    {</div>
<div class="line"> <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    mSchema.set(mSample);</div>
<div class="line"></div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">MayaTransformWriter::MayaTransformWriter(MayaTransformWriter &amp; iParent,</div>
<div class="line"> <a class="code" href="./class_m_dag_path.html">MDagPath</a> &amp; iDag, Alembic::Util::uint32_t iTimeIndex, <span class="keyword">const</span> JobArgs &amp; iArgs)</div>
<div class="line">{</div>
<div class="line">    mFilterEulerRotations = iArgs.filterEulerRotations;</div>
<div class="line">    mJointOrientOpIndex[0] = mJointOrientOpIndex[1] = mJointOrientOpIndex[2] =</div>
<div class="line">    mRotateOpIndex[0]      = mRotateOpIndex[1]      = mRotateOpIndex[2]      =</div>
<div class="line">    mRotateAxisOpIndex[0]  = mRotateAxisOpIndex[1]  = mRotateAxisOpIndex[2]  = ~size_t(0);</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (iDag.<a class="code" href="./class_m_dag_path.html#a5901f0fa543d32fb13756c2d004f37ae">hasFn</a>(<a class="code" href="./class_m_fn.html#a1d1cfd8ffb84e947f82999c682b666a7ab8b14d1ed753088b316e8ee8c5d38ca9">MFn::kJoint</a>))</div>
<div class="line">    {</div>
<div class="line"> <a class="code" href="./class_m_fn_ik_joint.html">MFnIkJoint</a> joint(iDag);</div>
<div class="line"> <a class="code" href="./class_m_string.html">MString</a> jointName = joint.name();</div>
<div class="line"></div>
<div class="line">        jointName = util::stripNamespaces(jointName, iArgs.stripNamespace);</div>
<div class="line"></div>
<div class="line">        Alembic::AbcGeom::OXform obj(iParent.getObject(), jointName.<a class="code" href="./class_m_string.html#aa9ab612f356c53479afc4c648c9ef94d">asChar</a>(),</div>
<div class="line">            iTimeIndex);</div>
<div class="line">        mSchema = obj.getSchema();</div>
<div class="line"></div>
<div class="line">        Alembic::Abc::OCompoundProperty cp;</div>
<div class="line">        Alembic::Abc::OCompoundProperty up;</div>
<div class="line"> <span class="keywordflow">if</span> (AttributesWriter::hasAnyAttr(joint, iArgs))</div>
<div class="line">        {</div>
<div class="line">            cp = mSchema.getArbGeomParams();</div>
<div class="line">            up = mSchema.getUserProperties();</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        mAttrs = AttributesWriterPtr(<span class="keyword">new</span> AttributesWriter(cp, up, obj, joint,</div>
<div class="line">            iTimeIndex, iArgs, <span class="keyword">false</span>));</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (!iArgs.writeTransforms)</div>
<div class="line">        {</div>
<div class="line"> <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        pushTransformStack(joint, iTimeIndex == 0);</div>
<div class="line">    }</div>
<div class="line"> <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line"> <a class="code" href="./class_m_fn_transform.html">MFnTransform</a> trans(iDag);</div>
<div class="line"> <a class="code" href="./class_m_string.html">MString</a> transName = trans.name();</div>
<div class="line"></div>
<div class="line">        transName = util::stripNamespaces(transName, iArgs.stripNamespace);</div>
<div class="line"></div>
<div class="line">        Alembic::AbcGeom::OXform obj(iParent.getObject(), transName.<a class="code" href="./class_m_string.html#aa9ab612f356c53479afc4c648c9ef94d">asChar</a>(),</div>
<div class="line">            iTimeIndex);</div>
<div class="line">        mSchema = obj.getSchema();</div>
<div class="line"></div>
<div class="line">        Alembic::Abc::OCompoundProperty cp;</div>
<div class="line">        Alembic::Abc::OCompoundProperty up;</div>
<div class="line"> <span class="keywordflow">if</span> (AttributesWriter::hasAnyAttr(trans, iArgs))</div>
<div class="line">        {</div>
<div class="line">            cp = mSchema.getArbGeomParams();</div>
<div class="line">            up = mSchema.getUserProperties();</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        mAttrs = AttributesWriterPtr(<span class="keyword">new</span> AttributesWriter(cp, up, obj, trans,</div>
<div class="line">            iTimeIndex, iArgs, <span class="keyword">false</span>));</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (!iArgs.writeTransforms)</div>
<div class="line">        {</div>
<div class="line"> <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        pushTransformStack(trans, iTimeIndex == 0);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"> <span class="comment">// need to look at inheritsTransform</span></div>
<div class="line"> <a class="code" href="./class_m_fn_dag_node.html">MFnDagNode</a> dagNode(iDag);</div>
<div class="line"> <a class="code" href="./class_m_plug.html">MPlug</a> inheritPlug = dagNode.findPlug(<span class="stringliteral">"inheritsTransform"</span>, <span class="keyword">true</span>);</div>
<div class="line"> <span class="keywordflow">if</span> (!inheritPlug.<a class="code" href="./class_m_plug.html#ab7ec149d38b7c29ca55c5aa7b407d8f9">isNull</a>())</div>
<div class="line">    {</div>
<div class="line"> <span class="keywordflow">if</span> (util::getSampledType(inheritPlug) != 0)</div>
<div class="line">            mInheritsPlug = inheritPlug;</div>
<div class="line"></div>
<div class="line">        mSample.setInheritsXforms(inheritPlug.<a class="code" href="./class_m_plug.html#a69b4092a85b4edf58b7d50f331cc38cf">asBool</a>());</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <span class="comment">// everything is default, don't write anything</span></div>
<div class="line"> <span class="keywordflow">if</span> (mSample.getNumOps() == 0 &amp;&amp; mSample.getInheritsXforms())</div>
<div class="line"> <span class="keywordflow">return</span>;</div>
<div class="line"></div>
<div class="line">    mSchema.set(mSample);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">MayaTransformWriter::~MayaTransformWriter()</div>
<div class="line">{</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> MayaTransformWriter::write()</div>
<div class="line">{</div>
<div class="line"> <span class="keywordtype">size_t</span> numSamples = mAnimChanList.size();</div>
<div class="line"> <span class="keywordflow">if</span> (numSamples &gt; 0)</div>
<div class="line">    {</div>
<div class="line">        std::vector &lt; AnimChan &gt;::iterator it, itEnd;</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">for</span> (it = mAnimChanList.begin(), itEnd = mAnimChanList.end();</div>
<div class="line">            it != itEnd; ++it)</div>
<div class="line">        {</div>
<div class="line"> <span class="keywordtype">double</span> val = it-&gt;plug.<a class="code" href="./class_m_plug.html#a62411b4c90ef50797f86b049bb1f934b">asDouble</a>();</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (it-&gt;scale == -std::numeric_limits&lt;double&gt;::infinity())</div>
<div class="line">                val = util::inverseScale(val);</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> (it-&gt;scale != 1.0)</div>
<div class="line">                val *= it-&gt;scale;</div>
<div class="line"></div>
<div class="line">            mSample[it-&gt;opNum].setChannelValue(it-&gt;channelNum, val);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (!mInheritsPlug.isNull())</div>
<div class="line">        {</div>
<div class="line">            mSample.setInheritsXforms(mInheritsPlug.asBool());</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (mFilterEulerRotations)</div>
<div class="line">        {</div>
<div class="line"> <span class="keywordtype">double</span> xx(0), yy(0), zz(0);</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (getSampledRotation(mSample, mJointOrientOpIndex, xx, yy, zz))</div>
<div class="line">            {</div>
<div class="line"> <a name="_a14"></a><a class="code" href="./class_m_euler_rotation.html">MEulerRotation</a> euler(xx, yy, zz, mPrevJointOrientSolution.order);</div>
<div class="line">                euler.setToClosestSolution(mPrevJointOrientSolution);</div>
<div class="line"></div>
<div class="line"> <span class="comment">// update sample with new solution</span></div>
<div class="line">                setSampledRotation(mSample, mJointOrientOpIndex, euler.x, euler.y, euler.z);</div>
<div class="line">                mPrevJointOrientSolution = euler;</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (getSampledRotation(mSample, mRotateOpIndex, xx, yy, zz))</div>
<div class="line">            {</div>
<div class="line"> <a class="code" href="./class_m_euler_rotation.html">MEulerRotation</a> euler(xx, yy, zz, mPrevRotateSolution.order);</div>
<div class="line">                euler.setToClosestSolution(mPrevRotateSolution);</div>
<div class="line"></div>
<div class="line"> <span class="comment">// update sample with new solution</span></div>
<div class="line">                setSampledRotation(mSample, mRotateOpIndex, euler.x, euler.y, euler.z);</div>
<div class="line">                mPrevRotateSolution = euler;</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (getSampledRotation(mSample, mRotateAxisOpIndex, xx, yy, zz))</div>
<div class="line">            {</div>
<div class="line"> <a class="code" href="./class_m_euler_rotation.html">MEulerRotation</a> euler(xx, yy, zz, mPrevRotateAxisSolution.order);</div>
<div class="line">                euler.setToClosestSolution(mPrevRotateAxisSolution);</div>
<div class="line"></div>
<div class="line"> <span class="comment">// update sample with new solution</span></div>
<div class="line">                setSampledRotation(mSample, mRotateAxisOpIndex, euler.x, euler.y, euler.z);</div>
<div class="line">                mPrevRotateAxisSolution = euler;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        mSchema.set(mSample);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">bool</span> MayaTransformWriter::isAnimated()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line"> <span class="keywordflow">return</span> mAnimChanList.size() &gt; 0 || !mInheritsPlug.isNull();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> MayaTransformWriter::pushTransformStack(<span class="keyword">const</span> <a class="code" href="./class_m_fn_transform.html">MFnTransform</a> &amp; iTrans,</div>
<div class="line"> <span class="keywordtype">bool</span> iForceStatic)</div>
<div class="line">{</div>
<div class="line"></div>
<div class="line"> <span class="comment">// inspect the translate</span></div>
<div class="line">    addTranslate(iTrans, <span class="stringliteral">"translate"</span>, <span class="stringliteral">"translateX"</span>, <span class="stringliteral">"translateY"</span>, <span class="stringliteral">"translateZ"</span>,</div>
<div class="line">        Alembic::AbcGeom::kTranslateHint, <span class="keyword">false</span>, iForceStatic, <span class="keyword">false</span>, mSample,</div>
<div class="line">        mAnimChanList);</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"> <span class="comment">// inspect the rotate pivot translate</span></div>
<div class="line">    addTranslate(iTrans, <span class="stringliteral">"rotatePivotTranslate"</span>, <span class="stringliteral">"rotatePivotTranslateX"</span>,</div>
<div class="line"> <span class="stringliteral">"rotatePivotTranslateY"</span>, <span class="stringliteral">"rotatePivotTranslateZ"</span>,</div>
<div class="line">        Alembic::AbcGeom::kRotatePivotTranslationHint, <span class="keyword">false</span>,</div>
<div class="line">            iForceStatic, <span class="keyword">false</span>, mSample, mAnimChanList);</div>
<div class="line"></div>
<div class="line"> <span class="comment">// inspect the rotate pivot</span></div>
<div class="line">    addTranslate(iTrans, <span class="stringliteral">"rotatePivot"</span>, <span class="stringliteral">"rotatePivotX"</span>, <span class="stringliteral">"rotatePivotY"</span>,</div>
<div class="line"> <span class="stringliteral">"rotatePivotZ"</span>,  Alembic::AbcGeom::kRotatePivotPointHint,</div>
<div class="line"> <span class="keyword">false</span>, iForceStatic, <span class="keyword">false</span>, mSample, mAnimChanList);</div>
<div class="line"></div>
<div class="line"> <span class="comment">// inspect rotate names</span></div>
<div class="line"> <a class="code" href="./class_m_string.html">MString</a> rotateNames[3];</div>
<div class="line">    rotateNames[0] = <span class="stringliteral">"rotateX"</span>;</div>
<div class="line">    rotateNames[1] = <span class="stringliteral">"rotateY"</span>;</div>
<div class="line">    rotateNames[2] = <span class="stringliteral">"rotateZ"</span>;</div>
<div class="line"></div>
<div class="line"> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> rotOrder[3];</div>
<div class="line"></div>
<div class="line"> <span class="comment">// if this returns false then the rotation order was kInvalid or kLast</span></div>
<div class="line"> <a class="code" href="./class_m_transformation_matrix.html#af3d74c777e523f2725cdf87c15a4b5bc">MTransformationMatrix::RotationOrder</a> eRotOrder(iTrans.<a name="a15"></a><a class="code" href="./class_m_fn_transform.html#a4279a68f07bfa316935e61610786e6aa">rotationOrder</a>());</div>
<div class="line"> <span class="keywordflow">if</span> (util::getRotOrder(eRotOrder, rotOrder[0], rotOrder[1],</div>
<div class="line">        rotOrder[2]))</div>
<div class="line">    {</div>
<div class="line">        addRotate(iTrans, <span class="stringliteral">"rotate"</span>, rotateNames, rotOrder,</div>
<div class="line">            Alembic::AbcGeom::kRotateHint, iForceStatic, <span class="keyword">false</span>,</div>
<div class="line">            mSample, mAnimChanList, mRotateOpIndex);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <span class="comment">// now look at the rotation orientation, aka rotate axis</span></div>
<div class="line">    rotateNames[0] = <span class="stringliteral">"rotateAxisX"</span>;</div>
<div class="line">    rotateNames[1] = <span class="stringliteral">"rotateAxisY"</span>;</div>
<div class="line">    rotateNames[2] = <span class="stringliteral">"rotateAxisZ"</span>;</div>
<div class="line">    rotOrder[0] = 0;</div>
<div class="line">    rotOrder[1] = 1;</div>
<div class="line">    rotOrder[2] = 2;</div>
<div class="line">    addRotate(iTrans, <span class="stringliteral">"rotateAxis"</span>, rotateNames, rotOrder,</div>
<div class="line">        Alembic::AbcGeom::kRotateOrientationHint, iForceStatic, <span class="keyword">false</span>,</div>
<div class="line">        mSample, mAnimChanList, mRotateAxisOpIndex);</div>
<div class="line"></div>
<div class="line"> <span class="comment">// invert the rotate pivot if necessary</span></div>
<div class="line">    addTranslate(iTrans, <span class="stringliteral">"rotatePivot"</span>, <span class="stringliteral">"rotatePivotX"</span>, <span class="stringliteral">"rotatePivotY"</span>,</div>
<div class="line"> <span class="stringliteral">"rotatePivotZ"</span>, Alembic::AbcGeom::kRotatePivotPointHint,</div>
<div class="line"> <span class="keyword">true</span>, iForceStatic, <span class="keyword">false</span>, mSample, mAnimChanList);</div>
<div class="line"></div>
<div class="line"> <span class="comment">// inspect the scale pivot translation</span></div>
<div class="line">    addTranslate(iTrans, <span class="stringliteral">"scalePivotTranslate"</span>, <span class="stringliteral">"scalePivotTranslateX"</span>,</div>
<div class="line"> <span class="stringliteral">"scalePivotTranslateY"</span>, <span class="stringliteral">"scalePivotTranslateZ"</span>,</div>
<div class="line">        Alembic::AbcGeom::kScalePivotTranslationHint, <span class="keyword">false</span>, iForceStatic,</div>
<div class="line"> <span class="keyword">false</span>, mSample, mAnimChanList);</div>
<div class="line"></div>
<div class="line"> <span class="comment">// inspect the scale pivot point</span></div>
<div class="line">    addTranslate(iTrans, <span class="stringliteral">"scalePivot"</span>, <span class="stringliteral">"scalePivotX"</span>, <span class="stringliteral">"scalePivotY"</span>,</div>
<div class="line"> <span class="stringliteral">"scalePivotZ"</span>, Alembic::AbcGeom::kScalePivotPointHint, <span class="keyword">false</span>,</div>
<div class="line">        iForceStatic, <span class="keyword">false</span>, mSample, mAnimChanList);</div>
<div class="line"></div>
<div class="line"> <span class="comment">// inspect the shear</span></div>
<div class="line">    addShear(iTrans, iForceStatic, mSample, mAnimChanList);</div>
<div class="line"></div>
<div class="line"> <span class="comment">// add the scale</span></div>
<div class="line">    addScale(iTrans, <span class="stringliteral">"scale"</span>, <span class="stringliteral">"scaleX"</span>, <span class="stringliteral">"scaleY"</span>, <span class="stringliteral">"scaleZ"</span>, <span class="keyword">false</span>,</div>
<div class="line">        iForceStatic, <span class="keyword">false</span>, mSample, mAnimChanList);</div>
<div class="line"></div>
<div class="line"> <span class="comment">// inverse the scale pivot point if necessary</span></div>
<div class="line">    addTranslate(iTrans, <span class="stringliteral">"scalePivot"</span>, <span class="stringliteral">"scalePivotX"</span>, <span class="stringliteral">"scalePivotY"</span>,</div>
<div class="line"> <span class="stringliteral">"scalePivotZ"</span>, Alembic::AbcGeom::kScalePivotPointHint, <span class="keyword">true</span>,</div>
<div class="line">        iForceStatic, <span class="keyword">false</span>, mSample, mAnimChanList);</div>
<div class="line"></div>
<div class="line"> <span class="comment">// remember current rotation</span></div>
<div class="line"> <span class="keywordflow">if</span> (mFilterEulerRotations)</div>
<div class="line">    {</div>
<div class="line"> <span class="keywordtype">double</span> xx(0), yy(0), zz(0);</div>
<div class="line"></div>
<div class="line"> <span class="comment">// there are 2 rotation order enum definitions:</span></div>
<div class="line"> <span class="comment">//     MEulerRotation::RotationOrder = MTransformationMatrix::RotationOrder-1</span></div>
<div class="line"> <span class="keywordflow">if</span> (getSampledRotation( mSample, mRotateOpIndex, xx, yy, zz ))</div>
<div class="line">        {</div>
<div class="line">            mPrevRotateSolution.setValue(xx, yy, zz, (<a class="code" href="./class_m_euler_rotation.html#af3d74c777e523f2725cdf87c15a4b5bc">MEulerRotation::RotationOrder</a>)(eRotOrder-1));</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (getSampledRotation( mSample, mRotateAxisOpIndex, xx, yy, zz ))</div>
<div class="line">        {</div>
<div class="line">            mPrevRotateAxisSolution.setValue(xx, yy, zz, <a name="a16"></a><a class="code" href="./class_m_euler_rotation.html#af3d74c777e523f2725cdf87c15a4b5bcacfa82ee0eaf4075f3cda4152dd020d99">MEulerRotation::kXYZ</a>);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> MayaTransformWriter::pushTransformStack(<span class="keyword">const</span> <a class="code" href="./class_m_fn_ik_joint.html">MFnIkJoint</a> &amp; iJoint,</div>
<div class="line"> <span class="keywordtype">bool</span> iForceStatic)</div>
<div class="line">{</div>
<div class="line"> <span class="comment">// Some special cases that the joint is animated but has no input connections.</span></div>
<div class="line"> <span class="keywordtype">bool</span> forceAnimated = util::isDrivenByFBIK(iJoint) || util::isDrivenBySplineIK(iJoint);</div>
<div class="line"></div>
<div class="line"> <span class="comment">// inspect the translate</span></div>
<div class="line">    addTranslate(iJoint, <span class="stringliteral">"translate"</span>, <span class="stringliteral">"translateX"</span>, <span class="stringliteral">"translateY"</span>, <span class="stringliteral">"translateZ"</span>,</div>
<div class="line">        Alembic::AbcGeom::kTranslateHint, <span class="keyword">false</span>, iForceStatic, forceAnimated,</div>
<div class="line">        mSample, mAnimChanList);</div>
<div class="line"></div>
<div class="line"> <span class="comment">// inspect the inverseParent scale</span></div>
<div class="line"> <span class="comment">// [IS] is ignored when Segment Scale Compensate is false</span></div>
<div class="line"> <a class="code" href="./class_m_plug.html">MPlug</a> scaleCompensatePlug = iJoint.<a class="code" href="./class_m_fn_dependency_node.html#aac29b4a3b51c9d236175e955638f7153">findPlug</a>(<span class="stringliteral">"segmentScaleCompensate"</span>, <span class="keyword">true</span>);</div>
<div class="line"> <span class="keywordflow">if</span> (scaleCompensatePlug.<a class="code" href="./class_m_plug.html#a69b4092a85b4edf58b7d50f331cc38cf">asBool</a>())</div>
<div class="line">    {</div>
<div class="line">        addScale(iJoint, <span class="stringliteral">"inverseScale"</span>, <span class="stringliteral">"inverseScaleX"</span>, <span class="stringliteral">"inverseScaleY"</span>,</div>
<div class="line"> <span class="stringliteral">"inverseScaleZ"</span>, <span class="keyword">true</span>, iForceStatic, forceAnimated, mSample, mAnimChanList);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <a class="code" href="./class_m_transformation_matrix.html#af3d74c777e523f2725cdf87c15a4b5bc">MTransformationMatrix::RotationOrder</a> eJointOrientOrder, eRotOrder, eRotateAxisOrder;</div>
<div class="line"> <span class="keywordtype">double</span> vals[3];</div>
<div class="line"></div>
<div class="line"> <span class="comment">// for reordering rotate names</span></div>
<div class="line"> <a class="code" href="./class_m_string.html">MString</a> rotateNames[3];</div>
<div class="line"> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> rotOrder[3];</div>
<div class="line"></div>
<div class="line"> <span class="comment">// now look at the joint orientation</span></div>
<div class="line">    rotateNames[0] = <span class="stringliteral">"jointOrientX"</span>;</div>
<div class="line">    rotateNames[1] = <span class="stringliteral">"jointOrientY"</span>;</div>
<div class="line">    rotateNames[2] = <span class="stringliteral">"jointOrientZ"</span>;</div>
<div class="line"></div>
<div class="line">    iJoint.<a name="a17"></a><a class="code" href="./class_m_fn_ik_joint.html#a0f41ef4fb484400b2472a6d9c1c5afcb">getOrientation</a>(vals, eJointOrientOrder);</div>
<div class="line"> <span class="keywordflow">if</span> (util::getRotOrder(eJointOrientOrder, rotOrder[0], rotOrder[1], rotOrder[2]))</div>
<div class="line">    {</div>
<div class="line">        addRotate(iJoint, <span class="stringliteral">"jointOrient"</span>, rotateNames, rotOrder,</div>
<div class="line">            Alembic::AbcGeom::kRotateHint, iForceStatic, <span class="keyword">true</span>,</div>
<div class="line">            mSample, mAnimChanList, mJointOrientOpIndex);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    rotateNames[0] = <span class="stringliteral">"rotateX"</span>;</div>
<div class="line">    rotateNames[1] = <span class="stringliteral">"rotateY"</span>;</div>
<div class="line">    rotateNames[2] = <span class="stringliteral">"rotateZ"</span>;</div>
<div class="line"></div>
<div class="line"> <span class="comment">// if this returns false then the rotation order was kInvalid or kLast</span></div>
<div class="line">    eRotOrder = iJoint.<a class="code" href="./class_m_fn_transform.html#a4279a68f07bfa316935e61610786e6aa">rotationOrder</a>();</div>
<div class="line"> <span class="keywordflow">if</span> (util::getRotOrder(eRotOrder, rotOrder[0], rotOrder[1],</div>
<div class="line">        rotOrder[2]))</div>
<div class="line">    {</div>
<div class="line">        addRotate(iJoint, <span class="stringliteral">"rotate"</span>, rotateNames, rotOrder,</div>
<div class="line">            Alembic::AbcGeom::kRotateHint, iForceStatic, <span class="keyword">true</span>,</div>
<div class="line">            mSample, mAnimChanList, mRotateOpIndex);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <span class="comment">// now look at the rotation orientation, aka rotate axis</span></div>
<div class="line">    rotateNames[0] = <span class="stringliteral">"rotateAxisX"</span>;</div>
<div class="line">    rotateNames[1] = <span class="stringliteral">"rotateAxisY"</span>;</div>
<div class="line">    rotateNames[2] = <span class="stringliteral">"rotateAxisZ"</span>;</div>
<div class="line"></div>
<div class="line">    iJoint.<a name="a18"></a><a class="code" href="./class_m_fn_ik_joint.html#a77418f351887f797ea214317a0c6e1bd">getScaleOrientation</a>(vals, eRotateAxisOrder);</div>
<div class="line"> <span class="keywordflow">if</span> (util::getRotOrder(eRotateAxisOrder, rotOrder[0], rotOrder[1], rotOrder[2]))</div>
<div class="line">    {</div>
<div class="line">        addRotate(iJoint, <span class="stringliteral">"rotateAxis"</span>, rotateNames, rotOrder,</div>
<div class="line">            Alembic::AbcGeom::kRotateOrientationHint, iForceStatic, <span class="keyword">true</span>,</div>
<div class="line">            mSample, mAnimChanList, mRotateAxisOpIndex);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <span class="comment">// inspect the scale</span></div>
<div class="line">    addScale(iJoint, <span class="stringliteral">"scale"</span>, <span class="stringliteral">"scaleX"</span>, <span class="stringliteral">"scaleY"</span>, <span class="stringliteral">"scaleZ"</span>, <span class="keyword">false</span>,</div>
<div class="line">        iForceStatic, forceAnimated, mSample, mAnimChanList);</div>
<div class="line"></div>
<div class="line"> <span class="comment">// remember current rotation</span></div>
<div class="line"> <span class="keywordflow">if</span> (mFilterEulerRotations)</div>
<div class="line">    {</div>
<div class="line"> <span class="keywordtype">double</span> xx(0), yy(0), zz(0);</div>
<div class="line"></div>
<div class="line"> <span class="comment">// there are 2 rotation order enum definitions:</span></div>
<div class="line"> <span class="comment">//     MEulerRotation::RotationOrder = MTransformationMatrix::RotationOrder-1</span></div>
<div class="line"> <span class="keywordflow">if</span> (getSampledRotation( mSample, mJointOrientOpIndex, xx, yy, zz ))</div>
<div class="line">        {</div>
<div class="line">            mPrevJointOrientSolution.setValue(xx, yy, zz, (<a class="code" href="./class_m_euler_rotation.html#af3d74c777e523f2725cdf87c15a4b5bc">MEulerRotation::RotationOrder</a>)(eJointOrientOrder-1));</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (getSampledRotation( mSample, mRotateOpIndex, xx, yy, zz ))</div>
<div class="line">        {</div>
<div class="line">            mPrevRotateSolution.setValue(xx, yy, zz, (<a class="code" href="./class_m_euler_rotation.html#af3d74c777e523f2725cdf87c15a4b5bc">MEulerRotation::RotationOrder</a>)(eRotOrder-1));</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (getSampledRotation( mSample, mRotateAxisOpIndex, xx, yy, zz ))</div>
<div class="line">        {</div>
<div class="line">            mPrevRotateAxisSolution.setValue(xx, yy, zz, (<a class="code" href="./class_m_euler_rotation.html#af3d74c777e523f2725cdf87c15a4b5bc">MEulerRotation::RotationOrder</a>)(eRotateAxisOrder-1));</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<div class="footer-block"><a class="comments-anchor" href="../html/ac.cmtdialog.htm" target="_blank"><span class="comments-link">Please send us your comment about this page</span></a></div></div>
</div></body>
</html>
