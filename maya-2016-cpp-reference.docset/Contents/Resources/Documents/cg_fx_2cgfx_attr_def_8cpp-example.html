<!-- saved from url=(0024)http://docs.autodesk.com -->
<html>
<head><script src="../scripts/yepnope.1.5.4-min.js" type="text/javascript"></script><script src="../scripts/lib/jquery-1.11.1.min.js" type="text/javascript"></script><meta content="text/html; charset=utf-8" http-equiv="Content-Type"><meta content="MAYAUL" name="product"><meta content="2016" name="release"><meta content="Developer" name="book"><meta content="2015-10-14" name="created"><meta content="GUID-02DEF634-1E7B-48C6-8ACD-2C934CA97887" name="topicid"><meta content="concept" name="topic-type">
<title>cgFx/cgfxAttrDef.cpp</title>
<meta content="C++" name="topic-subtype"/></meta></meta></meta></meta></meta></meta></meta></head>
<body height="100%"><div class="body_content" id="body-content"><link href="cpp_ref/navtree.css" rel="stylesheet" type="text/css"><link href="cpp_ref/doxygen.css" rel="stylesheet" type="text/css"><link href="cpp_ref/tabs.css" rel="stylesheet" type="text/css"><link href="style/adsk.cpm.css" rel="stylesheet" type="text/css"><script language="javascript">var index = 'index.html';</script><script>$(document).ready(function() { yepnope.injectJs("./scripts/ac_common.js"); });</script><script type="text/javascript">
var tocSystemNeedsToBeLoaded = typeof(cpp_ref_adsk_ref_toc) == 'undefined';
var weAreIn21 = $('div#main.view-active').length;
var tocPrefix = '';
if (weAreIn21)
{ tocPrefix = 'cpp_ref/'; }
function cpp_ref_initializeToc(forceTrigger) {
    cpp_ref_adsk_ref_toc.initResizable();
    cpp_ref_adsk_ref_toc.initNavTree('cg_fx_2cgfx_attr_def_8cpp-example.html', tocPrefix);
    dQuery(document).trigger('toc_initialized');
}
if (tocSystemNeedsToBeLoaded)
{
	yepnope([{
	load:[tocPrefix + 'json3.min.js', tocPrefix + 'jquery.js', tocPrefix + 'ref-toc-controller.js', tocPrefix + 'dynsections.js'],
	complete: function() {
	  if (typeof(dQuery) == 'undefined')
	  {
	    dQuery = jQuery.noConflict(true);
	  }
	  else { jQuery.noConflict(true); }
	  $(document).ready(cpp_ref_initializeToc);
	}
 	}])
}
if (!weAreIn21) { // if in AKN...
$(window).load( function() {
    setTimeout( function() {
        var content = $('body > div').not('#body-content');     // take any divs under body that are not id=body-content
        content.each( function() { 
            $(this).css( { 'padding-left': $(this).css('margin-left') } );       // and if they have any padding-left already, move it to margin-left.
        } );
        var width = cpp_ref_adsk_ref_toc.readFromStorage('width');
        content.css({marginLeft:parseInt(width)+6+"px"});
    }, 100);
} ); 
}
</script><script>$("div#WidgetFloaterPanels,link[href*='microsofttranslator.com'],script[src*='microsofttranslator.com'],script[src*='bing.com']").remove();</script><script type="text/javascript">$("div#navigation,div#breadcrumbs,div#banner").attr("translate","no"); var mtLocation = ((location && location.href && location.href.indexOf('https') == 0)?'https://ssl.microsofttranslator.com':'http://www.microsofttranslator.com')+'/ajax/v3/WidgetV3.ashx?siteData=y5CYlxTRD0znCzRLDwX0Wy7-g1EdC1XA4dSC-Y1LtaeScyli8_Ps5jPKqTr4xKxMI0OOUfkDplvX3uxN0JnPclebSYW8_J1HBzf4VLQEzQ8M4PsYXF_cMyp1Oumaetky&category=5297189e-446b-459e-ae1d-9d0360400781_tech&ctf=True&ui=true&settings=Manual&from=en&hidelanguages='; yepnope.injectJs(mtLocation, function() {}, { charset:'utf-8', type:'text/javascript' } );</script><script>
 if (!tocSystemNeedsToBeLoaded) { cpp_ref_initializeToc(); }
 </script><!-- begin MT -->
<div class="Dark" id="MicrosoftTranslatorWidget" style="position:absolute;right:20px;top:5px;z-index:100;color:white;background-color:#555555;height:58px;overflow:hidden"></div>
<div>
<div class="head">
<h1>cgFx/cgfxAttrDef.cpp</h1>
</div>
<div id="top"><!-- Generated by Doxygen 1.8.10 -->
<div class="tabs" id="navrow1">
<ul class="tablist">
<li><a href="./index.html"><span>MainÂ Page</span></a></li>
<li><a href="./pages.html"><span>Topics</span></a></li>
<li><a href="./modules.html"><span>Modules</span></a></li>
<li><a href="./namespaces.html"><span>Namespaces</span></a></li>
<li><a href="./annotated.html"><span>Classes</span></a></li>
<li><a href="./examples.html"><span>Examples</span></a></li>
</ul>
</div>
</div><!-- top -->
<div class="ui-resizable side-nav-resizable" id="side-nav">
<div id="nav-tree">
<div id="nav-tree-contents">
<div class="sync" id="nav-sync"></div>
</div>
</div>
<div class="ui-resizable-handle" id="splitbar" style="-moz-user-select:none;">
</div>
</div>
<div id="doc-content">
<div class="header">
<div class="headertitle">
<div class="title">cgFx/cgfxAttrDef.cpp</div> </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Copyright (C) 2002-2004 NVIDIA </span></div>
<div class="line"><span class="comment">// </span></div>
<div class="line"><span class="comment">// File: cgfxAttrDef.cpp</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Author: Jim Atkinson</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// cgfxAttrDef holds the "definition" of an attribute on a cgfxShader</span></div>
<div class="line"><span class="comment">// node.  This definition includes all the Maya attributes plus the</span></div>
<div class="line"><span class="comment">// CGeffect parameter index.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Changes:</span></div>
<div class="line"><span class="comment">//  12/2003  Kurt Harriman - www.octopusgraphics.com +1-415-893-1023</span></div>
<div class="line"><span class="comment">//           - Shader parameter descriptions can be queried via the</span></div>
<div class="line"><span class="comment">//             "-des/description" flag of cgfxShader command, together</span></div>
<div class="line"><span class="comment">//             with "-lp/listParameters" or "-p/parameter &lt;name&gt;"</span></div>
<div class="line"><span class="comment">//           - "-ci/caseInsensitive" option for "-p/parameter &lt;name&gt;"</span></div>
<div class="line"><span class="comment">//           - "uimin"/"uimax" annotations set numeric slider bounds.</span></div>
<div class="line"><span class="comment">//           - "uiname" annotation is used as parameter description </span></div>
<div class="line"><span class="comment">//             if there is no "desc" annotation.</span></div>
<div class="line"><span class="comment">//           - Attribute bounds and initial values are updated when</span></div>
<div class="line"><span class="comment">//             effect is changed or reloaded.  </span></div>
<div class="line"><span class="comment">//           - When creating dynamic attributes for shader parameters,</span></div>
<div class="line"><span class="comment">//             make them keyable if type is bool, int, float or color.</span></div>
<div class="line"><span class="comment">//             Vector types other than colors are made keyable if</span></div>
<div class="line"><span class="comment">//             they have a "desc" or "uiname" annotation.</span></div>
<div class="line"><span class="comment">//           - Dangling references to deleted dynamic attributes</span></div>
<div class="line"><span class="comment">//             caused exceptions in MObject destructor, terminating</span></div>
<div class="line"><span class="comment">//             the Maya process.  This has been fixed.</span></div>
<div class="line"><span class="comment">//           - Fixed some undo/redo bugs that caused crashes and</span></div>
<div class="line"><span class="comment">//             incorrect rendering.  Fixed some memory leaks.</span></div>
<div class="line"><span class="comment">//           - Improved error handling.  Use M_CHECK for internal errors. </span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//-</span></div>
<div class="line"><span class="comment">// ==========================================================================</span></div>
<div class="line"><span class="comment">// Copyright 2015 Autodesk, Inc.  All rights reserved.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Use of this software is subject to the terms of the Autodesk</span></div>
<div class="line"><span class="comment">// license agreement provided at the time of installation or download,</span></div>
<div class="line"><span class="comment">// or which otherwise accompanies this software in either electronic</span></div>
<div class="line"><span class="comment">// or hard copy form.</span></div>
<div class="line"><span class="comment">// ==========================================================================</span></div>
<div class="line"><span class="comment">//+</span></div>
<div class="line"><span class="preprocessor">#include "cgfxShaderCommon.h"</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;float.h&gt;</span> <span class="comment">// FLT_MAX</span></div>
<div class="line"><span class="preprocessor">#include &lt;limits.h&gt;</span> <span class="comment">// INT_MAX, INT_MIN</span></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MIOStream.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MGlobal.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MString.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MStringArray.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MFnStringData.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MFnStringArrayData.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MFnDependencyNode.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MFnCompoundAttribute.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MFnTypedAttribute.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MFnMatrixAttribute.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MDGModifier.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MFnMatrixData.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MPlugArray.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MItDependencyGraph.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MSelectionList.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include "cgfxAttrDef.h"</span></div>
<div class="line"><span class="preprocessor">#include "cgfxShaderNode.h"</span></div>
<div class="line"><span class="preprocessor">#include "cgfxFindImage.h"</span></div>
<div class="line"><span class="preprocessor">#include "cgfxTextureCache.h"</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Defines</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#define N_MAX_STRING_LENGTH 1024</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifdef _WIN32</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor">#   define stricmp  strcasecmp</span></div>
<div class="line"><span class="preprocessor">#   define strnicmp strncasecmp</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">// Decide the symbol we use</span></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> cgfxAttrDef::fSymbol = <span class="charliteral">'_'</span>;</div>
<div class="line"></div>
<div class="line"><span class="comment">// Constructor</span></div>
<div class="line">cgfxAttrDef::cgfxAttrDef(CGparameter cgParameter)</div>
<div class="line">: fType( kAttrTypeUnknown )</div>
<div class="line">, fSize( 0 )</div>
<div class="line">, fHint( kVectorHintNone )</div>
<div class="line">, fNumericMin( NULL )</div>
<div class="line">, fNumericMax( NULL )</div>
<div class="line">, fNumericSoftMin( NULL )</div>
<div class="line">, fNumericSoftMax( NULL )</div>
<div class="line">, fUnits( <a name="_a0"></a><a class="code" href="./class_m_distance.html">MDistance</a>::kInvalid )</div>
<div class="line">, fNumericDef( NULL )</div>
<div class="line">, fTextureMonitor(kNullCallback)</div>
<div class="line"><span class="comment">// , fParameterIndex( (LPCSTR)(-1) )</span></div>
<div class="line">, fParameterHandle(0)</div>
<div class="line">, fInvertMatrix( false )</div>
<div class="line">, fTransposeMatrix( false )</div>
<div class="line">, fTweaked( false )</div>
<div class="line">, fInitOnUndo( false )</div>
<div class="line">, fIsConvertedToInternal( false )</div>
<div class="line">{</div>
<div class="line">    fName = cgGetParameterName(cgParameter);</div>
<div class="line">    fType = cgfxAttrDef::kAttrTypeOther;</div>
<div class="line">    fSize = cgGetParameterRows(cgParameter) * cgGetParameterColumns(cgParameter);</div>
<div class="line">    fParameterHandle = cgParameter;</div>
<div class="line">    fSemantic = cgGetParameterSemantic(cgParameter);</div>
<div class="line"></div>
<div class="line">    CGtype cgParameterType = cgGetParameterType(cgParameter);</div>
<div class="line"> <span class="keywordflow">switch</span> (cgParameterType)</div>
<div class="line">    {</div>
<div class="line"> <span class="keywordflow">case</span> CG_BOOL    : </div>
<div class="line"> <span class="keywordflow">if</span> (stricmp(fSemantic.asChar() , <span class="stringliteral">"HardwareFogEnabled"</span>) == 0)</div>
<div class="line">                fType = cgfxAttrDef::kAttrTypeHardwareFogEnabled;</div>
<div class="line"> <span class="keywordflow">else</span> </div>
<div class="line">                fType = cgfxAttrDef::kAttrTypeBool; </div>
<div class="line">            break ;</div>
<div class="line"> <span class="keywordflow">case</span> CG_INT     : </div>
<div class="line"> <span class="keywordflow">if</span> (stricmp(fSemantic.asChar() , <span class="stringliteral">"HardwareFogMode"</span>) == 0)</div>
<div class="line">                fType = cgfxAttrDef::kAttrTypeHardwareFogMode;</div>
<div class="line"> <span class="keywordflow">else</span> </div>
<div class="line">                fType = cgfxAttrDef::kAttrTypeInt; </div>
<div class="line">            break ;</div>
<div class="line"> <span class="keywordflow">case</span> CG_HALF    :</div>
<div class="line"> <span class="keywordflow">case</span> CG_FLOAT :</div>
<div class="line"> <span class="keywordflow">if</span> (stricmp(fSemantic.asChar() , <span class="stringliteral">"HardwareFogStart"</span>) == 0)</div>
<div class="line">                fType = cgfxAttrDef::kAttrTypeHardwareFogStart;</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stricmp(fSemantic.asChar() , <span class="stringliteral">"HardwareFogEnd"</span>) == 0)</div>
<div class="line">                fType = cgfxAttrDef::kAttrTypeHardwareFogEnd;</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stricmp(fSemantic.asChar() , <span class="stringliteral">"HardwareFogDensity"</span>) == 0)</div>
<div class="line">                fType = cgfxAttrDef::kAttrTypeHardwareFogDensity;</div>
<div class="line"><span class="preprocessor">#ifdef _WIN32</span></div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stricmp(fSemantic.asChar() , <span class="stringliteral">"Time"</span>)==0)</div>
<div class="line">                fType = cgfxAttrDef::kAttrTypeTime;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> <span class="keywordflow">else</span> </div>
<div class="line">                fType = cgfxAttrDef::kAttrTypeFloat;</div>
<div class="line"> <span class="keywordflow">break</span>;</div>
<div class="line"> <span class="keywordflow">case</span> CG_HALF2               :</div>
<div class="line"> <span class="keywordflow">case</span> CG_FLOAT2          : </div>
<div class="line">            fType = cgfxAttrDef::kAttrTypeVector2; </div>
<div class="line">            break ;</div>
<div class="line"> <span class="keywordflow">case</span> CG_HALF3               :</div>
<div class="line"> <span class="keywordflow">case</span> CG_FLOAT3          : </div>
<div class="line">               fType = cgfxAttrDef::kAttrTypeVector3; </div>
<div class="line">            break ;</div>
<div class="line"> <span class="keywordflow">case</span> CG_HALF4               :</div>
<div class="line"> <span class="keywordflow">case</span> CG_FLOAT4          : </div>
<div class="line"> <span class="keywordflow">if</span> (stricmp(fSemantic.asChar() , <span class="stringliteral">"HardwareFogColor"</span>) == 0)</div>
<div class="line">                fType = cgfxAttrDef::kAttrTypeHardwareFogColor;</div>
<div class="line"> <span class="keywordflow">else</span></div>
<div class="line">                fType = cgfxAttrDef::kAttrTypeVector4; </div>
<div class="line">            break ;</div>
<div class="line"> <span class="keywordflow">case</span> CG_HALF4x4         :</div>
<div class="line"> <span class="keywordflow">case</span> CG_FLOAT4x4        : </div>
<div class="line">            setMatrixType(cgParameter); </div>
<div class="line">            break ;</div>
<div class="line"> <span class="keywordflow">case</span> CG_STRING          : </div>
<div class="line">            fType = cgfxAttrDef::kAttrTypeString; </div>
<div class="line">            break ;</div>
<div class="line"> <span class="keywordflow">case</span> CG_TEXTURE         :</div>
<div class="line"> <span class="comment">// handled by setSamplerType()</span></div>
<div class="line">            break ;</div>
<div class="line"> <span class="keywordflow">case</span> CG_SAMPLER1D       : </div>
<div class="line"> <span class="keywordflow">case</span> CG_SAMPLER2D       :</div>
<div class="line"> <span class="keywordflow">case</span> CG_SAMPLER3D       :</div>
<div class="line"> <span class="keywordflow">case</span> CG_SAMPLERRECT :</div>
<div class="line"> <span class="keywordflow">case</span> CG_SAMPLERCUBE :</div>
<div class="line">            setSamplerType(cgParameter);</div>
<div class="line">            break ;</div>
<div class="line"> <span class="keywordflow">case</span> CG_ARRAY               :</div>
<div class="line"> <span class="keywordflow">case</span> CG_STRUCT          :</div>
<div class="line">            break ;</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">default</span>                         : </div>
<div class="line"> <a name="_a1"></a><a class="code" href="./class_m_string.html">MString</a> msg = cgGetTypeString(cgParameterType);</div>
<div class="line">            msg += <span class="stringliteral">" not yet supported"</span>;</div>
<div class="line"> <a name="a2"></a><a class="code" href="./class_m_global.html#a4ddbe97e58a90e1ab05d45a62c006cf0">MGlobal::displayError</a>(msg);</div>
<div class="line">            M_CHECK( <span class="keyword">false</span> );</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (fType == cgfxAttrDef::kAttrTypeVector3 ||</div>
<div class="line">        fType == cgfxAttrDef::kAttrTypeVector4)</div>
<div class="line">    {</div>
<div class="line"> <span class="comment">// Set the specific vector type</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line">        setVectorType(cgParameter);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Now that we know something about this attribute, walk through</span></div>
<div class="line"> <span class="comment">// the annotations on the parameter and see if there is any</span></div>
<div class="line"> <span class="comment">// additional information we can find.</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"></div>
<div class="line"> <a class="code" href="./class_m_string.html">MString</a> sUIName;</div>
<div class="line"> </div>
<div class="line">    CGannotation cgAnnotation = cgGetFirstParameterAnnotation(cgParameter);</div>
<div class="line"> <span class="keywordflow">while</span> (cgAnnotation)</div>
<div class="line">    {</div>
<div class="line"> <span class="keyword">const</span> <span class="keywordtype">char</span>* annotationName      = cgGetAnnotationName(cgAnnotation);</div>
<div class="line"> <span class="keyword">const</span> <span class="keywordtype">char</span>* annotationValue     = cgGetStringAnnotationValue(cgAnnotation);</div>
<div class="line">        CGtype          cgAnnotationType    = cgGetAnnotationType(cgAnnotation);</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (stricmp(annotationName, <span class="stringliteral">"uihelp"</span>) == 0)</div>
<div class="line">        {</div>
<div class="line">            fDescription = <a class="code" href="./class_m_string.html">MString</a>(annotationValue);</div>
<div class="line">        }</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stricmp(annotationName, <span class="stringliteral">"uiname"</span> ) == 0 )</div>
<div class="line">        {</div>
<div class="line">            sUIName = <a class="code" href="./class_m_string.html">MString</a>(annotationValue);</div>
<div class="line">        }</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span>( stricmp( annotationName, <span class="stringliteral">"units"</span>) == 0)</div>
<div class="line">        {</div>
<div class="line"> <span class="comment">// Make sure units are converted to internal or not</span></div>
<div class="line"> <span class="comment">// _XXX is a unit converted to internal</span></div>
<div class="line"> <span class="keywordflow">if</span> ( fSymbol == annotationValue[0] ) </div>
<div class="line">            {</div>
<div class="line">                fIsConvertedToInternal = <span class="keyword">true</span>;</div>
<div class="line">                annotationValue++;</div>
<div class="line">            }</div>
<div class="line"> <span class="keywordflow">else</span></div>
<div class="line">            {</div>
<div class="line">                fIsConvertedToInternal = <span class="keyword">false</span>;</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span>( stricmp( annotationValue, <span class="stringliteral">"inches"</span>) == 0)</div>
<div class="line">            {</div>
<div class="line">                fUnits = <a name="a3"></a><a class="code" href="./class_m_distance.html#abceb2331ad056e3c5ad27894199a49eda30a33c2e169c9e6115692eda1c173f30">MDistance::kInches</a>;</div>
<div class="line">            }</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span>( stricmp( annotationValue, <span class="stringliteral">"millimetres"</span>) == 0 || stricmp( annotationValue, <span class="stringliteral">"millimeters"</span>) == 0 || stricmp( annotationValue, <span class="stringliteral">"mm"</span>) == 0)</div>
<div class="line">            {</div>
<div class="line">                fUnits = <a name="a4"></a><a class="code" href="./class_m_distance.html#abceb2331ad056e3c5ad27894199a49eda86e73f520eca40e3e3d4a08a43ddbffb">MDistance::kMillimeters</a>;</div>
<div class="line">            }</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span>( stricmp( annotationValue, <span class="stringliteral">"centimetres"</span>) == 0 || stricmp( annotationValue, <span class="stringliteral">"centimeters"</span>) == 0 || stricmp( annotationValue, <span class="stringliteral">"cm"</span>) == 0)</div>
<div class="line">            {</div>
<div class="line">                fUnits = <a name="a5"></a><a class="code" href="./class_m_distance.html#abceb2331ad056e3c5ad27894199a49eda0603f671fbadde0729a2e79a80fb9a0e">MDistance::kCentimeters</a>;</div>
<div class="line">            }</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span>( stricmp( annotationValue, <span class="stringliteral">"metres"</span>) == 0 || stricmp( annotationValue, <span class="stringliteral">"meters"</span>) == 0 || stricmp( annotationValue, <span class="stringliteral">"m"</span>) == 0)</div>
<div class="line">            {</div>
<div class="line">                fUnits = <a name="a6"></a><a class="code" href="./class_m_distance.html#abceb2331ad056e3c5ad27894199a49eda803a162c123bbe61a9d63d7f406e2b7c">MDistance::kMeters</a>;</div>
<div class="line">            }</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span>( stricmp( annotationValue, <span class="stringliteral">"kilometres"</span>) == 0 || stricmp( annotationValue, <span class="stringliteral">"kilometers"</span>) == 0 || stricmp( annotationValue, <span class="stringliteral">"km"</span>) == 0)</div>
<div class="line">            {</div>
<div class="line">                fUnits = <a name="a7"></a><a class="code" href="./class_m_distance.html#abceb2331ad056e3c5ad27894199a49edadc4fd556c40d608a34d8c2246ad6e4a5">MDistance::kKilometers</a>;</div>
<div class="line">            }</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span>( stricmp( annotationValue, <span class="stringliteral">"feet"</span>) == 0)</div>
<div class="line">            {</div>
<div class="line">                fUnits = <a name="a8"></a><a class="code" href="./class_m_distance.html#abceb2331ad056e3c5ad27894199a49edaedebe6dc6efd5df379da89064414ac43">MDistance::kFeet</a>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((fType &gt;= cgfxAttrDef::kAttrTypeFirstTexture &amp;&amp;</div>
<div class="line">                  fType &lt;= cgfxAttrDef::kAttrTypeLastTexture))</div>
<div class="line">        {</div>
<div class="line"> <span class="keywordflow">if</span> (stricmp(annotationName, <span class="stringliteral">"resourcetype"</span>) == 0)</div>
<div class="line">            {</div>
<div class="line"> <span class="keywordflow">if</span> (stricmp(annotationValue, <span class="stringliteral">"1d"</span>) == 0)</div>
<div class="line">                {</div>
<div class="line">                    fType = cgfxAttrDef::kAttrTypeColor1DTexture;</div>
<div class="line">                }</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stricmp(annotationValue, <span class="stringliteral">"2d"</span>) == 0)</div>
<div class="line">                {</div>
<div class="line">                    fType = cgfxAttrDef::kAttrTypeColor2DTexture;</div>
<div class="line">                }</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stricmp(annotationValue, <span class="stringliteral">"3d"</span>) == 0)</div>
<div class="line">                {</div>
<div class="line">                    fType = cgfxAttrDef::kAttrTypeColor3DTexture;</div>
<div class="line">                }</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stricmp(annotationValue, <span class="stringliteral">"cube"</span>) == 0)</div>
<div class="line">                {</div>
<div class="line">                    fType = cgfxAttrDef::kAttrTypeCubeTexture;</div>
<div class="line">                }</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stricmp(annotationValue, <span class="stringliteral">"rect"</span>) == 0)</div>
<div class="line">                {</div>
<div class="line">                    fType = cgfxAttrDef::kAttrTypeColor2DRectTexture;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stricmp(annotationName, <span class="stringliteral">"resourcename"</span>) == 0)</div>
<div class="line">            {</div>
<div class="line"> <span class="comment">// Store the texture file to load as the</span></div>
<div class="line"> <span class="comment">// string default argument.  (I know, its kind</span></div>
<div class="line"> <span class="comment">// of a kludge; but if the texture attributes</span></div>
<div class="line"> <span class="comment">// were string values, it would be exactly</span></div>
<div class="line"> <span class="comment">// correct.</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line">                fStringDef = annotationValue;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cgAnnotationType == CG_BOOL )</div>
<div class="line">        {}                     <span class="comment">// no min/max for bool</span></div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stricmp(annotationName, <span class="stringliteral">"min"</span>) == 0 ||</div>
<div class="line">                 stricmp(annotationName, <span class="stringliteral">"max"</span>) == 0 ||</div>
<div class="line">                 stricmp(annotationName, <span class="stringliteral">"uimin"</span>) == 0 ||</div>
<div class="line">                 stricmp(annotationName, <span class="stringliteral">"uimax"</span>) == 0 )</div>
<div class="line">        {</div>
<div class="line"> <span class="keywordtype">double</span> * tmp = <span class="keyword">new</span> <span class="keywordtype">double</span> [fSize];</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">switch</span> (cgAnnotationType)</div>
<div class="line">            {</div>
<div class="line"> <span class="keywordflow">case</span> CG_INT:</div>
<div class="line">                    {</div>
<div class="line"> <span class="comment">// int* val = (int*) adesc.Value;</span></div>
<div class="line"> <span class="comment">// for (int k = 0; k &lt; fSize; ++k)</span></div>
<div class="line"> <span class="comment">// {</span></div>
<div class="line"> <span class="comment">//     tmp[k] = val[k];</span></div>
<div class="line"> <span class="comment">// }</span></div>
<div class="line"> </div>
<div class="line"> <span class="keywordtype">int</span> nValues;</div>
<div class="line"> <span class="keyword">const</span> <span class="keywordtype">int</span>* annotationValues = cgGetIntAnnotationValues(cgAnnotation, &amp;nValues);</div>
<div class="line"> </div>
<div class="line"> <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iValue = 0; iValue &lt; nValues; ++iValue)</div>
<div class="line">                            tmp[iValue] = static_cast&lt;double&gt;(annotationValues[iValue]);</div>
<div class="line">                    }   </div>
<div class="line"> <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">case</span> CG_FLOAT:</div>
<div class="line">                    {</div>
<div class="line"> <span class="comment">// float* val = (float*) adesc.Value;</span></div>
<div class="line"> <span class="comment">// for (int k = 0; k &lt; fSize; ++k)</span></div>
<div class="line"> <span class="comment">// {</span></div>
<div class="line"> <span class="comment">//     tmp[k] = val[k];</span></div>
<div class="line"> <span class="comment">// }</span></div>
<div class="line"> <span class="keywordtype">int</span> nValues;</div>
<div class="line"> <span class="keyword">const</span> <span class="keywordtype">float</span>* annotationValues = cgGetFloatAnnotationValues(cgAnnotation, &amp;nValues);</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iValue = 0; iValue &lt; nValues; ++iValue)</div>
<div class="line">                            tmp[iValue] = static_cast&lt;double&gt;(annotationValues[iValue]);</div>
<div class="line">                    }</div>
<div class="line"> <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">default</span>:</div>
<div class="line"> <span class="comment">// This is not a numeric attribute, reset tmp to NULL</span></div>
<div class="line"> <span class="keyword">delete</span> [] tmp;</div>
<div class="line">                    tmp = 0;</div>
<div class="line"> <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (stricmp(annotationName, <span class="stringliteral">"min"</span>) == 0)</div>
<div class="line">            {</div>
<div class="line">                fNumericMin = tmp;</div>
<div class="line">            }</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stricmp(annotationName, <span class="stringliteral">"max"</span>) == 0)</div>
<div class="line">            {</div>
<div class="line">                fNumericMax = tmp;</div>
<div class="line">            }</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stricmp(annotationName, <span class="stringliteral">"uimin"</span>) == 0)</div>
<div class="line">            {</div>
<div class="line">                fNumericSoftMin = tmp;</div>
<div class="line">            }</div>
<div class="line"> <span class="keywordflow">else</span> </div>
<div class="line">            {</div>
<div class="line">                fNumericSoftMax = tmp;</div>
<div class="line">            }</div>
<div class="line">        } <span class="comment">// end of if (adesc.Name == "min"|"max")</span></div>
<div class="line"></div>
<div class="line">        cgAnnotation = cgGetNextAnnotation(cgAnnotation);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Enforce limits on colors if they do not already have them.</span></div>
<div class="line"> <span class="keywordflow">if</span> ( fType == cgfxAttrDef::kAttrTypeColor3 ||</div>
<div class="line">         fType == cgfxAttrDef::kAttrTypeColor4 )</div>
<div class="line">    {</div>
<div class="line"> <span class="keywordflow">if</span> ( !fNumericMin )</div>
<div class="line">        {</div>
<div class="line">            fNumericMin = <span class="keyword">new</span> <span class="keywordtype">double</span>[4];</div>
<div class="line">            fNumericMin[0] = 0.0;</div>
<div class="line">            fNumericMin[1] = 0.0;</div>
<div class="line">            fNumericMin[2] = 0.0;</div>
<div class="line">            fNumericMin[3] = 0.0;</div>
<div class="line">        }</div>
<div class="line"> <span class="keywordflow">if</span> ( !fNumericMax )</div>
<div class="line">        {</div>
<div class="line">            fNumericMax = <span class="keyword">new</span> <span class="keywordtype">double</span>[4];</div>
<div class="line">            fNumericMax[0] = 1.0;</div>
<div class="line">            fNumericMax[1] = 1.0;</div>
<div class="line">            fNumericMax[2] = 1.0;</div>
<div class="line">            fNumericMax[3] = 1.0;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <span class="comment">// If no description, use UIName.</span></div>
<div class="line"> <span class="keywordflow">if</span> ( !fDescription.length() )</div>
<div class="line">        fDescription = sUIName;</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Now get the default values</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <span class="keywordtype">double</span>* tmp = <span class="keyword">new</span> <span class="keywordtype">double</span> [fSize];</div>
<div class="line"></div>
<div class="line">    CGtype cgParameterBaseType = cgGetParameterBaseType(cgParameter);</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">switch</span> (cgParameterBaseType)</div>
<div class="line">    {</div>
<div class="line"> <span class="keywordflow">case</span> CG_BOOL:</div>
<div class="line">            {</div>
<div class="line"> <span class="keywordtype">int</span> val;</div>
<div class="line"> <span class="keywordflow">if</span> (cgGetParameterValueic(cgParameter, 1, &amp;val) != 1)</div>
<div class="line">                {</div>
<div class="line"> <span class="keyword">delete</span> [] tmp;</div>
<div class="line">                    tmp = 0;</div>
<div class="line"> <span class="keywordflow">break</span>;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; fSize; ++k)</div>
<div class="line">                {</div>
<div class="line">                    tmp[k] = val ? 1 : 0;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line"> <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">case</span> CG_INT:</div>
<div class="line">            {</div>
<div class="line"> <span class="keywordtype">int</span> val;</div>
<div class="line"> <span class="keywordflow">if</span> (cgGetParameterValueic(cgParameter, 1, &amp;val) != 1)</div>
<div class="line">                {</div>
<div class="line"> <span class="keyword">delete</span> [] tmp;</div>
<div class="line">                    tmp = 0;</div>
<div class="line"> <span class="keywordflow">break</span>;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; fSize; ++k)</div>
<div class="line">                {</div>
<div class="line">                    tmp[k] = val;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line"> <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">case</span> CG_FLOAT:</div>
<div class="line">            {</div>
<div class="line"> <span class="keywordflow">if</span> (fSize == 1)</div>
<div class="line">                {</div>
<div class="line"> <span class="keywordtype">float</span> val;</div>
<div class="line"> <span class="keywordflow">if</span> (cgGetParameterValuefc(cgParameter, 1, &amp;val) != 1)</div>
<div class="line">                    {</div>
<div class="line"> <span class="keyword">delete</span> [] tmp;</div>
<div class="line">                        tmp = 0;</div>
<div class="line"> <span class="keywordflow">break</span>;</div>
<div class="line">                    }</div>
<div class="line"></div>
<div class="line"> <span class="comment">// If the value is a converted value, we need to convert it to one with unit </span></div>
<div class="line"> <span class="keywordflow">if</span>( fIsConvertedToInternal)</div>
<div class="line">                    {</div>
<div class="line">                        val = (float)<a class="code" href="./class_m_distance.html">MDistance</a>( val, <a name="a9"></a><a class="code" href="./class_m_distance.html#a2a3077e91bb7ba19bade3cae7e4604a6">MDistance::internalUnit</a>()).as(fUnits);</div>
<div class="line">                    }</div>
<div class="line">                    tmp[0] = val;</div>
<div class="line">                }</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fSize &lt;= 4 || fType == cgfxAttrDef::kAttrTypeMatrix)</div>
<div class="line">                {</div>
<div class="line"> <span class="keywordtype">float</span> val[16];</div>
<div class="line"> <span class="keywordflow">if</span> (fType == kAttrTypeMatrix)</div>
<div class="line">                    {</div>
<div class="line">                        cgGetMatrixParameterfc(cgParameter, val);</div>
<div class="line">                    }</div>
<div class="line"> <span class="keywordflow">else</span></div>
<div class="line">                    {</div>
<div class="line"> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vecSize = fSize;</div>
<div class="line">                        cgGetParameterValuefc(cgParameter, vecSize, val);</div>
<div class="line">                    }</div>
<div class="line"> <span class="comment">/*if (result != S_OK)</span></div>
<div class="line"><span class="comment">                      {</span></div>
<div class="line"><span class="comment">                      delete [] tmp;</span></div>
<div class="line"><span class="comment">                      tmp = 0;</span></div>
<div class="line"><span class="comment">                      break;</span></div>
<div class="line"><span class="comment">                      }*/</span></div>
<div class="line"> <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; fSize; ++k)</div>
<div class="line">                    {</div>
<div class="line"> <span class="comment">// If the value is a converted value, we need to convert it to one with unit </span></div>
<div class="line"> <span class="keywordflow">if</span>( fIsConvertedToInternal)</div>
<div class="line">                        {</div>
<div class="line">                            val[k] = (float)<a class="code" href="./class_m_distance.html">MDistance</a>( val[k], <a class="code" href="./class_m_distance.html#a2a3077e91bb7ba19bade3cae7e4604a6">MDistance::internalUnit</a>()).as(fUnits);</div>
<div class="line">                        }</div>
<div class="line">                        tmp[k] = val[k];</div>
<div class="line">                    }</div>
<div class="line"> </div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line"> <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">case</span> CG_STRING:</div>
<div class="line">            {</div>
<div class="line"><span class="preprocessor">#ifdef _WIN32</span></div>
<div class="line">                LPCSTR val;</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"> <span class="keyword">const</span> <span class="keywordtype">char</span>* val = NULL;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">                val = cgGetStringParameterValue(cgParameter);</div>
<div class="line"></div>
<div class="line">                fStringDef = val;</div>
<div class="line">            }</div>
<div class="line"> <span class="comment">// Fall through into the default case to destroy the</span></div>
<div class="line"> <span class="comment">// numeric default value.</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">default</span>:</div>
<div class="line"> <span class="comment">// We don't know what to do but there is no point in</span></div>
<div class="line"> <span class="comment">// keeping tmp around.</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <span class="keyword">delete</span> [] tmp;</div>
<div class="line">            tmp = 0;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Don't save initial value if it is zero (or identity matrix).</span></div>
<div class="line"> <span class="keywordflow">if</span> ( tmp )</div>
<div class="line">    {</div>
<div class="line"> <span class="keywordtype">int</span> k;</div>
<div class="line"> <span class="keywordflow">if</span> ( fSize == 16 )</div>
<div class="line">        {</div>
<div class="line"> <span class="keyword">const</span> <span class="keywordtype">double</span>* d = &amp;<a name="a10"></a><a class="code" href="./class_m_matrix.html#a85de986c9f953535d185c6780cecb77e">MMatrix::identity</a>[0][0];</div>
<div class="line"> <span class="keywordflow">for</span> ( k = 0; k &lt; fSize; ++k )</div>
<div class="line"> <span class="keywordflow">if</span> ( tmp[ k ] != d[ k ] )</div>
<div class="line"> <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line"> <span class="keywordflow">for</span> ( k = 0; k &lt; fSize; ++k )</div>
<div class="line"> <span class="keywordflow">if</span> ( tmp[ k ] != 0.0 )</div>
<div class="line"> <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> <span class="keywordflow">if</span> ( k == fSize )</div>
<div class="line">        {</div>
<div class="line"> <span class="keyword">delete</span> [] tmp;</div>
<div class="line">            tmp = 0;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    fNumericDef = tmp;</div>
<div class="line"></div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">cgfxAttrDef::cgfxAttrDef(</div>
<div class="line"> <span class="keyword">const</span> <a class="code" href="./class_m_string.html">MString</a>&amp;          sAttrName,</div>
<div class="line"> <span class="keyword">const</span> cgfxAttrType      eAttrType,</div>
<div class="line"> <span class="keyword">const</span> <a class="code" href="./class_m_string.html">MString</a>&amp;          sDescription,</div>
<div class="line"> <span class="keyword">const</span> <a class="code" href="./class_m_string.html">MString</a>&amp;          sSemantic,</div>
<div class="line"> <a name="_a11"></a><a class="code" href="./class_m_object.html">MObject</a>                 obNode,</div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a>                 obAttr</div>
<div class="line">)</div>
<div class="line">: fType( kAttrTypeUnknown )</div>
<div class="line">, fSize( 0 )</div>
<div class="line">, fHint( kVectorHintNone )</div>
<div class="line">, fNumericMin( NULL )</div>
<div class="line">, fNumericMax( NULL )</div>
<div class="line">, fNumericSoftMin( NULL )</div>
<div class="line">, fNumericSoftMax( NULL )</div>
<div class="line">, fUnits( <a class="code" href="./class_m_distance.html">MDistance</a>::kInvalid )</div>
<div class="line">, fNumericDef( NULL )</div>
<div class="line">, fTextureMonitor(kNullCallback)</div>
<div class="line"><span class="comment">// , fParameterIndex( (LPCSTR)(-1) )</span></div>
<div class="line">, fParameterHandle(0)</div>
<div class="line">, fInvertMatrix( false )</div>
<div class="line">, fTransposeMatrix( false )</div>
<div class="line">, fTweaked( false )</div>
<div class="line">, fInitOnUndo( false )</div>
<div class="line">, fIsConvertedToInternal(false)</div>
<div class="line">{</div>
<div class="line"> <a name="_a12"></a><a class="code" href="./class_m_status.html">MStatus</a> status;</div>
<div class="line"> </div>
<div class="line">    fName = sAttrName;</div>
<div class="line">    fType = eAttrType;</div>
<div class="line">    fDescription = sDescription;</div>
<div class="line">    fSemantic = sSemantic;</div>
<div class="line">    fAttr = obAttr;</div>
<div class="line"></div>
<div class="line"> <a name="_a13"></a><a class="code" href="./class_m_fn_compound_attribute.html">MFnCompoundAttribute</a> fnCompound;</div>
<div class="line"> <a name="_a14"></a><a class="code" href="./class_m_fn_numeric_attribute.html">MFnNumericAttribute</a>  fnNumeric;</div>
<div class="line"> <a name="_a15"></a><a class="code" href="./class_m_fn_typed_attribute.html">MFnTypedAttribute</a>    fnTyped;</div>
<div class="line"> <a name="_a16"></a><a class="code" href="./class_m_fn_matrix_attribute.html">MFnMatrixAttribute</a>   fnMatrix;</div>
<div class="line"></div>
<div class="line"> <a name="_a17"></a><a class="code" href="./class_m_plug.html">MPlug</a>   plug( obNode, obAttr );</div>
<div class="line"> <span class="keywordtype">double</span>  numericMin[4];</div>
<div class="line"> <span class="keywordtype">double</span>  numericMax[4];</div>
<div class="line"> <span class="keywordtype">double</span>  numericValue[4];</div>
<div class="line"> <span class="keywordtype">bool</span>    hasMin    = <span class="keyword">false</span>;</div>
<div class="line"> <span class="keywordtype">bool</span>    hasMax    = <span class="keyword">false</span>; </div>
<div class="line"> <span class="keywordtype">bool</span>    isNumeric = <span class="keyword">false</span>;</div>
<div class="line"></div>
<div class="line"> <span class="comment">// If compound attribute, get value and bounds of each element.</span></div>
<div class="line"> <span class="keywordflow">if</span> ( fnCompound.<a name="a18"></a><a class="code" href="./class_m_fn_base.html#ad09f5acece0f9926b3e0e55cff78c3be">setObject</a>( obAttr ) )</div>
<div class="line">    {</div>
<div class="line">        hasMin = <span class="keyword">true</span>;</div>
<div class="line">        hasMax = <span class="keyword">true</span>;</div>
<div class="line">        isNumeric = <span class="keyword">true</span>;</div>
<div class="line"></div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a>      obChild;</div>
<div class="line"> <a name="_a19"></a><a class="code" href="./class_m_string_array.html">MStringArray</a> saChild;</div>
<div class="line"> <span class="keywordtype">int</span> iChild;</div>
<div class="line"> <span class="keywordtype">int</span> nChild = fnCompound.<a name="a20"></a><a class="code" href="./class_m_fn_compound_attribute.html#a0a27cb351cc1a05aa82d4329d7f99bd1">numChildren</a>();</div>
<div class="line">        M_CHECK( nChild &gt;= 2 &amp;&amp; nChild &lt;= 3 );</div>
<div class="line"> <span class="keywordflow">for</span> ( iChild = 0; iChild &lt; nChild; ++iChild )</div>
<div class="line">        {</div>
<div class="line"> <span class="comment">// Get child attribute.</span></div>
<div class="line"> <span class="keywordflow">if</span> ( iChild &lt; 3 )</div>
<div class="line">            {</div>
<div class="line">                obChild = fnCompound.<a name="a21"></a><a class="code" href="./class_m_fn_compound_attribute.html#a32afd4253a710c7cb42a82b636852d6d">child</a>( iChild, &amp;status );</div>
<div class="line">                M_CHECK( status );</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            status = fnNumeric.<a class="code" href="./class_m_fn_base.html#ad09f5acece0f9926b3e0e55cff78c3be">setObject</a>( obChild );</div>
<div class="line">            M_CHECK( status );</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Min</span></div>
<div class="line"> <span class="keywordflow">if</span> ( fnNumeric.<a name="a22"></a><a class="code" href="./class_m_fn_numeric_attribute.html#a1635117fc1cd56e612895c54a0996491">hasMin</a>() )</div>
<div class="line">                fnNumeric.<a name="a23"></a><a class="code" href="./class_m_fn_numeric_attribute.html#abb1aad941525b3b815f4039be325a1e1">getMin</a>( numericMin[ iChild ] );</div>
<div class="line"> <span class="keywordflow">else</span></div>
<div class="line">                hasMin = <span class="keyword">false</span>; </div>
<div class="line"></div>
<div class="line"> <span class="comment">// Max</span></div>
<div class="line"> <span class="keywordflow">if</span> ( fnNumeric.<a name="a24"></a><a class="code" href="./class_m_fn_numeric_attribute.html#a5b1ba68393fede3d8d2078add520f168">hasMax</a>() )</div>
<div class="line">                fnNumeric.<a name="a25"></a><a class="code" href="./class_m_fn_numeric_attribute.html#aad0f7617f31e702a6e626f7bf4bb7f2a">getMax</a>( numericMax[ iChild ] );</div>
<div class="line"> <span class="keywordflow">else</span></div>
<div class="line">                hasMax = <span class="keyword">false</span>; </div>
<div class="line"></div>
<div class="line"> <span class="comment">// Value</span></div>
<div class="line"> <a class="code" href="./class_m_plug.html">MPlug</a> plChild( obNode, obChild );</div>
<div class="line">            status = plChild.getValue( numericValue[ iChild ] );</div>
<div class="line">            M_CHECK( status );</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Check for 4-element vector.</span></div>
<div class="line">            saChild.<a name="a26"></a><a class="code" href="./class_m_string_array.html#a18d06b3d0af1426e654ac2cc1dc86c60">append</a>( fnNumeric.<a name="a27"></a><a class="code" href="./class_m_fn_attribute.html#a049384adbea0396ea2f03d1ad4d69df1">name</a>() );</div>
<div class="line"> <span class="keywordflow">if</span> ( iChild == 2 )</div>
<div class="line">            {</div>
<div class="line"> <span class="keyword">const</span> <span class="keywordtype">char</span>* suffix = NULL;</div>
<div class="line"> <span class="keywordflow">if</span> ( saChild[0] == sAttrName + <span class="stringliteral">"X"</span> &amp;&amp;</div>
<div class="line">                     saChild[1] == sAttrName + <span class="stringliteral">"Y"</span> &amp;&amp;</div>
<div class="line">                     saChild[2] == sAttrName + <span class="stringliteral">"Z"</span> ) </div>
<div class="line">                    suffix = <span class="stringliteral">"W"</span>;</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( saChild[0] == sAttrName + <span class="stringliteral">"R"</span> &amp;&amp;</div>
<div class="line">                          saChild[1] == sAttrName + <span class="stringliteral">"G"</span> &amp;&amp;</div>
<div class="line">                          saChild[2] == sAttrName + <span class="stringliteral">"B"</span> ) </div>
<div class="line">                    suffix = <span class="stringliteral">"Alpha"</span>;</div>
<div class="line"> <span class="keywordflow">if</span> ( suffix )</div>
<div class="line">                {</div>
<div class="line"> <a class="code" href="./class_m_string.html">MString</a> sName2 = sAttrName + suffix;</div>
<div class="line"> <a name="_a28"></a><a class="code" href="./class_m_fn_dependency_node.html">MFnDependencyNode</a> fnNode(obNode);</div>
<div class="line">                    obChild = fnNode.attribute( sName2, &amp;status );</div>
<div class="line"> <a class="code" href="./class_m_fn_numeric_data.html#a1d1cfd8ffb84e947f82999c682b666a7">MFnNumericData::Type</a> ndt = fnNumeric.<a name="a29"></a><a class="code" href="./class_m_fn_numeric_attribute.html#a475558f03040cb41c9af196253650823">unitType</a>();</div>
<div class="line"> <span class="keywordflow">if</span> ( status &amp;&amp;</div>
<div class="line">                         fnNumeric.<a class="code" href="./class_m_fn_base.html#ad09f5acece0f9926b3e0e55cff78c3be">setObject</a>( obChild ) &amp;&amp;</div>
<div class="line">                         fnNumeric.<a class="code" href="./class_m_fn_numeric_attribute.html#a475558f03040cb41c9af196253650823">unitType</a>() == ndt )</div>
<div class="line">                    {</div>
<div class="line">                        fAttr2 = obChild;</div>
<div class="line">                        nChild = 4;     <span class="comment">// loop again to get extra attr</span></div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }                          <span class="comment">// loop over children</span></div>
<div class="line">        fSize = nChild;</div>
<div class="line">    }                              <span class="comment">// compound </span></div>
<div class="line"></div>
<div class="line"> <span class="comment">// Simple numeric attribute?  </span></div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( fnNumeric.<a class="code" href="./class_m_fn_base.html#ad09f5acece0f9926b3e0e55cff78c3be">setObject</a>( obAttr ) )</div>
<div class="line">    {</div>
<div class="line"> <a class="code" href="./class_m_fn_numeric_attribute.html">MFnNumericAttribute</a> fnNumeric( obAttr, &amp;status );</div>
<div class="line">        M_CHECK( status );</div>
<div class="line"></div>
<div class="line"> </div>
<div class="line"></div>
<div class="line">        fSize = 1;</div>
<div class="line">        isNumeric = <span class="keyword">true</span>;</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Get min and max.</span></div>
<div class="line"> <span class="keywordflow">if</span> ( fnNumeric.<a class="code" href="./class_m_fn_numeric_attribute.html#a1635117fc1cd56e612895c54a0996491">hasMin</a>() )</div>
<div class="line">        {</div>
<div class="line">            fnNumeric.<a class="code" href="./class_m_fn_numeric_attribute.html#abb1aad941525b3b815f4039be325a1e1">getMin</a>( numericMin[0] );</div>
<div class="line">            hasMin = <span class="keyword">true</span>;</div>
<div class="line">        }</div>
<div class="line"> <span class="keywordflow">if</span> ( fnNumeric.<a class="code" href="./class_m_fn_numeric_attribute.html#a5b1ba68393fede3d8d2078add520f168">hasMax</a>() )</div>
<div class="line">        {</div>
<div class="line">            fnNumeric.<a class="code" href="./class_m_fn_numeric_attribute.html#aad0f7617f31e702a6e626f7bf4bb7f2a">getMax</a>( numericMax[0] );</div>
<div class="line">            hasMax = <span class="keyword">true</span>;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Get slider bounds.</span></div>
<div class="line"> <span class="keywordflow">if</span> ( fnNumeric.<a name="a30"></a><a class="code" href="./class_m_fn_numeric_attribute.html#a917aaf6e8026c32ca2f402c51e531b69">hasSoftMin</a>() )</div>
<div class="line">        {</div>
<div class="line">            fNumericSoftMin = <span class="keyword">new</span> <span class="keywordtype">double</span>[1];</div>
<div class="line">            fnNumeric.<a name="a31"></a><a class="code" href="./class_m_fn_numeric_attribute.html#aef16b8be7989f51572fdd91f041aeae0">getSoftMin</a>( fNumericSoftMin[0] );</div>
<div class="line">        }</div>
<div class="line"> <span class="keywordflow">if</span> ( fnNumeric.<a name="a32"></a><a class="code" href="./class_m_fn_numeric_attribute.html#a563766a920e62cba567fdc71af3be8e4">hasSoftMax</a>() )</div>
<div class="line">        {</div>
<div class="line">            fNumericSoftMax = <span class="keyword">new</span> <span class="keywordtype">double</span>[1];</div>
<div class="line">            fnNumeric.<a name="a33"></a><a class="code" href="./class_m_fn_numeric_attribute.html#a65535187b17c6a7418cf5be0c41bdc2d">getSoftMax</a>( fNumericSoftMax[0] );</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Value </span></div>
<div class="line">        status = plug.getValue( numericValue[0] );</div>
<div class="line">        M_CHECK( status );</div>
<div class="line">    }                              <span class="comment">// simple numeric</span></div>
<div class="line"></div>
<div class="line"> <span class="comment">// String attribute?</span></div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fnTyped.<a class="code" href="./class_m_fn_base.html#ad09f5acece0f9926b3e0e55cff78c3be">setObject</a>( obAttr ) &amp;&amp;</div>
<div class="line">             fnTyped.<a name="a34"></a><a class="code" href="./class_m_fn_typed_attribute.html#aa3bf2ba724f9aaf87976b1fb896fd700">attrType</a>() == <a name="a35"></a><a class="code" href="./class_m_fn_data.html#a1d1cfd8ffb84e947f82999c682b666a7afab53ea4a643325262b9c140af093279">MFnData::kString</a>)</div>
<div class="line">    {</div>
<div class="line">        fSize = 1;</div>
<div class="line">        status = plug.getValue( fStringDef );</div>
<div class="line">        M_CHECK( status );</div>
<div class="line">    }                           <span class="comment">// string</span></div>
<div class="line"> <span class="comment">// Matrix attribute?</span></div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fnMatrix.<a class="code" href="./class_m_fn_base.html#ad09f5acece0f9926b3e0e55cff78c3be">setObject</a>( obAttr ))</div>
<div class="line">    {</div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> obData;</div>
<div class="line">        status = plug.getValue( obData );</div>
<div class="line">        M_CHECK( status );</div>
<div class="line"> <a name="_a36"></a><a class="code" href="./class_m_fn_matrix_data.html">MFnMatrixData</a> fnMatrixData( obData, &amp;status );</div>
<div class="line">        M_CHECK( status );</div>
<div class="line"> <span class="keyword">const</span> <a name="_a37"></a><a class="code" href="./class_m_matrix.html">MMatrix</a>&amp; mat = fnMatrixData.<a name="a38"></a><a class="code" href="./class_m_matrix.html#a527b102f4eb0951cf4f391f828d3ca34">matrix</a>( &amp;status );</div>
<div class="line">        M_CHECK( status );</div>
<div class="line">        fSize = 16;</div>
<div class="line">        fNumericDef = <span class="keyword">new</span> <span class="keywordtype">double</span>[ fSize ];</div>
<div class="line"> <span class="keyword">const</span> <span class="keywordtype">double</span>* p = &amp;(mat.<a class="code" href="./class_m_matrix.html#a527b102f4eb0951cf4f391f828d3ca34">matrix</a>[0][0]);</div>
<div class="line"> <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; 16; ++i )</div>
<div class="line">            fNumericDef[ i ] = p[ i ];</div>
<div class="line">        M_CHECK( status );</div>
<div class="line">    }                           <span class="comment">// matrix </span></div>
<div class="line"> <span class="comment">// Mystified...</span></div>
<div class="line"> <span class="keywordflow">else</span></div>
<div class="line">        M_CHECK( <span class="keyword">false</span> );</div>
<div class="line"> </div>
<div class="line"></div>
<div class="line"> <span class="comment">// Store numeric value, min and max.</span></div>
<div class="line"> <span class="keywordflow">if</span> ( isNumeric )</div>
<div class="line">    {</div>
<div class="line">        fNumericDef = <span class="keyword">new</span> <span class="keywordtype">double</span>[ fSize ];</div>
<div class="line">        memcpy( fNumericDef, numericValue, fSize * <span class="keyword">sizeof</span>( numericValue[0] ) );</div>
<div class="line"> <span class="keywordflow">if</span> ( hasMin )</div>
<div class="line">        {</div>
<div class="line">            fNumericMin = <span class="keyword">new</span> <span class="keywordtype">double</span>[ fSize ];</div>
<div class="line">            memcpy( fNumericMin, numericMin, fSize * <span class="keyword">sizeof</span>( numericMin[0] ) );</div>
<div class="line">        }</div>
<div class="line"> <span class="keywordflow">if</span> ( hasMax )</div>
<div class="line">        {</div>
<div class="line">            fNumericMax = <span class="keyword">new</span> <span class="keywordtype">double</span>[ fSize ];</div>
<div class="line">            memcpy( fNumericMax, numericMax, fSize * <span class="keyword">sizeof</span>( numericMax[0] ) );</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <span class="comment">// set attribute flags</span></div>
<div class="line">    setAttributeFlags();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// Destructor</span></div>
<div class="line">cgfxAttrDef::~cgfxAttrDef()</div>
<div class="line">{</div>
<div class="line">    release();</div>
<div class="line"> <span class="keyword">delete</span> [] fNumericMin;</div>
<div class="line"> <span class="keyword">delete</span> [] fNumericMax;</div>
<div class="line"> <span class="keyword">delete</span> [] fNumericSoftMin;</div>
<div class="line"> <span class="keyword">delete</span> [] fNumericSoftMax;</div>
<div class="line"> <span class="keyword">delete</span> [] fNumericDef;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">// Release any associated resources</span></div>
<div class="line"><span class="keywordtype">void</span> cgfxAttrDef::release()</div>
<div class="line">{</div>
<div class="line">    releaseTexture();</div>
<div class="line">    releaseCallback();</div>
<div class="line">}</div>
<div class="line"><span class="keywordtype">void</span> cgfxAttrDef::releaseTexture()</div>
<div class="line">{</div>
<div class="line">    fTexture = cgfxRCPtr&lt;cgfxTextureCacheEntry&gt;();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> cgfxAttrDef::releaseCallback()</div>
<div class="line">{</div>
<div class="line"> <span class="keywordflow">if</span>( fTextureMonitor != kNullCallback)</div>
<div class="line">    {</div>
<div class="line"> <a name="a39"></a><a class="code" href="./class_m_message.html#a50fe995add3ce133b8b56551abb4ed09">MMessage::removeCallback</a>( fTextureMonitor);</div>
<div class="line">        fTextureMonitor = kNullCallback;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">// ================ cgfxAttrDef::setTextureType ================</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// This method looks at the parameter data type, semantic, and</span></div>
<div class="line"><span class="comment">// annotation and determines</span></div>
<div class="line"><span class="keywordtype">void</span> cgfxAttrDef::setTextureType(CGparameter cgParameter)</div>
<div class="line">{</div>
<div class="line">    fType = kAttrTypeColor2DTexture;</div>
<div class="line"></div>
<div class="line"> <span class="keyword">const</span> <span class="keywordtype">char</span>* semantic = cgGetParameterSemantic(cgParameter);</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (!semantic) <span class="keywordflow">return</span>;</div>
<div class="line"></div>
<div class="line"> <span class="comment">// We have to go thru semantics and annotations to find the type of the texture</span></div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (semantic)</div>
<div class="line">    {</div>
<div class="line"> <span class="keywordflow">if</span> (stricmp(semantic, <span class="stringliteral">"normal"</span>) == 0)</div>
<div class="line">        {</div>
<div class="line">            fType = kAttrTypeNormalTexture;</div>
<div class="line">        }</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stricmp(semantic, <span class="stringliteral">"height"</span>) == 0)</div>
<div class="line">        {</div>
<div class="line">            fType = kAttrTypeBumpTexture;</div>
<div class="line">        }</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stricmp(semantic, <span class="stringliteral">"environment"</span>) == 0)</div>
<div class="line">        {</div>
<div class="line">            fType = kAttrTypeEnvTexture;</div>
<div class="line">        }</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stricmp(semantic, <span class="stringliteral">"environmentnormal"</span>) == 0)</div>
<div class="line">        {</div>
<div class="line">            fType = kAttrTypeNormalizationTexture;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Now browse through the annotations to see if there is anything</span></div>
<div class="line"> <span class="comment">// interesting there too.</span></div>
<div class="line"></div>
<div class="line">    CGannotation cgAnnotation = cgGetFirstParameterAnnotation(cgParameter);</div>
<div class="line"> <span class="keywordflow">while</span> (cgAnnotation)</div>
<div class="line">    {</div>
<div class="line"> <span class="keyword">const</span> <span class="keywordtype">char</span>* annotationName  = cgGetAnnotationName(cgAnnotation);</div>
<div class="line"> <span class="keyword">const</span> <span class="keywordtype">char</span>* annotationValue = cgGetStringAnnotationValue(cgAnnotation);</div>
<div class="line"> </div>
<div class="line"> <span class="keywordflow">if</span> (stricmp(annotationName, <span class="stringliteral">"resourcetype"</span>) == 0)</div>
<div class="line">        {</div>
<div class="line"> <span class="keywordflow">if</span> (stricmp(annotationValue, <span class="stringliteral">"1d"</span>) == 0)</div>
<div class="line">            {</div>
<div class="line">                fType = kAttrTypeColor1DTexture;</div>
<div class="line">            }</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stricmp(annotationValue, <span class="stringliteral">"2d"</span>) == 0)</div>
<div class="line">            {</div>
<div class="line">                fType = kAttrTypeColor2DTexture;</div>
<div class="line">            }</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stricmp(annotationValue, <span class="stringliteral">"rect"</span>) == 0)</div>
<div class="line">            {</div>
<div class="line">                fType = kAttrTypeColor2DRectTexture;</div>
<div class="line">            }</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stricmp(annotationValue, <span class="stringliteral">"3d"</span>) == 0)</div>
<div class="line">            {</div>
<div class="line">                fType = kAttrTypeColor3DTexture;</div>
<div class="line">            }</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stricmp(annotationValue, <span class="stringliteral">"cube"</span>) == 0)</div>
<div class="line">            {</div>
<div class="line">                fType = kAttrTypeCubeTexture;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stricmp(annotationName, <span class="stringliteral">"resourcename"</span>) == 0)</div>
<div class="line">        {</div>
<div class="line"> <span class="comment">// Store the texture file to load as the</span></div>
<div class="line"> <span class="comment">// string default argument.  (I know, its kind</span></div>
<div class="line"> <span class="comment">// of a kludge; but if the texture attributes</span></div>
<div class="line"> <span class="comment">// were string values, it would be exactly</span></div>
<div class="line"> <span class="comment">// correct.</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line">            fStringDef = annotationValue;</div>
<div class="line">        }</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stricmp(annotationName, <span class="stringliteral">"uvlink"</span>) == 0)</div>
<div class="line">        {</div>
<div class="line"> <span class="comment">// Store the variable name of the input UV</span></div>
<div class="line"> <span class="comment">// set that this texture is to be linked against.</span></div>
<div class="line">            fTextureUVLink = annotationValue;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        cgAnnotation = cgGetNextAnnotation(cgAnnotation);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> cgfxAttrDef::setSamplerType(CGparameter cgParameter)</div>
<div class="line">{</div>
<div class="line">    CGstateassignment cgStateAssignment = cgGetNamedSamplerStateAssignment(cgParameter, <span class="stringliteral">"texture"</span>);</div>
<div class="line">    setTextureType(cgGetTextureStateAssignmentValue(cgStateAssignment));</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> cgfxAttrDef::setMatrixType(CGparameter cgParameter)</div>
<div class="line">{</div>
<div class="line">    fType = kAttrTypeMatrix;</div>
<div class="line"></div>
<div class="line"> <span class="keyword">const</span> <span class="keywordtype">char</span>* semantic = cgGetParameterSemantic(cgParameter);</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (!semantic)</div>
<div class="line"> <span class="keywordflow">return</span>;</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (stricmp(semantic, <span class="stringliteral">"world"</span>) == 0)</div>
<div class="line">    {</div>
<div class="line">        fType = kAttrTypeWorldMatrix;</div>
<div class="line">        fInvertMatrix = <span class="keyword">false</span>;</div>
<div class="line">        fTransposeMatrix = <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stricmp(semantic, <span class="stringliteral">"worldinverse"</span>) == 0)</div>
<div class="line">    {</div>
<div class="line">        fType = kAttrTypeWorldMatrix;</div>
<div class="line">        fInvertMatrix = <span class="keyword">true</span>;</div>
<div class="line">        fTransposeMatrix = <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stricmp(semantic, <span class="stringliteral">"worldtranspose"</span>) == 0)</div>
<div class="line">    {</div>
<div class="line">        fType = kAttrTypeWorldMatrix;</div>
<div class="line">        fInvertMatrix = <span class="keyword">false</span>;</div>
<div class="line">        fTransposeMatrix = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stricmp(semantic, <span class="stringliteral">"worldinversetranspose"</span>) == 0)</div>
<div class="line">    {</div>
<div class="line">        fType = kAttrTypeWorldMatrix;</div>
<div class="line">        fInvertMatrix = <span class="keyword">true</span>;</div>
<div class="line">        fTransposeMatrix = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stricmp(semantic, <span class="stringliteral">"worldview"</span>) == 0)</div>
<div class="line">    {</div>
<div class="line">        fType = kAttrTypeWorldViewMatrix;</div>
<div class="line">        fInvertMatrix = <span class="keyword">false</span>;</div>
<div class="line">        fTransposeMatrix = <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stricmp(semantic, <span class="stringliteral">"worldviewtranspose"</span>) == 0)</div>
<div class="line">    {</div>
<div class="line">        fType = kAttrTypeWorldViewMatrix;</div>
<div class="line">        fInvertMatrix = <span class="keyword">false</span>;</div>
<div class="line">        fTransposeMatrix = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stricmp(semantic, <span class="stringliteral">"worldviewinverse"</span>) == 0)</div>
<div class="line">    {</div>
<div class="line">        fType = kAttrTypeWorldViewMatrix;</div>
<div class="line">        fInvertMatrix = <span class="keyword">true</span>;</div>
<div class="line">        fTransposeMatrix = <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stricmp(semantic, <span class="stringliteral">"worldviewinversetranspose"</span>) == 0)</div>
<div class="line">    {</div>
<div class="line">        fType = kAttrTypeWorldViewMatrix;</div>
<div class="line">        fInvertMatrix = <span class="keyword">true</span>;</div>
<div class="line">        fTransposeMatrix = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stricmp(semantic, <span class="stringliteral">"worldviewprojection"</span>) == 0)</div>
<div class="line">    {</div>
<div class="line">        fType = kAttrTypeWorldViewProjectionMatrix;</div>
<div class="line">        fInvertMatrix = <span class="keyword">false</span>;</div>
<div class="line">        fTransposeMatrix = <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stricmp(semantic, <span class="stringliteral">"worldviewprojectiontranspose"</span>) == 0)</div>
<div class="line">    {</div>
<div class="line">        fType = kAttrTypeWorldViewProjectionMatrix;</div>
<div class="line">        fInvertMatrix = <span class="keyword">false</span>;</div>
<div class="line">        fTransposeMatrix = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stricmp(semantic, <span class="stringliteral">"worldviewprojectioninverse"</span>) == 0)</div>
<div class="line">    {</div>
<div class="line">        fType = kAttrTypeWorldViewProjectionMatrix;</div>
<div class="line">        fInvertMatrix = <span class="keyword">true</span>;</div>
<div class="line">        fTransposeMatrix = <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stricmp(semantic, <span class="stringliteral">"worldviewprojectioninversetranspose"</span>) == 0)</div>
<div class="line">    {</div>
<div class="line">        fType = kAttrTypeWorldViewProjectionMatrix;</div>
<div class="line">        fInvertMatrix = <span class="keyword">true</span>;</div>
<div class="line">        fTransposeMatrix = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stricmp(semantic, <span class="stringliteral">"view"</span>) == 0)</div>
<div class="line">    {</div>
<div class="line">        fType = kAttrTypeViewMatrix;</div>
<div class="line">        fInvertMatrix = <span class="keyword">false</span>;</div>
<div class="line">        fTransposeMatrix = <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stricmp(semantic, <span class="stringliteral">"viewinverse"</span>) == 0)</div>
<div class="line">    {</div>
<div class="line">        fType = kAttrTypeViewMatrix;</div>
<div class="line">        fInvertMatrix = <span class="keyword">true</span>;</div>
<div class="line">        fTransposeMatrix = <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stricmp(semantic, <span class="stringliteral">"viewtranspose"</span>) == 0)</div>
<div class="line">    {</div>
<div class="line">        fType = kAttrTypeViewMatrix;</div>
<div class="line">        fInvertMatrix = <span class="keyword">false</span>;</div>
<div class="line">        fTransposeMatrix = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stricmp(semantic, <span class="stringliteral">"viewinversetranspose"</span>) == 0)</div>
<div class="line">    {</div>
<div class="line">        fType = kAttrTypeViewMatrix;</div>
<div class="line">        fInvertMatrix = <span class="keyword">true</span>;</div>
<div class="line">        fTransposeMatrix = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stricmp(semantic, <span class="stringliteral">"projection"</span>) == 0)</div>
<div class="line">    {</div>
<div class="line">        fType = kAttrTypeProjectionMatrix;</div>
<div class="line">        fInvertMatrix = <span class="keyword">false</span>;</div>
<div class="line">        fTransposeMatrix = <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stricmp(semantic, <span class="stringliteral">"projectioninverse"</span>) == 0)</div>
<div class="line">    {</div>
<div class="line">        fType = kAttrTypeProjectionMatrix;</div>
<div class="line">        fInvertMatrix = <span class="keyword">true</span>;</div>
<div class="line">        fTransposeMatrix = <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stricmp(semantic, <span class="stringliteral">"projectiontranspose"</span>) == 0)</div>
<div class="line">    {</div>
<div class="line">        fType = kAttrTypeProjectionMatrix;</div>
<div class="line">        fInvertMatrix = <span class="keyword">false</span>;</div>
<div class="line">        fTransposeMatrix = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stricmp(semantic, <span class="stringliteral">"projectioninversetranspose"</span>) == 0)</div>
<div class="line">    {</div>
<div class="line">        fType = kAttrTypeProjectionMatrix;</div>
<div class="line">        fInvertMatrix = <span class="keyword">true</span>;</div>
<div class="line">        fTransposeMatrix = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// This routine returns true if the semantic value is known to refer</span></div>
<div class="line"><span class="comment">// to a color value instead of a positional value.  We determine that</span></div>
<div class="line"><span class="comment">// this is a color value because it uses one of the known names or it</span></div>
<div class="line"><span class="comment">// contains the string "color" or "colour" in it.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="keywordtype">void</span> cgfxAttrDef::setVectorType(CGparameter cgParameter)</div>
<div class="line">{</div>
<div class="line"><span class="preprocessor">#if 0</span></div>
<div class="line"> <span class="comment">// This variable is not used</span></div>
<div class="line"> <span class="keyword">static</span> <span class="keywordtype">char</span>* colorList[] = </div>
<div class="line">    {</div>
<div class="line"> <span class="stringliteral">"diffuse"</span>,</div>
<div class="line"> <span class="stringliteral">"specular"</span>,</div>
<div class="line"> <span class="stringliteral">"ambient"</span>,</div>
<div class="line"> <span class="stringliteral">"emissive"</span>,</div>
<div class="line">    };</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"></div>
<div class="line"> <span class="keyword">const</span> <span class="keywordtype">char</span>* semantic = cgGetParameterSemantic(cgParameter);</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> ((semantic == NULL || strcmp(semantic,<span class="stringliteral">""</span>) == 0) == <span class="keyword">false</span>)</div>
<div class="line">    {</div>
<div class="line"> <span class="comment">// Check the semantic value to see if this is a color</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <span class="keywordflow">if</span> (stricmp(semantic, <span class="stringliteral">"diffuse"</span>) == 0 ||</div>
<div class="line">            stricmp(semantic, <span class="stringliteral">"specular"</span>) == 0 ||</div>
<div class="line">            stricmp(semantic, <span class="stringliteral">"ambient"</span>) == 0 ||</div>
<div class="line">            stricmp(semantic, <span class="stringliteral">"emissive"</span>) == 0)</div>
<div class="line">        {</div>
<div class="line">            fType = (fSize == 3) ? kAttrTypeColor3 : kAttrTypeColor4;</div>
<div class="line">        }</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stricmp(semantic, <span class="stringliteral">"direction"</span>) == 0)</div>
<div class="line">        {</div>
<div class="line">            fType = kAttrTypeFirstDir;</div>
<div class="line">        }</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stricmp(semantic, <span class="stringliteral">"position"</span>) == 0)</div>
<div class="line">        {</div>
<div class="line">            fType = kAttrTypeFirstPos;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    CGannotation cgAnnotation = cgGetFirstParameterAnnotation(cgParameter);</div>
<div class="line"> <span class="keywordflow">while</span> (cgAnnotation)</div>
<div class="line">    {</div>
<div class="line"> <span class="keyword">const</span> <span class="keywordtype">char</span>* annotationName  = cgGetAnnotationName(cgAnnotation);</div>
<div class="line"> <span class="keyword">const</span> <span class="keywordtype">char</span>* annotationValue = cgGetStringAnnotationValue(cgAnnotation);</div>
<div class="line"> </div>
<div class="line"> <span class="keywordflow">if</span> (stricmp(annotationName, <span class="stringliteral">"type"</span>) == 0)</div>
<div class="line">        {</div>
<div class="line"> <span class="keywordflow">if</span> (strlen(annotationValue) != 0)</div>
<div class="line">            {</div>
<div class="line"> <span class="keywordflow">if</span> (stricmp(annotationValue, <span class="stringliteral">"color"</span>) == 0)</div>
<div class="line">                {</div>
<div class="line">                    fType = (fSize == 3) ? kAttrTypeColor3 : kAttrTypeColor4;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stricmp(annotationName, <span class="stringliteral">"space"</span>) == 0)</div>
<div class="line">        {</div>
<div class="line"> <span class="comment">// we assume the attribute to be a direction if it doesn't have semantic to determine it.</span></div>
<div class="line"> <span class="comment">// display a warning at the same time</span></div>
<div class="line"> <span class="keywordflow">if</span>(fType != kAttrTypeFirstDir &amp;&amp; fType != kAttrTypeFirstPos)</div>
<div class="line">            {</div>
<div class="line"> <span class="keyword">const</span> <a class="code" href="./class_m_string.html">MString</a> warnMsg = fName + <span class="stringliteral">" has space annotation but doesn't have semantic to determine if it is a direction or position! Assuming it to be a direction. You'd better add a semantic for it!"</span>;</div>
<div class="line"> <a name="a40"></a><a class="code" href="./class_m_global.html#acb043e7fc4eb7fc0f39833d31364b8a4">MGlobal::displayWarning</a>(warnMsg);</div>
<div class="line">                fType = kAttrTypeFirstDir;</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line"> <span class="keywordflow">if</span> (stricmp(annotationValue, <span class="stringliteral">"world"</span>) == 0)</div>
<div class="line">            {</div>
<div class="line">                fType = (cgfxAttrType)(fType + kAttrTypeWorldDir - kAttrTypeFirstDir);</div>
<div class="line">            }</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stricmp(annotationValue, <span class="stringliteral">"view"</span>) == 0 ||</div>
<div class="line">                stricmp(annotationValue, <span class="stringliteral">"devicelightspace"</span>) == 0)</div>
<div class="line">            {</div>
<div class="line">                fType = (cgfxAttrType)(fType + kAttrTypeViewDir - kAttrTypeFirstDir);</div>
<div class="line">            }</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stricmp(annotationValue, <span class="stringliteral">"projection"</span>) == 0)</div>
<div class="line">            {</div>
<div class="line">                fType = (cgfxAttrType)(fType + kAttrTypeProjectionDir - kAttrTypeFirstDir);</div>
<div class="line">            }</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stricmp(annotationValue, <span class="stringliteral">"screen"</span>) == 0)</div>
<div class="line">            {</div>
<div class="line">                fType = (cgfxAttrType)(fType + kAttrTypeScreenDir - kAttrTypeFirstDir);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stricmp(annotationName, <span class="stringliteral">"object"</span>) == 0)</div>
<div class="line">        {</div>
<div class="line">            fHint = kVectorHintNone;</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (stricmp(annotationValue, <span class="stringliteral">"dirlight"</span>) == 0)</div>
<div class="line">            {</div>
<div class="line">                fHint = kVectorHintDirLight;</div>
<div class="line">            }</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stricmp(annotationValue, <span class="stringliteral">"spotlight"</span>) == 0)</div>
<div class="line">            {</div>
<div class="line">                fHint = kVectorHintSpotLight;</div>
<div class="line">            }</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stricmp(annotationValue, <span class="stringliteral">"pointlight"</span>) == 0)</div>
<div class="line">            {</div>
<div class="line">                fHint = kVectorHintPointLight;</div>
<div class="line">            }</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stricmp(annotationValue, <span class="stringliteral">"camera"</span>) == 0 || stricmp(annotationValue, <span class="stringliteral">"eye"</span>) == 0)</div>
<div class="line">            {</div>
<div class="line">                fHint = kVectorHintEye;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        cgAnnotation = cgGetNextAnnotation(cgAnnotation);</div>
<div class="line">    }</div>
<div class="line"> <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// ========== cgfxAttrDef::attrsFromNode ==========</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// This function simply returns the parses through the dynamic</span></div>
<div class="line"><span class="comment">// attributes on an effect and builds a list of cgfxAttrDef objects.</span></div>
<div class="line"><span class="comment">// The cgfxAttrDef objects in the list are incomplete but they are</span></div>
<div class="line"><span class="comment">// only used to determine which attributes on the object need to be</span></div>
<div class="line"><span class="comment">// created, destroyed, or left alone.  Ultimately, the cgfxAttrDefList</span></div>
<div class="line"><span class="comment">// that is constructed from the effect itself will be the one held by</span></div>
<div class="line"><span class="comment">// the node.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">/* static */</span></div>
<div class="line">cgfxRCPtr&lt;cgfxAttrDefList&gt; cgfxAttrDef::attrsFromNode(<a class="code" href="./class_m_object.html">MObject</a>&amp; oNode)</div>
<div class="line">{</div>
<div class="line"> <a class="code" href="./class_m_status.html">MStatus</a> status;</div>
<div class="line"></div>
<div class="line"> <a class="code" href="./class_m_fn_dependency_node.html">MFnDependencyNode</a> fnNode(oNode, &amp;status);</div>
<div class="line">    M_CHECK( status );</div>
<div class="line">    M_CHECK( fnNode.typeId() == cgfxShaderNode::sId );</div>
<div class="line"></div>
<div class="line">    cgfxShaderNode* pNode = (cgfxShaderNode *) fnNode.userNode();</div>
<div class="line">    M_CHECK( pNode );</div>
<div class="line"></div>
<div class="line">    cgfxRCPtr&lt;cgfxAttrDefList&gt; list = pNode-&gt;attrDefList();</div>
<div class="line"></div>
<div class="line"> <span class="comment">// The list has not been initialized.  Create it and try again.</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <span class="keywordflow">if</span> (list.isNull())</div>
<div class="line">    {</div>
<div class="line">        buildAttrDefList(oNode);</div>
<div class="line">        list = pNode-&gt;attrDefList();</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">return</span> list;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// ========== cgfxAttrDef::buildAttrDefList ==========</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// This routine reconstructs the attrDefList from stringArray value in</span></div>
<div class="line"><span class="comment">// the attributeList attribute.  The reconstructed list is incomplete</span></div>
<div class="line"><span class="comment">// but it is good enough to compare to the list generated by</span></div>
<div class="line"><span class="comment">// attrsFromEffect to see if the connections are still valid.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="keywordtype">void</span> cgfxAttrDef::buildAttrDefList(<a class="code" href="./class_m_object.html">MObject</a>&amp; oNode)</div>
<div class="line">{</div>
<div class="line"> <a class="code" href="./class_m_status.html">MStatus</a> status;</div>
<div class="line"></div>
<div class="line"> <a class="code" href="./class_m_fn_dependency_node.html">MFnDependencyNode</a> fnNode(oNode, &amp;status);</div>
<div class="line">    M_CHECK( status &amp;&amp;</div>
<div class="line">             fnNode.typeId() == cgfxShaderNode::sId );</div>
<div class="line"></div>
<div class="line">    cgfxShaderNode* pNode = (cgfxShaderNode *) fnNode.userNode();</div>
<div class="line">    M_CHECK( pNode &amp;&amp; pNode-&gt;attrDefList().isNull() );</div>
<div class="line"></div>
<div class="line">    cgfxRCPtr&lt;cgfxAttrDefList&gt; list(<span class="keyword">new</span> cgfxAttrDefList);</div>
<div class="line"></div>
<div class="line"> <a class="code" href="./class_m_string_array.html">MStringArray</a> saList;</div>
<div class="line"></div>
<div class="line">    pNode-&gt;getAttributeList(saList);</div>
<div class="line"> <span class="comment">//         MStatus status;</span></div>
<div class="line"></div>
<div class="line"> <span class="comment">//         // Get the value of the attributeList attribute</span></div>
<div class="line"> <span class="comment">//         //</span></div>
<div class="line"> <span class="comment">//         MPlug    plug(oNode, cgfxShaderNode::sAttributeList);</span></div>
<div class="line"></div>
<div class="line"> <span class="comment">//         MObject saDataObject;</span></div>
<div class="line"></div>
<div class="line"> <span class="comment">//         status = plug.getValue(saDataObject);</span></div>
<div class="line"> <span class="comment">//         if (!status)</span></div>
<div class="line"> <span class="comment">//         {</span></div>
<div class="line"> <span class="comment">//             sprintf(errorMsg, "%s(%d): failed to get attributeList value: %s!",</span></div>
<div class="line"> <span class="comment">//                     __FILE__, __LINE__, status.errorString().asChar());</span></div>
<div class="line"> <span class="comment">//             throw errorMsg;</span></div>
<div class="line"> <span class="comment">//         }</span></div>
<div class="line"></div>
<div class="line"> <span class="comment">//         MFnStringArrayData fnSaData(saDataObject, &amp;status);</span></div>
<div class="line"> <span class="comment">//         if (!status)</span></div>
<div class="line"> <span class="comment">//         {</span></div>
<div class="line"> <span class="comment">//             sprintf(errorMsg,</span></div>
<div class="line"> <span class="comment">//                     "%s(%d): failed to construct attributeList function set: %s!",</span></div>
<div class="line"> <span class="comment">//                     __FILE__, __LINE__, status.errorString().asChar());</span></div>
<div class="line"> <span class="comment">//             throw errorMsg;</span></div>
<div class="line"> <span class="comment">//         }</span></div>
<div class="line"></div>
<div class="line"> <span class="comment">//         fnSaData.copyTo(saList);</span></div>
<div class="line"></div>
<div class="line"> <span class="comment">// Ok, we succeeded, saList is now an array of "top level"</span></div>
<div class="line"> <span class="comment">// dynamic attribute names along with some minimal type</span></div>
<div class="line"> <span class="comment">// information.  Parse through it and reconstruct the</span></div>
<div class="line"> <span class="comment">// cgfxAttrDefList.</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i;</div>
<div class="line"> <span class="keywordflow">for</span> (i = 0; i &lt; saList.<a name="a41"></a><a class="code" href="./class_m_string_array.html#a580388f31f60c46fac867ca48a48da1e">length</a>(); ++i)</div>
<div class="line">    {</div>
<div class="line"> <a class="code" href="./class_m_string.html">MString</a> item = saList[i];</div>
<div class="line"> <a class="code" href="./class_m_string_array.html">MStringArray</a>  splitItem;</div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> oAttr;</div>
<div class="line"></div>
<div class="line">        item.<a name="a42"></a><a class="code" href="./class_m_string.html#ac914d138fc96d7065c687a4f8b40c263">split</a>(<span class="charliteral">'\t'</span>, splitItem);</div>
<div class="line"></div>
<div class="line">        cgfxAttrDef* attrDef = attrFromNode( fnNode,</div>
<div class="line">                                             splitItem[0], </div>
<div class="line">                                             (cgfxAttrType)(splitItem[1].asInt()),</div>
<div class="line">                                             splitItem[2],</div>
<div class="line">                                             splitItem[3]);</div>
<div class="line"> <span class="keywordflow">if</span> ( attrDef )</div>
<div class="line">        {</div>
<div class="line">            list-&gt;add( attrDef );</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    pNode-&gt;setAttrDefList(list);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">/* static */</span></div>
<div class="line">cgfxAttrDef*</div>
<div class="line">cgfxAttrDef::attrFromNode( <span class="keyword">const</span> <a class="code" href="./class_m_fn_dependency_node.html">MFnDependencyNode</a>&amp; fnNode,</div>
<div class="line"> <span class="keyword">const</span> <a class="code" href="./class_m_string.html">MString</a>&amp;           sAttrName,</div>
<div class="line"> <span class="keyword">const</span> cgfxAttrType       eAttrType,</div>
<div class="line"> <span class="keyword">const</span> <a class="code" href="./class_m_string.html">MString</a>&amp;           sDescription,</div>
<div class="line"> <span class="keyword">const</span> <a class="code" href="./class_m_string.html">MString</a>&amp;           sSemantic)</div>
<div class="line">{</div>
<div class="line"> <a class="code" href="./class_m_status.html">MStatus</a>      status;</div>
<div class="line">    cgfxAttrDef* attrDef = NULL;</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">try</span></div>
<div class="line">    {</div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> obNode = fnNode.<a name="a43"></a><a class="code" href="./class_m_fn_base.html#a01c802c0a7fc219b5a9beff9787bcfa2">object</a>();</div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> obAttr = fnNode.<a name="a44"></a><a class="code" href="./class_m_fn_dependency_node.html#a6117a63ae3bb2d03aa976dc8732d93a5">attribute</a>( sAttrName, &amp;status );</div>
<div class="line"> <span class="keywordflow">if</span> ( !status )                 <span class="comment">// if node doesn't have this attr</span></div>
<div class="line"> <span class="keywordflow">return</span> NULL;               <span class="comment">// skip it</span></div>
<div class="line"></div>
<div class="line">        attrDef = <span class="keyword">new</span> cgfxAttrDef(</div>
<div class="line">            sAttrName, eAttrType, sDescription, sSemantic,</div>
<div class="line">            obNode, obAttr</div>
<div class="line">        );</div>
<div class="line"></div>
<div class="line">    }</div>
<div class="line"> <span class="keywordflow">catch</span> ( cgfxShaderCommon::InternalError* e )   </div>
<div class="line">    {</div>
<div class="line"> <span class="keywordtype">size_t</span> ee = (size_t)e;</div>
<div class="line"> <a class="code" href="./class_m_string.html">MString</a> sMsg = <span class="stringliteral">"("</span>;</div>
<div class="line">        sMsg += (int)ee;</div>
<div class="line">        sMsg += <span class="stringliteral">") cgfxShader node \""</span>;</div>
<div class="line">        sMsg += fnNode.<a name="a45"></a><a class="code" href="./class_m_fn_dependency_node.html#a049384adbea0396ea2f03d1ad4d69df1">name</a>();</div>
<div class="line">        sMsg += <span class="stringliteral">"\" has invalid attribute \""</span>;</div>
<div class="line">        sMsg += sAttrName;</div>
<div class="line">        sMsg += <span class="stringliteral">"\" - ignored"</span>;</div>
<div class="line"> <a class="code" href="./class_m_global.html#acb043e7fc4eb7fc0f39833d31364b8a4">MGlobal::displayWarning</a>( sMsg );</div>
<div class="line"> <span class="keyword">delete</span> attrDef;</div>
<div class="line">        attrDef = NULL; </div>
<div class="line">    }</div>
<div class="line"> <span class="keywordflow">catch</span> (...)</div>
<div class="line">    {</div>
<div class="line"> <span class="keyword">delete</span> attrDef;</div>
<div class="line">        M_CHECK( <span class="keyword">false</span> );</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">return</span> attrDef;</div>
<div class="line">}                                      <span class="comment">// cgfxAttrDef::attrFromNode</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">bool</span></div>
<div class="line">cgfxAttrDef::createAttribute( <span class="keyword">const</span> <a class="code" href="./class_m_object.html">MObject</a>&amp; oNode, <a name="_a46"></a><a class="code" href="./class_m_d_g_modifier.html">MDGModifier</a>* mod, cgfxShaderNode* pNode)</div>
<div class="line">{</div>
<div class="line"> <a class="code" href="./class_m_fn_dependency_node.html">MFnDependencyNode</a> fnNode( oNode );</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Return if node already has an attribute with the specified name.</span></div>
<div class="line"> <span class="comment">// (Shader var name could conflict with a predefined static attr.)</span></div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> obExistingAttr = fnNode.<a class="code" href="./class_m_fn_dependency_node.html#a6117a63ae3bb2d03aa976dc8732d93a5">attribute</a>( fName );</div>
<div class="line"> <span class="keywordflow">if</span> ( !obExistingAttr.<a name="a47"></a><a class="code" href="./class_m_object.html#ac02f2a4d7312eb91f40980adfd4e31b2">isNull</a>() )</div>
<div class="line">    {</div>
<div class="line"> <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">try</span></div>
<div class="line">    {</div>
<div class="line"> <a class="code" href="./class_m_status.html">MStatus</a> status;</div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> oAttr, oAttr2;</div>
<div class="line"></div>
<div class="line"> <a class="code" href="./class_m_fn_numeric_attribute.html">MFnNumericAttribute</a>     nAttr;</div>
<div class="line"> <a class="code" href="./class_m_fn_typed_attribute.html">MFnTypedAttribute</a>       tAttr;</div>
<div class="line"> <a class="code" href="./class_m_fn_matrix_attribute.html">MFnMatrixAttribute</a>      mAttr;</div>
<div class="line"></div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> oSrcNode, oDstNode;</div>
<div class="line"> <a class="code" href="./class_m_fn_dependency_node.html">MFnDependencyNode</a> fnFile;</div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> oSrcAttr, oDstAttr;</div>
<div class="line"></div>
<div class="line"> <span class="keywordtype">bool</span> doConnection = <span class="keyword">false</span>;</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">switch</span> (fType)</div>
<div class="line">        {</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeBool:</div>
<div class="line">            oAttr = nAttr.<a name="a48"></a><a class="code" href="./class_m_fn_numeric_attribute.html#a5c08a5ce5e7123cc444c95a0e4a50f29">create</a>( fName, fName, <a name="a49"></a><a class="code" href="./class_m_fn_numeric_data.html#a1d1cfd8ffb84e947f82999c682b666a7a8cfc0ab572a96edfc9db7c02f0d025d7">MFnNumericData::kBoolean</a>,</div>
<div class="line">                0.0, &amp;status );</div>
<div class="line">            M_CHECK( status );</div>
<div class="line">            nAttr.<a name="a50"></a><a class="code" href="./class_m_fn_attribute.html#a9e68a8b4af016b37f6567cfa6d68e551">setKeyable</a>( <span class="keyword">true</span> );</div>
<div class="line">            nAttr.<a name="a51"></a><a class="code" href="./class_m_fn_attribute.html#a0810da59cbaac7ecbd26ba0a43d0ac35">setAffectsAppearance</a>( <span class="keyword">true</span> );</div>
<div class="line"> <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeInt:</div>
<div class="line">            oAttr = nAttr.<a class="code" href="./class_m_fn_numeric_attribute.html#a5c08a5ce5e7123cc444c95a0e4a50f29">create</a>( fName, fName, <a name="a52"></a><a class="code" href="./class_m_fn_numeric_data.html#a1d1cfd8ffb84e947f82999c682b666a7a9bb31be73c01d40428195449f62588ac">MFnNumericData::kInt</a>,</div>
<div class="line">                0.0, &amp;status );</div>
<div class="line">            M_CHECK( status );</div>
<div class="line">            nAttr.<a class="code" href="./class_m_fn_attribute.html#a9e68a8b4af016b37f6567cfa6d68e551">setKeyable</a>( <span class="keyword">true</span> );</div>
<div class="line">            nAttr.<a class="code" href="./class_m_fn_attribute.html#a0810da59cbaac7ecbd26ba0a43d0ac35">setAffectsAppearance</a>( <span class="keyword">true</span> );</div>
<div class="line"> <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeFloat:</div>
<div class="line">            oAttr = nAttr.<a class="code" href="./class_m_fn_numeric_attribute.html#a5c08a5ce5e7123cc444c95a0e4a50f29">create</a>( fName, fName, <a name="a53"></a><a class="code" href="./class_m_fn_numeric_data.html#a1d1cfd8ffb84e947f82999c682b666a7a5686197bafb177bdc82550848416a1ad">MFnNumericData::kFloat</a>,</div>
<div class="line">                0.0, &amp;status );</div>
<div class="line">            M_CHECK( status );</div>
<div class="line">            nAttr.<a class="code" href="./class_m_fn_attribute.html#a9e68a8b4af016b37f6567cfa6d68e551">setKeyable</a>( <span class="keyword">true</span> );</div>
<div class="line">            nAttr.<a class="code" href="./class_m_fn_attribute.html#a0810da59cbaac7ecbd26ba0a43d0ac35">setAffectsAppearance</a>( <span class="keyword">true</span> );</div>
<div class="line"> <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeString:</div>
<div class="line">            oAttr = tAttr.<a name="a54"></a><a class="code" href="./class_m_fn_typed_attribute.html#af785af0a66bd4a4da1d9f7bd74d4de0a">create</a>(fName, fName, <a class="code" href="./class_m_fn_data.html#a1d1cfd8ffb84e947f82999c682b666a7afab53ea4a643325262b9c140af093279">MFnData::kString</a>,</div>
<div class="line"> <a name="a55"></a><a class="code" href="./class_m_object.html#ae6af14e0aa2c92bdda88c81280e1d122">MObject::kNullObj</a>, &amp;status );</div>
<div class="line">            tAttr.<a class="code" href="./class_m_fn_attribute.html#a0810da59cbaac7ecbd26ba0a43d0ac35">setAffectsAppearance</a>( <span class="keyword">true</span> );</div>
<div class="line">            M_CHECK( status );</div>
<div class="line"> <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeVector2:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeVector3:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeVector4:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeColor3:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeColor4:</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeObjectDir:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeWorldDir:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeViewDir:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeProjectionDir:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeScreenDir:</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeObjectPos:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeWorldPos:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeViewPos:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeProjectionPos:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeScreenPos:</div>
<div class="line">            {</div>
<div class="line"> <span class="keyword">const</span> <span class="keywordtype">char</span>** suffixes = compoundAttrSuffixes( fType );</div>
<div class="line"> <a class="code" href="./class_m_string.html">MString</a>      sChild;</div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a>      oaChildren[4];</div>
<div class="line">                M_CHECK( fSize &lt;= 4 );</div>
<div class="line"> <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> iChild = 0; iChild &lt; fSize; ++iChild )</div>
<div class="line">                {</div>
<div class="line"> <span class="keyword">const</span> <span class="keywordtype">char</span>* suffix = suffixes[ iChild ];</div>
<div class="line">                    sChild = fName + suffix;</div>
<div class="line">                    oaChildren[ iChild ] = nAttr.<a class="code" href="./class_m_fn_numeric_attribute.html#a5c08a5ce5e7123cc444c95a0e4a50f29">create</a>( sChild,</div>
<div class="line">                        sChild,</div>
<div class="line"> <a class="code" href="./class_m_fn_numeric_data.html#a1d1cfd8ffb84e947f82999c682b666a7a5686197bafb177bdc82550848416a1ad">MFnNumericData::kFloat</a>,</div>
<div class="line">                        0.0,</div>
<div class="line">                        &amp;status );</div>
<div class="line">                    M_CHECK( status );</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> ( fSize == 4 )</div>
<div class="line">                {</div>
<div class="line">                    oAttr2 = oaChildren[3];</div>
<div class="line"> <span class="keywordflow">if</span> ( fType == kAttrTypeColor3 ||</div>
<div class="line">                        fType == kAttrTypeColor4 ||</div>
<div class="line">                        fDescription.length() &gt; 0 )</div>
<div class="line">                        nAttr.<a class="code" href="./class_m_fn_attribute.html#a9e68a8b4af016b37f6567cfa6d68e551">setKeyable</a>( <span class="keyword">true</span> );</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">                oAttr = nAttr.<a class="code" href="./class_m_fn_numeric_attribute.html#a5c08a5ce5e7123cc444c95a0e4a50f29">create</a>( fName,</div>
<div class="line">                    fName,</div>
<div class="line">                    oaChildren[0],</div>
<div class="line">                    oaChildren[1],</div>
<div class="line">                    oaChildren[2], </div>
<div class="line">                    &amp;status );</div>
<div class="line">                M_CHECK( status );</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> ( fType == kAttrTypeColor3 ||</div>
<div class="line">                    fType == kAttrTypeColor4 )</div>
<div class="line">                {</div>
<div class="line">                    nAttr.<a class="code" href="./class_m_fn_attribute.html#a9e68a8b4af016b37f6567cfa6d68e551">setKeyable</a>( <span class="keyword">true</span> );</div>
<div class="line">                    nAttr.<a name="a56"></a><a class="code" href="./class_m_fn_attribute.html#a4a44548ca2e5b1e7613a992a6b96a147">setUsedAsColor</a>( <span class="keyword">true</span> );</div>
<div class="line">                }</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( fDescription.length() &gt; 0 )</div>
<div class="line">                    nAttr.<a class="code" href="./class_m_fn_attribute.html#a9e68a8b4af016b37f6567cfa6d68e551">setKeyable</a>( <span class="keyword">true</span> );</div>
<div class="line">                nAttr.<a class="code" href="./class_m_fn_attribute.html#a0810da59cbaac7ecbd26ba0a43d0ac35">setAffectsAppearance</a>( <span class="keyword">true</span> );</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeMatrix:</div>
<div class="line"> <span class="comment">// Create a generic matrix</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line">            oAttr = mAttr.<a name="a57"></a><a class="code" href="./class_m_fn_matrix_attribute.html#acccc043a2ac80be8fe8e32bcc36b8696">create</a>(fName, fName,</div>
<div class="line"> <a name="a58"></a><a class="code" href="./class_m_fn_matrix_attribute.html#a1d1cfd8ffb84e947f82999c682b666a7a5686197bafb177bdc82550848416a1ad">MFnMatrixAttribute::kFloat</a>, &amp;status );</div>
<div class="line">            M_CHECK( status );</div>
<div class="line">            mAttr.<a class="code" href="./class_m_fn_attribute.html#a0810da59cbaac7ecbd26ba0a43d0ac35">setAffectsAppearance</a>( <span class="keyword">true</span> );</div>
<div class="line"> <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeWorldMatrix:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeViewMatrix:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeProjectionMatrix:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeWorldViewMatrix:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeWorldViewProjectionMatrix:</div>
<div class="line"> <span class="comment">// These matricies are handled internally and have no attribute.</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeColor1DTexture:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeColor2DTexture:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeColor3DTexture:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeColor2DRectTexture:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeNormalTexture:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeBumpTexture:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeCubeTexture:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeEnvTexture:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeNormalizationTexture:</div>
<div class="line"> <span class="keywordflow">if</span>( pNode-&gt;getTexturesByName())</div>
<div class="line">            {</div>
<div class="line">                oAttr = tAttr.<a class="code" href="./class_m_fn_typed_attribute.html#af785af0a66bd4a4da1d9f7bd74d4de0a">create</a>(fName, fName, <a class="code" href="./class_m_fn_data.html#a1d1cfd8ffb84e947f82999c682b666a7afab53ea4a643325262b9c140af093279">MFnData::kString</a>,</div>
<div class="line"> <a class="code" href="./class_m_object.html#ae6af14e0aa2c92bdda88c81280e1d122">MObject::kNullObj</a>, &amp;status );</div>
<div class="line">                M_CHECK( status );</div>
<div class="line">                tAttr.<a class="code" href="./class_m_fn_attribute.html#a0810da59cbaac7ecbd26ba0a43d0ac35">setAffectsAppearance</a>( <span class="keyword">true</span> );</div>
<div class="line">            }</div>
<div class="line"> <span class="keywordflow">else</span></div>
<div class="line">            {</div>
<div class="line"> <span class="keyword">const</span> <span class="keywordtype">char</span>* suffix1 = <span class="stringliteral">"R"</span>;</div>
<div class="line"> <span class="keyword">const</span> <span class="keywordtype">char</span>* suffix2 = <span class="stringliteral">"G"</span>;</div>
<div class="line"> <span class="keyword">const</span> <span class="keywordtype">char</span>* suffix3 = <span class="stringliteral">"B"</span>;</div>
<div class="line"></div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> oChild1 = nAttr.<a class="code" href="./class_m_fn_numeric_attribute.html#a5c08a5ce5e7123cc444c95a0e4a50f29">create</a>(fName + suffix1,</div>
<div class="line">                    fName + suffix1,</div>
<div class="line"> <a class="code" href="./class_m_fn_numeric_data.html#a1d1cfd8ffb84e947f82999c682b666a7a5686197bafb177bdc82550848416a1ad">MFnNumericData::kFloat</a>,</div>
<div class="line">                    0.0, &amp;status);</div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> oChild2 = nAttr.<a class="code" href="./class_m_fn_numeric_attribute.html#a5c08a5ce5e7123cc444c95a0e4a50f29">create</a>(fName + suffix2,</div>
<div class="line">                    fName + suffix2,</div>
<div class="line"> <a class="code" href="./class_m_fn_numeric_data.html#a1d1cfd8ffb84e947f82999c682b666a7a5686197bafb177bdc82550848416a1ad">MFnNumericData::kFloat</a>,</div>
<div class="line">                    0.0, &amp;status);</div>
<div class="line"></div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> oChild3 = nAttr.<a class="code" href="./class_m_fn_numeric_attribute.html#a5c08a5ce5e7123cc444c95a0e4a50f29">create</a>(fName + suffix3,</div>
<div class="line">                    fName + suffix3,</div>
<div class="line"> <a class="code" href="./class_m_fn_numeric_data.html#a1d1cfd8ffb84e947f82999c682b666a7a5686197bafb177bdc82550848416a1ad">MFnNumericData::kFloat</a>,</div>
<div class="line">                    0.0, &amp;status);</div>
<div class="line"></div>
<div class="line">                oAttr = nAttr.<a class="code" href="./class_m_fn_numeric_attribute.html#a5c08a5ce5e7123cc444c95a0e4a50f29">create</a>( fName,</div>
<div class="line">                    fName,</div>
<div class="line">                    oChild1,</div>
<div class="line">                    oChild2,</div>
<div class="line">                    oChild3, </div>
<div class="line">                    &amp;status );</div>
<div class="line">                M_CHECK( status );</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Although it's not strictly necessary, set this attribute</span></div>
<div class="line"> <span class="comment">// to be a color so the user can will at least get the</span></div>
<div class="line"> <span class="comment">// texture assignment button in the AE if for some reason</span></div>
<div class="line"> <span class="comment">// our AE template is missing</span></div>
<div class="line">                nAttr.<a class="code" href="./class_m_fn_attribute.html#a4a44548ca2e5b1e7613a992a6b96a147">setUsedAsColor</a>( <span class="keyword">true</span> );</div>
<div class="line"></div>
<div class="line">                nAttr.<a class="code" href="./class_m_fn_attribute.html#a0810da59cbaac7ecbd26ba0a43d0ac35">setAffectsAppearance</a>( <span class="keyword">true</span> );</div>
<div class="line">            }</div>
<div class="line"> <span class="keywordflow">break</span>;</div>
<div class="line"><span class="preprocessor">#ifdef _WIN32</span></div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeTime:</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeHardwareFogEnabled:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeHardwareFogMode:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeHardwareFogStart:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeHardwareFogEnd:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeHardwareFogDensity:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeHardwareFogColor:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeOther:</div>
<div class="line"> <span class="keywordflow">break</span>;</div>
<div class="line"> <span class="keywordflow">default</span>:</div>
<div class="line">            M_CHECK( <span class="keyword">false</span> );</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (oAttr.<a class="code" href="./class_m_object.html#ac02f2a4d7312eb91f40980adfd4e31b2">isNull</a>())</div>
<div class="line">        {</div>
<div class="line"> <span class="comment">// There is no attribute for this parameter</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Add the attribute to the node</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line">        status = mod-&gt;<a name="a59"></a><a class="code" href="./class_m_d_g_modifier.html#ad714eb6c2e6f51659e3e50f176c75a91">addAttribute</a>( oNode, oAttr );</div>
<div class="line">        M_CHECK( status );</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (!oAttr2.<a class="code" href="./class_m_object.html#ac02f2a4d7312eb91f40980adfd4e31b2">isNull</a>())</div>
<div class="line">        {</div>
<div class="line">            status = mod-&gt;<a class="code" href="./class_m_d_g_modifier.html#ad714eb6c2e6f51659e3e50f176c75a91">addAttribute</a>( oNode, oAttr2 );</div>
<div class="line">            M_CHECK( status );</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Hold onto a copy of the attribute for easy access later.</span></div>
<div class="line">        fAttr  = oAttr;</div>
<div class="line">        fAttr2 = oAttr2;</div>
<div class="line"></div>
<div class="line"> <span class="comment">// If we need to connect this node to some other node, do so.</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <span class="keywordflow">if</span> (doConnection)</div>
<div class="line">        {</div>
<div class="line">            status = mod-&gt;<a name="a60"></a><a class="code" href="./class_m_d_g_modifier.html#afbd18f066f70fcd1864ddb4af91f3c7b">connect</a>(oSrcNode, oSrcAttr, oDstNode, oDstAttr);</div>
<div class="line">            M_CHECK( status );</div>
<div class="line">        }</div>
<div class="line"> <span class="keywordflow">return</span> <span class="keyword">true</span>;                   <span class="comment">// success</span></div>
<div class="line">    }</div>
<div class="line"> <span class="keywordflow">catch</span> ( cgfxShaderCommon::InternalError* e )   </div>
<div class="line">    {</div>
<div class="line"> <span class="keywordtype">size_t</span> ee = (size_t)e;</div>
<div class="line">        fType = kAttrTypeUnknown;</div>
<div class="line"> <a class="code" href="./class_m_string.html">MString</a> sMsg = <span class="stringliteral">"("</span>;</div>
<div class="line">        sMsg += (int)ee;</div>
<div class="line">        sMsg += <span class="stringliteral">") cgfxShader node \""</span>;</div>
<div class="line">        sMsg += fnNode.<a class="code" href="./class_m_fn_dependency_node.html#a049384adbea0396ea2f03d1ad4d69df1">name</a>();</div>
<div class="line">        sMsg += <span class="stringliteral">"\": unable to add attribute \""</span>;</div>
<div class="line">        sMsg += fName;</div>
<div class="line">        sMsg += <span class="stringliteral">"\""</span>;</div>
<div class="line"> <a class="code" href="./class_m_global.html#acb043e7fc4eb7fc0f39833d31364b8a4">MGlobal::displayWarning</a>( sMsg );</div>
<div class="line"> <span class="keywordflow">return</span> <span class="keyword">false</span>;                  <span class="comment">// failure</span></div>
<div class="line">    }</div>
<div class="line"> <span class="keywordflow">catch</span> (...)</div>
<div class="line">    {</div>
<div class="line">        M_CHECK( <span class="keyword">false</span> );</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}                                      <span class="comment">// cgfxAttrDef::createAttribute</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">bool</span></div>
<div class="line">cgfxAttrDef::destroyAttribute( <a class="code" href="./class_m_object.html">MObject</a>&amp; oNode, <a class="code" href="./class_m_d_g_modifier.html">MDGModifier</a>* dgMod)</div>
<div class="line">{</div>
<div class="line"> <a class="code" href="./class_m_status.html">MStatus</a> status;</div>
<div class="line"></div>
<div class="line"> <span class="comment">// If this is a texture node, clear the value (which will destroy</span></div>
<div class="line"> <span class="comment">// any attached textures)</span></div>
<div class="line"> <span class="keywordflow">if</span>( fType &gt;= kAttrTypeFirstTexture &amp;&amp; fType &lt;= kAttrTypeLastTexture)</div>
<div class="line">        setTexture( oNode, <span class="stringliteral">""</span>, dgMod);</div>
<div class="line"></div>
<div class="line"> <span class="comment">// New effect won't need this old attr anymore.  </span></div>
<div class="line">    status = dgMod-&gt;<a name="a61"></a><a class="code" href="./class_m_d_g_modifier.html#ab5595b225c59b15d902dc34b849d90d0">removeAttribute</a>( oNode, fAttr );</div>
<div class="line"></div>
<div class="line"> <span class="comment">// If there is a secondary attribute, remove that too.</span></div>
<div class="line"> <span class="keywordflow">if</span> ( !fAttr2.isNull() )</div>
<div class="line">        status = dgMod-&gt;<a class="code" href="./class_m_d_g_modifier.html#ab5595b225c59b15d902dc34b849d90d0">removeAttribute</a>( oNode, fAttr2 );</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Don't leave dangling references to deleted attributes.</span></div>
<div class="line">    fAttr  = <a class="code" href="./class_m_object.html#ae6af14e0aa2c92bdda88c81280e1d122">MObject::kNullObj</a>;  </div>
<div class="line">    fAttr2 = <a class="code" href="./class_m_object.html#ae6af14e0aa2c92bdda88c81280e1d122">MObject::kNullObj</a>;  </div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">return</span> status == <a name="a62"></a><a class="code" href="./class_m_status.html#a02ab596f4febca68da503aaf8dde3a80af0536797208144380691e2b376ffc1d1">MStatus::kSuccess</a>;</div>
<div class="line">}                                      <span class="comment">// cgfxAttrDef::destroyAttribute</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">// ========== cgfxAttrDef::updateNode ==========</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// This routine takes a node and an effect and ensures that all those</span></div>
<div class="line"><span class="comment">// and only those attributes that should be on the node, are on the</span></div>
<div class="line"><span class="comment">// node.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// The output cgfxAttrDefList and its elements are newly </span></div>
<div class="line"><span class="comment">// allocated.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">/* static */</span></div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">cgfxAttrDef::updateNode(</div>
<div class="line"> <span class="keyword">const</span> cgfxRCPtr&lt;const cgfxEffect&gt;&amp;  effect,         <span class="comment">// IN</span></div>
<div class="line">    cgfxShaderNode*                     pNode,          <span class="comment">// IN</span></div>
<div class="line"> <a class="code" href="./class_m_d_g_modifier.html">MDGModifier</a>*                        dgMod,          <span class="comment">// UPD</span></div>
<div class="line">    cgfxRCPtr&lt;cgfxAttrDefList&gt;&amp;         effectList,     <span class="comment">// OUT</span></div>
<div class="line"> <a class="code" href="./class_m_string_array.html">MStringArray</a>&amp;                       attributeList ) <span class="comment">// OUT</span></div>
<div class="line">{</div>
<div class="line"> <a class="code" href="./class_m_status.html">MStatus</a> status;</div>
<div class="line"></div>
<div class="line">    effectList = cgfxRCPtr&lt;cgfxAttrDefList&gt;();</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">try</span></div>
<div class="line">    {</div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a>           oNode = pNode-&gt;thisMObject();</div>
<div class="line"> <a class="code" href="./class_m_fn_dependency_node.html">MFnDependencyNode</a> fnNode( oNode );</div>
<div class="line"> <a name="_a63"></a><a class="code" href="./class_m_fn_attribute.html">MFnAttribute</a>      fnAttr;</div>
<div class="line"></div>
<div class="line">        effectList = effect-&gt;attrsFromEffect();  <span class="comment">// caller will own this list</span></div>
<div class="line">        cgfxRCPtr&lt;cgfxAttrDefList&gt; nodeList = attrsFromNode( oNode ); <span class="comment">// oNode owns this one</span></div>
<div class="line"></div>
<div class="line">        cgfxAttrDefList::iterator emIt;</div>
<div class="line">        cgfxAttrDefList::iterator nmIt;</div>
<div class="line"></div>
<div class="line">        cgfxAttrDef* adef;</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Walk through the nodeList.  Delete each attribute that is not</span></div>
<div class="line"> <span class="comment">// also found in the effect list.</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <span class="keywordflow">for</span> (nmIt = nodeList-&gt;begin(); nmIt; ++nmIt)</div>
<div class="line">        {                              <span class="comment">// loop over nodeList</span></div>
<div class="line">            adef = (*nmIt);</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Skip if node doesn't have this attribute.</span></div>
<div class="line"> <span class="keywordflow">if</span> ( adef-&gt;fAttr.isNull() )</div>
<div class="line"> <span class="keywordflow">continue</span>;</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Look for a matching attribute in the effect</span></div>
<div class="line">            emIt = effectList-&gt;find( adef-&gt;fName );</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Drop Maya attribute from node if shader var</span></div>
<div class="line"> <span class="comment">//   was declared in old effect, but not declared</span></div>
<div class="line"> <span class="comment">//   in new effect, or data type is not the same.</span></div>
<div class="line"> <span class="keywordflow">if</span> ( !emIt ||</div>
<div class="line">                (*emIt)-&gt;fType != adef-&gt;fType )</div>
<div class="line">            {</div>
<div class="line">                adef-&gt;destroyAttribute( oNode, dgMod);</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line"> <span class="comment">// If this is a texture and it has a non-default</span></div>
<div class="line"> <span class="comment">// value, we should switch to this mode of texture</span></div>
<div class="line"> <span class="comment">// definition (names or nodes)</span></div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span>( emIt &amp;&amp; </div>
<div class="line">                (*emIt)-&gt;fType &gt;= kAttrTypeFirstTexture &amp;&amp;</div>
<div class="line">                (*emIt)-&gt;fType &lt;= kAttrTypeLastTexture)</div>
<div class="line">            {</div>
<div class="line"> <span class="comment">// Get the attribute type of the existing attribute</span></div>
<div class="line"> <span class="comment">// and ensure our node is setup to digest the correct</span></div>
<div class="line"> <span class="comment">// type of textures</span></div>
<div class="line"> <a class="code" href="./class_m_fn_typed_attribute.html">MFnTypedAttribute</a> typedFn( adef-&gt;fAttr);</div>
<div class="line"> <span class="keywordtype">bool</span> usesName = typedFn.attrType() == <a class="code" href="./class_m_fn_data.html#a1d1cfd8ffb84e947f82999c682b666a7afab53ea4a643325262b9c140af093279">MFnData::kString</a>;</div>
<div class="line">                pNode-&gt;setTexturesByName( usesName);</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Finally, if this texture uses fileTexture nodes then</span></div>
<div class="line"> <span class="comment">// mark the value as "tweaked" to prevent the default value </span></div>
<div class="line"> <span class="comment">// code from trying to attach a default fileTexture node. </span></div>
<div class="line"> <span class="comment">// This is crucial to being able to load shaders back in. The</span></div>
<div class="line"> <span class="comment">// Maya file will create our node using the following steps:</span></div>
<div class="line"> <span class="comment">//  1) Create an empty cgfxShader node</span></div>
<div class="line"> <span class="comment">//  2) Create all the dynamic attributes (like this texture)</span></div>
<div class="line"> <span class="comment">//  3) Set the effect attribute (which calls this code)</span></div>
<div class="line"> <span class="comment">//  4) Create DG connections to file texture nodes</span></div>
<div class="line"> <span class="comment">// So, if we did setup a default file texture node, the load</span></div>
<div class="line"> <span class="comment">// would be unable to connect the real file texture. </span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <span class="keywordflow">if</span>( !usesName)</div>
<div class="line">                    (*emIt)-&gt;fTweaked = <span class="keyword">true</span>;</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">        }                              <span class="comment">// loop over nodeList</span></div>
<div class="line"></div>
<div class="line"> <span class="comment">// Delete any unnecessary attributes before starting to add new ones</span></div>
<div class="line"> <span class="comment">// (in case we're deleting and re-creating a property with a different</span></div>
<div class="line"> <span class="comment">// type)</span></div>
<div class="line"> <span class="comment">// </span></div>
<div class="line">        dgMod-&gt;<a name="a64"></a><a class="code" href="./class_m_d_g_modifier.html#a984345cd272bc1a32a9fc2e93a6678b2">doIt</a>();</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Walk through the effectList.  Add each item that is not also</span></div>
<div class="line"> <span class="comment">// found in the node list.</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <span class="keywordflow">for</span> (emIt = effectList-&gt;begin(); emIt; ++emIt)</div>
<div class="line">        {                              <span class="comment">// loop over effectList </span></div>
<div class="line">            adef = (*emIt);</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Note: nodeList::find will work with a null this pointer</span></div>
<div class="line"> <span class="comment">// so nodeList-&gt;find() will work even if nodeList is NULL.</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line">            nmIt = nodeList-&gt;find( adef-&gt;fName );</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Double check that the attr still exists.  Get current value.</span></div>
<div class="line">            cgfxAttrDef* cdef = NULL;</div>
<div class="line"> <span class="keywordflow">if</span> ( nmIt &amp;&amp;</div>
<div class="line">                !(*nmIt)-&gt;fAttr.isNull() )</div>
<div class="line">                cdef = attrFromNode( fnNode,</div>
<div class="line">                (*nmIt)-&gt;fName, </div>
<div class="line">                (*nmIt)-&gt;fType,</div>
<div class="line">                (*nmIt)-&gt;fDescription,</div>
<div class="line">                (*nmIt)-&gt;fSemantic);</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Add new Maya attribute.</span></div>
<div class="line"> <span class="keywordflow">if</span> ( !cdef )</div>
<div class="line">                adef-&gt;createAttribute( oNode, dgMod, pNode );</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Go on with existing attribute.</span></div>
<div class="line"> <span class="keywordflow">else</span></div>
<div class="line">            {                          <span class="comment">// use existing attribute</span></div>
<div class="line"> <span class="comment">// Copy the attribute handles to the new effect's cgfxAttrDef.</span></div>
<div class="line">                adef-&gt;fAttr  = (*nmIt)-&gt;fAttr;</div>
<div class="line">                adef-&gt;fAttr2 = (*nmIt)-&gt;fAttr2;</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Did we already notice that the user has set this attr?</span></div>
<div class="line"> <span class="keywordflow">if</span> ( (*nmIt)-&gt;fTweaked )</div>
<div class="line">                    adef-&gt;fTweaked = <span class="keyword">true</span>;</div>
<div class="line"></div>
<div class="line"> <span class="comment">// If no old effect, then the current values were</span></div>
<div class="line"> <span class="comment">//   loaded from the scene file, and should override </span></div>
<div class="line"> <span class="comment">//   the new effect's defaults if they are different.</span></div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( pNode-&gt;effect().isNull() )</div>
<div class="line">                {</div>
<div class="line"> <span class="keywordflow">if</span> ( !adef-&gt;isInitialValueEqual( *cdef ) )</div>
<div class="line">                        adef-&gt;fTweaked = <span class="keyword">true</span>;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line"> <span class="comment">// If current value is not the same as old effect's </span></div>
<div class="line"> <span class="comment">//   default, then user has adjusted it.  Current value</span></div>
<div class="line"> <span class="comment">//   takes precedence over the new effect's default.</span></div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( !(*nmIt)-&gt;isInitialValueEqual( *cdef ) )</div>
<div class="line">                    adef-&gt;fTweaked = <span class="keyword">true</span>;</div>
<div class="line"></div>
<div class="line"> <span class="comment">// User hasn't changed this value.  New effect's</span></div>
<div class="line"> <span class="comment">// default takes precedence.  Since we are going to</span></div>
<div class="line"> <span class="comment">// change the value, remember to change it back </span></div>
<div class="line"> <span class="comment">// to the old effect's default in case of undo.</span></div>
<div class="line"> <span class="comment">// Among other things, this logic allows the UI shader</span></div>
<div class="line"> <span class="comment">// description to update as different effects are chosen.</span></div>
<div class="line">                else</div>
<div class="line">                    (*nmIt)-&gt;fInitOnUndo = <span class="keyword">true</span>;</div>
<div class="line"></div>
<div class="line"> <span class="keyword">delete</span> cdef;</div>
<div class="line">            }                          <span class="comment">// use existing attribute</span></div>
<div class="line">        }                              <span class="comment">// loop over effectList </span></div>
<div class="line"></div>
<div class="line"> <span class="comment">// Now rebuild the attributeList attribute value.  This is an array</span></div>
<div class="line"> <span class="comment">// of strings of the format "attrName&lt;TAB&gt;type&lt;TAB&gt;Description&lt;TAB&gt;Semantic".</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <a class="code" href="./class_m_string.html">MString</a> tmpStr;</div>
<div class="line"></div>
<div class="line">        attributeList.<a name="a65"></a><a class="code" href="./class_m_string_array.html#ad5522f028dde0080b753279426415a4a">clear</a>();</div>
<div class="line"></div>
<div class="line">        cgfxAttrDefList::iterator it(effectList);</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">while</span> (it)</div>
<div class="line">        {</div>
<div class="line">            cgfxAttrDef* aDef = *it;</div>
<div class="line"></div>
<div class="line">            tmpStr = aDef-&gt;fName;</div>
<div class="line">            tmpStr += <span class="stringliteral">"\t"</span>;</div>
<div class="line">            tmpStr += (int)aDef-&gt;fType;</div>
<div class="line">            tmpStr += <span class="stringliteral">"\t"</span>;</div>
<div class="line">            tmpStr += aDef-&gt;fDescription;</div>
<div class="line">            tmpStr += <span class="stringliteral">"\t"</span>;</div>
<div class="line">            tmpStr += aDef-&gt;fSemantic;</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Drop trailing tabs.</span></div>
<div class="line"> <span class="keyword">const</span> <span class="keywordtype">char</span>* bp = tmpStr.<a name="a66"></a><a class="code" href="./class_m_string.html#aa9ab612f356c53479afc4c648c9ef94d">asChar</a>();</div>
<div class="line"> <span class="keyword">const</span> <span class="keywordtype">char</span>* ep;</div>
<div class="line"> <span class="keywordflow">for</span> ( ep = bp + tmpStr.<a name="a67"></a><a class="code" href="./class_m_string.html#a580388f31f60c46fac867ca48a48da1e">length</a>(); bp &lt; ep; --ep )</div>
<div class="line"> <span class="keywordflow">if</span> ( ep[-1] != <span class="charliteral">'\t'</span> )</div>
<div class="line"> <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">            attributeList.<a class="code" href="./class_m_string_array.html#a18d06b3d0af1426e654ac2cc1dc86c60">append</a>( <a class="code" href="./class_m_string.html">MString</a>( bp, (<span class="keywordtype">int</span>)(ep - bp) ) );</div>
<div class="line">            ++it;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> <span class="keywordflow">catch</span> ( cgfxShaderCommon::InternalError* )   </div>
<div class="line">    {</div>
<div class="line"> <span class="keywordflow">throw</span>;</div>
<div class="line">    }</div>
<div class="line"> <span class="keywordflow">catch</span> (...)</div>
<div class="line">    {</div>
<div class="line">        M_CHECK( <span class="keyword">false</span> );</div>
<div class="line">    }</div>
<div class="line">}                                      <span class="comment">// cgfxAttrDef::updateNode</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">// Return true if initial value of 'this' is same as 'that'.</span></div>
<div class="line"><span class="keywordtype">bool</span></div>
<div class="line">cgfxAttrDef::isInitialValueEqual( <span class="keyword">const</span> cgfxAttrDef&amp; that )<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line"> <span class="keywordflow">if</span> ( fStringDef != that.fStringDef )</div>
<div class="line"> <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"></div>
<div class="line"> <span class="keyword">const</span> <span class="keywordtype">double</span>* thisNumericDef = fNumericDef;</div>
<div class="line"> <span class="keyword">const</span> <span class="keywordtype">double</span>* thatNumericDef = that.fNumericDef;</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> ( thisNumericDef == thatNumericDef ) </div>
<div class="line"> <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Make sure we don't proceed to test default colour values for</span></div>
<div class="line"> <span class="comment">// texture attributes as the colour itself is meaningless!</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <span class="keywordflow">if</span>( fType == that.fType &amp;&amp; fType &gt;= kAttrTypeFirstTexture &amp;&amp; fType &lt;= kAttrTypeLastTexture)</div>
<div class="line"> <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> ( !thisNumericDef )</div>
<div class="line">    {</div>
<div class="line">        thisNumericDef = thatNumericDef;</div>
<div class="line">        thatNumericDef = fNumericDef;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> ( !thatNumericDef )</div>
<div class="line">    {</div>
<div class="line"> <span class="keywordflow">if</span> ( fType == kAttrTypeMatrix )</div>
<div class="line">        {</div>
<div class="line">            thatNumericDef = &amp;<a class="code" href="./class_m_matrix.html#a85de986c9f953535d185c6780cecb77e">MMatrix::identity</a>.<a class="code" href="./class_m_matrix.html#a527b102f4eb0951cf4f391f828d3ca34">matrix</a>[0][0];</div>
<div class="line">            M_CHECK( fSize == 16 &amp;&amp; that.fSize == 16 );</div>
<div class="line">        }</div>
<div class="line"> <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line"> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> d0[4] = {0.0, 0.0, 0.0, 0.0};</div>
<div class="line">            thatNumericDef = d0;</div>
<div class="line">            M_CHECK( fSize &lt;= <span class="keyword">sizeof</span>(d0)/<span class="keyword">sizeof</span>(d0[0]) );</div>
<div class="line"> <span class="keywordflow">if</span> ( fSize != that.fSize )</div>
<div class="line"> <a class="code" href="./class_m_global.html#acb043e7fc4eb7fc0f39833d31364b8a4">MGlobal::displayWarning</a>( <span class="stringliteral">"CgFX attribute size mismatch"</span> );</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <span class="keywordtype">double</span> eps = 0.0001;</div>
<div class="line"> <span class="keywordtype">int</span> i;</div>
<div class="line"> <span class="keywordflow">for</span> ( i = 0; i &lt; fSize; ++i )</div>
<div class="line"> <span class="keywordflow">if</span> ( thisNumericDef[ i ] + eps &lt; thatNumericDef[ i ] ||</div>
<div class="line">            thatNumericDef[ i ] + eps &lt; thisNumericDef[ i ] )</div>
<div class="line"> <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}                                      <span class="comment">// cgfxAttrDef::isInitialValueEqual</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">// Copy initial value from given attribute.</span></div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">cgfxAttrDef::setInitialValue( <span class="keyword">const</span> cgfxAttrDef&amp; from )</div>
<div class="line">{</div>
<div class="line"> <span class="keywordflow">if</span> ( from.fNumericDef )</div>
<div class="line">    {</div>
<div class="line">        M_CHECK( fSize == from.fSize );</div>
<div class="line"> <span class="keywordflow">if</span> ( !fNumericDef )</div>
<div class="line">            fNumericDef = <span class="keyword">new</span> <span class="keywordtype">double</span>[ fSize ];</div>
<div class="line">        memcpy( fNumericDef, from.fNumericDef, fSize * <span class="keyword">sizeof</span>( *fNumericDef ) );</div>
<div class="line">    }</div>
<div class="line"> <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line"> <span class="keyword">delete</span> fNumericDef;</div>
<div class="line">        fStringDef = from.fStringDef;</div>
<div class="line">    }</div>
<div class="line">}                                      <span class="comment">// cgfxAttrDef::setInitialValue</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">// Set attribute flag</span></div>
<div class="line"><span class="keywordtype">void</span> cgfxAttrDef::setAttributeFlags()</div>
<div class="line">{</div>
<div class="line"> <a class="code" href="./class_m_fn_attribute.html">MFnAttribute</a> attribute;</div>
<div class="line"> <span class="keywordflow">if</span>(!attribute.<a class="code" href="./class_m_fn_base.html#ad09f5acece0f9926b3e0e55cff78c3be">setObject</a>(fAttr))</div>
<div class="line"> <span class="keywordflow">return</span> ;</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">switch</span> (fType)</div>
<div class="line">    {</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeColor3:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeColor4:</div>
<div class="line">        attribute.<a class="code" href="./class_m_fn_attribute.html#a9e68a8b4af016b37f6567cfa6d68e551">setKeyable</a>( <span class="keyword">true</span> );</div>
<div class="line">        attribute.<a class="code" href="./class_m_fn_attribute.html#a4a44548ca2e5b1e7613a992a6b96a147">setUsedAsColor</a>( <span class="keyword">true</span> );</div>
<div class="line">        attribute.<a class="code" href="./class_m_fn_attribute.html#a0810da59cbaac7ecbd26ba0a43d0ac35">setAffectsAppearance</a>( <span class="keyword">true</span> );</div>
<div class="line"> <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeBool:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeInt:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeFloat:</div>
<div class="line">        attribute.<a class="code" href="./class_m_fn_attribute.html#a9e68a8b4af016b37f6567cfa6d68e551">setKeyable</a>( <span class="keyword">true</span> );</div>
<div class="line">        attribute.<a class="code" href="./class_m_fn_attribute.html#a0810da59cbaac7ecbd26ba0a43d0ac35">setAffectsAppearance</a>( <span class="keyword">true</span> );</div>
<div class="line"> <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeVector2:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeVector3:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeVector4:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeObjectDir:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeWorldDir:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeViewDir:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeProjectionDir:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeScreenDir:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeObjectPos:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeWorldPos:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeViewPos:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeProjectionPos:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeScreenPos:</div>
<div class="line"> <span class="keywordflow">if</span>( fDescription.length() &gt; 0)</div>
<div class="line">            attribute.<a class="code" href="./class_m_fn_attribute.html#a9e68a8b4af016b37f6567cfa6d68e551">setKeyable</a>( <span class="keyword">true</span> );</div>
<div class="line">        attribute.<a class="code" href="./class_m_fn_attribute.html#a0810da59cbaac7ecbd26ba0a43d0ac35">setAffectsAppearance</a>( <span class="keyword">true</span> );</div>
<div class="line"> <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeString:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeMatrix: <span class="comment">// Create a generic matrix</span></div>
<div class="line">        attribute.<a class="code" href="./class_m_fn_attribute.html#a0810da59cbaac7ecbd26ba0a43d0ac35">setAffectsAppearance</a>( <span class="keyword">true</span> );</div>
<div class="line"> <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeWorldMatrix:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeViewMatrix:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeProjectionMatrix:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeWorldViewMatrix:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeWorldViewProjectionMatrix:</div>
<div class="line"> <span class="comment">// These matricies are handled internally and have no attribute.</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeColor1DTexture:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeColor2DTexture:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeColor3DTexture:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeColor2DRectTexture:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeNormalTexture:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeBumpTexture:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeCubeTexture:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeEnvTexture:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeNormalizationTexture:</div>
<div class="line"> <span class="comment">/*if(!getTexturesByName())</span></div>
<div class="line"><span class="comment">            // Although it's not strictly necessary, set this attribute</span></div>
<div class="line"><span class="comment">            // to be a color so the user can will at least get the</span></div>
<div class="line"><span class="comment">            // texture assignment button in the AE if for some reason</span></div>
<div class="line"><span class="comment">            // our AE template is missing</span></div>
<div class="line"><span class="comment">            attribute.setUsedAsColor( true );*/</span></div>
<div class="line">        attribute.<a class="code" href="./class_m_fn_attribute.html#a0810da59cbaac7ecbd26ba0a43d0ac35">setAffectsAppearance</a>( <span class="keyword">true</span> );</div>
<div class="line"> <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifdef _WIN32</span></div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeTime:</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeHardwareFogEnabled:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeHardwareFogMode:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeHardwareFogStart:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeHardwareFogEnd:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeHardwareFogDensity:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeHardwareFogColor:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeOther:</div>
<div class="line"> <span class="keywordflow">break</span>;</div>
<div class="line"> <span class="keywordflow">default</span>:</div>
<div class="line">        M_CHECK( <span class="keyword">false</span> );</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// Set Maya attributes to their initial values.</span></div>
<div class="line"><span class="comment">/* static */</span></div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">cgfxAttrDef::initializeAttributes(</div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a>&amp;                            oNode,</div>
<div class="line"> <span class="keyword">const</span> cgfxRCPtr&lt;cgfxAttrDefList&gt;&amp;   list,</div>
<div class="line"> <span class="keywordtype">bool</span>                                bUndoing,</div>
<div class="line"> <a class="code" href="./class_m_d_g_modifier.html">MDGModifier</a>*                        dgMod)</div>
<div class="line">{</div>
<div class="line"> <a class="code" href="./class_m_status.html">MStatus</a>             status;</div>
<div class="line"> <a class="code" href="./class_m_fn_matrix_attribute.html">MFnMatrixAttribute</a>  fnMatrix;</div>
<div class="line"> <a class="code" href="./class_m_fn_numeric_attribute.html">MFnNumericAttribute</a> fnNumeric;</div>
<div class="line"> <a class="code" href="./class_m_fn_typed_attribute.html">MFnTypedAttribute</a>   fnTyped;</div>
<div class="line"> <span class="keywordflow">for</span> ( cgfxAttrDefList::iterator it( list ); it; ++it )</div>
<div class="line">    {                                  <span class="comment">// loop over cgfxAttrDefList</span></div>
<div class="line">        cgfxAttrDef* aDef = (*it);</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> ( aDef-&gt;fAttr.isNull() )    <span class="comment">// if no Maya attr</span></div>
<div class="line"> <span class="keywordflow">continue</span>;                  <span class="comment">// try next</span></div>
<div class="line"></div>
<div class="line"> <span class="keywordtype">bool</span> bSetValue = bUndoing ? aDef-&gt;fInitOnUndo</div>
<div class="line">            : !aDef-&gt;fTweaked;</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">try</span></div>
<div class="line">        {</div>
<div class="line"> <span class="comment">// Boolean</span></div>
<div class="line"> <span class="keywordflow">if</span> ( aDef-&gt;fType == kAttrTypeBool )</div>
<div class="line">            {</div>
<div class="line"> <span class="keywordflow">if</span> ( bSetValue )</div>
<div class="line">                    aDef-&gt;setValue( oNode, aDef-&gt;fNumericDef &amp;&amp; aDef-&gt;fNumericDef[0] );</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Texture node: must be check before both numeric (as a</span></div>
<div class="line"> <span class="comment">// texture could be a float3 colour) and string (as it</span></div>
<div class="line"> <span class="comment">// could also be a string)</span></div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span>( aDef-&gt;fType &gt;= kAttrTypeFirstTexture &amp;&amp; </div>
<div class="line">                aDef-&gt;fType &lt;= kAttrTypeLastTexture)</div>
<div class="line">            {</div>
<div class="line"> <span class="keywordflow">if</span> ( bSetValue )</div>
<div class="line">                    aDef-&gt;setTexture( oNode, aDef-&gt;fStringDef, dgMod);</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Numeric</span></div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( fnNumeric.<a class="code" href="./class_m_fn_base.html#ad09f5acece0f9926b3e0e55cff78c3be">setObject</a>( aDef-&gt;fAttr ) ) </div>
<div class="line">            {                          <span class="comment">// numeric attr</span></div>
<div class="line"></div>
<div class="line"> <span class="comment">// Constants for removing old bounds...</span></div>
<div class="line"> <span class="keywordtype">double</span> vMin = -FLT_MAX;</div>
<div class="line"> <span class="keywordtype">double</span> vMax = FLT_MAX;</div>
<div class="line"> <span class="keywordflow">if</span> ( aDef-&gt;fType == kAttrTypeInt )</div>
<div class="line">                {</div>
<div class="line">                    vMin = INT_MIN;</div>
<div class="line">                    vMax = INT_MAX;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Set or remove bounds.</span></div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">switch</span> ( aDef-&gt;fSize )</div>
<div class="line">                {                      <span class="comment">// switch to set/remove bounds</span></div>
<div class="line"> <span class="keywordflow">case</span> 1:</div>
<div class="line"> <span class="keywordflow">if</span> ( aDef-&gt;fNumericMin )</div>
<div class="line">                        fnNumeric.<a name="a68"></a><a class="code" href="./class_m_fn_numeric_attribute.html#aba21b33176bb831de026b78605c1dcf3">setMin</a>( aDef-&gt;fNumericMin[0] );</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( fnNumeric.<a class="code" href="./class_m_fn_numeric_attribute.html#a1635117fc1cd56e612895c54a0996491">hasMin</a>() )</div>
<div class="line">                        fnNumeric.<a class="code" href="./class_m_fn_numeric_attribute.html#aba21b33176bb831de026b78605c1dcf3">setMin</a>( vMin );</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> ( aDef-&gt;fNumericMax )</div>
<div class="line">                        fnNumeric.<a name="a69"></a><a class="code" href="./class_m_fn_numeric_attribute.html#adab95fd85497b1dad3a4ba7a842ce9d8">setMax</a>( aDef-&gt;fNumericMax[0] );</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( fnNumeric.<a class="code" href="./class_m_fn_numeric_attribute.html#a5b1ba68393fede3d8d2078add520f168">hasMax</a>() )</div>
<div class="line">                        fnNumeric.<a class="code" href="./class_m_fn_numeric_attribute.html#adab95fd85497b1dad3a4ba7a842ce9d8">setMax</a>( vMax );</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> ( aDef-&gt;fNumericSoftMin )</div>
<div class="line">                        fnNumeric.<a name="a70"></a><a class="code" href="./class_m_fn_numeric_attribute.html#af72ddb0704d27319ad52a28bdcd9f2a5">setSoftMin</a>( aDef-&gt;fNumericSoftMin[0] );</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( fnNumeric.<a class="code" href="./class_m_fn_numeric_attribute.html#a917aaf6e8026c32ca2f402c51e531b69">hasSoftMin</a>() )</div>
<div class="line">                        fnNumeric.<a class="code" href="./class_m_fn_numeric_attribute.html#af72ddb0704d27319ad52a28bdcd9f2a5">setSoftMin</a>( vMin );</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> ( aDef-&gt;fNumericSoftMax )</div>
<div class="line">                        fnNumeric.<a name="a71"></a><a class="code" href="./class_m_fn_numeric_attribute.html#acd6abf61e5a1e573a57a516bf81bb2dc">setSoftMax</a>( aDef-&gt;fNumericSoftMax[0] );</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( fnNumeric.<a class="code" href="./class_m_fn_numeric_attribute.html#a563766a920e62cba567fdc71af3be8e4">hasSoftMax</a>() )</div>
<div class="line">                        fnNumeric.<a class="code" href="./class_m_fn_numeric_attribute.html#acd6abf61e5a1e573a57a516bf81bb2dc">setSoftMax</a>( vMax );</div>
<div class="line"> <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">case</span> 2:</div>
<div class="line"> <span class="keywordflow">if</span> ( aDef-&gt;fNumericMin )</div>
<div class="line">                        fnNumeric.<a class="code" href="./class_m_fn_numeric_attribute.html#aba21b33176bb831de026b78605c1dcf3">setMin</a>( aDef-&gt;fNumericMin[0], </div>
<div class="line">                        aDef-&gt;fNumericMin[1] );</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( fnNumeric.<a class="code" href="./class_m_fn_numeric_attribute.html#a1635117fc1cd56e612895c54a0996491">hasMin</a>() )</div>
<div class="line">                        fnNumeric.<a class="code" href="./class_m_fn_numeric_attribute.html#aba21b33176bb831de026b78605c1dcf3">setMin</a>( vMin, vMin );</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> ( aDef-&gt;fNumericMax )</div>
<div class="line">                        fnNumeric.<a class="code" href="./class_m_fn_numeric_attribute.html#adab95fd85497b1dad3a4ba7a842ce9d8">setMax</a>( aDef-&gt;fNumericMax[0], </div>
<div class="line">                        aDef-&gt;fNumericMax[1] );</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( fnNumeric.<a class="code" href="./class_m_fn_numeric_attribute.html#a5b1ba68393fede3d8d2078add520f168">hasMax</a>() )</div>
<div class="line">                        fnNumeric.<a class="code" href="./class_m_fn_numeric_attribute.html#adab95fd85497b1dad3a4ba7a842ce9d8">setMax</a>( vMax, vMax );</div>
<div class="line"> <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">case</span> 3:</div>
<div class="line"> <span class="keywordflow">case</span> 4:</div>
<div class="line"> <span class="keywordflow">if</span> ( aDef-&gt;fNumericMin )</div>
<div class="line">                        fnNumeric.<a class="code" href="./class_m_fn_numeric_attribute.html#aba21b33176bb831de026b78605c1dcf3">setMin</a>( aDef-&gt;fNumericMin[0], </div>
<div class="line">                        aDef-&gt;fNumericMin[1],</div>
<div class="line">                        aDef-&gt;fNumericMin[2] );</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( fnNumeric.<a class="code" href="./class_m_fn_numeric_attribute.html#a1635117fc1cd56e612895c54a0996491">hasMin</a>() )</div>
<div class="line">                        fnNumeric.<a class="code" href="./class_m_fn_numeric_attribute.html#aba21b33176bb831de026b78605c1dcf3">setMin</a>( vMin, vMin, vMin );</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> ( aDef-&gt;fNumericMax )</div>
<div class="line">                        fnNumeric.<a class="code" href="./class_m_fn_numeric_attribute.html#adab95fd85497b1dad3a4ba7a842ce9d8">setMax</a>( aDef-&gt;fNumericMax[0], </div>
<div class="line">                        aDef-&gt;fNumericMax[1],</div>
<div class="line">                        aDef-&gt;fNumericMax[2] );</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( fnNumeric.<a class="code" href="./class_m_fn_numeric_attribute.html#a5b1ba68393fede3d8d2078add520f168">hasMax</a>() )</div>
<div class="line">                        fnNumeric.<a class="code" href="./class_m_fn_numeric_attribute.html#adab95fd85497b1dad3a4ba7a842ce9d8">setMax</a>( vMax, vMax, vMax );</div>
<div class="line"> <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">default</span>:</div>
<div class="line">                    M_CHECK( <span class="keyword">false</span> );</div>
<div class="line">                }                      <span class="comment">// switch to set/remove bounds</span></div>
<div class="line"></div>
<div class="line"> <span class="comment">// Set initial value.</span></div>
<div class="line"> <span class="comment">//   Use 0 if no initial value specified in .fx file.</span></div>
<div class="line"> <span class="keywordflow">if</span> ( bSetValue )</div>
<div class="line">                {                      <span class="comment">// set numeric initial value</span></div>
<div class="line"> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> d0[4] = {0.0, 0.0, 0.0, 0.0};</div>
<div class="line"> <span class="keyword">const</span> <span class="keywordtype">double</span>* pNumericDef = aDef-&gt;fNumericDef ? aDef-&gt;fNumericDef</div>
<div class="line">                        : d0;</div>
<div class="line"> <span class="keywordflow">switch</span> ( aDef-&gt;fSize )</div>
<div class="line">                    {                  </div>
<div class="line"> <span class="keywordflow">case</span> 1:</div>
<div class="line"> <span class="keywordflow">if</span> ( aDef-&gt;fType == kAttrTypeInt )</div>
<div class="line">                            aDef-&gt;setValue( oNode, (<span class="keywordtype">int</span>)pNumericDef[0] );</div>
<div class="line"> <span class="keywordflow">else</span></div>
<div class="line">                            aDef-&gt;setValue( oNode, (<span class="keywordtype">float</span>)pNumericDef[0] );</div>
<div class="line"> <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">case</span> 2:</div>
<div class="line">                        aDef-&gt;setValue( oNode,</div>
<div class="line">                            (<span class="keywordtype">float</span>)pNumericDef[0],</div>
<div class="line">                            (<span class="keywordtype">float</span>)pNumericDef[1] );</div>
<div class="line"> <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">case</span> 3:</div>
<div class="line">                        aDef-&gt;setValue( oNode,</div>
<div class="line">                            (<span class="keywordtype">float</span>)pNumericDef[0],</div>
<div class="line">                            (<span class="keywordtype">float</span>)pNumericDef[1],</div>
<div class="line">                            (<span class="keywordtype">float</span>)pNumericDef[2] );</div>
<div class="line"> <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">case</span> 4:</div>
<div class="line">                        status = fnNumeric.<a class="code" href="./class_m_fn_base.html#ad09f5acece0f9926b3e0e55cff78c3be">setObject</a>( aDef-&gt;fAttr2 );</div>
<div class="line">                        M_CHECK( status );</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> ( aDef-&gt;fNumericMin )</div>
<div class="line">                            fnNumeric.<a class="code" href="./class_m_fn_numeric_attribute.html#aba21b33176bb831de026b78605c1dcf3">setMin</a>( aDef-&gt;fNumericMin[3] );</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( fnNumeric.<a class="code" href="./class_m_fn_numeric_attribute.html#a1635117fc1cd56e612895c54a0996491">hasMin</a>() )</div>
<div class="line">                            fnNumeric.<a class="code" href="./class_m_fn_numeric_attribute.html#aba21b33176bb831de026b78605c1dcf3">setMin</a>( vMin );</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> ( aDef-&gt;fNumericMax )</div>
<div class="line">                            fnNumeric.<a class="code" href="./class_m_fn_numeric_attribute.html#adab95fd85497b1dad3a4ba7a842ce9d8">setMax</a>( aDef-&gt;fNumericMax[3] );</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( fnNumeric.<a class="code" href="./class_m_fn_numeric_attribute.html#a5b1ba68393fede3d8d2078add520f168">hasMax</a>() )</div>
<div class="line">                            fnNumeric.<a class="code" href="./class_m_fn_numeric_attribute.html#adab95fd85497b1dad3a4ba7a842ce9d8">setMax</a>( vMax );</div>
<div class="line"></div>
<div class="line">                        aDef-&gt;setValue( oNode,</div>
<div class="line">                            (<span class="keywordtype">float</span>)pNumericDef[0],</div>
<div class="line">                            (<span class="keywordtype">float</span>)pNumericDef[1],</div>
<div class="line">                            (<span class="keywordtype">float</span>)pNumericDef[2],</div>
<div class="line">                            (<span class="keywordtype">float</span>)pNumericDef[3] );</div>
<div class="line"> <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">default</span>:</div>
<div class="line">                        M_CHECK( <span class="keyword">false</span> );</div>
<div class="line">                    }                  <span class="comment">// switch ( aDef-&gt;fSize )</span></div>
<div class="line">                }                      <span class="comment">// set numeric initial value</span></div>
<div class="line">            }                          <span class="comment">// numeric attr</span></div>
<div class="line"></div>
<div class="line"> <span class="comment">// String</span></div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( fnTyped.<a class="code" href="./class_m_fn_base.html#ad09f5acece0f9926b3e0e55cff78c3be">setObject</a>( aDef-&gt;fAttr ) &amp;&amp;</div>
<div class="line">                fnTyped.<a class="code" href="./class_m_fn_typed_attribute.html#aa3bf2ba724f9aaf87976b1fb896fd700">attrType</a>() == <a class="code" href="./class_m_fn_data.html#a1d1cfd8ffb84e947f82999c682b666a7afab53ea4a643325262b9c140af093279">MFnData::kString</a> )</div>
<div class="line">            {</div>
<div class="line"> <span class="keywordflow">if</span> ( bSetValue )</div>
<div class="line">                    aDef-&gt;setValue( oNode, aDef-&gt;fStringDef );</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Matrix</span></div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( fnMatrix.<a class="code" href="./class_m_fn_base.html#ad09f5acece0f9926b3e0e55cff78c3be">setObject</a>( aDef-&gt;fAttr ) )</div>
<div class="line">            {</div>
<div class="line"> <span class="keywordflow">if</span> ( !bSetValue )</div>
<div class="line">                {}</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( aDef-&gt;fNumericDef )</div>
<div class="line">                {</div>
<div class="line"> <a class="code" href="./class_m_matrix.html">MMatrix</a> m;</div>
<div class="line"> <span class="keywordtype">double</span>* p = &amp;m.<a class="code" href="./class_m_matrix.html#a527b102f4eb0951cf4f391f828d3ca34">matrix</a>[0][0];</div>
<div class="line"> <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> k = 0; k &lt; 16; ++k )</div>
<div class="line">                        p[ k ] = aDef-&gt;fNumericDef[ k ];</div>
<div class="line">                    aDef-&gt;setValue( oNode, m );</div>
<div class="line">                }</div>
<div class="line"> <span class="keywordflow">else</span></div>
<div class="line">                    aDef-&gt;setValue( oNode, <a class="code" href="./class_m_matrix.html#a85de986c9f953535d185c6780cecb77e">MMatrix::identity</a> );</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> <span class="keywordflow">catch</span> ( cgfxShaderCommon::InternalError* e )   </div>
<div class="line">        {</div>
<div class="line"> <span class="keywordtype">size_t</span> ee = (size_t)e;</div>
<div class="line"> <a class="code" href="./class_m_fn_dependency_node.html">MFnDependencyNode</a> fnNode( oNode );</div>
<div class="line"> <a class="code" href="./class_m_string.html">MString</a> sMsg = <span class="stringliteral">"("</span>;</div>
<div class="line">            sMsg += (int)ee;</div>
<div class="line">            sMsg += <span class="stringliteral">") cgfxShader node \""</span>;</div>
<div class="line">            sMsg += fnNode.<a class="code" href="./class_m_fn_dependency_node.html#a049384adbea0396ea2f03d1ad4d69df1">name</a>();</div>
<div class="line">            sMsg += <span class="stringliteral">"\": unable to initialize attribute \""</span>;</div>
<div class="line">            sMsg += aDef-&gt;fName;</div>
<div class="line">            sMsg += <span class="stringliteral">"\""</span>;</div>
<div class="line"> <a class="code" href="./class_m_global.html#acb043e7fc4eb7fc0f39833d31364b8a4">MGlobal::displayWarning</a>( sMsg );</div>
<div class="line">        }</div>
<div class="line">    }                                  <span class="comment">// loop over cgfxAttrDefList</span></div>
<div class="line">}                                      <span class="comment">// cgfxAttrDef::initializeAttributes</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">// Clear all Maya attribute references in a cgfxAttrDefList.</span></div>
<div class="line"><span class="comment">//   This should be called whenever the list is detached from </span></div>
<div class="line"><span class="comment">//   the cgfxShader node, to avert an eventual exception in </span></div>
<div class="line"><span class="comment">//   MObject::~MObject() in case the referenced Maya attribute </span></div>
<div class="line"><span class="comment">//   happens to be deleted while the cgfxAttrDefList is in</span></div>
<div class="line"><span class="comment">//   suspense on Maya's undo queue.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">/* static */</span></div>
<div class="line"><span class="keywordtype">void</span> cgfxAttrDef::purgeMObjectCache(<span class="keyword">const</span> cgfxRCPtr&lt;cgfxAttrDefList&gt;&amp; list)</div>
<div class="line">{                                       </div>
<div class="line">    cgfxAttrDefList::iterator it( list );</div>
<div class="line"> <span class="keywordflow">for</span> ( ; it; ++it )</div>
<div class="line">    {</div>
<div class="line">        cgfxAttrDef* aDef = (*it);</div>
<div class="line">        aDef-&gt;fAttr  = <a class="code" href="./class_m_object.html#ae6af14e0aa2c92bdda88c81280e1d122">MObject::kNullObj</a>;</div>
<div class="line">        aDef-&gt;fAttr2 = <a class="code" href="./class_m_object.html#ae6af14e0aa2c92bdda88c81280e1d122">MObject::kNullObj</a>;</div>
<div class="line">    }</div>
<div class="line">}                                      <span class="comment">// cgfxAttrDef::purgeMObjectCache</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">// Refresh Maya attribute references in a cgfxAttrDefList.</span></div>
<div class="line"><span class="comment">//   This should be called whenever a saved list is re-attached</span></div>
<div class="line"><span class="comment">//   to the cgfxShader node in the course of undo or redo.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">/* static */</span></div>
<div class="line"><span class="keywordtype">void</span> cgfxAttrDef::validateMObjectCache(</div>
<div class="line"> <span class="keyword">const</span> <a class="code" href="./class_m_object.html">MObject</a>&amp;                      obCgfxShader, </div>
<div class="line"> <span class="keyword">const</span> cgfxRCPtr&lt;cgfxAttrDefList&gt;&amp;   list)</div>
<div class="line">{                                       </div>
<div class="line"> <a class="code" href="./class_m_status.html">MStatus</a> status;</div>
<div class="line"> <a class="code" href="./class_m_string.html">MString</a> sName2;</div>
<div class="line"> <a class="code" href="./class_m_fn_dependency_node.html">MFnDependencyNode</a> fnNode( obCgfxShader, &amp;status );</div>
<div class="line">    cgfxAttrDefList::iterator it( list );</div>
<div class="line"> <span class="keywordflow">for</span> ( ; it; ++it )</div>
<div class="line">    {</div>
<div class="line">        cgfxAttrDef* aDef = (*it);</div>
<div class="line">        aDef-&gt;fAttr = fnNode.<a class="code" href="./class_m_fn_dependency_node.html#a6117a63ae3bb2d03aa976dc8732d93a5">attribute</a>( aDef-&gt;fName, &amp;status );</div>
<div class="line"></div>
<div class="line"> <span class="comment">// 4-element vectors use an extra attribute for the 4th element.</span></div>
<div class="line"> <span class="keyword">const</span> <span class="keywordtype">char</span>* suffix = aDef-&gt;getExtraAttrSuffix();</div>
<div class="line"> <span class="keywordflow">if</span> ( suffix )</div>
<div class="line">            aDef-&gt;fAttr2 = fnNode.<a class="code" href="./class_m_fn_dependency_node.html#a6117a63ae3bb2d03aa976dc8732d93a5">attribute</a>( aDef-&gt;fName + suffix, &amp;status );</div>
<div class="line">    }</div>
<div class="line">}                                      <span class="comment">// cgfxAttrDef::validateMObjectCache</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">// Return suffix for Color4/Vector4 extra attribute, or NULL.</span></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>*</div>
<div class="line">cgfxAttrDef::getExtraAttrSuffix()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line"> <span class="keywordflow">if</span> ( fSize == 4 )</div>
<div class="line"> <span class="keywordflow">return</span> compoundAttrSuffixes( fType )[ 3 ];</div>
<div class="line"> <span class="keywordflow">return</span> NULL;</div>
<div class="line">}                                      <span class="comment">// cgfxAttrDef::getExtraAttrSuffix</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">// Get a string representation of a cgfxAttrType</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">/* static */</span></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* cgfxAttrDef::typeName( cgfxAttrType type )</div>
<div class="line">{</div>
<div class="line"><span class="preprocessor">#define CASE(name) case kAttrType##name: return #name</span></div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">switch</span> (type)</div>
<div class="line">    {</div>
<div class="line"> <span class="keywordflow">default</span>:    <span class="comment">// Fall through into case unknown</span></div>
<div class="line">        CASE(Unknown);</div>
<div class="line">        CASE(Bool);</div>
<div class="line">        CASE(Int);</div>
<div class="line">        CASE(Float);</div>
<div class="line">        CASE(String);</div>
<div class="line">        CASE(Vector2);</div>
<div class="line">        CASE(Vector3);</div>
<div class="line">        CASE(Vector4);</div>
<div class="line">        CASE(ObjectDir);</div>
<div class="line">        CASE(WorldDir);</div>
<div class="line">        CASE(ViewDir);</div>
<div class="line">        CASE(ProjectionDir);</div>
<div class="line">        CASE(ScreenDir);</div>
<div class="line">        CASE(ObjectPos);</div>
<div class="line">        CASE(WorldPos);</div>
<div class="line">        CASE(ViewPos);</div>
<div class="line">        CASE(ProjectionPos);</div>
<div class="line">        CASE(ScreenPos);</div>
<div class="line">        CASE(Color3);</div>
<div class="line">        CASE(Color4);</div>
<div class="line">        CASE(Matrix);</div>
<div class="line">        CASE(WorldMatrix);</div>
<div class="line">        CASE(ViewMatrix);</div>
<div class="line">        CASE(ProjectionMatrix);</div>
<div class="line">        CASE(WorldViewMatrix);</div>
<div class="line">        CASE(WorldViewProjectionMatrix);</div>
<div class="line">        CASE(Color1DTexture);</div>
<div class="line">        CASE(Color2DTexture);</div>
<div class="line">        CASE(Color3DTexture);</div>
<div class="line">        CASE(Color2DRectTexture);</div>
<div class="line">        CASE(NormalTexture);</div>
<div class="line">        CASE(BumpTexture);</div>
<div class="line">        CASE(CubeTexture);</div>
<div class="line">        CASE(EnvTexture);</div>
<div class="line">        CASE(NormalizationTexture);</div>
<div class="line"><span class="preprocessor">#ifdef _WIN32</span></div>
<div class="line">        CASE(Time);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">        CASE(HardwareFogEnabled);</div>
<div class="line">        CASE(HardwareFogMode);</div>
<div class="line">        CASE(HardwareFogStart);</div>
<div class="line">        CASE(HardwareFogEnd);</div>
<div class="line">        CASE(HardwareFogDensity);</div>
<div class="line">        CASE(HardwareFogColor);</div>
<div class="line">        CASE(Other);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">/* static */</span></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>**</div>
<div class="line">cgfxAttrDef::compoundAttrSuffixes( cgfxAttrType eAttrType )</div>
<div class="line">{</div>
<div class="line"> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* simple[] = { NULL, NULL, NULL, NULL,    NULL };</div>
<div class="line"> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* vector[] = { <span class="stringliteral">"X"</span>,  <span class="stringliteral">"Y"</span>,  <span class="stringliteral">"Z"</span>,  <span class="stringliteral">"W"</span>,     NULL };</div>
<div class="line"> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* color[]  = { <span class="stringliteral">"R"</span>,  <span class="stringliteral">"G"</span>,  <span class="stringliteral">"B"</span>,  <span class="stringliteral">"Alpha"</span>, NULL };</div>
<div class="line"></div>
<div class="line"> <span class="keyword">const</span> <span class="keywordtype">char</span>** p;</div>
<div class="line"> <span class="keywordflow">switch</span> ( eAttrType )</div>
<div class="line">    {</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeVector2:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeVector3:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeVector4:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeObjectDir:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeWorldDir:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeViewDir:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeProjectionDir:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeScreenDir:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeObjectPos:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeWorldPos:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeViewPos:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeProjectionPos:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeScreenPos:</div>
<div class="line">        p = vector;</div>
<div class="line"> <span class="keywordflow">break</span>;</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeColor3:</div>
<div class="line"> <span class="keywordflow">case</span> kAttrTypeColor4:</div>
<div class="line">        p = color;</div>
<div class="line"> <span class="keywordflow">break</span>;</div>
<div class="line"> <span class="keywordflow">default</span>:</div>
<div class="line">        p = simple;</div>
<div class="line"> <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line"> <span class="keywordflow">return</span> p;</div>
<div class="line">}                                      <span class="comment">// cgfxAttrDef::compoundAttrSuffixes</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">// Methods to get attribute values</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">cgfxAttrDef::getValue( <a class="code" href="./class_m_object.html">MObject</a>&amp; oNode, <span class="keywordtype">bool</span>&amp; value )<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line"> <a class="code" href="./class_m_status.html">MStatus</a> status;</div>
<div class="line"> <a class="code" href="./class_m_plug.html">MPlug</a> plug(oNode, fAttr);</div>
<div class="line">    status = plug.getValue(value);</div>
<div class="line">    M_CHECK( status );</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">cgfxAttrDef::getValue( <a class="code" href="./class_m_object.html">MObject</a>&amp; oNode, <span class="keywordtype">int</span>&amp; value )<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line"> <a class="code" href="./class_m_status.html">MStatus</a> status;</div>
<div class="line"> <a class="code" href="./class_m_plug.html">MPlug</a> plug(oNode, fAttr);</div>
<div class="line">    status = plug.getValue(value);</div>
<div class="line">    M_CHECK( status );</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">cgfxAttrDef::getValue( <a class="code" href="./class_m_object.html">MObject</a>&amp; oNode, <span class="keywordtype">float</span>&amp; value )<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line"> <a class="code" href="./class_m_status.html">MStatus</a> status;</div>
<div class="line"> <a class="code" href="./class_m_plug.html">MPlug</a> plug(oNode, fAttr);</div>
<div class="line">    status = plug.getValue(value);</div>
<div class="line"> <span class="keywordflow">if</span>( fUnits != MDistance::kInvalid)</div>
<div class="line">    {</div>
<div class="line">        value = (float)<a class="code" href="./class_m_distance.html">MDistance</a>( value, fUnits).<a name="a72"></a><a class="code" href="./class_m_distance.html#a10e4859da6d5243c4805beb98affb3f2">as</a>( <a class="code" href="./class_m_distance.html#a2a3077e91bb7ba19bade3cae7e4604a6">MDistance::internalUnit</a>());</div>
<div class="line">    }</div>
<div class="line">    M_CHECK( status );</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">cgfxAttrDef::getValue( <a class="code" href="./class_m_object.html">MObject</a>&amp; oNode, <a class="code" href="./class_m_string.html">MString</a>&amp; value )<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line"> <a class="code" href="./class_m_status.html">MStatus</a> status;</div>
<div class="line"> <a class="code" href="./class_m_plug.html">MPlug</a> plug(oNode, fAttr);</div>
<div class="line">    status = plug.getValue(value);</div>
<div class="line">    M_CHECK( status );</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">cgfxAttrDef::getValue( <a class="code" href="./class_m_object.html">MObject</a>&amp; oNode, <span class="keywordtype">float</span>&amp; v1, <span class="keywordtype">float</span>&amp; v2 )<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line"> <a class="code" href="./class_m_status.html">MStatus</a> status;</div>
<div class="line"> <a class="code" href="./class_m_plug.html">MPlug</a> plug(oNode, fAttr);</div>
<div class="line"></div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> oData;</div>
<div class="line">    status = plug.getValue(oData);</div>
<div class="line">    M_CHECK( status );</div>
<div class="line"></div>
<div class="line"> <a name="_a73"></a><a class="code" href="./class_m_fn_numeric_data.html">MFnNumericData</a> fnData(oData, &amp;status);</div>
<div class="line">    M_CHECK( status );</div>
<div class="line"></div>
<div class="line">    status = fnData.getData(v1, v2);</div>
<div class="line">    M_CHECK( status );</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span>( fUnits != MDistance::kInvalid)</div>
<div class="line">    {</div>
<div class="line">        v1 = (float)<a class="code" href="./class_m_distance.html">MDistance</a>( v1, fUnits).<a class="code" href="./class_m_distance.html#a10e4859da6d5243c4805beb98affb3f2">as</a>( <a class="code" href="./class_m_distance.html#a2a3077e91bb7ba19bade3cae7e4604a6">MDistance::internalUnit</a>());</div>
<div class="line">        v2 = (float)<a class="code" href="./class_m_distance.html">MDistance</a>( v2, fUnits).<a class="code" href="./class_m_distance.html#a10e4859da6d5243c4805beb98affb3f2">as</a>( <a class="code" href="./class_m_distance.html#a2a3077e91bb7ba19bade3cae7e4604a6">MDistance::internalUnit</a>());</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">cgfxAttrDef::getValue( <a class="code" href="./class_m_object.html">MObject</a>&amp; oNode,</div>
<div class="line"> <span class="keywordtype">float</span>&amp; v1, <span class="keywordtype">float</span>&amp; v2, <span class="keywordtype">float</span>&amp; v3 )<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line"> <a class="code" href="./class_m_status.html">MStatus</a> status;</div>
<div class="line"> <a class="code" href="./class_m_plug.html">MPlug</a> plug(oNode, fAttr);</div>
<div class="line"></div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> oData;</div>
<div class="line">    status = plug.getValue(oData);</div>
<div class="line">    M_CHECK( status );</div>
<div class="line"></div>
<div class="line"> <a class="code" href="./class_m_fn_numeric_data.html">MFnNumericData</a> fnData(oData, &amp;status);</div>
<div class="line">    M_CHECK( status );</div>
<div class="line"></div>
<div class="line">    status = fnData.getData(v1, v2, v3);</div>
<div class="line">    M_CHECK( status );</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span>( fUnits != MDistance::kInvalid)</div>
<div class="line">    {</div>
<div class="line">        v1 = (float)<a class="code" href="./class_m_distance.html">MDistance</a>( v1, fUnits).<a class="code" href="./class_m_distance.html#a10e4859da6d5243c4805beb98affb3f2">as</a>( <a class="code" href="./class_m_distance.html#a2a3077e91bb7ba19bade3cae7e4604a6">MDistance::internalUnit</a>());</div>
<div class="line">        v2 = (float)<a class="code" href="./class_m_distance.html">MDistance</a>( v2, fUnits).<a class="code" href="./class_m_distance.html#a10e4859da6d5243c4805beb98affb3f2">as</a>( <a class="code" href="./class_m_distance.html#a2a3077e91bb7ba19bade3cae7e4604a6">MDistance::internalUnit</a>());</div>
<div class="line">        v3 = (float)<a class="code" href="./class_m_distance.html">MDistance</a>( v3, fUnits).<a class="code" href="./class_m_distance.html#a10e4859da6d5243c4805beb98affb3f2">as</a>( <a class="code" href="./class_m_distance.html#a2a3077e91bb7ba19bade3cae7e4604a6">MDistance::internalUnit</a>());</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">cgfxAttrDef::getValue( <a class="code" href="./class_m_object.html">MObject</a>&amp; oNode,</div>
<div class="line"> <span class="keywordtype">float</span>&amp; v1, <span class="keywordtype">float</span>&amp; v2, <span class="keywordtype">float</span>&amp; v3, <span class="keywordtype">float</span>&amp; v4 )<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line"> <a class="code" href="./class_m_status.html">MStatus</a> status;</div>
<div class="line"> <a class="code" href="./class_m_plug.html">MPlug</a> plug(oNode, fAttr);</div>
<div class="line"> <a class="code" href="./class_m_plug.html">MPlug</a> plug2(oNode, fAttr2);</div>
<div class="line"></div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> oData;</div>
<div class="line">    status = plug.getValue(oData);</div>
<div class="line">    M_CHECK( status );</div>
<div class="line"></div>
<div class="line"> <a class="code" href="./class_m_fn_numeric_data.html">MFnNumericData</a> fnData(oData, &amp;status);</div>
<div class="line">    M_CHECK( status );</div>
<div class="line"></div>
<div class="line">    status = fnData.getData(v1, v2, v3);</div>
<div class="line">    M_CHECK( status );</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Get the 4th value from the extra attribute.</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line">    status = plug2.getValue(v4);</div>
<div class="line">    M_CHECK( status );</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span>( fUnits != MDistance::kInvalid)</div>
<div class="line">    {</div>
<div class="line">        v1 = (float)<a class="code" href="./class_m_distance.html">MDistance</a>( v1, fUnits).<a class="code" href="./class_m_distance.html#a10e4859da6d5243c4805beb98affb3f2">as</a>( <a class="code" href="./class_m_distance.html#a2a3077e91bb7ba19bade3cae7e4604a6">MDistance::internalUnit</a>());</div>
<div class="line">        v2 = (float)<a class="code" href="./class_m_distance.html">MDistance</a>( v2, fUnits).<a class="code" href="./class_m_distance.html#a10e4859da6d5243c4805beb98affb3f2">as</a>( <a class="code" href="./class_m_distance.html#a2a3077e91bb7ba19bade3cae7e4604a6">MDistance::internalUnit</a>());</div>
<div class="line">        v3 = (float)<a class="code" href="./class_m_distance.html">MDistance</a>( v3, fUnits).<a class="code" href="./class_m_distance.html#a10e4859da6d5243c4805beb98affb3f2">as</a>( <a class="code" href="./class_m_distance.html#a2a3077e91bb7ba19bade3cae7e4604a6">MDistance::internalUnit</a>());</div>
<div class="line">        v4 = (float)<a class="code" href="./class_m_distance.html">MDistance</a>( v4, fUnits).<a class="code" href="./class_m_distance.html#a10e4859da6d5243c4805beb98affb3f2">as</a>( <a class="code" href="./class_m_distance.html#a2a3077e91bb7ba19bade3cae7e4604a6">MDistance::internalUnit</a>());</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">cgfxAttrDef::getValue( <a class="code" href="./class_m_object.html">MObject</a>&amp; oNode, <a class="code" href="./class_m_matrix.html">MMatrix</a>&amp; value )<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line"> <a class="code" href="./class_m_status.html">MStatus</a> status;</div>
<div class="line"> <a class="code" href="./class_m_plug.html">MPlug</a> plug(oNode, fAttr);</div>
<div class="line"></div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> oData;</div>
<div class="line">    status = plug.getValue(oData);</div>
<div class="line">    M_CHECK( status );</div>
<div class="line"></div>
<div class="line"> <a class="code" href="./class_m_fn_matrix_data.html">MFnMatrixData</a> fnData(oData, &amp;status);</div>
<div class="line">    M_CHECK( status );</div>
<div class="line"></div>
<div class="line">    value = fnData.<a class="code" href="./class_m_matrix.html#a527b102f4eb0951cf4f391f828d3ca34">matrix</a>(&amp;status);</div>
<div class="line">    M_CHECK( status );</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">cgfxAttrDef::getValue( <a class="code" href="./class_m_object.html">MObject</a>&amp; oNode, <a name="_a74"></a><a class="code" href="./class_m_image.html">MImage</a>&amp; value )<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line"> <a class="code" href="./class_m_status.html">MStatus</a> status = <a name="a75"></a><a class="code" href="./class_m_status.html#a02ab596f4febca68da503aaf8dde3a80a1ef6c2d725fb4bec3e7e840d28adbc00">MS::kFailure</a>;</div>
<div class="line"> <a class="code" href="./class_m_plug.html">MPlug</a> plug(oNode, fAttr);</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (fType &gt;= kAttrTypeFirstTexture &amp;&amp;</div>
<div class="line">        fType &lt;= kAttrTypeLastTexture)</div>
<div class="line">    {</div>
<div class="line"> <a name="_a76"></a><a class="code" href="./class_m_plug_array.html">MPlugArray</a> plugArray;</div>
<div class="line">        plug.connectedTo(plugArray, <span class="keyword">true</span>, <span class="keyword">false</span>, &amp;status);</div>
<div class="line">        M_CHECK( status );</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (plugArray.<a name="a77"></a><a class="code" href="./class_m_plug_array.html#a580388f31f60c46fac867ca48a48da1e">length</a>() != 1)</div>
<div class="line">        {</div>
<div class="line">            M_CHECK( status );</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line"> <a class="code" href="./class_m_plug.html">MPlug</a> srcPlug = plugArray[0];</div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> oSrcNode = srcPlug.<a name="a78"></a><a class="code" href="./class_m_plug.html#ad1aa507eb8e63e89e8d46a0abc18aa8c">node</a>();</div>
<div class="line"></div>
<div class="line"> <span class="comment">// OutputDebugStrings("Source texture object = ", oSrcNode.apiTypeStr());</span></div>
<div class="line"></div>
<div class="line">        value.<a name="a79"></a><a class="code" href="./class_m_image.html#a314b4e06c651149b90dd3cea3a0aae24">release</a>();</div>
<div class="line">        status = value.<a name="a80"></a><a class="code" href="./class_m_image.html#a3e3e6e8e454d2335a2206ea7fc6075d9">readFromTextureNode</a>(oSrcNode);</div>
<div class="line">        M_CHECK( status );</div>
<div class="line">    }</div>
<div class="line">    M_CHECK( status );</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">// Get the source of an attribute value</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">cgfxAttrDef::getSource( <a class="code" href="./class_m_object.html">MObject</a>&amp; oNode, <a class="code" href="./class_m_plug.html">MPlug</a>&amp; src)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line"> <a class="code" href="./class_m_status.html">MStatus</a> status = <a class="code" href="./class_m_status.html#a02ab596f4febca68da503aaf8dde3a80a1ef6c2d725fb4bec3e7e840d28adbc00">MS::kFailure</a>;</div>
<div class="line"> <a class="code" href="./class_m_plug.html">MPlug</a> plug(oNode, fAttr);</div>
<div class="line"></div>
<div class="line"> <a class="code" href="./class_m_plug_array.html">MPlugArray</a> plugArray;</div>
<div class="line">    plug.connectedTo(plugArray, <span class="keyword">true</span>, <span class="keyword">false</span>, &amp;status);</div>
<div class="line">    M_CHECK( status &amp;&amp; plugArray.<a class="code" href="./class_m_plug_array.html#a580388f31f60c46fac867ca48a48da1e">length</a>() &lt;= 1);</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (plugArray.<a class="code" href="./class_m_plug_array.html#a580388f31f60c46fac867ca48a48da1e">length</a>() == 1)</div>
<div class="line">        src = plugArray[0];</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">// Methods to set attribute values</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">cgfxAttrDef::setValue( <a class="code" href="./class_m_object.html">MObject</a>&amp; oNode, <span class="keywordtype">bool</span> value )</div>
<div class="line">{</div>
<div class="line"> <a class="code" href="./class_m_status.html">MStatus</a> status;</div>
<div class="line"> <a class="code" href="./class_m_plug.html">MPlug</a> plug(oNode, fAttr);</div>
<div class="line">    status = plug.setValue(value);</div>
<div class="line">    M_CHECK( status );</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">cgfxAttrDef::setValue( <a class="code" href="./class_m_object.html">MObject</a>&amp; oNode, <span class="keywordtype">int</span> value )</div>
<div class="line">{</div>
<div class="line"> <a class="code" href="./class_m_status.html">MStatus</a> status;</div>
<div class="line"> <a class="code" href="./class_m_plug.html">MPlug</a> plug(oNode, fAttr);</div>
<div class="line">    status = plug.setValue(value);</div>
<div class="line">    M_CHECK( status );</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">cgfxAttrDef::setValue( <a class="code" href="./class_m_object.html">MObject</a>&amp; oNode, <span class="keywordtype">float</span> value )</div>
<div class="line">{</div>
<div class="line"> <a class="code" href="./class_m_status.html">MStatus</a> status;</div>
<div class="line"> <a class="code" href="./class_m_plug.html">MPlug</a> plug(oNode, fAttr);</div>
<div class="line"> </div>
<div class="line">    status = plug.setValue(value);</div>
<div class="line">    M_CHECK( status );</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">cgfxAttrDef::setValue( <a class="code" href="./class_m_object.html">MObject</a>&amp; oNode, <span class="keyword">const</span> <a class="code" href="./class_m_string.html">MString</a>&amp; value )</div>
<div class="line">{</div>
<div class="line"> <a class="code" href="./class_m_status.html">MStatus</a> status;</div>
<div class="line"> <a class="code" href="./class_m_plug.html">MPlug</a> plug(oNode, fAttr);</div>
<div class="line">    status = plug.setValue((<a class="code" href="./class_m_string.html">MString</a> &amp;)value);</div>
<div class="line">    M_CHECK( status );</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">cgfxAttrDef::setValue( <a class="code" href="./class_m_object.html">MObject</a>&amp; oNode, <span class="keywordtype">float</span> v1, <span class="keywordtype">float</span> v2 )</div>
<div class="line">{</div>
<div class="line"> <a class="code" href="./class_m_status.html">MStatus</a> status;</div>
<div class="line"> <a class="code" href="./class_m_plug.html">MPlug</a> plug(oNode, fAttr);</div>
<div class="line"></div>
<div class="line"> <a class="code" href="./class_m_fn_numeric_data.html">MFnNumericData</a> fnData;</div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> oData = fnData.<a name="a81"></a><a class="code" href="./class_m_fn_numeric_data.html#a82c1cfe8ea0f4ed6e13097715906d600">create</a>(<a name="a82"></a><a class="code" href="./class_m_fn_numeric_data.html#a1d1cfd8ffb84e947f82999c682b666a7af8f260603ef20b1e0c3d09de0e9c645c">MFnNumericData::k2Float</a>, &amp;status);</div>
<div class="line">    M_CHECK( status );</div>
<div class="line"></div>
<div class="line">    fnData.<a name="a83"></a><a class="code" href="./class_m_fn_numeric_data.html#a5a8685975c5472876e8e3558911a7b7b">setData</a>(v1, v2);</div>
<div class="line">    status = plug.setValue(oData);</div>
<div class="line">    M_CHECK( status );</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">cgfxAttrDef::setValue( <a class="code" href="./class_m_object.html">MObject</a>&amp; oNode, <span class="keywordtype">float</span> v1, <span class="keywordtype">float</span> v2, <span class="keywordtype">float</span> v3 )</div>
<div class="line">{</div>
<div class="line"> <a class="code" href="./class_m_status.html">MStatus</a> status;</div>
<div class="line"> <a class="code" href="./class_m_plug.html">MPlug</a> plug(oNode, fAttr);</div>
<div class="line"></div>
<div class="line"> <a class="code" href="./class_m_fn_numeric_data.html">MFnNumericData</a> fnData;</div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> oData = fnData.<a class="code" href="./class_m_fn_numeric_data.html#a82c1cfe8ea0f4ed6e13097715906d600">create</a>(<a name="a84"></a><a class="code" href="./class_m_fn_numeric_data.html#a1d1cfd8ffb84e947f82999c682b666a7a91f4ea6e351f41893ac43d373f9d647c">MFnNumericData::k3Float</a>, &amp;status);</div>
<div class="line">    M_CHECK( status );</div>
<div class="line"></div>
<div class="line">    fnData.<a class="code" href="./class_m_fn_numeric_data.html#a5a8685975c5472876e8e3558911a7b7b">setData</a>(v1, v2, v3);</div>
<div class="line">    status = plug.setValue(oData);</div>
<div class="line">    M_CHECK( status );</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">cgfxAttrDef::setValue( <a class="code" href="./class_m_object.html">MObject</a>&amp; oNode, <span class="keywordtype">float</span> v1, <span class="keywordtype">float</span> v2, <span class="keywordtype">float</span> v3, <span class="keywordtype">float</span> v4 )</div>
<div class="line">{</div>
<div class="line"> <a class="code" href="./class_m_status.html">MStatus</a> status;</div>
<div class="line"> <a class="code" href="./class_m_plug.html">MPlug</a> plug(oNode, fAttr);</div>
<div class="line"> <a class="code" href="./class_m_plug.html">MPlug</a> plug2(oNode, fAttr2);</div>
<div class="line"></div>
<div class="line"> <a class="code" href="./class_m_fn_numeric_data.html">MFnNumericData</a> fnData;</div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> oData = fnData.<a class="code" href="./class_m_fn_numeric_data.html#a82c1cfe8ea0f4ed6e13097715906d600">create</a>(<a class="code" href="./class_m_fn_numeric_data.html#a1d1cfd8ffb84e947f82999c682b666a7a91f4ea6e351f41893ac43d373f9d647c">MFnNumericData::k3Float</a>, &amp;status);</div>
<div class="line">    M_CHECK( status );</div>
<div class="line"> </div>
<div class="line">    fnData.<a class="code" href="./class_m_fn_numeric_data.html#a5a8685975c5472876e8e3558911a7b7b">setData</a>(v1, v2, v3);</div>
<div class="line">    status = plug.setValue(oData);</div>
<div class="line">    M_CHECK( status );</div>
<div class="line"></div>
<div class="line">    status = plug2.setValue(v4);</div>
<div class="line">    M_CHECK( status );</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">cgfxAttrDef::setValue( <a class="code" href="./class_m_object.html">MObject</a>&amp; oNode, <span class="keyword">const</span> <a class="code" href="./class_m_matrix.html">MMatrix</a>&amp; v )</div>
<div class="line">{</div>
<div class="line"> <a class="code" href="./class_m_status.html">MStatus</a>       status;</div>
<div class="line"> <a class="code" href="./class_m_fn_matrix_data.html">MFnMatrixData</a> fnData;</div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a>       oData = fnData.<a name="a85"></a><a class="code" href="./class_m_fn_matrix_data.html#af1adb4abaf5243c6c0749bcca7b5c418">create</a>( v, &amp;status );</div>
<div class="line">    M_CHECK( status );</div>
<div class="line"></div>
<div class="line"> <a class="code" href="./class_m_plug.html">MPlug</a> plug( oNode, fAttr );</div>
<div class="line">    status = plug.setValue( oData );</div>
<div class="line">    M_CHECK( status );</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// Utility to check if a node is used by any nodes other than us</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="keywordtype">bool</span> isUsedElsewhere( <a class="code" href="./class_m_object.html">MObject</a> node, <a class="code" href="./class_m_object.html">MObject</a> user)</div>
<div class="line">{</div>
<div class="line"> <span class="keywordflow">for</span>( <a name="_a86"></a><a class="code" href="./class_m_it_dependency_graph.html">MItDependencyGraph</a> iter( node); !iter.<a name="a87"></a><a class="code" href="./class_m_it_dependency_graph.html#ac0f0d6fc806b11d246e05cb94e886b38">isDone</a>(); iter.next())</div>
<div class="line">    {</div>
<div class="line"> <span class="comment">// If there is a downstream connection to something other than our shader ...</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <span class="keywordflow">if</span>( iter.thisNode() != node)</div>
<div class="line">        {</div>
<div class="line"> <span class="keywordflow">if</span>( iter.thisNode() != user)</div>
<div class="line">            {</div>
<div class="line"> <span class="comment">// And that connection uses anything other than the message attribute</span></div>
<div class="line"> <span class="comment">// of the texture (which is used to connect the texture to the </span></div>
<div class="line"> <span class="comment">// global texture list)</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <a class="code" href="./class_m_plug_array.html">MPlugArray</a> src;</div>
<div class="line">                iter.thisPlug().<a name="a88"></a><a class="code" href="./class_m_plug.html#a3727c18c58fc5ba8be5fb2582b5d06f1">connectedTo</a>( src, <span class="keyword">true</span>, <span class="keyword">false</span>);</div>
<div class="line"> <span class="keywordflow">if</span>( src.<a class="code" href="./class_m_plug_array.html#a580388f31f60c46fac867ca48a48da1e">length</a>() == 1 &amp;&amp; src[ 0].partialName() != <span class="stringliteral">"msg"</span>)</div>
<div class="line">                {</div>
<div class="line"> <span class="comment">// Finally, check this isn't just the swatch renderer taking</span></div>
<div class="line"> <span class="comment">// a quick look at this node</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <a class="code" href="./class_m_fn_dependency_node.html">MFnDependencyNode</a> dgFn( iter.thisNode());</div>
<div class="line"> <span class="keywordflow">if</span>( dgFn.name() != <span class="stringliteral">"swatchShadingGroup"</span>)</div>
<div class="line">                    {</div>
<div class="line"> <span class="comment">// Then we're not the only user of this node!</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <span class="comment">//cout&lt;&lt;"Not removing node due to connection&lt;&lt;src[0].name().asChar()&lt;&lt;" to "&lt;&lt;iter.thisPlug().name().asChar()&lt;&lt;endl;</span></div>
<div class="line"> <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line"> <span class="comment">// If this downstream connection is to another shader, or a</span></div>
<div class="line"> <span class="comment">// message connection, don't follow the connection any further</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line">            iter.prune();</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">cgfxAttrDef::setTexture( <a class="code" href="./class_m_object.html">MObject</a>&amp; oNode, <span class="keyword">const</span> <a class="code" href="./class_m_string.html">MString</a>&amp; value, <a class="code" href="./class_m_d_g_modifier.html">MDGModifier</a>* dgMod)</div>
<div class="line">{</div>
<div class="line"> <a class="code" href="./class_m_status.html">MStatus</a> status;</div>
<div class="line"> <a class="code" href="./class_m_plug.html">MPlug</a> plug(oNode, fAttr);</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Is this a node or name based texture?</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <a class="code" href="./class_m_fn_attribute.html">MFnAttribute</a> attrFn( fAttr);</div>
<div class="line"> <span class="keywordflow">if</span>( attrFn.isUsedAsColor() )</div>
<div class="line">    {</div>
<div class="line"> <span class="comment">// Node based texture.</span></div>
<div class="line"> <span class="comment">// Remove any existing texture</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <span class="keywordflow">if</span>( plug.isConnected())</div>
<div class="line">        {</div>
<div class="line"> <a class="code" href="./class_m_plug_array.html">MPlugArray</a> src;</div>
<div class="line">            plug.connectedTo( src, <span class="keyword">true</span>, <span class="keyword">false</span>, &amp;status);</div>
<div class="line">            M_CHECK( status );</div>
<div class="line"> <span class="keywordflow">if</span>( src.<a class="code" href="./class_m_plug_array.html#a580388f31f60c46fac867ca48a48da1e">length</a>() &gt; 0)</div>
<div class="line">            {</div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> textureNode = src[ 0].node();</div>
<div class="line"></div>
<div class="line"> <span class="comment">// If no other nodes use this texture, we can remove it to </span></div>
<div class="line"> <span class="comment">// avoid cluttering up the scene with unused texture nodes</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <span class="keywordflow">if</span>( !isUsedElsewhere( textureNode, oNode))</div>
<div class="line">                {</div>
<div class="line"> <span class="comment">// We are the only user of this texture node so we</span></div>
<div class="line"> <span class="comment">// can delete it. Before we do that though, are</span></div>
<div class="line"> <span class="comment">// we the only user of the placement node too?</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <a class="code" href="./class_m_fn_dependency_node.html">MFnDependencyNode</a> textureFn( textureNode);</div>
<div class="line"> <a class="code" href="./class_m_plug.html">MPlug</a> uvPlug = textureFn.findPlug( <span class="stringliteral">"uv"</span>, &amp;status);</div>
<div class="line"> <span class="keywordflow">if</span>( status == <a class="code" href="./class_m_status.html#a02ab596f4febca68da503aaf8dde3a80af0536797208144380691e2b376ffc1d1">MS::kSuccess</a>)</div>
<div class="line">                    {</div>
<div class="line"> <a class="code" href="./class_m_plug_array.html">MPlugArray</a> placementNode;</div>
<div class="line">                        uvPlug.<a class="code" href="./class_m_plug.html#a3727c18c58fc5ba8be5fb2582b5d06f1">connectedTo</a>( placementNode, <span class="keyword">true</span>, <span class="keyword">false</span>, &amp;status);</div>
<div class="line">                        M_CHECK( status );</div>
<div class="line"></div>
<div class="line"> <span class="comment">// If we are the only user of the placement node, delete </span></div>
<div class="line"> <span class="comment">// it as well</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <span class="keywordflow">if</span>( placementNode.<a class="code" href="./class_m_plug_array.html#a580388f31f60c46fac867ca48a48da1e">length</a>() &gt; 0 &amp;&amp;</div>
<div class="line">                            !isUsedElsewhere( placementNode[ 0].node(), textureNode))</div>
<div class="line">                        {</div>
<div class="line">                            M_CHECK( dgMod-&gt;<a name="a89"></a><a class="code" href="./class_m_d_g_modifier.html#a9e6962659554cd09e71b3d4ef2244404">deleteNode</a>( placementNode[ 0].node()) );</div>
<div class="line">                        }</div>
<div class="line">                    }</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Delete the texture node</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line">                    M_CHECK( dgMod-&gt;<a class="code" href="./class_m_d_g_modifier.html#a9e6962659554cd09e71b3d4ef2244404">deleteNode</a>( textureNode) );</div>
<div class="line">                }</div>
<div class="line"> <span class="keywordflow">else</span></div>
<div class="line">                {</div>
<div class="line"> <span class="comment">// We're not deleting the texture, so just disconnect it</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line">                    M_CHECK( dgMod-&gt;<a name="a90"></a><a class="code" href="./class_m_d_g_modifier.html#aee585c763e12aa6277000a028dbfa619">disconnect</a>( src[ 0], plug) );</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Do we have a (default) value to set?</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <span class="keywordflow">if</span>( value.<a class="code" href="./class_m_string.html#a580388f31f60c46fac867ca48a48da1e">length</a>() &gt; 0)</div>
<div class="line">        {</div>
<div class="line"> <span class="comment">// Resolve the texture value as either an absolute or</span></div>
<div class="line"> <span class="comment">// project relative path. Even though we re-resolve paths</span></div>
<div class="line"> <span class="comment">// when loading textures ourselves, if we want the Maya</span></div>
<div class="line"> <span class="comment">// texture swatch to display, Maya needs to be able to</span></div>
<div class="line"> <span class="comment">// find the texture as well.</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <a class="code" href="./class_m_string.html">MString</a> relativePath = cgfxFindFile( value, <span class="keyword">true</span> );</div>
<div class="line"></div>
<div class="line"> <span class="comment">// If we didn't find it, just leave the original path (even</span></div>
<div class="line"> <span class="comment">// though it wont work)</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <span class="keywordflow">if</span>( relativePath.<a class="code" href="./class_m_string.html#a580388f31f60c46fac867ca48a48da1e">length</a>() == 0) relativePath = value;</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Create a new file texture and placement node</span></div>
<div class="line"> <span class="comment">// Use the MEL commands (as opposed to dgMod.createNode) as these</span></div>
<div class="line"> <span class="comment">// correctly hook up the rendering message connections so our </span></div>
<div class="line"> <span class="comment">// nodes show up in the hypershade etc.</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> textureNode, placementNode;</div>
<div class="line"> <a name="_a91"></a><a class="code" href="./class_m_selection_list.html">MSelectionList</a> originalSelection, newlyCreatedNode;</div>
<div class="line"> <a name="a92"></a><a class="code" href="./class_m_global.html#a6d81d38246555884897fb153c93aaf42">MGlobal::getActiveSelectionList</a>( originalSelection);            </div>
<div class="line">            dgMod-&gt;<a name="a93"></a><a class="code" href="./class_m_d_g_modifier.html#a8df68858b554bb4efd63ce16deec6aa0">commandToExecute</a>( <span class="stringliteral">"shadingNode -asTexture file"</span> );</div>
<div class="line"> <span class="comment">// the next operation getActiveSelectionList needs the node indeed created, so force doIt.</span></div>
<div class="line">            dgMod-&gt;<a class="code" href="./class_m_d_g_modifier.html#a984345cd272bc1a32a9fc2e93a6678b2">doIt</a>();</div>
<div class="line"> <a class="code" href="./class_m_global.html#a6d81d38246555884897fb153c93aaf42">MGlobal::getActiveSelectionList</a>( newlyCreatedNode);</div>
<div class="line">            M_CHECK( newlyCreatedNode.<a name="a94"></a><a class="code" href="./class_m_selection_list.html#a99dd6a54b909ede1d11702fe58977e2a">length</a>() &gt; 0 &amp;&amp; newlyCreatedNode.<a name="a95"></a><a class="code" href="./class_m_selection_list.html#a72d8cd9c78fd234dcf68cd2fb70bc432">getDependNode</a>( 0, textureNode));         </div>
<div class="line">            dgMod-&gt;<a class="code" href="./class_m_d_g_modifier.html#a8df68858b554bb4efd63ce16deec6aa0">commandToExecute</a>( <span class="stringliteral">"shadingNode -asUtility place2dTexture"</span> );</div>
<div class="line"> <span class="comment">// the next operation getActiveSelectionList needs the node indeed created, so force doIt.</span></div>
<div class="line">            dgMod-&gt;<a class="code" href="./class_m_d_g_modifier.html#a984345cd272bc1a32a9fc2e93a6678b2">doIt</a>();</div>
<div class="line"> <a class="code" href="./class_m_global.html#a6d81d38246555884897fb153c93aaf42">MGlobal::getActiveSelectionList</a>( newlyCreatedNode);</div>
<div class="line">            M_CHECK( newlyCreatedNode.<a class="code" href="./class_m_selection_list.html#a99dd6a54b909ede1d11702fe58977e2a">length</a>() &gt; 0 &amp;&amp; newlyCreatedNode.<a class="code" href="./class_m_selection_list.html#a72d8cd9c78fd234dcf68cd2fb70bc432">getDependNode</a>( 0, placementNode));</div>
<div class="line"> <a name="a96"></a><a class="code" href="./class_m_global.html#a33e6a7c8fa1c06fd64063bd08d4e4aef">MGlobal::setActiveSelectionList</a>( originalSelection);</div>
<div class="line"> <a class="code" href="./class_m_fn_dependency_node.html">MFnDependencyNode</a> fileTextureFn( textureNode, &amp;status);</div>
<div class="line">            M_CHECK( status );</div>
<div class="line"> <a class="code" href="./class_m_fn_dependency_node.html">MFnDependencyNode</a> placementFn( placementNode, &amp;status);</div>
<div class="line">            M_CHECK( status );</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Connect the placement node to the file texture node</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line">            M_CHECK( dgMod-&gt;<a class="code" href="./class_m_d_g_modifier.html#afbd18f066f70fcd1864ddb4af91f3c7b">connect</a>( placementFn.findPlug( <span class="stringliteral">"coverage"</span>), fileTextureFn.findPlug( <span class="stringliteral">"coverage"</span>)) );</div>
<div class="line">            M_CHECK( dgMod-&gt;<a class="code" href="./class_m_d_g_modifier.html#afbd18f066f70fcd1864ddb4af91f3c7b">connect</a>( placementFn.findPlug( <span class="stringliteral">"translateFrame"</span>), fileTextureFn.findPlug( <span class="stringliteral">"translateFrame"</span>)) );</div>
<div class="line">            M_CHECK( dgMod-&gt;<a class="code" href="./class_m_d_g_modifier.html#afbd18f066f70fcd1864ddb4af91f3c7b">connect</a>( placementFn.findPlug( <span class="stringliteral">"rotateFrame"</span>), fileTextureFn.findPlug( <span class="stringliteral">"rotateFrame"</span>)) );</div>
<div class="line">            M_CHECK( dgMod-&gt;<a class="code" href="./class_m_d_g_modifier.html#afbd18f066f70fcd1864ddb4af91f3c7b">connect</a>( placementFn.findPlug( <span class="stringliteral">"mirrorU"</span>), fileTextureFn.findPlug( <span class="stringliteral">"mirrorU"</span>)) );</div>
<div class="line">            M_CHECK( dgMod-&gt;<a class="code" href="./class_m_d_g_modifier.html#afbd18f066f70fcd1864ddb4af91f3c7b">connect</a>( placementFn.findPlug( <span class="stringliteral">"mirrorV"</span>), fileTextureFn.findPlug( <span class="stringliteral">"mirrorV"</span>)) );</div>
<div class="line">            M_CHECK( dgMod-&gt;<a class="code" href="./class_m_d_g_modifier.html#afbd18f066f70fcd1864ddb4af91f3c7b">connect</a>( placementFn.findPlug( <span class="stringliteral">"stagger"</span>), fileTextureFn.findPlug( <span class="stringliteral">"stagger"</span>)) );</div>
<div class="line">            M_CHECK( dgMod-&gt;<a class="code" href="./class_m_d_g_modifier.html#afbd18f066f70fcd1864ddb4af91f3c7b">connect</a>( placementFn.findPlug( <span class="stringliteral">"wrapU"</span>), fileTextureFn.findPlug( <span class="stringliteral">"wrapU"</span>)) );</div>
<div class="line">            M_CHECK( dgMod-&gt;<a class="code" href="./class_m_d_g_modifier.html#afbd18f066f70fcd1864ddb4af91f3c7b">connect</a>( placementFn.findPlug( <span class="stringliteral">"wrapV"</span>), fileTextureFn.findPlug( <span class="stringliteral">"wrapV"</span>)) );</div>
<div class="line">            M_CHECK( dgMod-&gt;<a class="code" href="./class_m_d_g_modifier.html#afbd18f066f70fcd1864ddb4af91f3c7b">connect</a>( placementFn.findPlug( <span class="stringliteral">"repeatUV"</span>), fileTextureFn.findPlug( <span class="stringliteral">"repeatUV"</span>)) );</div>
<div class="line">            M_CHECK( dgMod-&gt;<a class="code" href="./class_m_d_g_modifier.html#afbd18f066f70fcd1864ddb4af91f3c7b">connect</a>( placementFn.findPlug( <span class="stringliteral">"offset"</span>), fileTextureFn.findPlug( <span class="stringliteral">"offset"</span>)) );</div>
<div class="line">            M_CHECK( dgMod-&gt;<a class="code" href="./class_m_d_g_modifier.html#afbd18f066f70fcd1864ddb4af91f3c7b">connect</a>( placementFn.findPlug( <span class="stringliteral">"rotateUV"</span>), fileTextureFn.findPlug( <span class="stringliteral">"rotateUV"</span>)) );</div>
<div class="line">            M_CHECK( dgMod-&gt;<a class="code" href="./class_m_d_g_modifier.html#afbd18f066f70fcd1864ddb4af91f3c7b">connect</a>( placementFn.findPlug( <span class="stringliteral">"noiseUV"</span>), fileTextureFn.findPlug( <span class="stringliteral">"noiseUV"</span>)) );</div>
<div class="line">            M_CHECK( dgMod-&gt;<a class="code" href="./class_m_d_g_modifier.html#afbd18f066f70fcd1864ddb4af91f3c7b">connect</a>( placementFn.findPlug( <span class="stringliteral">"vertexUvOne"</span>), fileTextureFn.findPlug( <span class="stringliteral">"vertexUvOne"</span>)) );</div>
<div class="line">            M_CHECK( dgMod-&gt;<a class="code" href="./class_m_d_g_modifier.html#afbd18f066f70fcd1864ddb4af91f3c7b">connect</a>( placementFn.findPlug( <span class="stringliteral">"vertexUvTwo"</span>), fileTextureFn.findPlug( <span class="stringliteral">"vertexUvTwo"</span>)) );</div>
<div class="line">            M_CHECK( dgMod-&gt;<a class="code" href="./class_m_d_g_modifier.html#afbd18f066f70fcd1864ddb4af91f3c7b">connect</a>( placementFn.findPlug( <span class="stringliteral">"vertexUvThree"</span>), fileTextureFn.findPlug( <span class="stringliteral">"vertexUvThree"</span>)) );</div>
<div class="line">            M_CHECK( dgMod-&gt;<a class="code" href="./class_m_d_g_modifier.html#afbd18f066f70fcd1864ddb4af91f3c7b">connect</a>( placementFn.findPlug( <span class="stringliteral">"vertexCameraOne"</span>), fileTextureFn.findPlug( <span class="stringliteral">"vertexCameraOne"</span>)) );</div>
<div class="line">            M_CHECK( dgMod-&gt;<a class="code" href="./class_m_d_g_modifier.html#afbd18f066f70fcd1864ddb4af91f3c7b">connect</a>( placementFn.findPlug( <span class="stringliteral">"outUV"</span>), fileTextureFn.findPlug( <span class="stringliteral">"uv"</span>)) );</div>
<div class="line">            M_CHECK( dgMod-&gt;<a class="code" href="./class_m_d_g_modifier.html#afbd18f066f70fcd1864ddb4af91f3c7b">connect</a>( placementFn.findPlug( <span class="stringliteral">"outUvFilterSize"</span>), fileTextureFn.findPlug( <span class="stringliteral">"uvFilterSize"</span>)) );</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Connect our file texture node to our shader attribute, then set the texture</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line">            M_CHECK( dgMod-&gt;<a class="code" href="./class_m_d_g_modifier.html#afbd18f066f70fcd1864ddb4af91f3c7b">connect</a>( fileTextureFn.findPlug( <span class="stringliteral">"outColor"</span>), plug) );</div>
<div class="line">            status = fileTextureFn.findPlug( <span class="stringliteral">"fileTextureName"</span>).setValue( relativePath);</div>
<div class="line">            M_CHECK( status );</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        M_CHECK( dgMod-&gt;<a class="code" href="./class_m_d_g_modifier.html#a984345cd272bc1a32a9fc2e93a6678b2">doIt</a>() );</div>
<div class="line">    }</div>
<div class="line"> <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line"> <span class="comment">// Simple String attribute - but do a safety check to be sure</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <a class="code" href="./class_m_fn_typed_attribute.html">MFnTypedAttribute</a> fnTyped;</div>
<div class="line"> <span class="keywordflow">if</span>( fnTyped.<a class="code" href="./class_m_fn_base.html#ad09f5acece0f9926b3e0e55cff78c3be">setObject</a>( fAttr ) &amp;&amp;</div>
<div class="line">            fnTyped.<a class="code" href="./class_m_fn_typed_attribute.html#aa3bf2ba724f9aaf87976b1fb896fd700">attrType</a>() == <a class="code" href="./class_m_fn_data.html#a1d1cfd8ffb84e947f82999c682b666a7afab53ea4a643325262b9c140af093279">MFnData::kString</a> )</div>
<div class="line">        {</div>
<div class="line">            status = plug.setValue((<a class="code" href="./class_m_string.html">MString</a> &amp;)value);</div>
<div class="line">            M_CHECK( status );</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> cgfxAttrDef::setUnitsToInternal( CGparameter&amp; cgParameter ) </div>
<div class="line">{</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// If the units are converted to internal, return</span></div>
<div class="line"> <span class="keywordflow">if</span> (fIsConvertedToInternal) <span class="keywordflow">return</span>;</div>
<div class="line"></div>
<div class="line">    CGannotation cgAnnotation = cgGetFirstParameterAnnotation(cgParameter);</div>
<div class="line"> <span class="keywordflow">while</span> (cgAnnotation)</div>
<div class="line">    {</div>
<div class="line"> <span class="keyword">const</span> <span class="keywordtype">char</span>* annotationName      = cgGetAnnotationName(cgAnnotation);</div>
<div class="line"> <span class="keyword">const</span> <span class="keywordtype">char</span>* annotationValue     = cgGetStringAnnotationValue(cgAnnotation);</div>
<div class="line"> <span class="keywordflow">if</span>( stricmp( annotationName, <span class="stringliteral">"units"</span> ) == 0)</div>
<div class="line">        {</div>
<div class="line"> <a class="code" href="./class_m_string.html">MString</a> unit(&amp;fSymbol);</div>
<div class="line">            unit += annotationValue;</div>
<div class="line"> <span class="comment">// Notice: _XXX is a internal unit</span></div>
<div class="line">            cgSetStringAnnotation(cgAnnotation, unit.asChar());</div>
<div class="line"> <span class="comment">// Make sure if the bind is called more than one time, no need to set to internal again</span></div>
<div class="line">            fIsConvertedToInternal = <span class="keyword">true</span>;</div>
<div class="line"> <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line">        cgAnnotation = cgGetNextAnnotation(cgAnnotation);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"><span class="comment">//--------------------------------------------------------------------//</span></div>
<div class="line"><span class="comment">//                          cgfxAttrDefList                           //</span></div>
<div class="line"><span class="comment">//--------------------------------------------------------------------//</span></div>
<div class="line"></div>
<div class="line">cgfxAttrDefList::iterator</div>
<div class="line">cgfxAttrDefList::findInsensitive( <span class="keyword">const</span> <a class="code" href="./class_m_string.html">MString</a>&amp; name )</div>
<div class="line">{</div>
<div class="line"> <span class="keyword">const</span> <span class="keywordtype">char</span>* pName = name.<a class="code" href="./class_m_string.html#aa9ab612f356c53479afc4c648c9ef94d">asChar</a>();</div>
<div class="line"> <span class="keywordtype">unsigned</span>    lName = name.<a class="code" href="./class_m_string.html#a580388f31f60c46fac867ca48a48da1e">length</a>();</div>
<div class="line">    iterator    it( *<span class="keyword">this</span> );</div>
<div class="line"> <span class="keywordflow">for</span> ( ; it; ++it )</div>
<div class="line"> <span class="keywordflow">if</span> ( lName == (*it)-&gt;fName.length() &amp;&amp;</div>
<div class="line">            0 == stricmp( pName, (*it)-&gt;fName.asChar() ) )</div>
<div class="line"> <span class="keywordflow">break</span>;</div>
<div class="line"> <span class="keywordflow">return</span> it;</div>
<div class="line">};                                     <span class="comment">// cgfxAttrDefList::findInsensitive</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> cgfxAttrDefList::release()</div>
<div class="line">{</div>
<div class="line">    --refcount;</div>
<div class="line"> <span class="keywordflow">if</span> (refcount &lt;= 0)</div>
<div class="line">    {</div>
<div class="line">        M_CHECK( refcount == 0 );</div>
<div class="line"> <span class="keyword">delete</span> <span class="keyword">this</span>;</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> cgfxAttrDefList::releaseTextures()</div>
<div class="line">{</div>
<div class="line">    iterator it(*<span class="keyword">this</span>);</div>
<div class="line"> <span class="keywordflow">while</span> (it)</div>
<div class="line">    {</div>
<div class="line">        (*it)-&gt;release();</div>
<div class="line">        ++it;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> cgfxAttrDefList::dump(<span class="keyword">const</span> <span class="keywordtype">char</span>* name)</div>
<div class="line">{</div>
<div class="line">    fprintf(stderr, <span class="stringliteral">"Dumping cgfxAttrDefList %s : \n"</span>, name);</div>
<div class="line"> </div>
<div class="line"> <span class="keywordflow">for</span> (cgfxAttrDefList::iterator it = begin(); it; ++it) {</div>
<div class="line">        cgfxAttrDef* aDef = (*it);</div>
<div class="line">        fprintf(</div>
<div class="line">            stderr,</div>
<div class="line"> <span class="stringliteral">"   name=%s, type=%s, size=%d, attr=%s, hint=%d, attr2=%s, def=%s, desc=%s, semantic=%s, CGParameter=0x%p\n"</span>,</div>
<div class="line">            aDef-&gt;fName.asChar(),</div>
<div class="line">            cgfxAttrDef::typeName(aDef-&gt;fType),</div>
<div class="line">            aDef-&gt;fSize,</div>
<div class="line">            aDef-&gt;fAttr.apiTypeStr(),</div>
<div class="line">            aDef-&gt;fHint,</div>
<div class="line">            aDef-&gt;fAttr2.apiTypeStr(),</div>
<div class="line">            aDef-&gt;fStringDef.asChar(),</div>
<div class="line">            aDef-&gt;fDescription.asChar(),</div>
<div class="line">            aDef-&gt;fSemantic.asChar(),</div>
<div class="line">            aDef-&gt;fParameterHandle</div>
<div class="line">        );</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<div class="footer-block"><a class="comments-anchor" href="../html/ac.cmtdialog.htm" target="_blank"><span class="comments-link">Please send us your comment about this page</span></a></div><br/></div>
</link></link></link></link></div></body>
</html>
