<!-- saved from url=(0024)http://docs.autodesk.com -->
<html>
 <head>
  <script src="../scripts/yepnope.1.5.4-min.js" type="text/javascript">
  </script>
  <script src="../scripts/lib/jquery-1.11.1.min.js" type="text/javascript">
  </script>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
   <meta content="MAYAUL" name="product">
    <meta content="2016" name="release">
     <meta content="Developer" name="book">
      <meta content="2015-10-14" name="created">
       <meta content="GUID-02DEF634-1E7B-48C6-8ACD-2C934CA97887" name="topicid">
        <meta content="concept" name="topic-type">
         <title>
          hairCollisionSolver/hairCollisionSolver.cpp
         </title>
         <meta content="C++" name="topic-subtype"/>
        </meta>
       </meta>
      </meta>
     </meta>
    </meta>
   </meta>
  </meta>
 </head>
 <body height="100%">
  <div class="body_content" id="body-content">
   <link href="cpp_ref/navtree.css" rel="stylesheet" type="text/css">
    <link href="cpp_ref/doxygen.css" rel="stylesheet" type="text/css">
     <link href="cpp_ref/tabs.css" rel="stylesheet" type="text/css">
      <link href="style/adsk.cpm.css" rel="stylesheet" type="text/css">
       <script language="javascript">
        var index = 'index.html';
       </script>
       <script>
        $(document).ready(function() { yepnope.injectJs("./scripts/ac_common.js"); });
       </script>
       <script type="text/javascript">
        var tocSystemNeedsToBeLoaded = typeof(cpp_ref_adsk_ref_toc) == 'undefined';
var weAreIn21 = $('div#main.view-active').length;
var tocPrefix = '';
if (weAreIn21)
{ tocPrefix = 'cpp_ref/'; }
function cpp_ref_initializeToc(forceTrigger) {
    cpp_ref_adsk_ref_toc.initResizable();
    cpp_ref_adsk_ref_toc.initNavTree('hair_collision_solver_2hair_collision_solver_8cpp-example.html', tocPrefix);
    dQuery(document).trigger('toc_initialized');
}
if (tocSystemNeedsToBeLoaded)
{
	yepnope([{
	load:[tocPrefix + 'json3.min.js', tocPrefix + 'jquery.js', tocPrefix + 'ref-toc-controller.js', tocPrefix + 'dynsections.js'],
	complete: function() {
	  if (typeof(dQuery) == 'undefined')
	  {
	    dQuery = jQuery.noConflict(true);
	  }
	  else { jQuery.noConflict(true); }
	  $(document).ready(cpp_ref_initializeToc);
	}
 	}])
}
if (!weAreIn21) { // if in AKN...
$(window).load( function() {
    setTimeout( function() {
        var content = $('body > div').not('#body-content');     // take any divs under body that are not id=body-content
        content.each( function() { 
            $(this).css( { 'padding-left': $(this).css('margin-left') } );       // and if they have any padding-left already, move it to margin-left.
        } );
        var width = cpp_ref_adsk_ref_toc.readFromStorage('width');
        content.css({marginLeft:parseInt(width)+6+"px"});
    }, 100);
} ); 
}
       </script>
       <script>
        $("div#WidgetFloaterPanels,link[href*='microsofttranslator.com'],script[src*='microsofttranslator.com'],script[src*='bing.com']").remove();
       </script>
       <script type="text/javascript">
        $("div#navigation,div#breadcrumbs,div#banner").attr("translate","no"); var mtLocation = ((location && location.href && location.href.indexOf('https') == 0)?'https://ssl.microsofttranslator.com':'http://www.microsofttranslator.com')+'/ajax/v3/WidgetV3.ashx?siteData=y5CYlxTRD0znCzRLDwX0Wy7-g1EdC1XA4dSC-Y1LtaeScyli8_Ps5jPKqTr4xKxMI0OOUfkDplvX3uxN0JnPclebSYW8_J1HBzf4VLQEzQ8M4PsYXF_cMyp1Oumaetky&category=5297189e-446b-459e-ae1d-9d0360400781_tech&ctf=True&ui=true&settings=Manual&from=en&hidelanguages='; yepnope.injectJs(mtLocation, function() {}, { charset:'utf-8', type:'text/javascript' } );
       </script>
       <script>
        if (!tocSystemNeedsToBeLoaded) { cpp_ref_initializeToc(); }
       </script>
       <!-- begin MT -->
       <div class="Dark" id="MicrosoftTranslatorWidget" style="position:absolute;right:20px;top:5px;z-index:100;color:white;background-color:#555555;height:58px;overflow:hidden">
       </div>
       <div>
        <div class="head">
         <h1>
          hairCollisionSolver/hairCollisionSolver.cpp
         </h1>
        </div>
        <div id="top">
         <!-- Generated by Doxygen 1.8.10 -->
         <div class="tabs" id="navrow1">
          <ul class="tablist">
           <li>
            <a href="./index.html">
             <span>
              MainÂ Page
             </span>
            </a>
           </li>
           <li>
            <a href="./pages.html">
             <span>
              Topics
             </span>
            </a>
           </li>
           <li>
            <a href="./modules.html">
             <span>
              Modules
             </span>
            </a>
           </li>
           <li>
            <a href="./namespaces.html">
             <span>
              Namespaces
             </span>
            </a>
           </li>
           <li>
            <a href="./annotated.html">
             <span>
              Classes
             </span>
            </a>
           </li>
           <li>
            <a href="./examples.html">
             <span>
              Examples
             </span>
            </a>
           </li>
          </ul>
         </div>
        </div>
        <!-- top -->
        <div class="ui-resizable side-nav-resizable" id="side-nav">
         <div id="nav-tree">
          <div id="nav-tree-contents">
           <div class="sync" id="nav-sync">
           </div>
          </div>
         </div>
         <div class="ui-resizable-handle" id="splitbar" style="-moz-user-select:none;">
         </div>
        </div>
        <div id="doc-content">
         <div class="header">
          <div class="headertitle">
           <div class="title">
            hairCollisionSolver/hairCollisionSolver.cpp
           </div>
          </div>
         </div>
         <!--header-->
         <div class="contents">
          <div class="fragment">
           <div class="line">
            <span class="comment">
             //-
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // ==========================================================================
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // Copyright 1995,2006,2008 Autodesk, Inc. All rights reserved.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // Use of this software is subject to the terms of the Autodesk
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // license agreement provided at the time of installation or download,
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // or which otherwise accompanies this software in either electronic
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // or hard copy form.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // ==========================================================================
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //+
            </span>
           </div>
           <div class="line">
           </div>
           <div class="line">
            <span class="preprocessor">
             #include &lt;maya/MIOStream.h&gt;
            </span>
           </div>
           <div class="line">
            <span class="preprocessor">
             #include &lt;maya/MStatus.h&gt;
            </span>
           </div>
           <div class="line">
            <span class="preprocessor">
             #include &lt;maya/MDagPath.h&gt;
            </span>
           </div>
           <div class="line">
            <span class="preprocessor">
             #include &lt;maya/MFloatPointArray.h&gt;
            </span>
           </div>
           <div class="line">
            <span class="preprocessor">
             #include &lt;maya/MObject.h&gt;
            </span>
           </div>
           <div class="line">
            <span class="preprocessor">
             #include &lt;maya/MPlugArray.h&gt;
            </span>
           </div>
           <div class="line">
            <span class="preprocessor">
             #include &lt;maya/MFnDependencyNode.h&gt;
            </span>
           </div>
           <div class="line">
            <span class="preprocessor">
             #include &lt;maya/MFnDagNode.h&gt;
            </span>
           </div>
           <div class="line">
            <span class="preprocessor">
             #include &lt;maya/MFnMesh.h&gt;
            </span>
           </div>
           <div class="line">
            <span class="preprocessor">
             #include &lt;maya/MHairSystem.h&gt;
            </span>
           </div>
           <div class="line">
            <span class="preprocessor">
             #include &lt;maya/MFnPlugin.h&gt;
            </span>
           </div>
           <div class="line">
           </div>
           <div class="line">
            <span class="preprocessor">
             #include &lt;math.h&gt;
            </span>
           </div>
           <div class="line">
           </div>
           <div class="line">
            <span class="preprocessor">
             #define kPluginName     "hairCollisionSolver"
            </span>
           </div>
           <div class="line">
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // OVERVIEW:
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // This plug-in implements a custom collision solver for Maya's dynamic
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // hair system. This allows users to override the following aspects of
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // Maya's dynamic hair systems:
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //      o Override the Maya dynamic hair system's object-to-hair
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //        collision algorithm with a user-defined algorithm.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //      o Optionally perform global filtering on hair, such as freeze,
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //        smoothing, etc.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // It should be noted that Maya's dynamic hair system involves four
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // arears of collision detection, and this plug-in is specific to the
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // Hair-to-Object aspect only. The four areas collision which the Maya
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // dynamic hair system involves are:
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //      1) Hair to object collision.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //      2) Hair to implicit object collision.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //      3) Hair to ground plane collision.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //      4) Self collision between hairs.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // This plug-in illustrates the first case, overriding Maya's internal
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // Hair-to-Object collision solver. There is currently no API for over-
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // riding the other three collision solvers.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // RATIONALE:
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // There are several reasons why are user may wish to override Maya's
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // internal hair to object collision algorithm. These are:
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //      1) The internal algorithm may not be accurate enough. After all,
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //         it is a simulation of real-life physics and there are tradeoffs
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //         taken to provide reasonable performance. Note that there are
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //         means of increasing the accuracy without writing a custom
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //         implementation, such as decreasing the dynamics time step, or
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //         increasing the hair width.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //      2) The built-in algorithm might be too accurate. If you only want
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //         simplified collisions, such as against a bounding box repre-
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //         sentation instead of the internal algorithm's exhasutive test-
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //         ing against each surface of the object, you could write a
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //         lighter-weight implementation.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //      3) You might have a desire to process the hairs, such as smooth
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //         them out.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // STRATEGY:
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // The basic idea is to implement a custom callback which is registered
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // via MHairSystem::registerCollisionSolverCollide(). Your callback will
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // then be invoked in place of Maya's internal collision solver. By simply
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // registering a collision solver, you can completely implement a custom
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // hair-to-object solution.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // However, since the collision solver is called once per hair times the
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // number of solver iterations, it is wise to pre-process the data if
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // possible to speed up the collision tests. For this reason, you can
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // assign a pre-frame callback. One approach is to create a pre-processed
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // representation of your object pre-frame (e.g. an octree representation)
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // and then access this representation during the collision testing.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // For the purposes of our simple demo plug-in, our private data will
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // consist of a COLLISION_INFO which contains an array of COLLISION_OBJ
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // structures, each one holding the bounding box of the object in world
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // space.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // One issue with pre-processing the data involves managing the private
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // data. A collision object could be deleted or turned off during a
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // simulation. One way to cleanly manage such data is to store your
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // private data on a typed attribute which is added to the node. You
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // would build your private data once at the start of simulation in your
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // pre-frame callback (keep track of the current time, and if the curTime
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // passed in is less than what you store locally, assume the playback
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // has restarted from the beginning -- or the user is being silly and
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // trying to play the simulation backwards :-) Since it is relatively
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // expensive to look up a dynamic attribute value, and the collide()
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // callback can get triggered 1000's of times per frame, for efficiency
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // you can pass back your private data as a pointer from your pre-frame
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // routine, and this pointer is then passed directly into your collide()
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // callback.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <span class="keyword">
             typedef
            </span>
            <span class="keyword">
             struct
            </span>
            {
           </div>
           <div class="line">
            <span class="keywordtype">
             int
            </span>
            numVerts;
            <span class="comment">
             // Number of vertices in object.
            </span>
           </div>
           <div class="line">
            <span class="keywordtype">
             double
            </span>
            minx;
            <span class="comment">
             // Bounding box minimal extrema.
            </span>
           </div>
           <div class="line">
            <span class="keywordtype">
             double
            </span>
            miny;
            <span class="comment">
             // Bounding box minimal extrema.
            </span>
           </div>
           <div class="line">
            <span class="keywordtype">
             double
            </span>
            minz;
            <span class="comment">
             // Bounding box minimal extrema.
            </span>
           </div>
           <div class="line">
            <span class="keywordtype">
             double
            </span>
            maxx;
            <span class="comment">
             // Bounding box maximal extrema.
            </span>
           </div>
           <div class="line">
            <span class="keywordtype">
             double
            </span>
            maxy;
            <span class="comment">
             // Bounding box maximal extrema.
            </span>
           </div>
           <div class="line">
            <span class="keywordtype">
             double
            </span>
            maxz;
            <span class="comment">
             // Bounding box maximal extrema.
            </span>
           </div>
           <div class="line">
            } COLLISION_OBJ ;
           </div>
           <div class="line">
           </div>
           <div class="line">
            <span class="keyword">
             typedef
            </span>
            <span class="keyword">
             struct
            </span>
            {
           </div>
           <div class="line">
            <span class="keywordtype">
             int
            </span>
            numObjs;
            <span class="comment">
             // Number of collision objects.
            </span>
           </div>
           <div class="line">
            COLLISION_OBJ   *objs;
            <span class="comment">
             // Array of per-object info.
            </span>
           </div>
           <div class="line">
            } COLLISION_INFO ;
           </div>
           <div class="line">
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // Synopsis:
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //      bool    preFrame( hairSystem, curTime, privateData )
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // Description:
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //      This callback is invoked once at the start of each frame, allowing
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //  the user to perform any pre-processing as they see fit, such as build-
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //  ing or updating private collision-detection structures.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //      Note: it is possible for collision objects to change between
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //  frames during a simulation (for example, the user could delete a col-
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //  lision object), so if you choose to store your pre-processed data, it
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //  is critical to track any edits or deletions to the collision object
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //  to keep your pre-processed data valid.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //      There are lots of hints for writing an effective pre-frame call-
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //  back in the STRATEGY section listed earlier in this file.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // Parameters:
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //      MObject hairSystem  : (in)  The hair system shape node.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //      double  curTime     : (in)  Current time in seconds.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //      void    **privateData:(out) Allows the user to return a private
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //                                  data pointer to be passed into their
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //                                  collision solver. If you store your
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //                                  pre-processed data in data structure
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //                                  which is difficult to access, such as
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //                                  on a typed attribute, this provides
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //                                  an easy way to provide the pointer.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // Returns:
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //      bool    true        : Successfully performed any needed initial-
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //                            isation for the hair simulation this frame.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //      bool    false       : An error was detected.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <span class="comment">
            </span>
           </div>
           <div class="line">
           </div>
           <div class="line">
            <span class="keywordtype">
             bool
            </span>
            preFrame(
           </div>
           <div class="line">
            <span class="keyword">
             const
            </span>
            <a name="_a0">
            </a>
            <a class="code" href="./class_m_object.html">
             MObject
            </a>
            hairSystem,
           </div>
           <div class="line">
            <span class="keyword">
             const
            </span>
            <span class="keywordtype">
             double
            </span>
            curTime,
           </div>
           <div class="line">
            <span class="keywordtype">
             void
            </span>
            **privateData )
           </div>
           <div class="line">
            {
           </div>
           <div class="line">
            <a name="_a1">
            </a>
            <a class="code" href="./class_m_status.html">
             MStatus
            </a>
            status;
           </div>
           <div class="line">
           </div>
           <div class="line">
            <span class="comment">
             // If you need want to perform any preprocessing on your collision
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // objects pre-frame, do it here. One option for storing the pre-
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // processed data is on a typed attribute on the hairSystem node.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // That data could be fetched and updated here.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // In our example, we'll just compute a bounding box here and NOT use
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // attribute storage. That is an exercise for the reader.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <a name="_a2">
            </a>
            <a class="code" href="./class_m_fn_dependency_node.html">
             MFnDependencyNode
            </a>
            fnHairSystem( hairSystem, &amp;status );
           </div>
           <div class="line">
            <a name="a3">
            </a>
            <a class="code" href="./group___macros.html#ga1c1d4871f9859a07b14c0218a3609fd9">
             CHECK_MSTATUS_AND_RETURN
            </a>
            ( status,
            <span class="keyword">
             false
            </span>
            );
           </div>
           <div class="line">
            fprintf( stderr,
           </div>
           <div class="line">
            <span class="stringliteral">
             "preFrame: calling hairSystem node=`%s', time=%g\n"
            </span>
            ,
           </div>
           <div class="line">
            fnHairSystem.name().asChar(), curTime );
           </div>
           <div class="line">
            <a name="_a4">
            </a>
            <a class="code" href="./class_m_object_array.html">
             MObjectArray
            </a>
            cols;
           </div>
           <div class="line">
            <a name="_a5">
            </a>
            <a class="code" href="./class_m_int_array.html">
             MIntArray
            </a>
            logIdxs;
           </div>
           <div class="line">
            <a class="code" href="./group___macros.html#ga1c1d4871f9859a07b14c0218a3609fd9">
             CHECK_MSTATUS_AND_RETURN
            </a>
            (
            <a name="a6">
            </a>
            <a class="code" href="./class_m_hair_system.html#a0aed534fe1495976805ff9848853b3b4">
             MHairSystem::getCollisionObject
            </a>
            ( hairSystem,
           </div>
           <div class="line">
            cols, logIdxs ),
            <span class="keyword">
             false
            </span>
            );
           </div>
           <div class="line">
            <span class="keywordtype">
             int
            </span>
            nobj = cols.length();
           </div>
           <div class="line">
           </div>
           <div class="line">
            <span class="comment">
             // Allocate private data.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // This allows us to pre-process data on a pre-frame basis to avoid
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // calculating it per hair inside the collide() call. As noted earlier
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // we could allocate this in preFrame() and hang it off the hairSystem
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // node via a dynamic attribute.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // Instead we'll allocate it here.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            COLLISION_INFO *collisionInfo = (COLLISION_INFO *) malloc(
           </div>
           <div class="line">
            <span class="keyword">
             sizeof
            </span>
            ( COLLISION_INFO ) );
           </div>
           <div class="line">
            collisionInfo-&gt;objs = (COLLISION_OBJ *) malloc(
           </div>
           <div class="line">
            nobj *
            <span class="keyword">
             sizeof
            </span>
            ( COLLISION_OBJ ) );
           </div>
           <div class="line">
            collisionInfo-&gt;numObjs = nobj;
           </div>
           <div class="line">
           </div>
           <div class="line">
            <span class="comment">
             // Create the private data that we'll make available to the collide
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // method. The data should actually be stored in a way that it can
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // be cleaned up (such as storing the pointer on the hairSystem node
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // using a dynamic attribute). As it stands right now, there is a
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // memory leak with this plug-in because the memory we're allocating
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // for the private data is never cleaned up.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // Note that when using the dynamic attribute approach, it is still
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // wise to set *privateData because this avoids the need to look up
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // the plug inside the collide() routine which is a high-traffic
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // method.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            *privateData = (
            <span class="keywordtype">
             void
            </span>
            *) collisionInfo;
           </div>
           <div class="line">
           </div>
           <div class="line">
            <span class="comment">
             // Loop through the collision objects and pre-process, storing the
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // results in the collisionInfo structure.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <span class="keywordtype">
             int
            </span>
            obj;
           </div>
           <div class="line">
            <span class="keywordflow">
             for
            </span>
            ( obj = 0; obj &lt; nobj; ++obj ) {
           </div>
           <div class="line">
            <span class="comment">
             // Get the ith collision geometry we are connected to.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <a class="code" href="./class_m_object.html">
             MObject
            </a>
            colObj = cols[obj];
           </div>
           <div class="line">
           </div>
           <div class="line">
            <span class="comment">
             // Get the DAG path for the collision object so we can transform
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // the vertices to world space.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <a name="_a7">
            </a>
            <a class="code" href="./class_m_fn_dag_node.html">
             MFnDagNode
            </a>
            fnDagNode( colObj, &amp;status );
           </div>
           <div class="line">
            <a class="code" href="./group___macros.html#ga1c1d4871f9859a07b14c0218a3609fd9">
             CHECK_MSTATUS_AND_RETURN
            </a>
            ( status,
            <span class="keyword">
             false
            </span>
            );
           </div>
           <div class="line">
            <a name="_a8">
            </a>
            <a class="code" href="./class_m_dag_path.html">
             MDagPath
            </a>
            path;
           </div>
           <div class="line">
            status = fnDagNode.getPath( path );
           </div>
           <div class="line">
            <a class="code" href="./group___macros.html#ga1c1d4871f9859a07b14c0218a3609fd9">
             CHECK_MSTATUS_AND_RETURN
            </a>
            ( status,
            <span class="keyword">
             false
            </span>
            );
           </div>
           <div class="line">
            <a name="_a9">
            </a>
            <a class="code" href="./class_m_fn_mesh.html">
             MFnMesh
            </a>
            fnMesh( path, &amp;status );
           </div>
           <div class="line">
            <span class="keywordflow">
             if
            </span>
            (
            <a name="a10">
            </a>
            <a class="code" href="./class_m_status.html#a02ab596f4febca68da503aaf8dde3a80af0536797208144380691e2b376ffc1d1">
             MS::kSuccess
            </a>
            != status ) {
           </div>
           <div class="line">
            fprintf( stderr,
           </div>
           <div class="line">
            <span class="stringliteral">
             "%s:%d: collide was not passed a valid mesh shape\n"
            </span>
            ,
           </div>
           <div class="line">
            __FILE__, __LINE__ );
           </div>
           <div class="line">
            <span class="keywordflow">
             return
            </span>
            (
            <span class="keyword">
             false
            </span>
            );
           </div>
           <div class="line">
            }
           </div>
           <div class="line">
           </div>
           <div class="line">
            <span class="comment">
             // Get the vertices of the object transformed to world space.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <a name="_a11">
            </a>
            <a class="code" href="./class_m_float_point_array.html">
             MFloatPointArray
            </a>
            verts;
           </div>
           <div class="line">
            status = fnMesh.getPoints( verts,
            <a name="a12">
            </a>
            <a class="code" href="./class_m_space.html#ab11a1dda34491acff014ddfc9e6bafb8a45a60f04ac9114f0d6e865a6285f40b2">
             MSpace::kWorld
            </a>
            );
           </div>
           <div class="line">
            <a class="code" href="./group___macros.html#ga1c1d4871f9859a07b14c0218a3609fd9">
             CHECK_MSTATUS_AND_RETURN
            </a>
            ( status,
            <span class="keyword">
             false
            </span>
            );
           </div>
           <div class="line">
           </div>
           <div class="line">
            <span class="comment">
             // Compute the bounding box for the collision object.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // As this is a quick and dirty demo, we'll just support collisions
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // between hair and the bbox.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <span class="keywordtype">
             double
            </span>
            minx, miny, minz, maxx, maxy, maxz, x, y, z;
           </div>
           <div class="line">
            minx = maxx = verts[0].x;
           </div>
           <div class="line">
            miny = maxy = verts[0].y;
           </div>
           <div class="line">
            minz = maxz = verts[0].z;
           </div>
           <div class="line">
            <span class="keywordtype">
             int
            </span>
            nv = verts.
            <a name="a13">
            </a>
            <a class="code" href="./class_m_float_point_array.html#a580388f31f60c46fac867ca48a48da1e">
             length
            </a>
            ();
           </div>
           <div class="line">
            <span class="keywordtype">
             int
            </span>
            i;
           </div>
           <div class="line">
            <span class="keywordflow">
             for
            </span>
            ( i = 1; i &lt; nv; ++i ) {
           </div>
           <div class="line">
            x = verts[i].x;
           </div>
           <div class="line">
            y = verts[i].y;
           </div>
           <div class="line">
            z = verts[i].z;
           </div>
           <div class="line">
           </div>
           <div class="line">
            <span class="keywordflow">
             if
            </span>
            ( x &lt; minx ) {
           </div>
           <div class="line">
            minx = x;
           </div>
           <div class="line">
            }
           </div>
           <div class="line">
            <span class="keywordflow">
             if
            </span>
            ( y &lt; miny ) {
           </div>
           <div class="line">
            miny = y;
           </div>
           <div class="line">
            }
           </div>
           <div class="line">
            <span class="keywordflow">
             if
            </span>
            ( z &lt; minz ) {
           </div>
           <div class="line">
            minz = z;
           </div>
           <div class="line">
            }
           </div>
           <div class="line">
           </div>
           <div class="line">
            <span class="keywordflow">
             if
            </span>
            ( x &gt; maxx ) {
           </div>
           <div class="line">
            maxx = x;
           </div>
           <div class="line">
            }
           </div>
           <div class="line">
            <span class="keywordflow">
             if
            </span>
            ( y &gt; maxy ) {
           </div>
           <div class="line">
            maxy = y;
           </div>
           <div class="line">
            }
           </div>
           <div class="line">
            <span class="keywordflow">
             if
            </span>
            ( z &gt; maxz ) {
           </div>
           <div class="line">
            maxz = z;
           </div>
           <div class="line">
            }
           </div>
           <div class="line">
            }
           </div>
           <div class="line">
           </div>
           <div class="line">
            <span class="comment">
             // Store this precomputed informantion into our private data
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // structure.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            collisionInfo-&gt;objs[obj].numVerts = nv;
           </div>
           <div class="line">
            collisionInfo-&gt;objs[obj].minx = minx;
           </div>
           <div class="line">
            collisionInfo-&gt;objs[obj].miny = miny;
           </div>
           <div class="line">
            collisionInfo-&gt;objs[obj].minz = minz;
           </div>
           <div class="line">
            collisionInfo-&gt;objs[obj].maxx = maxx;
           </div>
           <div class="line">
            collisionInfo-&gt;objs[obj].maxy = maxy;
           </div>
           <div class="line">
            collisionInfo-&gt;objs[obj].maxz = maxz;
           </div>
           <div class="line">
            fprintf( stderr,
            <span class="stringliteral">
             "Inside preFrameInit, bbox=%g %g %g %g %g %g\n"
            </span>
            ,
           </div>
           <div class="line">
            minx,miny,minz,maxx,maxy,maxz);
           </div>
           <div class="line">
            }
           </div>
           <div class="line">
           </div>
           <div class="line">
            <span class="keywordflow">
             return
            </span>
            (
            <span class="keyword">
             true
            </span>
            );
           </div>
           <div class="line">
            }
           </div>
           <div class="line">
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // Synopsis:
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //      bool    belowCollisionPlane( co, pnt )
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // Description:
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //      Test if `pnt' is directly below the collision plane of `co'.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // Parameters:
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //      COLLISION_OBJ   *co : (in)  The collision object to test against.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //      MVector         &amp;pnt: (in)  Point to test.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // Returns:
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //      bool    true        : The `pnt' is directly below the collision
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //                            plane specified by `co'.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //      bool    false       : The `pnt' is not directly below the collis-
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //                            ion plane specified by `co'.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <span class="comment">
            </span>
           </div>
           <div class="line">
           </div>
           <div class="line">
            <span class="keywordtype">
             bool
            </span>
            belowCollisionPlane(
            <span class="keyword">
             const
            </span>
            COLLISION_OBJ *co,
            <span class="keyword">
             const
            </span>
            <a name="_a14">
            </a>
            <a class="code" href="./class_m_vector.html">
             MVector
            </a>
            &amp;pnt )
           </div>
           <div class="line">
            {
           </div>
           <div class="line">
            <span class="keywordflow">
             return
            </span>
            (    pnt.
            <a name="a15">
            </a>
            <a class="code" href="./class_m_vector.html#af88b946fb90d5f08b5fb740c70e98c10">
             x
            </a>
            &gt; co-&gt;minx &amp;&amp; pnt.
            <a class="code" href="./class_m_vector.html#af88b946fb90d5f08b5fb740c70e98c10">
             x
            </a>
            &lt; co-&gt;maxx
           </div>
           <div class="line">
            &amp;&amp; pnt.
            <a name="a16">
            </a>
            <a class="code" href="./class_m_vector.html#ab927965981178aa1fba979a37168db2a">
             y
            </a>
            &lt; co-&gt;maxy
           </div>
           <div class="line">
            &amp;&amp; pnt.
            <a name="a17">
            </a>
            <a class="code" href="./class_m_vector.html#ab3e6ed577a7c669c19de1f9c1b46c872">
             z
            </a>
            &gt; co-&gt;minz &amp;&amp; pnt.
            <a class="code" href="./class_m_vector.html#ab3e6ed577a7c669c19de1f9c1b46c872">
             z
            </a>
            &lt; co-&gt;maxz );
           </div>
           <div class="line">
            }
           </div>
           <div class="line">
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // Synopsis:
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //      MStatus collide( hairSystem, follicleIndex, hairPositions,
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //                      hairPositionsLast, hairWidths, startIndex,
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //                      endIndex, curTime, friction, privateData )
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // Description:
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //      This callback is invoked by Maya to test if a collision exists be-
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //  tween the follicle (defined by `hairPositions', `hairPositionsLast'
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //  and `hairWidths') and the collision objects associated with the
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //  hairSystem. If a collision is detected, this routine should adjust
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //  `hairPositions' to compensate. The `hairPositionsLast' can also be
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //  modified to adjust the velocity, but this should only be a dampening
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //  effect as the hair solver expects collisions to be dampened,
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //      This method is invoked often (actually its once per hair times the
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //  hairSystem shape's iterations factor). Thus with 10,000 follicles it
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //  would be called 80,000 times per frame (Note: as of Maya 7.0, the
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //  iterations factor is multipled by 2, so at its default value of 4, you
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //  get 8x calls. However, if you set iterations=0, it clamps to 1x calls).
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // Parameters:
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //      MObject hairSystem  : (in)  The hair system shape node.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //      int     follicleIndex:(in)  Which follicle we are processing.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //                                  You can get the follicle node if you
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //                                  wish via MHairSystem::getFollicle().
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //      MVectorArray &amp;hairPositions:
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //                            (mod) Array of locations in world space
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //                                  where the hair system is trying to
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //                                  move the follicle. The first entry
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //                                  corresponds to the root of the hair
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //                                  and the last entry to the tip. If a
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //                                  collision is detected, these values
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //                                  should be updated appropriately.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //                                  Note that hairPositions can change
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //                                  from iteration to iteration on the
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //                                  same hair and same frame. You can set
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //                                  a position, and then find the hair has
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //                                  moved a bit the next iteration. There
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //                                  are two reasons for this phenomenom:
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //                                    1) Other collisions could occur,
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //                                       including self collision.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //                                    2) Stiffness is actually applied PER
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //                                       ITERATION.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //      MVectorArray &amp;hairPositionsLast:
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //                            (mod) Array of the position at the previous
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //                                  time for each entry in `hairPositions'.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //      MDoubleArray &amp;hairWidths:
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //                            (in)  Array of widths, representing the
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //                                  width of the follcle at each entry in
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //                                  `hairPositions'.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //      int     startIndex  : (in)  First index in `hairPositions' we
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //                                  can move. This will be 0 unless the
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //                                  root is locked in which case it will
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //                                  be 1.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //      int     endIndex    : (in)  Last index in `hairPositions' we can
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //                                  move. Will be the full array (N-1)
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //                                  unless the tip is locked.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //      double  curTime     : (in)  Start of current time interval.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //      double  friction    : (in)  Frictional coefficient.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //      void    *privateData: (in)  If a privateData record was returned
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //                                  from preFrame() it will be passed in
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //                                  here. This is an optimisation to save
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //                                  expensive lookups of your private data
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //                                  if stored on the node.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // Returns:
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //      bool    true        : Successfully performed collision testing and
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //                            adjustment of the hair array data.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //      bool    false       : An error occurred.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <span class="comment">
            </span>
           </div>
           <div class="line">
           </div>
           <div class="line">
            <span class="preprocessor">
             #define EPSILON 0.0001
            </span>
           </div>
           <div class="line">
           </div>
           <div class="line">
            <span class="keywordtype">
             bool
            </span>
            collide(
           </div>
           <div class="line">
            <span class="keyword">
             const
            </span>
            <a class="code" href="./class_m_object.html">
             MObject
            </a>
            hairSystem,
           </div>
           <div class="line">
            <span class="keyword">
             const
            </span>
            <span class="keywordtype">
             int
            </span>
            follicleIndex,
           </div>
           <div class="line">
            <a name="_a18">
            </a>
            <a class="code" href="./class_m_vector_array.html">
             MVectorArray
            </a>
            &amp;hairPositions,
           </div>
           <div class="line">
            <a class="code" href="./class_m_vector_array.html">
             MVectorArray
            </a>
            &amp;hairPositionsLast,
           </div>
           <div class="line">
            <span class="keyword">
             const
            </span>
            <a name="_a19">
            </a>
            <a class="code" href="./class_m_double_array.html">
             MDoubleArray
            </a>
            &amp;hairWidths,
           </div>
           <div class="line">
            <span class="keyword">
             const
            </span>
            <span class="keywordtype">
             int
            </span>
            startIndex,
           </div>
           <div class="line">
            <span class="keyword">
             const
            </span>
            <span class="keywordtype">
             int
            </span>
            endIndex,
           </div>
           <div class="line">
            <span class="keyword">
             const
            </span>
            <span class="keywordtype">
             double
            </span>
            curTime,
           </div>
           <div class="line">
            <span class="keyword">
             const
            </span>
            <span class="keywordtype">
             double
            </span>
            friction,
           </div>
           <div class="line">
            <span class="keyword">
             const
            </span>
            <span class="keywordtype">
             void
            </span>
            *privateData )
           </div>
           <div class="line">
            {
           </div>
           <div class="line">
            <span class="comment">
             // Get the private data for the collision objects which was returned
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // from preFrame().
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            COLLISION_INFO *ci = (COLLISION_INFO *) privateData;
           </div>
           <div class="line">
            <span class="keywordflow">
             if
            </span>
            ( !ci ) {
           </div>
           <div class="line">
            fprintf( stderr,
            <span class="stringliteral">
             "%s:%d: collide() privateData pointer is NULL\n"
            </span>
            ,
           </div>
           <div class="line">
            __FILE__, __LINE__ );
           </div>
           <div class="line">
            <span class="keywordflow">
             return
            </span>
            (
            <span class="keyword">
             false
            </span>
            );
           </div>
           <div class="line">
            }
           </div>
           <div class="line">
           </div>
           <div class="line">
            <span class="comment">
             // If object has no vertices, or hair has no segments, then there is
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // nothing to collide. In our example, we'll return here, but if you
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // want to implement your own hair processing such as smoothing or
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // freeze on the hair, you could proceed and let the processing happen
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // after the object loop so that the data gets processed even if no
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // collisions occur.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <span class="keywordflow">
             if
            </span>
            ( ci-&gt;numObjs &lt;= 0 || hairPositions.
            <a name="a20">
            </a>
            <a class="code" href="./class_m_vector_array.html#a580388f31f60c46fac867ca48a48da1e">
             length
            </a>
            () &lt;= 0 ) {
           </div>
           <div class="line">
            <span class="keywordflow">
             return
            </span>
            (
            <span class="keyword">
             true
            </span>
            );
           </div>
           <div class="line">
            }
           </div>
           <div class="line">
           </div>
           <div class="line">
            <span class="keywordtype">
             int
            </span>
            obj;
           </div>
           <div class="line">
            <span class="keywordflow">
             for
            </span>
            ( obj = 0; obj &lt; ci-&gt;numObjs; ++obj ) {
           </div>
           <div class="line">
            COLLISION_OBJ *co = &amp;ci-&gt;objs[obj];
           </div>
           <div class="line">
           </div>
           <div class="line">
            <span class="comment">
             // For our plug-in example, we just collide the segments of the
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // hair against the top of the bounding box for the geometry.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // In an implementation where you only care about hair falling
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // downwards onto flat objects, this might be OK. However, in the
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // most deluxe of implementation, you should do the following:
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //      o  Determine the motion of each face of your collision
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //         object during the time range.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //      o  Step through the follicle, and consider each segment
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //         to be a moving cylinder where the start and end radii
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //         can differ. The radii come from `hairWidths' and the
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //         motion comes from the difference between `hairPositions'
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //         and `hairPositionsLast'.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //      o  Intersect each moving element (e.g. moving triangle
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //         if you have a mesh obect) with each hair segment
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //         e.g. moving cylinder). This intersection may occur
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //         at a point within the frame. (Remember that the
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //         hairPositions[] array holds the DESIRED location where
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //         the hair system wants the hair to go.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //      o  There can be multiple collisions along a hair segment.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //         Use the first location found and the maximal velocity.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // If a collision is detected, the `hairPositions' array should be
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // updated. `hairPositionsLast' may also be updated to provide a
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // dampening effect only.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
           </div>
           <div class="line">
            <span class="comment">
             // Loop through the follicle, starting at the root and advancing
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // toward the tip.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <span class="keywordtype">
             int
            </span>
            numSegments = hairPositions.
            <a class="code" href="./class_m_vector_array.html#a580388f31f60c46fac867ca48a48da1e">
             length
            </a>
            () - 1;
           </div>
           <div class="line">
            <span class="keywordtype">
             int
            </span>
            seg;
           </div>
           <div class="line">
            <span class="keywordflow">
             for
            </span>
            ( seg = 0; seg &lt; numSegments; ++seg ) {
           </div>
           <div class="line">
            <span class="comment">
             // Get the desired position of the segment (i.e. where the
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // solver is trying to put the hair for the current frame)
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // and the velocity required to get to that desired position.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // Thus,
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //      P = hairPositions       // Desired pos'n at cur frame.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //      L = hairPositionsLast   // Position at prev frame.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //      V = P - L               // Desired velocity of hair.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <a class="code" href="./class_m_vector.html">
             MVector
            </a>
            pStart = hairPositions[seg];
           </div>
           <div class="line">
            <a class="code" href="./class_m_vector.html">
             MVector
            </a>
            pEnd = hairPositions[seg + 1];
           </div>
           <div class="line">
           </div>
           <div class="line">
            <a class="code" href="./class_m_vector.html">
             MVector
            </a>
            vStart = pStart - hairPositionsLast[seg];
           </div>
           <div class="line">
            <a class="code" href="./class_m_vector.html">
             MVector
            </a>
            vEnd = pEnd - hairPositionsLast[seg + 1];
           </div>
           <div class="line">
           </div>
           <div class="line">
            <span class="comment">
             // The proper way to time sample is to intersect the moving
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // segment of width `hairWidths[seg] to hairWidths[seg + 1]'
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // with the moving collision object. For the purposes of our
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // demo plug-in, we will simply assume the collision object is
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // static, the hair segment has zero width, and instead of
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // intersecting continuously in time, we will sample discrete
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // steps along the segment.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <span class="preprocessor">
             #define STEPS 4
            </span>
           </div>
           <div class="line">
            <span class="keywordtype">
             int
            </span>
            step;
           </div>
           <div class="line">
            <span class="keywordflow">
             for
            </span>
            ( step = 0; step &lt; STEPS; ++step ) {
           </div>
           <div class="line">
            <span class="comment">
             // Compute the point for this step and its corresponding
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // velocity. This is a "time swept" point:
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //  p1 = desired position at current time
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //  p0 = position at previous time to achieve desired pos
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <a class="code" href="./class_m_vector.html">
             MVector
            </a>
            pCur, pPrev, v;
           </div>
           <div class="line">
            <span class="keywordtype">
             double
            </span>
            fracAlongSeg = step / ( (double) STEPS );
           </div>
           <div class="line">
            v = vStart * ( 1.0 - fracAlongSeg ) + vEnd * fracAlongSeg;
           </div>
           <div class="line">
            <a class="code" href="./class_m_vector.html">
             MVector
            </a>
            p1 = pStart * ( 1.0 - fracAlongSeg )
           </div>
           <div class="line">
            + pEnd * fracAlongSeg;
           </div>
           <div class="line">
            <a class="code" href="./class_m_vector.html">
             MVector
            </a>
            p0 = p1 - v;
           </div>
           <div class="line">
           </div>
           <div class="line">
            <span class="comment">
             // See if BOTH endpoints are outside of the bounding box
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // on the same side. If so, then the segment cannot
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // intersect the bounding box. Note that we assume the
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // bounding box is static.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <span class="keywordflow">
             if
            </span>
            (       (p0.x &lt; co-&gt;minx &amp;&amp; p1.x &lt; co-&gt;minx)
           </div>
           <div class="line">
            || (p0.y &lt; co-&gt;miny &amp;&amp; p1.y &lt; co-&gt;miny)
           </div>
           <div class="line">
            || (p0.z &lt; co-&gt;minz &amp;&amp; p1.z &lt; co-&gt;minz)
           </div>
           <div class="line">
            || (p0.x &gt; co-&gt;maxx &amp;&amp; p1.x &gt; co-&gt;maxx)
           </div>
           <div class="line">
            || (p0.y &gt; co-&gt;maxy &amp;&amp; p1.y &gt; co-&gt;maxy)
           </div>
           <div class="line">
            || (p0.z &gt; co-&gt;maxz &amp;&amp; p1.z &gt; co-&gt;maxz) ) {
           </div>
           <div class="line">
            <span class="keywordflow">
             continue
            </span>
            ;
           </div>
           <div class="line">
            }
           </div>
           <div class="line">
           </div>
           <div class="line">
            <span class="comment">
             // For the purposes of this example plug-in, we'll assume
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // the hair always moves downwards (due to gravity and
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // thus in the negative Y direction). As such, we only
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // need to test for collisions with the TOP of the
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // bounding box. Expanding the example to all 6 sides is
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // left as an exercise for the reader.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // Remember that p1 is the point at current time, and
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // p0 is the point at the previous time. Since we assume
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // the bounding box to be static, this simplifies things.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <a class="code" href="./class_m_vector.html">
             MVector
            </a>
            where(-100000,-100000,-100000);
            <span class="comment">
             // Loc'n of collision
            </span>
           </div>
           <div class="line">
            <span class="keywordtype">
             double
            </span>
            fracTime;
            <span class="comment">
             // Time at which collision happens 0..1
            </span>
           </div>
           <div class="line">
           </div>
           <div class="line">
            <span class="keywordflow">
             if
            </span>
            ( fabs( v.y ) &lt; EPSILON
            <span class="comment">
             // velocity is zero
            </span>
           </div>
           <div class="line">
            &amp;&amp; fabs( p1.y - co-&gt;maxy ) &lt; EPSILON ) {
            <span class="comment">
             // right on the bbox
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // Velocity is zero and the desired location (p1) is
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // right on top of the bounding box.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            where = p1;
           </div>
           <div class="line">
            fracTime = 1.0;
            <span class="comment">
             // Collides right at end;
            </span>
           </div>
           <div class="line">
            }
            <span class="keywordflow">
             else
            </span>
            {
           </div>
           <div class="line">
            fracTime = ( co-&gt;maxy -  p0.y ) / v.y;
           </div>
           <div class="line">
            if ( fracTime &gt;= 0.0 &amp;&amp; fracTime &lt;= 1.0 ) {
           </div>
           <div class="line">
            <span class="comment">
             // Compute the collision of the swept point with the
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // plane defined by the top of the bounding box.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            where = p0 + v * fracTime;
           </div>
           <div class="line">
            }
           </div>
           <div class="line">
            }
           </div>
           <div class="line">
           </div>
           <div class="line">
            <span class="comment">
             // If `seg' lies between startIndex and endIndex
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // we can move it. If its &lt;= startIndex, the root is
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // locked and if &gt;= endIndex the tip is locked.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <span class="keywordflow">
             if
            </span>
            ( seg &gt;= startIndex &amp;&amp; seg &lt;= endIndex ) {
           </div>
           <div class="line">
            <span class="comment">
             // Since we are just colliding with the top of the
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // bounding box, the normal where we hit is (0,1,0).
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // For the object velocity, we SHOULD measure the
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // relative motion of the object during the time
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // interval, but for our example, we'll assume its
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // not moving (0,0,0).
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <span class="keywordtype">
             bool
            </span>
            segCollides =
            <span class="keyword">
             false
            </span>
            ;
           </div>
           <div class="line">
            <a class="code" href="./class_m_vector.html">
             MVector
            </a>
            normal(0.0,1.0,0.0);
            <span class="comment">
             // normal is always up
            </span>
           </div>
           <div class="line">
            <a class="code" href="./class_m_vector.html">
             MVector
            </a>
            objectVel(0.0,0.0,0.0);
            <span class="comment">
             // assume bbox is static
            </span>
           </div>
           <div class="line">
           </div>
           <div class="line">
            <span class="comment">
             // If we get the this point, then the intersection
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // point `where' is on the plane of the bounding box
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // top. See if it lies within the actual bounds of the
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // boxtop, and if so compute the position and velocity
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // information and apply to the hair segment.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <span class="keywordflow">
             if
            </span>
            ( where.x &gt;= co-&gt;minx &amp;&amp; where.x &lt;= co-&gt;maxx
           </div>
           <div class="line">
            &amp;&amp; where.z &gt;= co-&gt;minz &amp;&amp; where.z &lt;= co-&gt;maxz
           </div>
           <div class="line">
            &amp;&amp; fracTime &gt;= 0.0 &amp;&amp; fracTime &lt;= 0.0 ) {
           </div>
           <div class="line">
            <span class="comment">
             // We have a collision at `where' with the plane.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // Compute the new velocity for the hair at the
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // point of collision.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <a class="code" href="./class_m_vector.html">
             MVector
            </a>
            objVelAlongNormal = (objectVel * normal)
           </div>
           <div class="line">
            * normal;
           </div>
           <div class="line">
            <a class="code" href="./class_m_vector.html">
             MVector
            </a>
            objVelAlongTangent = objectVel
           </div>
           <div class="line">
            - objVelAlongNormal;
           </div>
           <div class="line">
            <a class="code" href="./class_m_vector.html">
             MVector
            </a>
            pntVelAlongTangent = v - ( v * normal )
           </div>
           <div class="line">
            * normal;
           </div>
           <div class="line">
            <a class="code" href="./class_m_vector.html">
             MVector
            </a>
            reflectedPntVelAlongTangent
           </div>
           <div class="line">
            = pntVelAlongTangent * ( 1.0 - friction )
           </div>
           <div class="line">
            + objVelAlongTangent * friction;
           </div>
           <div class="line">
            <a class="code" href="./class_m_vector.html">
             MVector
            </a>
            newVel = objVelAlongNormal
           </div>
           <div class="line">
            + reflectedPntVelAlongTangent;
           </div>
           <div class="line">
           </div>
           <div class="line">
            <span class="comment">
             // Update the hair position. It actually looks
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // more stable from a simulation standpoint to
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // just move the closest segment endpoint, but
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // you are free to experiment. What we'll do in
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // our example is move the closest segment end-
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // point by the amount the collided point (where)
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // has to move to have velocity `newVel' yet still
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // pass through `where' at time `fracTime'.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <span class="keywordflow">
             if
            </span>
            ( fracAlongSeg &gt; 0.5 ) {
           </div>
           <div class="line">
            <a class="code" href="./class_m_vector.html">
             MVector
            </a>
            deltaPos = -newVel * fracTime;
           </div>
           <div class="line">
            hairPositionsLast[seg + 1] += deltaPos;
           </div>
           <div class="line">
            hairPositions[seg + 1] = hairPositionsLast[seg]
           </div>
           <div class="line">
            + newVel;
           </div>
           <div class="line">
            }
            <span class="keywordflow">
             else
            </span>
            {
           </div>
           <div class="line">
            <a class="code" href="./class_m_vector.html">
             MVector
            </a>
            deltaPos = newVel * fracTime;
           </div>
           <div class="line">
            hairPositionsLast[seg] += deltaPos;
           </div>
           <div class="line">
            hairPositions[seg] = hairPositionsLast[seg]
           </div>
           <div class="line">
            + newVel;
           </div>
           <div class="line">
            }
           </div>
           <div class="line">
            segCollides =
            <span class="keyword">
             true
            </span>
            ;
           </div>
           <div class="line">
            }
           </div>
           <div class="line">
           </div>
           <div class="line">
            <span class="comment">
             // Check for segment endpoints that may still be
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // inside. Note that segments which started out being
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // totally inside will never collide using the
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // algorithm we use above, so we'll simply clamp them
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // here. One might expect an inside-the-bounding-box
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // test instead. However, this does not work if the
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // collision object is a very thin object.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <span class="keywordtype">
             bool
            </span>
            inside =
            <span class="keyword">
             false
            </span>
            ;
           </div>
           <div class="line">
            <span class="keywordflow">
             if
            </span>
            ( belowCollisionPlane( co, hairPositions[seg] ) ) {
           </div>
           <div class="line">
            hairPositions[seg].y = co-&gt;maxy + EPSILON;
           </div>
           <div class="line">
            hairPositionsLast[seg] = hairPositions[seg] - objectVel;
           </div>
           <div class="line">
            inside =
            <span class="keyword">
             true
            </span>
            ;
           </div>
           <div class="line">
            }
           </div>
           <div class="line">
            <span class="keywordflow">
             if
            </span>
            ( belowCollisionPlane( co, hairPositions[seg+1] ) ) {
           </div>
           <div class="line">
            hairPositions[seg+1].y = co-&gt;maxy + EPSILON;
           </div>
           <div class="line">
            hairPositionsLast[seg+1] = hairPositions[seg+1] - objectVel;
           </div>
           <div class="line">
            inside =
            <span class="keyword">
             true
            </span>
            ;
           </div>
           <div class="line">
            }
           </div>
           <div class="line">
           </div>
           <div class="line">
            <span class="comment">
             // If we collided, go onto the next segment.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <span class="keywordflow">
             if
            </span>
            ( segCollides || inside ) {
           </div>
           <div class="line">
            <span class="keywordflow">
             goto
            </span>
            nextSeg;
           </div>
           <div class="line">
            }
           </div>
           <div class="line">
            }
           </div>
           <div class="line">
            }
           </div>
           <div class="line">
            nextSeg:;
           </div>
           <div class="line">
            }
           </div>
           <div class="line">
            }
           </div>
           <div class="line">
           </div>
           <div class="line">
            <span class="comment">
             // You could perform any global filtering that you want on the hair
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // right here. For example: smoothing. This code is independent of
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // whether or not a collision occurred, and note that collide() is
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // called even with zero collision objects, so you will be guaranteed
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // of reaching here once per hair per iteration.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
           </div>
           <div class="line">
            <span class="keywordflow">
             return
            </span>
            (
            <span class="keyword">
             true
            </span>
            );
           </div>
           <div class="line">
            }
           </div>
           <div class="line">
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // Synopsis:
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //      MStatus initializePlugin( MObject obj )
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // Description:
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //      Invoked upon plug-in load to register the plug-in and initialise.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // Parameters:
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //      MObject obj         : (in)  Plug-in object being loaded.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // Returns:
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //      MStatus::kSuccess   : Successfully performed any needed initial-
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //                            isation for the plug-in.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //      MStatus statusCode  : Error was detected.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <span class="comment">
            </span>
           </div>
           <div class="line">
           </div>
           <div class="line">
            <a class="code" href="./class_m_status.html">
             MStatus
            </a>
            initializePlugin(
            <a class="code" href="./class_m_object.html">
             MObject
            </a>
            obj )
           </div>
           <div class="line">
            {
           </div>
           <div class="line">
            <a name="_a21">
            </a>
            <a class="code" href="./class_m_fn_plugin.html">
             MFnPlugin
            </a>
            plugin( obj,
            <span class="stringliteral">
             "Autodesk"
            </span>
            ,
            <span class="stringliteral">
             "8.0"
            </span>
            ,
            <span class="stringliteral">
             "Any"
            </span>
            );
           </div>
           <div class="line">
           </div>
           <div class="line">
            <a name="a22">
            </a>
            <a class="code" href="./group___macros.html#gae3dc78724237805e00a767b587b7cf79">
             CHECK_MSTATUS
            </a>
            (
            <a name="a23">
            </a>
            <a class="code" href="./class_m_hair_system.html#a2428d36bd0a47deeb8c43d2138ace7da">
             MHairSystem::registerCollisionSolverCollide
            </a>
            ( collide ) );
           </div>
           <div class="line">
            <a class="code" href="./group___macros.html#gae3dc78724237805e00a767b587b7cf79">
             CHECK_MSTATUS
            </a>
            (
            <a name="a24">
            </a>
            <a class="code" href="./class_m_hair_system.html#a78aa477cff5ec54b1810d5a3f13b6e1a">
             MHairSystem::registerCollisionSolverPreFrame
            </a>
            ( preFrame ) );
           </div>
           <div class="line">
           </div>
           <div class="line">
            <span class="keywordflow">
             return
            </span>
            (
            <a class="code" href="./class_m_status.html#a02ab596f4febca68da503aaf8dde3a80af0536797208144380691e2b376ffc1d1">
             MS::kSuccess
            </a>
            );
           </div>
           <div class="line">
            }
           </div>
           <div class="line">
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // Synopsis:
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //      MStatus uninitializePlugin( MObject obj )
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // Description:
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //      Invoked upon plug-in unload to deregister the plug-in and clean up.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // Parameters:
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //      MObject obj         : (in)  Plug-in object being unloaded.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <span class="comment">
             // Returns:
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //      MStatus::kSuccess   : Successfully performed any needed cleanup.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //      MStatus statusCode  : Error was detected.
            </span>
           </div>
           <div class="line">
            <span class="comment">
             //
            </span>
           </div>
           <div class="line">
            <span class="comment">
            </span>
           </div>
           <div class="line">
           </div>
           <div class="line">
            <a class="code" href="./class_m_status.html">
             MStatus
            </a>
            uninitializePlugin(
            <a class="code" href="./class_m_object.html">
             MObject
            </a>
            obj )
           </div>
           <div class="line">
            {
           </div>
           <div class="line">
            <a class="code" href="./class_m_fn_plugin.html">
             MFnPlugin
            </a>
            plugin( obj );
           </div>
           <div class="line">
           </div>
           <div class="line">
            <a class="code" href="./group___macros.html#gae3dc78724237805e00a767b587b7cf79">
             CHECK_MSTATUS
            </a>
            (
            <a name="a25">
            </a>
            <a class="code" href="./class_m_hair_system.html#aed270f78aa2c10fe69fef015be60921a">
             MHairSystem::unregisterCollisionSolverCollide
            </a>
            () );
           </div>
           <div class="line">
            <a class="code" href="./group___macros.html#gae3dc78724237805e00a767b587b7cf79">
             CHECK_MSTATUS
            </a>
            (
            <a name="a26">
            </a>
            <a class="code" href="./class_m_hair_system.html#a01eeb1c0cf1fd6abe5b9a609157e3fca">
             MHairSystem::unregisterCollisionSolverPreFrame
            </a>
            () );
           </div>
           <div class="line">
           </div>
           <div class="line">
            <span class="keywordflow">
             return
            </span>
            (
            <a class="code" href="./class_m_status.html#a02ab596f4febca68da503aaf8dde3a80af0536797208144380691e2b376ffc1d1">
             MS::kSuccess
            </a>
            );
           </div>
           <div class="line">
            }
           </div>
          </div>
          <!-- fragment -->
         </div>
         <!-- contents -->
        </div>
        <!-- doc-content -->
        <div class="footer-block">
         <a class="comments-anchor" href="../html/ac.cmtdialog.htm" target="_blank">
          <span class="comments-link">
           Please send us your comment about this page
          </span>
         </a>
        </div>
        <br/>
       </div>
      </link>
     </link>
    </link>
   </link>
  </div>
 </body>
</html>
