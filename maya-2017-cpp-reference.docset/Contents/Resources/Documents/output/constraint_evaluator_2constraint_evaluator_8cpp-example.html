<!-- saved from url=(0024)http://docs.autodesk.com -->
<html>
<head><script src="../scripts/yepnope.1.5.4-min.js" type="text/javascript"></script><script src="../scripts/lib/jquery-1.11.1.min.js" type="text/javascript"></script><meta content="text/html; charset=utf-8" http-equiv="Content-Type"><meta content="MAYAUL" name="product"><meta content="2017" name="release"><meta content="Developer" name="book"><meta content="2016-06-16" name="created"><meta content="GUID-02DEF634-1E7B-48C6-8ACD-2C934CA97887" name="topicid"><meta content="concept" name="topic-type">
<title>constraintEvaluator/constraintEvaluator.cpp</title>
<meta content="C++" name="topic-subtype"/></meta></meta></meta></meta></meta></meta></meta></head>
<body height="100%"><div class="body_content" id="body-content"><link href="cpp_ref/navtree.css" rel="stylesheet" type="text/css"><link href="cpp_ref/doxygen.css" rel="stylesheet" type="text/css"><link href="cpp_ref/tabs.css" rel="stylesheet" type="text/css"><link href="style/adsk.cpm.css" rel="stylesheet" type="text/css"><script language="javascript">var index = 'index.html';</script><script>$(document).ready(function() { yepnope.injectJs("./scripts/ac_common.js"); });</script><script type="text/javascript">
var tocSystemNeedsToBeLoaded = typeof(cpp_ref_adsk_ref_toc) == 'undefined';
var weAreIn21 = $('div#main.view-active').length;
var tocPrefix = '';
if (weAreIn21)
{ tocPrefix = 'cpp_ref/'; }
function cpp_ref_initializeToc(forceTrigger) {
    cpp_ref_adsk_ref_toc.initResizable();
    cpp_ref_adsk_ref_toc.initNavTree('constraint_evaluator_2constraint_evaluator_8cpp-example.html', tocPrefix);
    dQuery(document).trigger('toc_initialized');
}
if (tocSystemNeedsToBeLoaded)
{
	yepnope([{
	load:[tocPrefix + 'json3.min.js', tocPrefix + 'jquery.js', tocPrefix + 'ref-toc-controller.js', tocPrefix + 'dynsections.js'],
	complete: function() {
	  if (typeof(dQuery) == 'undefined')
	  {
	    dQuery = jQuery.noConflict(true);
	  }
	  else { jQuery.noConflict(true); }
	  $(document).ready(cpp_ref_initializeToc);
	}
 	}])
}
if (!weAreIn21) { // if in AKN...
$(window).load( function() {
    setTimeout( function() {
        var content = $('body > div').not('#body-content');     // take any divs under body that are not id=body-content
        content.each( function() { 
            $(this).css( { 'padding-left': $(this).css('margin-left') } );       // and if they have any padding-left already, move it to margin-left.
        } );
        var width = cpp_ref_adsk_ref_toc.readFromStorage('width');
        content.css({marginLeft:parseInt(width)+6+"px"});
    }, 100);
} ); 
}
</script><script>$("div#WidgetFloaterPanels,link[href*='microsofttranslator.com'],script[src*='microsofttranslator.com'],script[src*='bing.com']").remove();</script><script type="text/javascript">$("div#navigation,div#breadcrumbs,div#banner").attr("translate","no"); var mtLocation = ((location && location.href && location.href.indexOf('https') == 0)?'https://ssl.microsofttranslator.com':'http://www.microsofttranslator.com')+'/ajax/v3/WidgetV3.ashx?ctf=True&ui=true&settings=Manual&from=en&hidelanguages='; yepnope.injectJs(mtLocation, function() {}, { charset:'utf-8', type:'text/javascript' } );</script><script>
 if (!tocSystemNeedsToBeLoaded) { cpp_ref_initializeToc(); }
 </script><!-- begin MT -->
<div class="Dark" id="MicrosoftTranslatorWidget" style="float:right;z-index:100;color:white;background-color:#bbbbbb;height:58px;overflow:hidden"></div>
<div>
<div class="head">
<h1>constraintEvaluator/constraintEvaluator.cpp</h1>
</div>
<div id="top"><!-- Generated by Doxygen 1.8.10 -->
<div class="tabs" id="navrow1">
<ul class="tablist">
<li><a href="./index.html"><span>MainÂ Page</span></a></li>
<li><a href="./pages.html"><span>Topics</span></a></li>
<li><a href="./modules.html"><span>Modules</span></a></li>
<li><a href="./namespaces.html"><span>Namespaces</span></a></li>
<li><a href="./annotated.html"><span>Classes</span></a></li>
<li><a href="./examples.html"><span>Examples</span></a></li>
</ul>
</div>
</div><!-- top -->
<div class="ui-resizable side-nav-resizable" id="side-nav">
<div id="nav-tree">
<div id="nav-tree-contents">
<div class="sync" id="nav-sync"></div>
</div>
</div>
<div class="ui-resizable-handle" id="splitbar" style="-moz-user-select:none;">
</div>
</div>
<div id="doc-content">
<div class="header">
<div class="headertitle">
<div class="title">constraintEvaluator/constraintEvaluator.cpp</div> </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">//-</span></div>
<div class="line"><span class="comment">// ===========================================================================</span></div>
<div class="line"><span class="comment">// Copyright 2016 Autodesk, Inc. All rights reserved.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Use of this software is subject to the terms of the Autodesk license</span></div>
<div class="line"><span class="comment">// agreement provided at the time of installation or download, or which</span></div>
<div class="line"><span class="comment">// otherwise accompanies this software in either electronic or hard copy form.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// ===========================================================================</span></div>
<div class="line"><span class="comment">//+</span></div>
<div class="line"></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"># This custom evaluator is used to replace evaluation clusters consisting of </span></div>
<div class="line"><span class="comment"># point and orient constraints. Since cycles are introduced between those </span></div>
<div class="line"><span class="comment"># constraints, evaluation inefficiency can arise. By replacing those clusters </span></div>
<div class="line"><span class="comment"># with a custom evaluator we are able to evaluate the position and orientation</span></div>
<div class="line"><span class="comment"># of the given object faster.</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment"># The code sample below creates a cone that is point and orient constrained</span></div>
<div class="line"><span class="comment"># to an animated locator. The evaluator detects this setup and claims </span></div>
<div class="line"><span class="comment"># the transform for evaluation.</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment"># During evaluation, the evaluator does the requisite math that the </span></div>
<div class="line"><span class="comment"># constraints would normally do, thus saving the cost of computation</span></div>
<div class="line"><span class="comment"># of the constraints </span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment"># NOTE: This is a limited example and is not intended for a more complex</span></div>
<div class="line"><span class="comment"># setup. The setup is, while common, deliberately simple. The evaluator</span></div>
<div class="line"><span class="comment"># checks only if a source transform is basically constrained by a </span></div>
<div class="line"><span class="comment"># point and orient constraint. It doesn't check additions to this scenario</span></div>
<div class="line"><span class="comment"># (offsets, constraint axes, etc). </span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment"># setup the scene </span></div>
<div class="line"><span class="comment">import maya.cmds as cmds</span></div>
<div class="line"><span class="comment">import math</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">def getConstraintSetup():</span></div>
<div class="line"><span class="comment">    constraintPair = {} # 0-src, 1-dst</span></div>
<div class="line"><span class="comment">    constraintPair[0] = cmds.spaceLocator()[0]</span></div>
<div class="line"><span class="comment">    constraintPair[1] = cmds.polyCone()[0]</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">    cmds.select(constraintPair.values(), r=True)</span></div>
<div class="line"><span class="comment">    cmds.pointConstraint(offset=[0,0,0], weight=1)</span></div>
<div class="line"><span class="comment">    cmds.orientConstraint(offset=[0,0,0], weight=1)</span></div>
<div class="line"><span class="comment">    cmds.select(clear=True)</span></div>
<div class="line"><span class="comment"> </span></div>
<div class="line"><span class="comment">    return constraintPair</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">def animate(transform, step, ampT, ampR):</span></div>
<div class="line"><span class="comment">    cmds.setKeyframe( transform, attribute='translateX', t='0sec', v=0 )</span></div>
<div class="line"><span class="comment">    cmds.setKeyframe( transform, attribute='translateZ', t='0sec', v=0 )</span></div>
<div class="line"><span class="comment">    cmds.setKeyframe( transform, attribute='translateX', t='2sec', v=(math.cos(step) * ampT) )</span></div>
<div class="line"><span class="comment">    cmds.setKeyframe( transform, attribute='translateZ', t='2sec', v=(math.sin(step) * ampT) )</span></div>
<div class="line"><span class="comment"> </span></div>
<div class="line"><span class="comment">    cmds.setKeyframe( transform, attribute='rotateX', t='0sec', v=0 )</span></div>
<div class="line"><span class="comment">    cmds.setKeyframe( transform, attribute='rotateZ', t='0sec', v=0 )</span></div>
<div class="line"><span class="comment">    cmds.setKeyframe( transform, attribute='rotateX', t='2sec', v=ampR )</span></div>
<div class="line"><span class="comment">    cmds.setKeyframe( transform, attribute='rotateZ', t='2sec', v=ampR )</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">def createPointOrientSetup(numberOfInstances):</span></div>
<div class="line"><span class="comment">    increment = 360.0/numberOfInstances</span></div>
<div class="line"><span class="comment">    step = 0</span></div>
<div class="line"><span class="comment">    for i in range(numberOfInstances):</span></div>
<div class="line"><span class="comment">        constraintPair = getConstraintSetup()</span></div>
<div class="line"><span class="comment">        animate(constraintPair[0], math.radians(step), 15, 180)</span></div>
<div class="line"><span class="comment">        step += increment</span></div>
<div class="line"><span class="comment"> </span></div>
<div class="line"><span class="comment"># Create 100 constrainted objects with point and orient constraints</span></div>
<div class="line"><span class="comment">createPointOrientSetup(100)</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment"># load and register the evaluator</span></div>
<div class="line"><span class="comment">cmds.loadPlugin("constraintEvaluator.mll")</span></div>
<div class="line"><span class="comment">cmds.evaluator(enable=True, name="ConstraintEvaluator")</span></div>
<div class="line"><span class="comment">cmds.evaluator(query=True, name="ConstraintEvaluator", clusters=True)</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment"># clear the scene, de-register and unload the evaluator</span></div>
<div class="line"><span class="comment">cmds.file(force=True, new=True)</span></div>
<div class="line"><span class="comment">cmds.evaluator(enable=False, name="ConstraintEvaluator")</span></div>
<div class="line"><span class="comment">cmds.unloadPlugin("constraintEvaluator")</span></div>
<div class="line"><span class="comment">*/</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MFnPlugin.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MString.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MPxCustomEvaluator.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MCustomEvaluatorClusterNode.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MFnDependencyNode.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MPlug.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MProfiler.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MGraphNodeIterator.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MFnMatrixData.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MPlugArray.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MPxTransform.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MObjectHandle.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;map&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">namespace</span></div>
<div class="line">{</div>
<div class="line"> <span class="keywordtype">int</span> _profilerCategory = <a name="a0"></a><a class="code" href="./class_m_profiler.html#aa43b57b5469ba5db72843a2d2b9e5c11">MProfiler::addCategory</a>(<span class="stringliteral">"Constraint Evaluator"</span>);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Evaluator class declaration</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment"></span><span class="keyword">class </span>constraintEvaluator : <span class="keyword">public</span> <a name="_a1"></a><a class="code" href="./class_m_px_custom_evaluator.html">MPxCustomEvaluator</a></div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line"> <span class="keyword">typedef</span> std::map&lt;unsigned int, MObject&gt; TargetMapHash;</div>
<div class="line"></div>
<div class="line"> <span class="keyword">virtual</span> ~constraintEvaluator();</div>
<div class="line"></div>
<div class="line"> <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a name="a2"></a><a class="code" href="./class_m_px_custom_evaluator.html#ab796c49be826aa53c78faf09f05ab0c8">markIfSupported</a>(<span class="keyword">const</span> <a name="_a3"></a><a class="code" href="./class_m_evaluation_node.html">MEvaluationNode</a>* node);</div>
<div class="line"> </div>
<div class="line"> <span class="keyword">virtual</span> <a class="code" href="./class_m_custom_evaluator_cluster_node.html#aa4dfc80e0475312169cf7a2b4299b825">MCustomEvaluatorClusterNode::SchedulingType</a> schedulingType(<span class="keyword">const</span> <a name="_a4"></a><a class="code" href="./class_m_custom_evaluator_cluster_node.html">MCustomEvaluatorClusterNode</a>* cluster);</div>
<div class="line"> </div>
<div class="line"> <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a name="a5"></a><a class="code" href="./class_m_px_custom_evaluator.html#a9bded60be46fea26c410402438aa331a">clusterEvaluate</a>(<span class="keyword">const</span> <a class="code" href="./class_m_custom_evaluator_cluster_node.html">MCustomEvaluatorClusterNode</a>* cluster);</div>
<div class="line"> <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a name="a6"></a><a class="code" href="./class_m_px_custom_evaluator.html#a93f7f73d9a911cd75458e64fa9b4a29b">clusterTerminate</a>(<span class="keyword">const</span> <a class="code" href="./class_m_custom_evaluator_cluster_node.html">MCustomEvaluatorClusterNode</a>* cluster);</div>
<div class="line"></div>
<div class="line"> <span class="keyword">virtual</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* evaluatorName();</div>
<div class="line"></div>
<div class="line"> <span class="keyword">static</span> <span class="keywordtype">void</span>* creator();</div>
<div class="line"></div>
<div class="line"> <span class="keywordtype">void</span> reset();</div>
<div class="line"></div>
<div class="line">    TargetMapHash fTransformTargetHash;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="comment">// reset any data we're storing</span></div>
<div class="line"><span class="keywordtype">void</span> constraintEvaluator::reset()</div>
<div class="line">{</div>
<div class="line">    fTransformTargetHash.clear();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// Check the provided node (and its local network) to see</span></div>
<div class="line"><span class="comment">// if it's something we can support. In this case, we want to claim</span></div>
<div class="line"><span class="comment">// the transform that's constrained to a target by two constraints. Once</span></div>
<div class="line"><span class="comment">// we've ascertained that the provided node is the one we want, we'll store</span></div>
<div class="line"><span class="comment">// it (via a hashcode) and its target node.</span></div>
<div class="line"><span class="keywordtype">bool</span> constraintEvaluator::markIfSupported(<span class="keyword">const</span> <a class="code" href="./class_m_evaluation_node.html">MEvaluationNode</a>* node)</div>
<div class="line">{</div>
<div class="line"> <a name="_a7"></a><a class="code" href="./class_m_status.html">MStatus</a> stat;</div>
<div class="line"> <a name="_a8"></a><a class="code" href="./class_m_object.html">MObject</a> thisNode = node-&gt;dependencyNode(&amp;stat);</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (stat == <a name="a9"></a><a class="code" href="./class_m_status.html#a02ab596f4febca68da503aaf8dde3a80af0536797208144380691e2b376ffc1d1">MS::kSuccess</a>)</div>
<div class="line">    {</div>
<div class="line"> <a name="_a10"></a><a class="code" href="./class_m_fn_dependency_node.html">MFnDependencyNode</a> depNodeFn(thisNode, &amp;stat);</div>
<div class="line"> <a name="_a11"></a><a class="code" href="./class_m_string.html">MString</a> nodeName = depNodeFn.name();</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (depNodeFn.typeName() == <span class="stringliteral">"transform"</span>)</div>
<div class="line">        {</div>
<div class="line"> <span class="comment">// check the source of any connections to the translate</span></div>
<div class="line"> <a name="_a12"></a><a class="code" href="./class_m_plug.html">MPlug</a> translateXPlug = depNodeFn.findPlug(<span class="stringliteral">"translateX"</span>, &amp;stat);</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (stat != <a class="code" href="./class_m_status.html#a02ab596f4febca68da503aaf8dde3a80af0536797208144380691e2b376ffc1d1">MS::kSuccess</a>) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"></div>
<div class="line"> <a name="_a13"></a><a class="code" href="./class_m_plug_array.html">MPlugArray</a> sources;</div>
<div class="line">            translateXPlug.<a name="a14"></a><a class="code" href="./class_m_plug.html#a3727c18c58fc5ba8be5fb2582b5d06f1">connectedTo</a>(sources, <span class="keyword">true</span> <span class="comment">/* asDst */</span>, <span class="keyword">false</span> <span class="comment">/* asSrc */</span>, &amp;stat);</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (stat != <a class="code" href="./class_m_status.html#a02ab596f4febca68da503aaf8dde3a80af0536797208144380691e2b376ffc1d1">MS::kSuccess</a>) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"> <span class="keywordflow">if</span> (sources.<a name="a15"></a><a class="code" href="./class_m_plug_array.html#a580388f31f60c46fac867ca48a48da1e">length</a>() != 1) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"> <span class="keywordflow">if</span> (sources[0].node().hasFn(<a name="a16"></a><a class="code" href="./class_m_fn.html#a1d1cfd8ffb84e947f82999c682b666a7ab7ec4db4e20394eaf6b695cab4465ba0">MFn::kPointConstraint</a>) != <span class="keyword">true</span>) <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// is this a point constraint?</span></div>
<div class="line"></div>
<div class="line"> <span class="comment">// store the point constraint</span></div>
<div class="line"> <a class="code" href="./class_m_fn_dependency_node.html">MFnDependencyNode</a> pointConstraintNode(sources[0].node());</div>
<div class="line"></div>
<div class="line">            sources.<a name="a17"></a><a class="code" href="./class_m_plug_array.html#ad5522f028dde0080b753279426415a4a">clear</a>();</div>
<div class="line"> <a class="code" href="./class_m_plug.html">MPlug</a> rotateXPlug = depNodeFn.findPlug(<span class="stringliteral">"rotateX"</span>, &amp;stat);</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (stat != <a class="code" href="./class_m_status.html#a02ab596f4febca68da503aaf8dde3a80af0536797208144380691e2b376ffc1d1">MS::kSuccess</a>) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"></div>
<div class="line">            rotateXPlug.<a class="code" href="./class_m_plug.html#a3727c18c58fc5ba8be5fb2582b5d06f1">connectedTo</a>(sources, <span class="keyword">true</span> <span class="comment">/* asDst */</span>, <span class="keyword">false</span> <span class="comment">/* asSrc */</span>, &amp;stat);</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (stat != <a class="code" href="./class_m_status.html#a02ab596f4febca68da503aaf8dde3a80af0536797208144380691e2b376ffc1d1">MS::kSuccess</a>) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"> <span class="keywordflow">if</span> (sources.<a class="code" href="./class_m_plug_array.html#a580388f31f60c46fac867ca48a48da1e">length</a>() &gt; 1) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"> <span class="keywordflow">if</span> (sources[0].node().hasFn(<a name="a18"></a><a class="code" href="./class_m_fn.html#a1d1cfd8ffb84e947f82999c682b666a7a6238013a3ded4d9484fa775437874b27">MFn::kOrientConstraint</a>) != <span class="keyword">true</span>) <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// is this an orient constraint?</span></div>
<div class="line"></div>
<div class="line"> <span class="comment">// store the orient constraint</span></div>
<div class="line"> <a class="code" href="./class_m_fn_dependency_node.html">MFnDependencyNode</a> orientConstraintNode(sources[0].node());</div>
<div class="line"></div>
<div class="line"> <span class="comment">// check if the point and orient constraint have the same target</span></div>
<div class="line"> <a class="code" href="./class_m_plug.html">MPlug</a> pointConstraintTargetTranslatePlug = pointConstraintNode.findPlug(<span class="stringliteral">"targetTranslate"</span>, <span class="keyword">true</span>, &amp;stat);</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (stat != <a class="code" href="./class_m_status.html#a02ab596f4febca68da503aaf8dde3a80af0536797208144380691e2b376ffc1d1">MS::kSuccess</a>) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"></div>
<div class="line"> <a class="code" href="./class_m_fn_dependency_node.html">MFnDependencyNode</a> sourceNode(pointConstraintTargetTranslatePlug.<a name="a19"></a><a class="code" href="./class_m_plug.html#a105bb4374ce03922a4cb04537beb6769">source</a>().<a name="a20"></a><a class="code" href="./class_m_plug.html#ad1aa507eb8e63e89e8d46a0abc18aa8c">node</a>(), &amp;stat);</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (stat != <a class="code" href="./class_m_status.html#a02ab596f4febca68da503aaf8dde3a80af0536797208144380691e2b376ffc1d1">MS::kSuccess</a>) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"></div>
<div class="line"> <a class="code" href="./class_m_string.html">MString</a> targetNodeName = sourceNode.name(); <span class="comment">// we'll need this target's name to see if the other constraint uses this</span></div>
<div class="line"></div>
<div class="line"> <a class="code" href="./class_m_plug.html">MPlug</a> orientConstraintTargetRotatePlug = orientConstraintNode.findPlug(<span class="stringliteral">"targetRotate"</span>, <span class="keyword">true</span>, &amp;stat);</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (stat != <a class="code" href="./class_m_status.html#a02ab596f4febca68da503aaf8dde3a80af0536797208144380691e2b376ffc1d1">MS::kSuccess</a>) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"></div>
<div class="line">            stat = sourceNode.setObject(orientConstraintTargetRotatePlug.<a class="code" href="./class_m_plug.html#a105bb4374ce03922a4cb04537beb6769">source</a>().<a class="code" href="./class_m_plug.html#ad1aa507eb8e63e89e8d46a0abc18aa8c">node</a>());</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (stat != <a class="code" href="./class_m_status.html#a02ab596f4febca68da503aaf8dde3a80af0536797208144380691e2b376ffc1d1">MS::kSuccess</a>) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"> <span class="keywordflow">if</span> (targetNodeName != sourceNode.name()) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"></div>
<div class="line">            fTransformTargetHash[<a name="a21"></a><a class="code" href="./class_m_object_handle.html#addc1c7628b6f11fdc67e53c02746b7fe">MObjectHandle::objectHashCode</a>(thisNode)] = orientConstraintTargetRotatePlug.<a class="code" href="./class_m_plug.html#a105bb4374ce03922a4cb04537beb6769">source</a>().<a class="code" href="./class_m_plug.html#ad1aa507eb8e63e89e8d46a0abc18aa8c">node</a>();</div>
<div class="line"></div>
<div class="line"> <span class="comment">// this is a transform constrained by a point and an orient constraint, claim it</span></div>
<div class="line"> <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">        }</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((depNodeFn.typeName() == <span class="stringliteral">"pointConstraint"</span>) || (depNodeFn.typeName() == <span class="stringliteral">"orientConstraint"</span>))</div>
<div class="line">        {</div>
<div class="line"> <span class="comment">// Marking all point and orient constraints as supported since they will </span></div>
<div class="line"> <span class="comment">// always be in a cycle with destination node, and we will be able to </span></div>
<div class="line"> <span class="comment">// override the entire cycle only if we mark all nodes forming it. When </span></div>
<div class="line"> <span class="comment">// processing destination we will test connectivity and decide if we support </span></div>
<div class="line"> <span class="comment">// this cycle cluster</span></div>
<div class="line"> <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">        }</div>
<div class="line">    }  </div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// return the scheduling type of the provided cluster</span></div>
<div class="line"><a class="code" href="./class_m_custom_evaluator_cluster_node.html#aa4dfc80e0475312169cf7a2b4299b825">MCustomEvaluatorClusterNode::SchedulingType</a> constraintEvaluator::schedulingType(<span class="keyword">const</span> <a class="code" href="./class_m_custom_evaluator_cluster_node.html">MCustomEvaluatorClusterNode</a>* cluster)</div>
<div class="line">{</div>
<div class="line"> <span class="keywordflow">return</span> cluster-&gt;<a name="a22"></a><a class="code" href="./class_m_custom_evaluator_cluster_node.html#aaaceae2c8e44fe97940fd1d625389ac2">schedulingType</a>();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// During evaluation, we first make sure we're called on our cone's transform</span></div>
<div class="line"><span class="comment">// and grab the information we need from its target node, as well as some of</span></div>
<div class="line"><span class="comment">// its attributes. We then make the appropriate calculations and evaluate only</span></div>
<div class="line"><span class="comment">// the transform node (thus avoiding evaluating the constraints).</span></div>
<div class="line"><span class="keywordtype">void</span> constraintEvaluator::clusterEvaluate(<span class="keyword">const</span> <a class="code" href="./class_m_custom_evaluator_cluster_node.html">MCustomEvaluatorClusterNode</a>* cluster)</div>
<div class="line">{</div>
<div class="line"> <a name="_a23"></a><a class="code" href="./class_m_profiling_scope.html">MProfilingScope</a> profilingScope(_profilerCategory, MProfiler::kColorD_L1, <span class="stringliteral">"Evaluate constraint cluster"</span>);</div>
<div class="line"> </div>
<div class="line"> <a class="code" href="./class_m_status.html">MStatus</a> stat = <a class="code" href="./class_m_status.html#a02ab596f4febca68da503aaf8dde3a80af0536797208144380691e2b376ffc1d1">MS::kSuccess</a>;</div>
<div class="line"> <a name="_a24"></a><a class="code" href="./class_m_graph_node_iterator.html">MGraphNodeIterator</a> iterator(cluster, &amp;stat);</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (stat == <a class="code" href="./class_m_status.html#a02ab596f4febca68da503aaf8dde3a80af0536797208144380691e2b376ffc1d1">MS::kSuccess</a>)</div>
<div class="line">    {</div>
<div class="line"> <span class="keywordflow">while</span> (!iterator.isDone())</div>
<div class="line">        {</div>
<div class="line">            iterator.next(&amp;stat);</div>
<div class="line"></div>
<div class="line"> <a class="code" href="./class_m_evaluation_node.html">MEvaluationNode</a> currEvalNode = iterator.currentEvaluationNode(&amp;stat);</div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> currObject = currEvalNode.dependencyNode(&amp;stat);</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> ( currObject.<a name="a25"></a><a class="code" href="./class_m_object.html#af0af77f14f96d1134fb8e8e60dc7e420">hasFn</a>(<a name="a26"></a><a class="code" href="./class_m_fn.html#a1d1cfd8ffb84e947f82999c682b666a7adafa274206df602835f0f22ae887e126">MFn::kTransform</a>) )</div>
<div class="line">            {</div>
<div class="line"> <a name="_a27"></a><a class="code" href="./class_m_matrix.html">MMatrix</a> piMatrix, wMatrix;</div>
<div class="line"></div>
<div class="line"> <span class="comment">// We're forcing a call to pre-evaluate on the current node.</span></div>
<div class="line"> <span class="comment">// The idea here is to ask an attribute on the given transform</span></div>
<div class="line"> <span class="comment">// for its dirty status to force a call to that node's preEvaluate(...)</span></div>
<div class="line"> <span class="comment">// call. This is typically not required, however in the case of</span></div>
<div class="line"> <span class="comment">// transform nodes, in order for them to *not* re-dirty and re-evaluate</span></div>
<div class="line"> <span class="comment">// anything, we force a pre-evaluation before setting anything in</span></div>
<div class="line"> <span class="comment">// the plug and/or datablock</span></div>
<div class="line"> <a class="code" href="./class_m_plug.html">MPlug</a> worldMatrixForPreEval(currObject, <a name="a28"></a><a class="code" href="./class_m_px_transform.html#aae8765de146707c69dc4c25709b15456">MPxTransform::worldMatrix</a>);</div>
<div class="line">                currEvalNode.datablock(&amp;stat).isClean(worldMatrixForPreEval);</div>
<div class="line"></div>
<div class="line">                {</div>
<div class="line"> <a class="code" href="./class_m_profiling_scope.html">MProfilingScope</a> profilingScopeParent(_profilerCategory, MProfiler::kColorD_L1, <span class="stringliteral">"Get parent inverse matrix"</span>);</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Read parent inverse matrix. Use inputValue call to get the most up to </span></div>
<div class="line"> <span class="comment">// date value and allow preEvaluation to happen before we write anything </span></div>
<div class="line"> <span class="comment">// back to data block.</span></div>
<div class="line"> <a class="code" href="./class_m_plug.html">MPlug</a> parentInverseMatrixPlug(currObject, <a name="a29"></a><a class="code" href="./class_m_px_transform.html#a60307c6c66af3a3e889bf0dde83ef54e">MPxTransform::parentInverseMatrix</a>);</div>
<div class="line"> <a name="_a30"></a><a class="code" href="./class_m_array_data_handle.html">MArrayDataHandle</a> parentInverseMatrixArrayHandle = currEvalNode.datablock(&amp;stat).inputArrayValue(parentInverseMatrixPlug.attribute());</div>
<div class="line"> <span class="keywordflow">if</span> ((stat != <a class="code" href="./class_m_status.html#a02ab596f4febca68da503aaf8dde3a80af0536797208144380691e2b376ffc1d1">MS::kSuccess</a>) || (parentInverseMatrixArrayHandle.<a name="a31"></a><a class="code" href="./class_m_array_data_handle.html#a5f3dd1d27853eccbbe78b6d4383ccb79">elementCount</a>() == 0)) <span class="keywordflow">continue</span>;</div>
<div class="line"></div>
<div class="line"> <span class="comment">// We don't support instancing for now, so grab only first instance</span></div>
<div class="line">                    stat = parentInverseMatrixArrayHandle.<a name="a32"></a><a class="code" href="./class_m_array_data_handle.html#a8d77f0fea87bb6854b60cd199bf26240">jumpToElement</a>(0); </div>
<div class="line"> <span class="keywordflow">if</span> (stat != <a class="code" href="./class_m_status.html#a02ab596f4febca68da503aaf8dde3a80af0536797208144380691e2b376ffc1d1">MS::kSuccess</a>) <span class="keywordflow">continue</span>;</div>
<div class="line"></div>
<div class="line"> <a name="_a33"></a><a class="code" href="./class_m_data_handle.html">MDataHandle</a> elementHandle = parentInverseMatrixArrayHandle.<a name="a34"></a><a class="code" href="./class_m_array_data_handle.html#a81d24dca6d647d8d0a8fe0ef2c63b170">inputValue</a>(&amp;stat);</div>
<div class="line"> <span class="keywordflow">if</span> (stat != <a class="code" href="./class_m_status.html#a02ab596f4febca68da503aaf8dde3a80af0536797208144380691e2b376ffc1d1">MS::kSuccess</a>) <span class="keywordflow">continue</span>;</div>
<div class="line"></div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> parentInverseMatrixData = elementHandle.<a name="a35"></a><a class="code" href="./class_m_data_handle.html#a31773b870681e1f6b3ad82ff58de33bc">data</a>();</div>
<div class="line"> <a name="_a36"></a><a class="code" href="./class_m_fn_matrix_data.html">MFnMatrixData</a> fnMatrixData(parentInverseMatrixData, &amp;stat);</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (stat != <a class="code" href="./class_m_status.html#a02ab596f4febca68da503aaf8dde3a80af0536797208144380691e2b376ffc1d1">MS::kSuccess</a>) <span class="keywordflow">continue</span>;</div>
<div class="line"> </div>
<div class="line">                    piMatrix = fnMatrixData.<a name="a37"></a><a class="code" href="./class_m_matrix.html#a527b102f4eb0951cf4f391f828d3ca34">matrix</a>(&amp;stat);</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">                {</div>
<div class="line"> <span class="comment">// Get target world matrix</span></div>
<div class="line"> <a class="code" href="./class_m_profiling_scope.html">MProfilingScope</a> profilingScopeTarget(_profilerCategory, MProfiler::kColorD_L1, <span class="stringliteral">"Get target matrix"</span>);</div>
<div class="line"> </div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> targetObject = fTransformTargetHash[<a class="code" href="./class_m_object_handle.html#addc1c7628b6f11fdc67e53c02746b7fe">MObjectHandle::objectHashCode</a>(currObject)];</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (stat != <a class="code" href="./class_m_status.html#a02ab596f4febca68da503aaf8dde3a80af0536797208144380691e2b376ffc1d1">MS::kSuccess</a>) <span class="keywordflow">continue</span>;</div>
<div class="line"></div>
<div class="line"> <a class="code" href="./class_m_plug.html">MPlug</a> worldMatrixPlug(targetObject, <a class="code" href="./class_m_px_transform.html#aae8765de146707c69dc4c25709b15456">MPxTransform::worldMatrix</a>);</div>
<div class="line"> <a class="code" href="./class_m_plug.html">MPlug</a> worldMatrixPlugElement = worldMatrixPlug.<a name="a38"></a><a class="code" href="./class_m_plug.html#a69c9b843aafeadbcaa3cdad274b9aeb8">elementByLogicalIndex</a>(0, &amp;stat);</div>
<div class="line"> </div>
<div class="line"> <span class="keywordflow">if</span> (stat != <a class="code" href="./class_m_status.html#a02ab596f4febca68da503aaf8dde3a80af0536797208144380691e2b376ffc1d1">MS::kSuccess</a>) <span class="keywordflow">continue</span>;</div>
<div class="line"></div>
<div class="line"> <a class="code" href="./class_m_data_handle.html">MDataHandle</a> targetWorldMatrixHandle = worldMatrixPlugElement.<a name="a39"></a><a class="code" href="./class_m_plug.html#aab6efee8cb55ea51f97394b345d2cec1">asMDataHandle</a>();</div>
<div class="line"> <a class="code" href="./class_m_object.html">MObject</a> targetWorldMatrixData = targetWorldMatrixHandle.<a class="code" href="./class_m_data_handle.html#a31773b870681e1f6b3ad82ff58de33bc">data</a>();</div>
<div class="line"> <a class="code" href="./class_m_fn_matrix_data.html">MFnMatrixData</a> fnTargetWorldMatrixData(targetWorldMatrixData, &amp;stat);</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (stat != <a class="code" href="./class_m_status.html#a02ab596f4febca68da503aaf8dde3a80af0536797208144380691e2b376ffc1d1">MS::kSuccess</a>) <span class="keywordflow">continue</span>;</div>
<div class="line"></div>
<div class="line">                    wMatrix = fnTargetWorldMatrixData.<a class="code" href="./class_m_matrix.html#a527b102f4eb0951cf4f391f828d3ca34">matrix</a>(&amp;stat);</div>
<div class="line">                }</div>
<div class="line"> </div>
<div class="line">                {</div>
<div class="line"> <span class="comment">// We don't support in this simple example offsets</span></div>
<div class="line"> <a class="code" href="./class_m_profiling_scope.html">MProfilingScope</a> profilingScopeDestination(_profilerCategory, MProfiler::kColorD_L1, <span class="stringliteral">"Compute and write TR"</span>);</div>
<div class="line"></div>
<div class="line"> <a class="code" href="./class_m_matrix.html">MMatrix</a> currLocalMatrix = wMatrix * piMatrix;</div>
<div class="line"> <a name="_a40"></a><a class="code" href="./class_m_transformation_matrix.html">MTransformationMatrix</a> transformer(currLocalMatrix);</div>
<div class="line"> <a name="_a41"></a><a class="code" href="./class_m_vector.html">MVector</a> translate = transformer.getTranslation(<a name="a42"></a><a class="code" href="./class_m_space.html#ab11a1dda34491acff014ddfc9e6bafb8adafa274206df602835f0f22ae887e126">MSpace::kTransform</a>, &amp;stat);</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (stat != <a class="code" href="./class_m_status.html#a02ab596f4febca68da503aaf8dde3a80af0536797208144380691e2b376ffc1d1">MS::kSuccess</a>) <span class="keywordflow">continue</span>;</div>
<div class="line"></div>
<div class="line"> <span class="keywordtype">double</span> rotateVals[3];</div>
<div class="line"> <a class="code" href="./class_m_transformation_matrix.html#af3d74c777e523f2725cdf87c15a4b5bc">MTransformationMatrix::RotationOrder</a> ro = <a name="a43"></a><a class="code" href="./class_m_transformation_matrix.html#af3d74c777e523f2725cdf87c15a4b5bcacfa82ee0eaf4075f3cda4152dd020d99">MTransformationMatrix::kXYZ</a>;</div>
<div class="line">                    stat = transformer.getRotation(rotateVals, ro);</div>
<div class="line"> <span class="keywordflow">if</span> (stat != <a class="code" href="./class_m_status.html#a02ab596f4febca68da503aaf8dde3a80af0536797208144380691e2b376ffc1d1">MS::kSuccess</a>) <span class="keywordflow">continue</span>;</div>
<div class="line"></div>
<div class="line"> <span class="comment">// Put the computed data back to data block. We'll set the </span></div>
<div class="line"> <span class="comment">// translate and rotate plugs directly since these will affect</span></div>
<div class="line"> <span class="comment">// the world space matrix (which we can't set directly).</span></div>
<div class="line"> <a name="_a44"></a><a class="code" href="./class_m_data_block.html">MDataBlock</a> currDataBlock = currEvalNode.datablock(&amp;stat);</div>
<div class="line"> <span class="keywordflow">if</span> (stat != <a class="code" href="./class_m_status.html#a02ab596f4febca68da503aaf8dde3a80af0536797208144380691e2b376ffc1d1">MS::kSuccess</a>) <span class="keywordflow">continue</span>;</div>
<div class="line"></div>
<div class="line"> <a class="code" href="./class_m_plug.html">MPlug</a> tPlug(currObject, <a name="a45"></a><a class="code" href="./class_m_px_transform.html#a552fb7f80b36a9e0b0c500d00153409b">MPxTransform::translate</a>);</div>
<div class="line"> <a class="code" href="./class_m_data_handle.html">MDataHandle</a> currTranslateHandle = currDataBlock.<a name="a46"></a><a class="code" href="./class_m_data_block.html#a5e4082d6ab961bee4ec0281676bb4834">outputValue</a>(tPlug);</div>
<div class="line">                    currTranslateHandle.<a name="a47"></a><a class="code" href="./class_m_data_handle.html#ae204e3f02340f8714425a949a2195dbe">set3Double</a>(translate.<a name="a48"></a><a class="code" href="./class_m_vector.html#af88b946fb90d5f08b5fb740c70e98c10">x</a>, translate.<a name="a49"></a><a class="code" href="./class_m_vector.html#ab927965981178aa1fba979a37168db2a">y</a>, translate.<a name="a50"></a><a class="code" href="./class_m_vector.html#ab3e6ed577a7c669c19de1f9c1b46c872">z</a>);</div>
<div class="line">                    currTranslateHandle.<a name="a51"></a><a class="code" href="./class_m_data_handle.html#a7bdd61b8405188bb547fdba3fddace91">setClean</a>();</div>
<div class="line"></div>
<div class="line"> <a class="code" href="./class_m_plug.html">MPlug</a> rPlug(currObject, <a name="a52"></a><a class="code" href="./class_m_px_transform.html#a929db3d0bef90b2cfb29a1a6c4bff827">MPxTransform::rotate</a>);</div>
<div class="line"> <a class="code" href="./class_m_data_handle.html">MDataHandle</a> currRotateHandle = currDataBlock.<a class="code" href="./class_m_data_block.html#a5e4082d6ab961bee4ec0281676bb4834">outputValue</a>(rPlug);</div>
<div class="line">                    currRotateHandle.<a class="code" href="./class_m_data_handle.html#ae204e3f02340f8714425a949a2195dbe">set3Double</a>(rotateVals[0], rotateVals[1], rotateVals[2]);</div>
<div class="line">                    currRotateHandle.<a class="code" href="./class_m_data_handle.html#a7bdd61b8405188bb547fdba3fddace91">setClean</a>();</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// We can't set the world matrix directly, so put</span></div>
<div class="line"> <span class="comment">// the computed data back onto the data block by</span></div>
<div class="line"> <span class="comment">// manually setting the translate and rotate plugs.</span></div>
<div class="line"> <span class="comment">// We do this to make sure the transform knows the values</span></div>
<div class="line"> <span class="comment">// have been computed and updated properly, and so won't</span></div>
<div class="line"> <span class="comment">// have to trigger an evaluation with the constraints</span></div>
<div class="line">                    tPlug.setValue(currTranslateHandle);</div>
<div class="line">                    rPlug.setValue(currRotateHandle);</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">                {</div>
<div class="line"> <span class="comment">// Call evaluation on the current node to compute what remains to be </span></div>
<div class="line"> <span class="comment">// computed and notify renderer. In this particular case we have written </span></div>
<div class="line"> <span class="comment">// TR values to transform and will let default code recompute and cache </span></div>
<div class="line"> <span class="comment">// world matrix. Many non-drawable nodes will not require this call, </span></div>
<div class="line"> <span class="comment">// e.g. the two constraints that we completely ignored.</span></div>
<div class="line"> <a class="code" href="./class_m_profiling_scope.html">MProfilingScope</a> profilingScopeUpdate(_profilerCategory, MProfiler::kColorD_L1, <span class="stringliteral">"Finalize evaluation and render update"</span>);</div>
<div class="line">                    cluster-&gt;<a name="a53"></a><a class="code" href="./class_m_custom_evaluator_cluster_node.html#a8b7dfa5083f66d442a0ca339c733ea83">evaluateNode</a>(currEvalNode, &amp;stat);</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <span class="comment">// We failed to evaluate, use native compute</span></div>
<div class="line"> <span class="keywordflow">if</span>(stat != <a class="code" href="./class_m_status.html#a02ab596f4febca68da503aaf8dde3a80af0536797208144380691e2b376ffc1d1">MS::kSuccess</a>)</div>
<div class="line">    {</div>
<div class="line"> <a class="code" href="./class_m_profiling_scope.html">MProfilingScope</a> profilingScopeFallback(_profilerCategory, MProfiler::kColorD_L2, <span class="stringliteral">"Fall back to native"</span>);</div>
<div class="line">        cluster-&gt;<a name="a54"></a><a class="code" href="./class_m_custom_evaluator_cluster_node.html#ad188df5aadbf5bdbc691f3d82e2e371d">evaluate</a>(&amp;stat);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> constraintEvaluator::clusterTerminate(<span class="keyword">const</span> <a class="code" href="./class_m_custom_evaluator_cluster_node.html">MCustomEvaluatorClusterNode</a>* cluster)</div>
<div class="line">{</div>
<div class="line"> <span class="comment">// Clear this map when topology gets invalidated</span></div>
<div class="line">    reset();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span>* constraintEvaluator::creator()</div>
<div class="line">{</div>
<div class="line">    constraintEvaluator* newEval = <span class="keyword">new</span> constraintEvaluator();</div>
<div class="line">    newEval-&gt;reset();</div>
<div class="line"> <span class="keywordflow">return</span> ((<span class="keywordtype">void</span>*) newEval);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* constraintEvaluator::evaluatorName()</div>
<div class="line">{</div>
<div class="line"> <span class="keywordflow">return</span> <span class="stringliteral">"ConstraintEvaluator"</span>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">constraintEvaluator::~constraintEvaluator()</div>
<div class="line">{</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// The following routines are used to register/unregister</span></div>
<div class="line"><span class="comment">// the evaluator we are creating within Maya</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment"></span><a class="code" href="./class_m_status.html">MStatus</a> initializePlugin( <a class="code" href="./class_m_object.html">MObject</a> obj )</div>
<div class="line">{</div>
<div class="line"> <a class="code" href="./class_m_status.html">MStatus</a>   status;</div>
<div class="line"> <a name="_a55"></a><a class="code" href="./class_m_fn_plugin.html">MFnPlugin</a> plugin( obj, PLUGIN_COMPANY, <span class="stringliteral">"3.0"</span>, <span class="stringliteral">"Any"</span>);</div>
<div class="line"></div>
<div class="line">    status = plugin.registerEvaluator(<span class="stringliteral">"ConstraintEvaluator"</span>, 42, constraintEvaluator::creator);</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">if</span> (!status) </div>
<div class="line">    {</div>
<div class="line">        status.<a name="a56"></a><a class="code" href="./class_m_status.html#a1f01a4748fea4d8bcced082df83f804d">perror</a>(<span class="stringliteral">"registerEvaluator"</span>);</div>
<div class="line"> <span class="keywordflow">return</span> status;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">return</span> status;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="./class_m_status.html">MStatus</a> uninitializePlugin( <a class="code" href="./class_m_object.html">MObject</a> obj)</div>
<div class="line">{</div>
<div class="line"> <a class="code" href="./class_m_status.html">MStatus</a>   status;</div>
<div class="line"> <a class="code" href="./class_m_fn_plugin.html">MFnPlugin</a> plugin( obj );</div>
<div class="line"></div>
<div class="line">    status =  plugin.deregisterEvaluator( <span class="stringliteral">"ConstraintEvaluator"</span> );</div>
<div class="line"> <span class="keywordflow">if</span> (!status)</div>
<div class="line">    {</div>
<div class="line">        status.<a class="code" href="./class_m_status.html#a1f01a4748fea4d8bcced082df83f804d">perror</a>(<span class="stringliteral">"deRegisterEvaluator"</span>);</div>
<div class="line"> <span class="keywordflow">return</span> status;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"> <span class="keywordflow">return</span> status;</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<div class="footer-block"><a class="comments-anchor" href="../html/ac.cmtdialog.htm" target="_blank"><span class="comments-link">Please send us your comment about this page</span></a></div><br/></div>
</link></link></link></link></div></body>
</html>
